<html lang="en">
<head>
<title>Here-Documents - Autoconf</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name="description" content="Autoconf">
<meta name="generator" content="makeinfo 4.13">
<link title="Top" rel="start" href="index.html#Top">
<link rel="up" href="Portable-Shell.html#Portable-Shell" title="Portable Shell">
<link rel="prev" href="Invoking-the-Shell.html#Invoking-the-Shell" title="Invoking the Shell">
<link rel="next" href="File-Descriptors.html#File-Descriptors" title="File Descriptors">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home" title="Texinfo Homepage">
<!--
This manual (24 April 2012) is for GNU Autoconf
(version 2.69),
a package for creating scripts to configure source code packages using
templates and an M4 macro package.

Copyright (C) 1992-1996, 1998-2012 Free Software Foundation,
Inc.

     Permission is granted to copy, distribute and/or modify this
     document under the terms of the GNU Free Documentation License,
     Version 1.3 or any later version published by the Free Software
     Foundation; with no Invariant Sections, no Front-Cover texts, and
     no Back-Cover Texts.  A copy of the license is included in the
     section entitled ``GNU Free Documentation License.''
   -->
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
  span.sc    { font-variant:small-caps }
  span.roman { font-family:serif; font-weight:normal; } 
  span.sansserif { font-family:sans-serif; font-weight:normal; } 
--></style>
</head>
<body>
<div class="node">
<a name="Here-Documents"></a>
<a name="Here_002dDocuments"></a>
<p>
Next:&nbsp;<a rel="next" accesskey="n" href="File-Descriptors.html#File-Descriptors">File Descriptors</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="Invoking-the-Shell.html#Invoking-the-Shell">Invoking the Shell</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="Portable-Shell.html#Portable-Shell">Portable Shell</a>
<hr>
</div>

<h3 class="section">11.3 Here-Documents</h3>

<p><a name="index-Here_002ddocuments-1695"></a><a name="index-Shell-here_002ddocuments-1696"></a>
Don't rely on &lsquo;<samp><span class="samp">\</span></samp>&rsquo; being preserved just because it has no special
meaning together with the next symbol.  In the native <samp><span class="command">sh</span></samp>
on OpenBSD 2.7 &lsquo;<samp><span class="samp">\"</span></samp>&rsquo; expands to &lsquo;<samp><span class="samp">"</span></samp>&rsquo; in here-documents with
unquoted delimiter.  As a general rule, if &lsquo;<samp><span class="samp">\\</span></samp>&rsquo; expands to &lsquo;<samp><span class="samp">\</span></samp>&rsquo;
use &lsquo;<samp><span class="samp">\\</span></samp>&rsquo; to get &lsquo;<samp><span class="samp">\</span></samp>&rsquo;.

   <p>With OpenBSD 2.7's <samp><span class="command">sh</span></samp>

<pre class="example">     $ <kbd>cat &lt;&lt;EOF
     &gt; \" \\
     &gt; EOF</kbd>
     " \
</pre>
   <p class="noindent">and with Bash:

<pre class="example">     bash-2.04$ <kbd>cat &lt;&lt;EOF
     &gt; \" \\
     &gt; EOF</kbd>
     \" \
</pre>
   <p>Using command substitutions in a here-document that is fed to a shell
function is not portable.  For example, with Solaris 10 <samp><span class="command">/bin/sh</span></samp>:

<pre class="example">     $ <kbd>kitty () { cat; }</kbd>
     $ <kbd>kitty &lt;&lt;EOF
     &gt; `echo ok`
     &gt; EOF</kbd>
     /tmp/sh199886: cannot open
     $ <kbd>echo $?</kbd>
     1
</pre>
   <p>Some shells mishandle large here-documents: for example,
Solaris 10 <samp><span class="command">dtksh</span></samp> and the UnixWare 7.1.1 Posix shell, which are
derived from Korn shell version M-12/28/93d, mishandle braced variable
expansion that crosses a 1024- or 4096-byte buffer boundary
within a here-document.  Only the part of the variable name after the boundary
is used.  For example, <code>${variable}</code> could be replaced by the expansion
of <code>${ble}</code>.  If the end of the variable name is aligned with the block
boundary, the shell reports an error, as if you used <code>${}</code>. 
Instead of <code>${variable-default}</code>, the shell may expand
<code>${riable-default}</code>, or even <code>${fault}</code>.  This bug can often
be worked around by omitting the braces: <code>$variable</code>.  The bug was
fixed in
&lsquo;<samp><span class="samp">ksh93g</span></samp>&rsquo; (1998-04-30) but as of 2006 many operating systems were
still shipping older versions with the bug.

   <p>Empty here-documents are not portable either; with the following code,
<samp><span class="command">zsh</span></samp> up to at least version 4.3.10 creates a file with a single
newline, whereas other shells create an empty file:

<pre class="example">     cat &gt;file &lt;&lt;EOF
     EOF
</pre>
   <p>Many shells (including the Bourne shell) implement here-documents
inefficiently.  In particular, some shells can be extremely inefficient when
a single statement contains many here-documents.  For instance if your
<samp><span class="file">configure.ac</span></samp> includes something like:

<pre class="example">     if &lt;cross_compiling&gt;; then
       assume this and that
     else
       check this
       check that
       check something else
       ...
       on and on forever
       ...
     fi
</pre>
   <p>A shell parses the whole <code>if</code>/<code>fi</code> construct, creating
temporary files for each here-document in it.  Some shells create links
for such here-documents on every <code>fork</code>, so that the clean-up code
they had installed correctly removes them.  It is creating the links
that can take the shell forever.

   <p>Moving the tests out of the <code>if</code>/<code>fi</code>, or creating multiple
<code>if</code>/<code>fi</code> constructs, would improve the performance
significantly.  Anyway, this kind of construct is not exactly the
typical use of Autoconf.  In fact, it's even not recommended, because M4
macros can't look into shell conditionals, so we may fail to expand a
macro when it was expanded before in a conditional path, and the
condition turned out to be false at runtime, and we end up not
executing the macro at all.

   <p>Be careful with the use of &lsquo;<samp><span class="samp">&lt;&lt;-</span></samp>&rsquo; to unindent here-documents.  The
behavior is only portable for stripping leading &lt;TAB&gt;s, and things
can silently break if an overzealous editor converts to using leading
spaces (not all shells are nice enough to warn about unterminated
here-documents).

<pre class="example">     $ <kbd>printf 'cat &lt;&lt;-x\n\t1\n\t 2\n\tx\n' | bash &amp;&amp; echo done</kbd>
     1
      2
     done
     $ <kbd>printf 'cat &lt;&lt;-x\n 1\n  2\n x\n' | bash-3.2 &amp;&amp; echo done</kbd>
      1
       2
      x
     done
</pre>
   </body></html>

