<html lang="en">
<head>
<title>Balancing Parentheses - Autoconf</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name="description" content="Autoconf">
<meta name="generator" content="makeinfo 4.13">
<link title="Top" rel="start" href="index.html#Top">
<link rel="up" href="M4-Quotation.html#M4-Quotation" title="M4 Quotation">
<link rel="prev" href="Quadrigraphs.html#Quadrigraphs" title="Quadrigraphs">
<link rel="next" href="Quotation-Rule-Of-Thumb.html#Quotation-Rule-Of-Thumb" title="Quotation Rule Of Thumb">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home" title="Texinfo Homepage">
<!--
This manual (24 April 2012) is for GNU Autoconf
(version 2.69),
a package for creating scripts to configure source code packages using
templates and an M4 macro package.

Copyright (C) 1992-1996, 1998-2012 Free Software Foundation,
Inc.

     Permission is granted to copy, distribute and/or modify this
     document under the terms of the GNU Free Documentation License,
     Version 1.3 or any later version published by the Free Software
     Foundation; with no Invariant Sections, no Front-Cover texts, and
     no Back-Cover Texts.  A copy of the license is included in the
     section entitled ``GNU Free Documentation License.''
   -->
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
  span.sc    { font-variant:small-caps }
  span.roman { font-family:serif; font-weight:normal; } 
  span.sansserif { font-family:sans-serif; font-weight:normal; } 
--></style>
</head>
<body>
<div class="node">
<a name="Balancing-Parentheses"></a>
<p>
Next:&nbsp;<a rel="next" accesskey="n" href="Quotation-Rule-Of-Thumb.html#Quotation-Rule-Of-Thumb">Quotation Rule Of Thumb</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="Quadrigraphs.html#Quadrigraphs">Quadrigraphs</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="M4-Quotation.html#M4-Quotation">M4 Quotation</a>
<hr>
</div>

<h4 class="subsection">8.1.7 Dealing with unbalanced parentheses</h4>

<p><a name="index-balancing-parentheses-1246"></a><a name="index-parentheses_002c-balancing-1247"></a><a name="index-unbalanced-parentheses_002c-managing-1248"></a>
One of the pitfalls of portable shell programming is that <samp><span class="command">case</span></samp>
statements require unbalanced parentheses (see <a href="case.html#case">Limitations of Shell Builtins</a>).  With syntax highlighting
editors, the presence of unbalanced &lsquo;<samp><span class="samp">)</span></samp>&rsquo; can interfere with editors
that perform syntax highlighting of macro contents based on finding the
matching &lsquo;<samp><span class="samp">(</span></samp>&rsquo;.  Another concern is how much editing must be done
when transferring code snippets between shell scripts and macro
definitions.  But most importantly, the presence of unbalanced
parentheses can introduce expansion bugs.

   <p>For an example, here is an underquoted attempt to use the macro
<code>my_case</code>, which happens to expand to a portable <samp><span class="command">case</span></samp>
statement:

<pre class="example">     AC_DEFUN([my_case],
     [case $file_name in
       *.c) echo "C source code";;
     esac])
     AS_IF(:, my_case)
</pre>
   <p class="noindent">In the above example, the <code>AS_IF</code> call underquotes its arguments. 
As a result, the unbalanced &lsquo;<samp><span class="samp">)</span></samp>&rsquo; generated by the premature
expansion of <code>my_case</code> results in expanding <code>AS_IF</code> with a
truncated parameter, and the expansion is syntactically invalid:

<pre class="example">     if :; then
       case $file_name in
       *.c
     fi echo "C source code";;
     esac)
</pre>
   <p>If nothing else, this should emphasize the importance of the quoting
arguments to macro calls.  On the other hand, there are several
variations for defining <code>my_case</code> to be more robust, even when used
without proper quoting, each with some benefits and some drawbacks.

     <ul>
<li>Creative literal shell comment
     <pre class="example">          AC_DEFUN([my_case],
          [case $file_name in #(
            *.c) echo "C source code";;
          esac])
</pre>
     <p class="noindent">This version provides balanced parentheses to several editors, and can
be copied and pasted into a terminal as is.  Unfortunately, it is still
unbalanced as an Autoconf argument, since &lsquo;<samp><span class="samp">#(</span></samp>&rsquo; is an M4 comment
that masks the normal properties of &lsquo;<samp><span class="samp">(</span></samp>&rsquo;.

     <li>Quadrigraph shell comment
     <pre class="example">          AC_DEFUN([my_case],
          [case $file_name in @%:@(
            *.c) echo "C source code";;
          esac])
</pre>
     <p class="noindent">This version provides balanced parentheses to even more editors, and can
be used as a balanced Autoconf argument.  Unfortunately, it requires
some editing before it can be copied and pasted into a terminal, and the
use of the quadrigraph &lsquo;<samp><span class="samp">@%:@</span></samp>&rsquo; for &lsquo;<samp><span class="samp">#</span></samp>&rsquo; reduces readability.

     <li>Quoting just the parenthesis
     <pre class="example">          AC_DEFUN([my_case],
          [case $file_name in
            *.c[)] echo "C source code";;
          esac])
</pre>
     <p class="noindent">This version quotes the &lsquo;<samp><span class="samp">)</span></samp>&rsquo;, so that it can be used as a balanced
Autoconf argument.  As written, this is not balanced to an editor, but
it can be coupled with &lsquo;<samp><span class="samp">[#(]</span></samp>&rsquo; to meet that need, too.  However, it
still requires some edits before it can be copied and pasted into a
terminal.

     <li>Double-quoting the entire statement
     <pre class="example">          AC_DEFUN([my_case],
          [[case $file_name in #(
            *.c) echo "C source code";;
          esac]])
</pre>
     <p class="noindent">Since the entire macro is double-quoted, there is no problem with using
this as an Autoconf argument; and since the double-quoting is over the
entire statement, this code can be easily copied and pasted into a
terminal.  However, the double quoting prevents the expansion of any
macros inside the case statement, which may cause its own set of
problems.

     <li>Using <code>AS_CASE</code>
     <pre class="example">          AC_DEFUN([my_case],
          [AS_CASE([$file_name],
            [*.c], [echo "C source code"])])
</pre>
     <p class="noindent">This version avoids the balancing issue altogether, by relying on
<code>AS_CASE</code> (see <a href="Common-Shell-Constructs.html#Common-Shell-Constructs">Common Shell Constructs</a>); it also allows for the
expansion of <code>AC_REQUIRE</code> to occur prior to the entire case
statement, rather than within a branch of the case statement that might
not be taken.  However, the abstraction comes with a penalty that it is
no longer a quick copy, paste, and edit to get back to shell code. 
</ul>

   </body></html>

