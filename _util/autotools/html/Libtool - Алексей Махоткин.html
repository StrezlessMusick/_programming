<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!-->
<html class=" js video no-maskImage placeholder" lang="en"><!--<![endif]--><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8"><script src="Libtool%20-%20%D0%90%D0%BB%D0%B5%D0%BA%D1%81%D0%B5%D0%B9%20%D0%9C%D0%B0%D1%85%D0%BE%D1%82%D0%BA%D0%B8%D0%BD_files/jXHR.js" type="text/javascript"></script><script async="" src="Libtool%20-%20%D0%90%D0%BB%D0%B5%D0%BA%D1%81%D0%B5%D0%B9%20%D0%9C%D0%B0%D1%85%D0%BE%D1%82%D0%BA%D0%B8%D0%BD_files/cbgapi.loaded_1"></script><script async="" src="Libtool%20-%20%D0%90%D0%BB%D0%B5%D0%BA%D1%81%D0%B5%D0%B9%20%D0%9C%D0%B0%D1%85%D0%BE%D1%82%D0%BA%D0%B8%D0%BD_files/cbgapi.loaded_0"></script><script gapi_processed="true" src="Libtool%20-%20%D0%90%D0%BB%D0%B5%D0%BA%D1%81%D0%B5%D0%B9%20%D0%9C%D0%B0%D1%85%D0%BE%D1%82%D0%BA%D0%B8%D0%BD_files/plusone.js" async="" type="text/javascript"></script>
  <meta charset="utf-8">
  <title>Libtool - Алексей Махоткин</title>
  <meta name="author" content="Алексей Махоткин">

  
  <meta name="description" content="Libtool Mar 8th, 2007 Введение В двух предыдущих статьях из цикла, посвященного GNU Autotools, мы
обсуждали два “основных” пакета: …">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width,minimum-scale=1,maximum-scale=1">

  
  <link rel="canonical" href="http://squadette.ru/autotools-ru/article3.html">
  <link href="http://squadette.ru/favicon.png" rel="icon">
  <link href="Libtool%20-%20%D0%90%D0%BB%D0%B5%D0%BA%D1%81%D0%B5%D0%B9%20%D0%9C%D0%B0%D1%85%D0%BE%D1%82%D0%BA%D0%B8%D0%BD_files/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="Libtool%20-%20%D0%90%D0%BB%D0%B5%D0%BA%D1%81%D0%B5%D0%B9%20%D0%9C%D0%B0%D1%85%D0%BE%D1%82%D0%BA%D0%B8%D0%BD_files/all.js" id="facebook-jssdk"></script><script src="Libtool%20-%20%D0%90%D0%BB%D0%B5%D0%BA%D1%81%D0%B5%D0%B9%20%D0%9C%D0%B0%D1%85%D0%BE%D1%82%D0%BA%D0%B8%D0%BD_files/watch.js" async="" type="text/javascript"></script><script src="Libtool%20-%20%D0%90%D0%BB%D0%B5%D0%BA%D1%81%D0%B5%D0%B9%20%D0%9C%D0%B0%D1%85%D0%BE%D1%82%D0%BA%D0%B8%D0%BD_files/widgets.js" id="twitter-wjs"></script><script src="Libtool%20-%20%D0%90%D0%BB%D0%B5%D0%BA%D1%81%D0%B5%D0%B9%20%D0%9C%D0%B0%D1%85%D0%BE%D1%82%D0%BA%D0%B8%D0%BD_files/ga.js" async="" type="text/javascript"></script><script src="Libtool%20-%20%D0%90%D0%BB%D0%B5%D0%BA%D1%81%D0%B5%D0%B9%20%D0%9C%D0%B0%D1%85%D0%BE%D1%82%D0%BA%D0%B8%D0%BD_files/modernizr-2.js"></script>
  <script src="Libtool%20-%20%D0%90%D0%BB%D0%B5%D0%BA%D1%81%D0%B5%D0%B9%20%D0%9C%D0%B0%D1%85%D0%BE%D1%82%D0%BA%D0%B8%D0%BD_files/ender.js"></script>
  <script src="Libtool%20-%20%D0%90%D0%BB%D0%B5%D0%BA%D1%81%D0%B5%D0%B9%20%D0%9C%D0%B0%D1%85%D0%BE%D1%82%D0%BA%D0%B8%D0%BD_files/octopress.js" type="text/javascript"></script>
  <link href="http://squadette.ru/atom.xml" rel="alternate" title="Алексей Махоткин" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="Libtool%20-%20%D0%90%D0%BB%D0%B5%D0%BA%D1%81%D0%B5%D0%B9%20%D0%9C%D0%B0%D1%85%D0%BE%D1%82%D0%BA%D0%B8%D0%BD_files/css_002.css" rel="stylesheet" type="text/css">
<link href="Libtool%20-%20%D0%90%D0%BB%D0%B5%D0%BA%D1%81%D0%B5%D0%B9%20%D0%9C%D0%B0%D1%85%D0%BE%D1%82%D0%BA%D0%B8%D0%BD_files/css.css" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-546988-5']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>



<script type="text/javascript" src="Libtool%20-%20%D0%90%D0%BB%D0%B5%D0%BA%D1%81%D0%B5%D0%B9%20%D0%9C%D0%B0%D1%85%D0%BE%D1%82%D0%BA%D0%B8%D0%BD_files/openapi.js"></script>

<script type="text/javascript">
  VK.init({apiId: 3427377, onlyWidgets: true});
</script>

<script src="Libtool%20-%20%D0%90%D0%BB%D0%B5%D0%BA%D1%81%D0%B5%D0%B9%20%D0%9C%D0%B0%D1%85%D0%BE%D1%82%D0%BA%D0%B8%D0%BD_files/embed.js" async="" type="text/javascript"></script><script src="Libtool%20-%20%D0%90%D0%BB%D0%B5%D0%BA%D1%81%D0%B5%D0%B9%20%D0%9C%D0%B0%D1%85%D0%BE%D1%82%D0%BA%D0%B8%D0%BD_files/widgets.js" async="" type="text/javascript"></script><style type="text/css">.fb_hidden{position:absolute;top:-10000px;z-index:10001}.fb_invisible{display:none}.fb_reset{background:none;border:0;border-spacing:0;color:#000;cursor:auto;direction:ltr;font-family:"lucida grande", tahoma, verdana, arial, sans-serif;font-size:11px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:1;margin:0;overflow:visible;padding:0;text-align:left;text-decoration:none;text-indent:0;text-shadow:none;text-transform:none;visibility:visible;white-space:normal;word-spacing:normal}.fb_reset>div{overflow:hidden}.fb_link img{border:none}
.fb_dialog{background:rgba(82, 82, 82, .7);position:absolute;top:-10000px;z-index:10001}.fb_reset .fb_dialog_legacy{overflow:visible}.fb_dialog_advanced{padding:10px;-moz-border-radius:8px;-webkit-border-radius:8px;border-radius:8px}.fb_dialog_content{background:#fff;color:#333}.fb_dialog_close_icon{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 0 transparent;_background-image:url(http://static.ak.fbcdn.net/rsrc.php/v2/yL/r/s816eWC-2sl.gif);cursor:pointer;display:block;height:15px;position:absolute;right:18px;top:17px;width:15px}.fb_dialog_mobile .fb_dialog_close_icon{top:5px;left:5px;right:auto}.fb_dialog_padding{background-color:transparent;position:absolute;width:1px;z-index:-1}.fb_dialog_close_icon:hover{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 -15px transparent;_background-image:url(http://static.ak.fbcdn.net/rsrc.php/v2/yL/r/s816eWC-2sl.gif)}.fb_dialog_close_icon:active{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 -30px transparent;_background-image:url(http://static.ak.fbcdn.net/rsrc.php/v2/yL/r/s816eWC-2sl.gif)}.fb_dialog_loader{background-color:#f2f2f2;border:1px solid #606060;font-size:24px;padding:20px}.fb_dialog_top_left,.fb_dialog_top_right,.fb_dialog_bottom_left,.fb_dialog_bottom_right{height:10px;width:10px;overflow:hidden;position:absolute}.fb_dialog_top_left{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/ye/r/8YeTNIlTZjm.png) no-repeat 0 0;left:-10px;top:-10px}.fb_dialog_top_right{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/ye/r/8YeTNIlTZjm.png) no-repeat 0 -10px;right:-10px;top:-10px}.fb_dialog_bottom_left{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/ye/r/8YeTNIlTZjm.png) no-repeat 0 -20px;bottom:-10px;left:-10px}.fb_dialog_bottom_right{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/ye/r/8YeTNIlTZjm.png) no-repeat 0 -30px;right:-10px;bottom:-10px}.fb_dialog_vert_left,.fb_dialog_vert_right,.fb_dialog_horiz_top,.fb_dialog_horiz_bottom{position:absolute;background:#525252;filter:alpha(opacity=70);opacity:.7}.fb_dialog_vert_left,.fb_dialog_vert_right{width:10px;height:100%}.fb_dialog_vert_left{margin-left:-10px}.fb_dialog_vert_right{right:0;margin-right:-10px}.fb_dialog_horiz_top,.fb_dialog_horiz_bottom{width:100%;height:10px}.fb_dialog_horiz_top{margin-top:-10px}.fb_dialog_horiz_bottom{bottom:0;margin-bottom:-10px}.fb_dialog_iframe{line-height:0}.fb_dialog_content .dialog_title{background:#6d84b4;border:1px solid #3b5998;color:#fff;font-size:14px;font-weight:bold;margin:0}.fb_dialog_content .dialog_title>span{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/yd/r/Cou7n-nqK52.gif) no-repeat 5px 50%;float:left;padding:5px 0 7px 26px}body.fb_hidden{-webkit-transform:none;height:100%;margin:0;overflow:visible;position:absolute;top:-10000px;left:0;width:100%}.fb_dialog.fb_dialog_mobile.loading{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/ya/r/3rhSv5V8j3o.gif) white no-repeat 50% 50%;min-height:100%;min-width:100%;overflow:hidden;position:absolute;top:0;z-index:10001}.fb_dialog.fb_dialog_mobile.loading.centered{max-height:590px;min-height:590px;max-width:500px;min-width:500px}#fb-root #fb_dialog_ipad_overlay{background:rgba(0, 0, 0, .45);position:absolute;left:0;top:0;width:100%;min-height:100%;z-index:10000}#fb-root #fb_dialog_ipad_overlay.hidden{display:none}.fb_dialog.fb_dialog_mobile.loading iframe{visibility:hidden}.fb_dialog_content .dialog_header{-webkit-box-shadow:white 0 1px 1px -1px inset;background:-webkit-gradient(linear, 0% 0%, 0% 100%, from(#738ABA), to(#2C4987));border-bottom:1px solid;border-color:#1d4088;color:#fff;font:14px Helvetica, sans-serif;font-weight:bold;text-overflow:ellipsis;text-shadow:rgba(0, 30, 84, .296875) 0 -1px 0;vertical-align:middle;white-space:nowrap}.fb_dialog_content .dialog_header table{-webkit-font-smoothing:subpixel-antialiased;height:43px;width:100%}.fb_dialog_content .dialog_header td.header_left{font-size:12px;padding-left:5px;vertical-align:middle;width:60px}.fb_dialog_content .dialog_header td.header_right{font-size:12px;padding-right:5px;vertical-align:middle;width:60px}.fb_dialog_content .touchable_button{background:-webkit-gradient(linear, 0% 0%, 0% 100%, from(#4966A6), color-stop(.5, #355492), to(#2A4887));border:1px solid #29447e;-webkit-background-clip:padding-box;-webkit-border-radius:3px;-webkit-box-shadow:rgba(0, 0, 0, .117188) 0 1px 1px inset, rgba(255, 255, 255, .167969) 0 1px 0;display:inline-block;margin-top:3px;max-width:85px;line-height:18px;padding:4px 12px;position:relative}.fb_dialog_content .dialog_header .touchable_button input{border:none;background:none;color:#fff;font:12px Helvetica, sans-serif;font-weight:bold;margin:2px -12px;padding:2px 6px 3px 6px;text-shadow:rgba(0, 30, 84, .296875) 0 -1px 0}.fb_dialog_content .dialog_header .header_center{color:#fff;font-size:16px;font-weight:bold;line-height:18px;text-align:center;vertical-align:middle}.fb_dialog_content .dialog_content{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/y9/r/jKEcVPZFk-2.gif) no-repeat 50% 50%;border:1px solid #555;border-bottom:0;border-top:0;height:150px}.fb_dialog_content .dialog_footer{background:#f2f2f2;border:1px solid #555;border-top-color:#ccc;height:40px}#fb_dialog_loader_close{float:left}.fb_dialog.fb_dialog_mobile .fb_dialog_close_button{text-shadow:rgba(0, 30, 84, .296875) 0 -1px 0}.fb_dialog.fb_dialog_mobile .fb_dialog_close_icon{visibility:hidden}
.fb_iframe_widget{display:inline-block;position:relative}.fb_iframe_widget span{display:inline-block;position:relative;text-align:justify}.fb_iframe_widget iframe{position:absolute}.fb_iframe_widget_lift{z-index:1}.fb_hide_iframes iframe{position:relative;left:-10000px}.fb_iframe_widget_loader{position:relative;display:inline-block}.fb_iframe_widget_fluid{display:inline}.fb_iframe_widget_fluid span{width:100%}.fb_iframe_widget_loader iframe{min-height:32px;z-index:2;zoom:1}.fb_iframe_widget_loader .FB_Loader{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/y9/r/jKEcVPZFk-2.gif) no-repeat;height:32px;width:32px;margin-left:-16px;position:absolute;left:50%;z-index:4}
.fbpluginrecommendationsbarleft,.fbpluginrecommendationsbarright{position:fixed !important;bottom:0;z-index:999}.fbpluginrecommendationsbarleft{left:10px}.fbpluginrecommendationsbarright{right:10px}</style><script charset="UTF-8" async="" src="Libtool%20-%20%D0%90%D0%BB%D0%B5%D0%BA%D1%81%D0%B5%D0%B9%20%D0%9C%D0%B0%D1%85%D0%BE%D1%82%D0%BA%D0%B8%D0%BD_files/alfie.js"></script></head>

<body data-twttr-rendered="true">
  <header role="banner"><hgroup>
	<a href="http://squadette.ru/"><img src="Libtool%20-%20%D0%90%D0%BB%D0%B5%D0%BA%D1%81%D0%B5%D0%B9%20%D0%9C%D0%B0%D1%85%D0%BE%D1%82%D0%BA%D0%B8%D0%BD_files/squadette-userpic.png" style="float: left; padding-right: 20px;" height="100" width="100"></a>
  <h1><a href="http://squadette.ru/">Алексей Махоткин</a></h1>
  
    <h2>домашняя страница</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="http://squadette.ru/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input name="q" value="site:squadette.ru" type="hidden">
    <input class="search" name="q" results="0" placeholder="Search" type="text">
  </fieldset><fieldset class="mobile-nav"><select><option value="">Navigate…</option><option value="http://squadette.ru/">» Blog</option><option value="http://squadette.ru/blog/archives">» Archives</option><option value="http://squadette.ru/about">» Обо мне</option><option value="http://squadette.ru/content/index.html">» Контент</option><option selected="selected" value="http://squadette.ru/atom.xml">» RSS</option></select></fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="http://squadette.ru/">Blog</a></li>
  <li><a href="http://squadette.ru/blog/archives">Archives</a></li>
  <li><a href="http://squadette.ru/about">Обо мне</a></li>
  <li><a href="http://squadette.ru/content/index.html">Контент</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article role="article">
  
  <header>
    <h1 class="entry-title">Libtool</h1>
    <p class="meta">








  


<time datetime="2007-03-08T21:00:00+01:00" pubdate="" data-updated="true">Mar 8<span>th</span>, 2007</time></p>
  </header>
  
  <h1>Введение</h1>




<p>В двух предыдущих статьях из цикла, посвященного GNU Autotools, мы
обсуждали два “основных” пакета: Automake и Autoconf.  В третьей,
заключительной статье цикла, мы кратко обсудим оставшихся два пакета:
Libtool и Shtool.


</p><h1>Libtool – разделяемые библиотеки</h1>

<p></p>


<p>Необходимость появления пакета Libtool стала очевидной после того, как
доказали свою жизнеспособность пакеты Autoconf и Automake.
Разработчики проекта GNU постоянно вставали перед проблемой создания
разделяемых библиотек (shared libraries) на различных платформах.

</p>


<p>К сожалению, практически каждый из производителей UNIX-совместимых
операционных систем изобретал свой собственный способ создания
разделяемых библиотек.  Особенности присутствовали практически везде&nbsp;—
при вызове компилятора, компоновщика, при установке библиотек, даже
при вызове отладчика.  Каждый отдельный автор той или иной библиотеки
практически не имел возможности поддержать все многообразие различных
вариантов, учесть все ошибки различных реализаций системных утилит,
реализовать всю функциональность, которая нужна пользователям.

</p>


<p>После того, как несколько существующих к тому времени пакетов были
признаны неудовлетворительными, началась работа над пакетом Libtool,
который и является на текущий момент самым функциональным.


</p><h2>Предварительные комментарии</h2>

<p></p>


<p>Для иллюстрации использования Libtool мы будем использовать первую
версию нашей многострадальной программы Hello, world.  Как вы помните,
в первой статье мы заранее разбили эту программу на два файла, в одном
из которых находится наша функция <tt>print_hello()</tt>.  Нашей
задачей будет превратить этот файл в полноценную разделяемую
библиотеку libhello.

</p>


<p>Вообще, Libtool способна работать сама по себе, в файлах Makefile,
созданных вручную.  Однако, в этой статье мы будем рассматривать
только совместную работу Automake и Libtool.  Подробности, как всегда,
можно найти в документации на пакет Libtool.

</p>


<p>Вообще, Libtool создает так называемые Libtool-библиотеки – это целый
набор файлов.  Главный файл, содержащий описание библиотеки, имеет
расширение <tt>.la</tt>.  Объектные файлы, используемые при компиляции, а также
результирующие статические и динамические библиотеки, помещаются в
подкаталог <tt>.libs/</tt>.  При установке Libtool автоматически обрабатывает
эти файлы, помещая их в нужные каталоги.

</p>


<p>Заметьте, что некоторые устаревшие операционные системы не
поддерживают динамических библиотек&nbsp;— Libtool автоматически будет
создавать при этом только статические библиотеки.


</p><h2>Простейшая Libtool-библиотека</h2>

<p></p>


<p>Для того, чтобы добавить поддержку Libtool в вашем проекте,
используется макрос <tt>AC_PROG_LIBTOOL</tt> в файле <tt>configure.in</tt>:

</p><pre>=== configure.in ===
AC_INIT([src/hello.c])
AM_INIT_AUTOMAKE([hello], [0.3])
AC_PROG_CC
AC_PROG_LIBTOOL

AM_CONFIG_HEADER(config.h)

AC_OUTPUT([Makefile src/Makefile])
=== configure.in ===
</pre>

<p></p>


<p>Этот макрос не входит в стандартную поставку Autoconf, поэтому его
нужно добавить в пакет с помощью программы <tt>aclocal</tt>.  Кроме того, для
поддержки Libtool требуется еще несколько файлов, которые можно
автоматически установить с помощью программы <tt>automake</tt>:

</p><pre>    $ aclocal
    $ autoconf
    $ automake -ac
</pre>

<p></p>


<p>В дистрибутив добавятся следующие файлы: <tt>config.guess</tt>, <tt>config.sub</tt>,
<tt>ltmain.sh</tt>, <tt>ltconfig</tt>.  В процессе работы скрипта configure будет создан
файл libtool, который и будет обеспечивать всю поддержку сборки.

</p>


<p>Для создания Libtool-библиотек используется основная переменная
Automake <tt>_LTLIBRARIES</tt>.  Для того, чтобы создать разделяемую
библиотеку libhello, напишем в <tt>src/Makefile.am</tt>:

</p><pre>=== src/Makefile.am ===
lib_LTLIBRARIES = libhello.la

libhello_la_SOURCES = hello.c hello.h
=== src/Makefile.am ===
</pre>

<p></p>


<p>Эта запись означает, что будет создана Libtool-библиотека, которая
называется <tt>libhello.la</tt> и компилируется из двух исходных файлов:
<tt>hello.c</tt> и <tt>hello.h</tt>.

</p>


<p>Выполним программы automake, autoconf, файлы шаблонов; затем выполним
скрипт <tt>./configure</tt>.  Теперь попробуем собрать библиотеку (несколько
строчек из выдачи программы make удалено для краткости):

</p><pre>    $ cd src/
    $ make libhello.la
        . . .
    gcc -DHAVE_CONFIG_H -I. -I. -I.. -g -O2 -c hello.c  -fPIC -DPIC -Wp,-MD,.deps/hello.TPlo -o .libs/hello.lo
        /bin/sh ../libtool --mode=link gcc  -g -O2   -o libhello.la -rpath /usr/local/lib  hello.lo
        gcc -shared  hello.lo  -lc  -Wl,-soname -Wl,libhello.so.0 -o .libs/libhello.so.0.0.0
        (cd .libs &amp;&amp; rm -f libhello.so.0 &amp;&amp; ln -s libhello.so.0.0.0 libhello.so.0)
        ar cru .libs/libhello.a  hello.o 
        ranlib .libs/libhello.a
        creating libhello.la
</pre>

<p></p>


<p>Заглянув в каталог <tt>.libs/</tt>, можно увидеть там как статическую
библиотеку c расширением <tt>.a</tt>, так и динамические библиотеки с
расширением <tt>.so</tt>, со всеми необходимыми символьными ссылками.


</p><h2>Сборка программ с Libtool-библиотеками</h2>

<p></p>


<p>Довольно часто ваш пакет состоит не только из разделяемой библиотеки,
но также и из набора программ, использующих эту библиотеку.  Libtool
автоматически обрабатывает этот распространенный случай.

</p>


<p>Давайте сделаем так, чтобы программа hello использовала разделяемую
библиотеку libhello:

</p><pre>=== src/Makefile.am ===
bin_PROGRAMS=hello

hello_SOURCES=main.c

hello_LIBADD = $(top_builddir)/src/libhello.la
=== src/Makefile.am ===
</pre>

<p></p>


<p>Переменная $(top_builddir) содержит каталог сборки верхнего уровня.
Есть еще похожая переменная $(top_srcdir), содержащая верхний уровень
каталога с исходными текстами.  Если вам нужно обратиться к
собираемому объекту, используйте первую из них; в противном случае,
чтобы обратиться к объекту, существующему в дистрибутиве (например,
файлу данных или каталогу с заголовочными файлами), используйте вторую
переменную.

</p>


<p>Итак, мы опять обновляем файлы Makefile.in и Makefile, собираем
библиотеку libhello.la, затем собираем программу hello (несколько
строк удалено для краткости):

</p><pre>    $ cd src/
    $ make libhello.la
    $ make hello
    gcc -DHAVE_CONFIG_H -I. -I. -I..     -g -O2 -c `test -f main.c || echo './'`main.c
        /bin/sh ../libtool --mode=link gcc  -g -O2   -o hello  main.o ../src/libhello.la 
        gcc -g -O2 -o .libs/hello main.o ../src/.libs/libhello.so -Wl,--rpath -Wl,/usr/local/lib
        creating hello
</pre>

<p></p>


<p>Если мы посмотрим на файл hello, то увидим, что он на самом деле
представляет собой shell-скрипт.  Настоящий исполняемый файл находится
в подкаталоге .libs/.  Он будет установлен как следует при выполнении
make install.

</p>


<p>Впрочем, этот скрипт можно запустить прямо из каталога сборки, как
если бы это была обычная программа:

    $ ./hello
    Hello, world!


</p><h2>Дополнительные возможности</h2>

Если вы хотите отладить вашу программу, то не сможете сделать это
простым наивным методом:

<pre>    $ gdb hello
    "/home/alexm/autotools-ru/hello/src/hello": not in executable format: File format not recognized
</pre>

Libtool обеспечивает специальный режим для отладки:

<pre>    $ <b>libtool gdb hello</b>
    This GDB was configured as "i686-pc-linux-gnu"...
    (gdb) <b>run</b> 
    Starting program: /home/alexm/autotools-ru/hello/src/.libs/lt-hello 
    Hello, world!

    Program exited normally.
</pre>


<h1>Shtool</h1>

<p></p>


<p>Однажды Ральф Энгельшал заметил, что во многих его проектах ему
приходится раз за разом писать одни и те же вспомогательные скрипты.
Так как он участвует в чрезвычайно большом количестве проектов, то все
эти различные скрипты, разбросанные по куче подкаталогов, и в сущности
выполняющие одну и ту же работу, стали катастрофически неудобны в
работе и поддержке.  В результате было принято решение собрать их все
в одном центральном месте – пакете Shtool.

</p>


<p>Shtool является одним большим shell-скриптом, который умеет выполнять
полтора десятка подкоманд разного назначения.  Основная причина
использования этого скрипта – невероятная переносимость.  Shell-код,
который используется внутри этих скриптов, работает на огромном
количестве командных интерпретаторов различных операционных систем,
каждая из которых, как всегда, имеет свои, скажем так, особенности.

</p>


<p>Вообще, в системах сборки пакетов, использующих Automake и Autoconf,
почти нет места, где можно было бы использовать Shtool: разве что
можно использовать подкоманды mkdir и install.  Зачем бы это было
нужно? – спросите вы, ведь команды mkdir и install есть на всякой
системе?  Нет.  Например, команда mkdir имеет флаг -p только в
GNU-версии и еще в некоторых.  Ощутимое количество коммерческих
операционных систем не умеют создавать каталоги, только если все его
родительские каталоги уже существуют.  Некоторые программы install
также не поддерживают ряда полезных ключей.

</p>


<p>Скрипты shtool проявляют себя в полной мере, когда их используют для
различных дополнительных, нестандартных целей.  В этой статье мы лишь
кратко опишем подкоманды, которые обеспечивает Shtool, чтобы вы
представляли себе, что можно не реализовывать снова и снова, а взять
уже готовое.  Подробности, как обычно, можно найти на великолепной
странице руководства к Shtool.

</p>


<p>Вывод на экран:

</p>


<p>- echo:  выдает на экран строку, в которой можно использовать
         служебные конструкции; поддерживает ключ -n, который умеет не
         всякая программа echo; 

</p>


<p>- mdate: печатает в указанном формате время последней модификации
         файла или каталога; 


</p>


<p>- table: печатает список значений в виде таблицы;

</p>


<p>- prop:  рисует красивый “пропеллер” во время выполнения длинной
         операции;


</p>


<p>Работа с файлами:

</p>


<p>- move:     позволяет переименовывать файлы с поддержкой маски:
            например, <tt>shtool move -e %.txt %.asc</tt> переименует все файлы
            с расширением .txt в .asc; такой возможности обычно не
            хватает многим, привыкшим к досовской команде rename;

</p>


<p>- install:  устанавливает программу, скрипт или обычный файл;
            обеспечивает все флаги BSD-версии программы install, даже
            если системная программа install их не поддерживает или
            вообще не существует;

</p>


<p>- mkdir:    создает каталог; позволяет также создать все необходимые
            родительские каталоги – эта возможность часто отсутствует
            в системных программах mkdir;

</p>


<p>- mkln:     создает ссылку (жесткую или символьную) на файл; при
            создании символьной ссылки старается, чтобы ссылка была
            относительной;

</p>


<p>- mkshadow: создает копию дерева исходных текстов с помощью символьных
            ссылок; полезно, если хочется внести несколько исправлений
            в существующее дерево, чтобы потом создать diff-файл;

</p>


<p>- fixperm:  “исправляет” права доступа к файлам перед созданием
            дистрибутива;  обычно при этом устанавливаются недостающие
            права доступа и выполнения для “группы” и для “всех
            остальных”; 

</p>


<p>- tarball:  создает правильный tar-файл с дистрибутивом.  Этот
            tar-файл будет распаковываться в отдельный подкаталог;
            список файлов в этом tar-файле будет отсортирован, чтобы
            можно было пользоваться командой tar tvf;

</p>


<p>Системные возможности:

</p>


<p>- guessos:  определяет операционную систему и архитектуру; обычно
            лучше использовать стандартный GNU-скрипт config.guess;

</p>


<p>- arx:      расширенный вариант команды ar;

</p>


<p>- slo:      специальная обертка к системному компоновщику, позволяющая
            удобно работать со специальными динамическими библиотеками;

</p>


<p>- scpp:     специальная обертка к препроцессору языка C, облегчающая
            написание библиотек на ANSI C;

</p>


<p>- version:  обеспечивает создание файлов описания версии пакета для
            нескольких различных языков программирования;

</p>


<p>- path:     утилита для работы с переменной окружения $PATH.


</p>


<p>С помощью программы shtoolize можно создать скрипт shtool, содержащий
необходимое подмножество подкоманд.


</p><h1>Дополнительные вопросы</h1>

<h2>Сборка вне дерева исходников</h2>

<p></p>


<p>Autoconf и Automake обеспечивают чрезвычайно полезную возможность:
сборка вне дерева исходников.  Предположим, что исходники пакета hello
распакованы в каталоге /usr/local/src, а вы хотите собрать пакет в
каталоге /var/tmp/hello-build.  Вот последовательность шагов:

</p><pre>    $ mkdir /var/tmp/hello-build
    $ cd /var/tmp/hello-build
    $ /usr/local/src/hello-1.3/configure
    $ make
</pre>

<p></p>


<p>Этот способ сборки особенно полезен, когда вашему пользователю нужно
собирать пакет одновременно для множества различных архитектур: тогда
он может иметь каталоги hello-build-linux, hello-build-solaris,
hello-build-hpux.  Если размер дерева исходников довольно велик, то
экономия налицо.

</p>


<p>Обязательно перед выпуском новой версии проверяйте, что пакет
собирается вне дерева исходников.


</p><h1>Заключение</h1>

<p></p>


<p>Итак, мы закончили краткий обзор пакетов из серии GNU Autotools.
Надеемся, что мы помогли сориентироваться в обсуждаемой области, и вы
станете использовать Autoconf, Automake и Libtool в своих программах,
сэкономив время, и предоставив пользователю удобную и привычную
поддержку сборки.  Учтите, лицензия на все эти пакеты _позволяет_
использовать их даже в коммерческих программных продуктах.

</p>


<p>Без сомнения, формат статей не позволил затронуть большого количества
тонких вопросов, возникающих на практике, но документация, а также
списки рассылки и группы новостей помогут вам добиться эффективного
использования Autotools в  повседневной практике.

</p><h1>Ссылки</h1>

<p></p>


<p>Основная страница проекта Libtool:

    <a href="http://www.gnu.org/software/libtool/libtool.html" title="http://www.gnu.org/software/libtool/libtool.html">http://www.gnu.org/software/libtool/libtool.html</a>

</p>


<p>Основная страница проекта Shtool:

    <a href="http://www.gnu.org/software/shtool/shtool.html" title="http://www.gnu.org/software/shtool/shtool.html">http://www.gnu.org/software/shtool/shtool.html</a>


</p>


<p>Русская страница по Autotools:

    <a href="http://squadette.ru/autotools-ru/" title="http://squadette.ru/autotools-ru/">http://squadette.ru/autotools-ru/</a>


</p>


<p>Книга “GNU Autoconf, Automake, and Libtool”:

    <a href="http://sourceware.org/autobook/">http://sourceware.org/autobook/</a>

</p>


  
    <footer>
      <p class="meta">
        
        








  


<time datetime="2007-03-08T21:00:00+01:00" pubdate="" data-updated="true">Mar 8<span>th</span>, 2007</time>
        
      </p>
      
        <div class="sharing">
  
  <iframe style="width: 109px; height: 20px;" data-twttr-rendered="true" title="Twitter Tweet Button" class="twitter-share-button twitter-tweet-button twitter-share-button twitter-count-horizontal" src="Libtool%20-%20%D0%90%D0%BB%D0%B5%D0%BA%D1%81%D0%B5%D0%B9%20%D0%9C%D0%B0%D1%85%D0%BE%D1%82%D0%BA%D0%B8%D0%BD_files/tweet_button.htm" allowtransparency="true" scrolling="no" id="twitter-widget-0" frameborder="0"></iframe>
  
  
  <div id="___plusone_0" style="text-indent: 0px; margin: 0px; padding: 0px; background: none repeat scroll 0% 0% transparent; border-style: none; float: none; line-height: normal; font-size: 1px; vertical-align: baseline; display: inline-block; width: 90px; height: 20px;"><iframe title="+1" data-gapiattached="true" src="Libtool%20-%20%D0%90%D0%BB%D0%B5%D0%BA%D1%81%D0%B5%D0%B9%20%D0%9C%D0%B0%D1%85%D0%BE%D1%82%D0%BA%D0%B8%D0%BD_files/fastbutton.htm" name="I0_1414769103946" id="I0_1414769103946" vspace="0" tabindex="0" style="position: static; top: 0px; width: 90px; margin: 0px; border-style: none; left: 0px; visibility: visible; height: 20px;" scrolling="no" marginwidth="0" marginheight="0" hspace="0" frameborder="0" width="100%"></iframe></div>
  
 
<div id="vk_like" style="display: inline-block; height: 22px; width: 180px; background: none repeat scroll 0% 0% transparent; position: relative; clear: both;"><iframe style="overflow: hidden; height: 22px; width: 180px; z-index: 150;" id="vkwidget1" scrolling="no" src="Libtool%20-%20%D0%90%D0%BB%D0%B5%D0%BA%D1%81%D0%B5%D0%B9%20%D0%9C%D0%B0%D1%85%D0%BE%D1%82%D0%BA%D0%B8%D0%BD_files/widget_like.htm" name="fXDd6c5d" frameborder="0" height="22" width="100%"></iframe></div>
<script type="text/javascript">
VK.Widgets.Like("vk_like", {type: "button", verb: 1});
</script>  

  
    <div fb-iframe-plugin-query="app_id=212934732101925&amp;href=http%3A%2F%2Fsquadette.ru%2Fautotools-ru%2Farticle3.html&amp;locale=en_US&amp;sdk=joey&amp;send=true&amp;show_faces=false&amp;width=250" fb-xfbml-state="rendered" class="fb-like fb_iframe_widget" data-send="true" data-width="250" data-show-faces="false"><span style="vertical-align: bottom; width: 250px; height: 28px;"><iframe class="" src="Libtool%20-%20%D0%90%D0%BB%D0%B5%D0%BA%D1%81%D0%B5%D0%B9%20%D0%9C%D0%B0%D1%85%D0%BE%D1%82%D0%BA%D0%B8%D0%BD_files/like.htm" style="border: medium none; visibility: visible; width: 250px; height: 28px;" title="fb:like Facebook Social Plugin" scrolling="no" allowtransparency="true" name="f1ec463bdfc10d6" frameborder="0" height="1000px" width="250px"></iframe></span></div>
  

</div>

      
    </footer>
  
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><iframe verticalscrolling="no" horizontalscrolling="no" src="Libtool%20-%20%D0%90%D0%BB%D0%B5%D0%BA%D1%81%D0%B5%D0%B9%20%D0%9C%D0%B0%D1%85%D0%BE%D1%82%D0%BA%D0%B8%D0%BD_files/a.htm" style="width: 100% ! important; border: medium none ! important; overflow: hidden ! important; height: 975px ! important;" title="Disqus" tabindex="0" scrolling="no" allowtransparency="true" data-disqus-uid="2" id="dsq-2" frameborder="0" width="100%"></iframe></div>
  </section>

</div>

<aside class="sidebar thirds">
  
    <section class="first odd">
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="http://squadette.ru/blog/2014/10/19/coursera-bioinformatics-algorithms/">Онлайн-курс «Алгоритмы биоинформатики» на  Coursera</a>
      </li>
    
      <li class="post">
        <a href="http://squadette.ru/blog/2014/08/12/bazy-dannykh-i-nosql/">Базы данных и NoSQL</a>
      </li>
    
      <li class="post">
        <a href="http://squadette.ru/blog/2013/12/04/copywriting/">Подборка текстов по копирайтингу</a>
      </li>
    
      <li class="post">
        <a href="http://squadette.ru/blog/2013/06/19/high-scalability-3/">Устройство сетевых серверов</a>
      </li>
    
      <li class="post">
        <a href="http://squadette.ru/blog/2013/06/06/gnu-makefile/">Использование GNU Make для многотредовой обработки файлов</a>
      </li>
    
  </ul>
</section>
<section class="even">
<div>
<script type="text/javascript"><!--
google_ad_client = "ca-pub-7306996412762055";
/* 250x250 */
google_ad_slot = "5902831299";
google_ad_width = 250;
google_ad_height = 250;
//-->
</script>
<script type="text/javascript" src="Libtool%20-%20%D0%90%D0%BB%D0%B5%D0%BA%D1%81%D0%B5%D0%B9%20%D0%9C%D0%B0%D1%85%D0%BE%D1%82%D0%BA%D0%B8%D0%BD_files/show_ads.js">
</script>
</div>
</section>

<section data-twttr-id="twttr-sandbox-0" class="odd">

<iframe title="Twitter Timeline" style="border: medium none; max-width: 100%; min-width: 180px; width: 210px;" allowfullscreen="" class="twitter-timeline twitter-timeline-rendered" allowtransparency="true" scrolling="no" id="twitter-widget-1" frameborder="0" height="600"></iframe>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>

</section>

<section class="first even">
<a href="http://stackoverflow.com/users/7754/squadette">
<img src="Libtool%20-%20%D0%90%D0%BB%D0%B5%D0%BA%D1%81%D0%B5%D0%B9%20%D0%9C%D0%B0%D1%85%D0%BE%D1%82%D0%BA%D0%B8%D0%BD_files/7754.png" alt="profile for squadette at Stack Overflow, Q&amp;A for professional and enthusiast programmers" title="profile for squadette at Stack Overflow, Q&amp;A for professional and enthusiast programmers" height="58" width="208">
</a>
</section>

<section class="odd">
  <h1>GitHub Repos</h1>
  <ul id="gh_repos"><li><a href="https://github.com/squadette/project-euler">project-euler</a><p>My solutions to project-euler.net in Haskell</p></li><li><a href="https://github.com/squadette/tiff">tiff</a><p>libtiff with fixes to PDF files generation</p></li><li><a href="https://github.com/squadette/pppd">pppd</a><p>Fixes for pppd, gathered from various distributions</p></li></ul>
  
  <a href="https://github.com/squadette">@squadette</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'squadette',
            count: 3,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="Libtool%20-%20%D0%90%D0%BB%D0%B5%D0%BA%D1%81%D0%B5%D0%B9%20%D0%9C%D0%B0%D1%85%D0%BE%D1%82%D0%BA%D0%B8%D0%BD_files/github.js" type="text/javascript"> </script>
</section>





  
</aside>


    <span class="toggle-sidebar"></span></div>
  </div>
  <footer role="contentinfo"><p>
  Copyright © 2014 - Алексей Махоткин -
  <span class="credit">Powered by <a href="http://octopress.org/">Octopress</a></span>

	&nbsp;&nbsp;&nbsp;

<!-- Yandex.Metrika informer -->
<a href="http://metrika.yandex.ru/stat/?id=22962932&amp;from=informer" target="_blank" rel="nofollow"><img src="Libtool%20-%20%D0%90%D0%BB%D0%B5%D0%BA%D1%81%D0%B5%D0%B9%20%D0%9C%D0%B0%D1%85%D0%BE%D1%82%D0%BA%D0%B8%D0%BD_files/3_1_FFFFFFFF_EFEFEFFF_0_pageviews.png" style="width:88px; height:31px; border:0;" alt="Яндекс.Метрика" title="Яндекс.Метрика: данные за сегодня (просмотры, визиты и уникальные посетители)" onclick="try{Ya.Metrika.informer({i:this,id:22962932,lang:'ru'});return false}catch(e){}"></a>
<!-- /Yandex.Metrika informer -->

<!-- Yandex.Metrika counter -->
<script type="text/javascript">
(function (d, w, c) {
    (w[c] = w[c] || []).push(function() {
        try {
            w.yaCounter22962932 = new Ya.Metrika({id:22962932,
                    clickmap:true,
                    trackLinks:true,
                    accurateTrackBounce:true});
        } catch(e) { }
    });

    var n = d.getElementsByTagName("script")[0],
        s = d.createElement("script"),
        f = function () { n.parentNode.insertBefore(s, n); };
    s.type = "text/javascript";
    s.async = true;
    s.src = (d.location.protocol == "https:" ? "https:" : "http:") + "//mc.yandex.ru/metrika/watch.js";

    if (w.opera == "[object Opera]") {
        d.addEventListener("DOMContentLoaded", f, false);
    } else { f(); }
})(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="//mc.yandex.ru/watch/22962932" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'squadette';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://squadette.ru/autotools-ru/article3.html';
        var disqus_url = 'http://squadette.ru/autotools-ru/article3.html';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div class=" fb_reset" id="fb-root"><div style="position: absolute; top: -10000px; height: 0px; width: 0px;"><div><iframe src="Libtool%20-%20%D0%90%D0%BB%D0%B5%D0%BA%D1%81%D0%B5%D0%B9%20%D0%9C%D0%B0%D1%85%D0%BE%D1%82%D0%BA%D0%B8%D0%BD_files/ehazDpFPEnK.htm" style="border: medium none;" tabindex="-1" title="Facebook Cross Domain Communication Frame" aria-hidden="true" id="fb_xdm_frame_http" scrolling="no" allowtransparency="true" name="fb_xdm_frame_http" frameborder="0"></iframe><iframe src="Libtool%20-%20%D0%90%D0%BB%D0%B5%D0%BA%D1%81%D0%B5%D0%B9%20%D0%9C%D0%B0%D1%85%D0%BE%D1%82%D0%BA%D0%B8%D0%BD_files/ehazDpFPEnK_002.htm" style="border: medium none;" tabindex="-1" title="Facebook Cross Domain Communication Frame" aria-hidden="true" id="fb_xdm_frame_https" scrolling="no" allowtransparency="true" name="fb_xdm_frame_https" frameborder="0"></iframe></div></div><div style="position: absolute; top: -10000px; height: 0px; width: 0px;"><div><iframe src="Libtool%20-%20%D0%90%D0%BB%D0%B5%D0%BA%D1%81%D0%B5%D0%B9%20%D0%9C%D0%B0%D1%85%D0%BE%D1%82%D0%BA%D0%B8%D0%BD_files/ping.htm" style="display: none;" scrolling="no" allowtransparency="true" name="f8999ef7d08788" frameborder="0"></iframe></div></div></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>







<iframe style="display: none;" allowtransparency="true" scrolling="no" id="rufous-sandbox" frameborder="0"></iframe><iframe tabindex="-1" style="width: 1px; height: 1px; position: absolute; top: -100px;" src="Libtool%20-%20%D0%90%D0%BB%D0%B5%D0%BA%D1%81%D0%B5%D0%B9%20%D0%9C%D0%B0%D1%85%D0%BE%D1%82%D0%BA%D0%B8%D0%BD_files/postmessageRelay.htm" id="oauth2relay303439446" name="oauth2relay303439446"></iframe></body></html>