<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Глава 16. System and Administrative Commands</title><meta name="generator" content="DocBook XSL Stylesheets V1.75.2"/><link rel="home" href="index.html" title="Advanced Bash Scripting по-русски"/><link rel="up" href="pt04.html" title="Часть Part 4. Commands"/><link rel="prev" href="ch15s09.html" title="Miscellaneous Commands"/><link rel="next" href="pt05.html" title="Часть Part 5. Материал повышенной сложности"/></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Глава 16. System and Administrative Commands</th></tr><tr><td align="left"><a accesskey="p" href="ch15s09.html">Пред.</a> </td><th width="60%" align="center">Часть Part 4. Commands</th><td align="right"> <a accesskey="n" href="pt05.html">След.</a></td></tr></table><hr/></div><div class="chapter" title="Глава 16. System and Administrative Commands"><div class="titlepage"><div><div><h2 class="title"><a id="system"/>Глава 16. System and Administrative Commands</h2></div></div></div><div class="toc"><p><b>Содержание</b></p><dl><dt><span class="sect1"><a href="ch16.html#sysscripts">Analyzing a System Script</a></span></dt></dl></div><p>The startup and shutdown scripts in 
  <code class="filename">/etc/rc.d</code> illustrate the uses
  (and usefulness) of many of these comands. These are usually
  invoked by <em class="firstterm">root</em> and used for system
  maintenance or emergency filesystem repairs. Use with caution, as
  some of these commands may damage your system if misused.</p><div class="variablelist" title="Users and Groups"><a id="usersgroups"/><p class="title"><b><a id="usersgroups1"/>Users and Groups</b></p><dl><dt><span class="term"><a id="usersref"/><span class="command"><strong>users</strong></span></span></dt><dd><p>Show all logged on users. This is the approximate
        equivalent of <span class="command"><strong>who -q</strong></span>.</p></dd><dt><span class="term"><a id="groupscmdref"/><span class="command"><strong>groups</strong></span></span></dt><dd><p>Lists the current user and the groups she belongs to.
         This corresponds to the <a class="link" href="ch09.html#groupsref">$GROUPS</a> internal variable,
         but gives the group names, rather than the numbers.</p><pre class="screen"><code class="prompt">bash$ </code><strong class="userinput"><code>groups</code></strong>
<code class="computeroutput">bozita cdrom cdwriter audio xgrp</code>

<code class="prompt">bash$ </code><strong class="userinput"><code>echo $GROUPS</code></strong>
<code class="computeroutput">501</code></pre></dd><dt><span class="term"><a id="chownref"/><span class="command"><strong>chown</strong></span>, </span><span class="term"><a id="chgrpref"/><span class="command"><strong>chgrp</strong></span></span></dt><dd><p>The <span class="command"><strong>chown</strong></span> command changes the
        ownership of a file or files. This command is a useful
        method that <em class="firstterm">root</em> can use to
        shift file ownership from one user to another. An ordinary
        user may not change the ownership of files, not even her
        own files.
           <sup>[<a id="idp14211328" href="#ftn.idp14211328" class="footnote">78</a>]</sup>
        </p><p>
        </p><pre class="screen"><code class="prompt">root# </code><strong class="userinput"><code>chown bozo *.txt</code></strong>
<code class="computeroutput"/>
        </pre><p>
      </p><p>The <span class="command"><strong>chgrp</strong></span> command changes the
        <em class="replaceable"><code>group</code></em> ownership of a file or
        files. You must be owner of the file(s) as well as a member
        of the destination group (or <em class="firstterm">root</em>)
        to use this operation.
        </p><pre class="programlisting">chgrp --recursive dunderheads *.data
#  The "dunderheads" group will now own all the "*.data" files
#+ all the way down the $PWD directory tree (that's what "recursive" means).
</pre></dd><dt><span class="term"><a id="useraddref"/><span class="command"><strong>useradd</strong></span>, </span><span class="term"><span class="command"><strong>userdel</strong></span></span></dt><dd><p>The <span class="command"><strong>useradd</strong></span> administrative command
        adds a user account to the system and creates a home
        directory for that particular user, if so specified. The
        corresponding <span class="command"><strong>userdel</strong></span> command removes
        a user account from the system
     <sup>[<a id="idp14227680" href="#ftn.idp14227680" class="footnote">79</a>]</sup>
        and deletes associated files.</p><div class="note" title="Замечание" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Замечание</h3><p>The <span class="command"><strong>adduser</strong></span> command is a synonym
        for <span class="command"><strong>useradd</strong></span> and is usually a symbolic link to
        it.</p></div></dd><dt><span class="term"><a id="usermodref"/><span class="command"><strong>usermod</strong></span></span></dt><dd><p>Modify a user account. Changes may be made to the password,
        group membership, expiration date, and other attributes of
        a given user's account. With this command, a user's password
        may be locked, which has the effect of disabling the
        account.</p></dd><dt><span class="term"><a id="groupmodref"/><span class="command"><strong>groupmod</strong></span></span></dt><dd><p>Modify a given group. The group name and/or ID number may be
        changed using this command.</p></dd><dt><span class="term"><a id="idref"/><span class="command"><strong>id</strong></span></span></dt><dd><p>The <span class="command"><strong>id</strong></span> command lists the real and
        effective user IDs and the group IDs of the user
        associated with the current process. This is the
        counterpart to the <a class="link" href="ch09.html#uidref">$UID</a>,
        <a class="link" href="ch09.html#euidref">$EUID</a>, and <a class="link" href="ch09.html#groupsref">$GROUPS</a> internal Bash
        variables.</p><pre class="screen"><code class="prompt">bash$ </code><strong class="userinput"><code>id</code></strong>
<code class="computeroutput">uid=501(bozo) gid=501(bozo) groups=501(bozo),22(cdrom),80(cdwriter),81(audio)</code>

<code class="prompt">bash$ </code><strong class="userinput"><code>echo $UID</code></strong>
<code class="computeroutput">501</code></pre><div class="note" title="Замечание" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Замечание</h3><p>The <span class="command"><strong>id</strong></span> command shows the
        <span class="emphasis"><em>effective</em></span> IDs only when they differ
        from the <span class="emphasis"><em>real</em></span> ones.</p></div><p>Also see <a class="xref" href="ch09.html#amiroot" title="Пример 9.5. Am I root?">Пример 9.5, «Am I root?»</a>.</p></dd><dt><span class="term"><a id="lidref"/><span class="command"><strong>lid</strong></span></span></dt><dd><p>The <em class="firstterm">lid</em> (list ID) command
        shows the group(s) that a given user belongs to, or alternately,
        the users belonging to a given group. May be invoked only by
        root.</p><p>
        </p><pre class="screen"><code class="prompt">root# </code><strong class="userinput"><code>lid bozo</code></strong>
<code class="computeroutput"> bozo(gid=500)</code>


<code class="prompt">root# </code><strong class="userinput"><code>lid daemon</code></strong>
<code class="computeroutput"> bin(gid=1)
  daemon(gid=2)
  adm(gid=4)
  lp(gid=7)</code>
        </pre><p>
      </p></dd><dt><span class="term"><a id="whoref"/><span class="command"><strong>who</strong></span></span></dt><dd><p>Show all users logged on to the system.</p><p>
        </p><pre class="screen"><code class="prompt">bash$ </code><strong class="userinput"><code>who</code></strong>
<code class="computeroutput">bozo  tty1     Apr 27 17:45
 bozo  pts/0    Apr 27 17:46
 bozo  pts/1    Apr 27 17:47
 bozo  pts/2    Apr 27 17:49
</code>
        </pre><p>
      </p><p>The <code class="option">-m</code> gives detailed information about
        only the current user. Passing any two arguments to
        <span class="command"><strong>who</strong></span> is the equivalent of <span class="command"><strong>who
        -m</strong></span>, as in <span class="command"><strong>who am i</strong></span> or <span class="command"><strong>who
        The Man</strong></span>.</p><p>
        </p><pre class="screen"><code class="prompt">bash$ </code><strong class="userinput"><code>who -m</code></strong>
<code class="computeroutput">localhost.localdomain!bozo  pts/2    Apr 27 17:49</code>
        </pre><p>
      </p><p><a id="whoamiref"/><span class="command"><strong>whoami</strong></span> is similar to <span class="command"><strong>who
        -m</strong></span>, but only lists the user name.</p><p>
        </p><pre class="screen"><code class="prompt">bash$ </code><strong class="userinput"><code>whoami</code></strong>
<code class="computeroutput">bozo</code>
        </pre><p>
      </p></dd><dt><span class="term"><a id="wref"/><span class="command"><strong>w</strong></span></span></dt><dd><p>Show all logged on users and the processes belonging to them. This is
        an extended version of <span class="command"><strong>who</strong></span>. The output of <span class="command"><strong>w</strong></span>
        may be piped to <a class="link" href="ch15s04.html#grepref">grep</a> to find
        a specific user and/or process.</p><pre class="screen"><code class="prompt">bash$ </code><strong class="userinput"><code>w | grep startx</code></strong>
<code class="computeroutput">bozo  tty1     -                 4:22pm  6:41   4.47s  0.45s  startx</code></pre></dd><dt><span class="term"><a id="lognameref"/><span class="command"><strong>logname</strong></span></span></dt><dd><p>Show current user's login name (as found in
        <code class="filename">/var/run/utmp</code>). This is a
        near-equivalent to <a class="link" href="ch16.html#whoamiref">whoami</a>,
        above.</p><pre class="screen"><code class="prompt">bash$ </code><strong class="userinput"><code>logname</code></strong>
<code class="computeroutput">bozo</code>

<code class="prompt">bash$ </code><strong class="userinput"><code>whoami</code></strong>
<code class="computeroutput">bozo</code></pre><p>However . . .</p><p>
      </p><pre class="screen"><code class="prompt">bash$ </code><strong class="userinput"><code>su</code></strong>
<code class="computeroutput">Password: ......</code>

<code class="prompt">bash# </code><strong class="userinput"><code>whoami</code></strong>
<code class="computeroutput">root</code>
<code class="prompt">bash# </code><strong class="userinput"><code>logname</code></strong>
<code class="computeroutput">bozo</code></pre><p>      
      </p><div class="note" title="Замечание" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Замечание</h3><p>While <span class="command"><strong>logname</strong></span> prints the name
        of the logged in user, <span class="command"><strong>whoami</strong></span> gives the
        name of the user attached to the current process. As we have
        just seen, sometimes these are not the same.</p></div></dd><dt><span class="term"><a id="suref"/><span class="command"><strong>su</strong></span></span></dt><dd><p>Runs a program or script as a
        <span class="command"><strong>s</strong></span>ubstitute <span class="command"><strong>u</strong></span>ser.
        <span class="command"><strong>su rjones</strong></span> starts a shell as user
        <span class="emphasis"><em>rjones</em></span>. A naked <span class="command"><strong>su</strong></span>
        defaults to <em class="firstterm">root</em>.  See <a class="xref" href="apa.html#fifo" title="Пример A.14. fifo: Making daily backups, using named pipes">Пример A.14, «<em class="firstterm">fifo</em>: Making daily backups, using
      named pipes»</a>.</p></dd><dt><span class="term"><a id="sudoref"/><span class="command"><strong>sudo</strong></span></span></dt><dd><p>Runs a command as <em class="firstterm">root</em> (or
        another user). This may be used in a script, thus permitting
        a <em class="firstterm">regular user</em> to run the script.</p><pre class="programlisting">#!/bin/bash

# Some commands.
sudo cp /root/secretfile /home/bozo/secret
# Some more commands.</pre><p>The file <code class="filename">/etc/sudoers</code> holds
        the names of users permitted to invoke
        <span class="command"><strong>sudo</strong></span>.</p></dd><dt><span class="term"><a id="passwdref"/><span class="command"><strong>passwd</strong></span></span></dt><dd><p>Sets, changes, or manages a user's password.</p><p>The <span class="command"><strong>passwd</strong></span> command can be used in
        a script, but probably <span class="emphasis"><em>should not</em></span> be.</p><div class="example"><a id="setnewpw"/><p class="title"><b>Пример 16.1. Setting a new password</b></p><div class="example-contents"><pre class="programlisting">&amp;setnewpw;</pre></div></div><br class="example-break"/><p>The <span class="command"><strong>passwd</strong></span> command's <code class="option">-l</code>,
        <code class="option">-u</code>, and <code class="option">-d</code> options permit
        locking, unlocking, and deleting a user's password. Only
        <em class="firstterm">root</em> may use these options.</p></dd><dt><span class="term"><a id="acref"/><span class="command"><strong>ac</strong></span></span></dt><dd><p>Show users' logged in time, as read from
        <code class="filename">/var/log/wtmp</code>. This is one of the GNU
        accounting utilities.</p><pre class="screen"><code class="prompt">bash$ </code><strong class="userinput"><code>ac</code></strong>
<code class="computeroutput">        total       68.08</code></pre></dd><dt><span class="term"><a id="lastref"/><span class="command"><strong>last</strong></span></span></dt><dd><p>List <span class="emphasis"><em>last</em></span> logged in users, as read from
        <code class="filename">/var/log/wtmp</code>. This command can also
        show remote logins.</p><p>For example, to show the last few times the system
        rebooted:</p><pre class="screen"><code class="prompt">bash$ </code><strong class="userinput"><code>last reboot</code></strong>
<code class="computeroutput">reboot   system boot  2.6.9-1.667      Fri Feb  4 18:18          (00:02)    
 reboot   system boot  2.6.9-1.667      Fri Feb  4 15:20          (01:27)    
 reboot   system boot  2.6.9-1.667      Fri Feb  4 12:56          (00:49)    
 reboot   system boot  2.6.9-1.667      Thu Feb  3 21:08          (02:17)    
 . . .

 wtmp begins Tue Feb  1 12:50:09 2005</code></pre></dd><dt><span class="term"><a id="newgrpref"/><span class="command"><strong>newgrp</strong></span></span></dt><dd><p>Change user's <em class="firstterm">group ID</em> without
        logging out. This permits access to the new group's
        files. Since users may be members of multiple groups
        simultaneously, this command finds only limited use.</p><div class="note" title="Замечание" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Замечание</h3><p>Kurt Glaesemann points out that the
        <em class="firstterm">newgrp</em> command could prove helpful
        in setting the default group permissions for files a user
        writes. However, the <a class="link" href="ch16.html#chgrpref">chgrp</a>
        command might be more convenient for this purpose.</p></div></dd></dl></div><div class="variablelist" title="Terminals"><a id="terminalssys"/><p class="title"><b><a id="terminalssys1"/>Terminals</b></p><dl><dt><span class="term"><a id="ttyref"/><span class="command"><strong>tty</strong></span></span></dt><dd><p>Echoes the name (filename) of the current user's terminal.
        Note that each separate <em class="firstterm">xterm</em>
        window counts as a different terminal.</p><pre class="screen"><code class="prompt">bash$ </code><strong class="userinput"><code>tty</code></strong>
<code class="computeroutput">/dev/pts/1</code></pre></dd><dt><span class="term"><a id="sttyref"/><span class="command"><strong>stty</strong></span></span></dt><dd><p>Shows and/or changes terminal settings. This complex
        command, used in a script, can control terminal behavior
        and the way output displays. See the info page, and study
        it carefully.</p><div class="example"><a id="erase"/><p class="title"><b>Пример 16.2. Setting an <em class="firstterm">erase</em> character</b></p><div class="example-contents"><pre class="programlisting">&amp;erase;</pre></div></div><br class="example-break"/><div class="example"><a id="secretpw"/><p class="title"><b>Пример 16.3. <em class="firstterm">secret password</em>:
        Turning off terminal echoing </b></p><div class="example-contents"><pre class="programlisting">&amp;secretpw;</pre></div></div><br class="example-break"/><p>A creative use of <span class="command"><strong>stty</strong></span> is detecting a
        user keypress (without hitting
        <span class="keycap"><strong>ENTER</strong></span>).</p><div class="example"><a id="keypress"/><p class="title"><b>Пример 16.4. Keypress detection</b></p><div class="example-contents"><pre class="programlisting">&amp;keypress;</pre></div></div><br class="example-break"/><p>Also see <a class="xref" href="ch09.html#timeout" title="Пример 9.3. Once more, timed input">Пример 9.3, «Once more, timed input»</a> and <a class="xref" href="apa.html#stopwatch" title="Пример A.43. A command-line stopwatch">Пример A.43, «A command-line stopwatch»</a>.</p><p><a id="terminalsref"/></p><div class="sidebar" title="terminals and modes"><p class="title"><b>terminals and modes</b></p><p>Normally, a terminal works in the
        <em class="firstterm">canonical</em> mode.  When a user hits a
        key, the resulting character does not immediately go to
        the program actually running in this terminal.  A buffer
        local to the terminal stores keystrokes. When the user
        hits the <span class="keycap"><strong>ENTER</strong></span> key, this sends all the
        stored keystrokes to the program running.  There is even
        a basic line editor inside the terminal.</p><p>
          </p><pre class="screen"><code class="prompt">bash$ </code><strong class="userinput"><code>stty -a</code></strong>
<code class="computeroutput">speed 9600 baud; rows 36; columns 96; line = 0;
 intr = ^C; quit = ^\; erase = ^H; kill = ^U; eof = ^D; eol = &lt;undef&gt;; eol2 = &lt;undef&gt;;
 start = ^Q; stop = ^S; susp = ^Z; rprnt = ^R; werase = ^W; lnext = ^V; flush = ^O;
 ...
 isig icanon iexten echo echoe echok -echonl -noflsh -xcase -tostop -echoprt</code>
                </pre><p>
      </p><p>Using canonical mode, it is possible to redefine the
              special keys for the local terminal line editor.

          </p><pre class="screen">
<code class="prompt">bash$ </code><strong class="userinput"><code>cat &gt; filexxx</code></strong>
<strong class="userinput"><code>wha&lt;ctl-W&gt;I&lt;ctl-H&gt;foo bar&lt;ctl-U&gt;hello world&lt;ENTER&gt;</code></strong>
<strong class="userinput"><code>&lt;ctl-D&gt;</code></strong>
<code class="prompt">bash$ </code><strong class="userinput"><code>cat filexxx</code></strong>
<code class="computeroutput">hello world</code>    
<code class="prompt">bash$ </code><strong class="userinput"><code>wc -c &lt; filexxx</code></strong>
<code class="computeroutput">12</code>   
                </pre><p>

              The process controlling the terminal receives only 12
              characters (11 alphabetic ones, plus a newline), although
              the user hit 26 keys.
            </p><p>In non-canonical (<span class="quote">«<span class="quote">raw</span>»</span>) mode, every
              key hit (including special editing keys such as
              <span class="keycap"><strong>ctl-H</strong></span>) sends a character immediately to
              the controlling process.</p><p>The Bash prompt disables both <code class="option">icanon</code>
              and <code class="option">echo</code>, since it replaces the basic
              terminal line editor with its own more elaborate one. For
              example, when you hit <span class="keycap"><strong>ctl-A</strong></span> at the Bash
              prompt, there's no <span class="keycap"><strong>^A</strong></span> echoed by the
              terminal, but Bash gets a <span class="keycap"><strong>\1</strong></span> character,
              interprets it, and moves the cursor to the begining of
              the line.</p><p><span class="emphasis"><em>Stéphane Chazelas</em></span></p></div></dd><dt><span class="term"><a id="settermref"/><span class="command"><strong>setterm</strong></span></span></dt><dd><p>Set certain terminal attributes. This command writes
        to its terminal's <code class="filename">stdout</code> a string that
        changes the behavior of that terminal.</p><p>
        </p><pre class="screen"><code class="prompt">bash$ </code><strong class="userinput"><code>setterm -cursor off</code></strong>
<code class="computeroutput">bash$</code>
        </pre><p>
      </p><p>The <span class="command"><strong>setterm</strong></span> command can be used within a
        script to change the appearance of text written to
        <code class="filename">stdout</code>, although there are certainly
        <a class="link" href="ch33s06.html#colorizingref">better tools</a> available
        for this purpose.</p><pre class="programlisting">setterm -bold on
echo bold hello

setterm -bold off
echo normal hello</pre></dd><dt><span class="term"><a id="tsetref"/><span class="command"><strong>tset</strong></span></span></dt><dd><p>Show or initialize terminal settings. 
        This is a less capable version of
        <span class="command"><strong>stty</strong></span>.</p><p>
        </p><pre class="screen"><code class="prompt">bash$ </code><strong class="userinput"><code>tset -r</code></strong>
<code class="computeroutput">Terminal type is xterm-xfree86.
 Kill is control-U (^U).
 Interrupt is control-C (^C).</code>
        </pre><p>
      </p></dd><dt><span class="term"><a id="setserialref"/><span class="command"><strong>setserial</strong></span></span></dt><dd><p>Set or display serial port parameters. This command must be
        run by <em class="firstterm">root</em> and is usually found in a
        system setup script.</p><pre class="programlisting"># From /etc/pcmcia/serial script:

IRQ=`setserial /dev/$DEVICE | sed -e 's/.*IRQ: //'`
setserial /dev/$DEVICE irq 0 ; setserial /dev/$DEVICE irq $IRQ</pre></dd><dt><span class="term"><a id="gettyref"/><span class="command"><strong>getty</strong></span>, </span><span class="term"><a id="agettyref"/><span class="command"><strong>agetty</strong></span></span></dt><dd><p>The initialization process for a terminal uses
        <span class="command"><strong>getty</strong></span> or <span class="command"><strong>agetty</strong></span>
        to set it up for login by a user. These commands are not
        used within user shell scripts. Their scripting counterpart
        is <span class="command"><strong>stty</strong></span>.</p></dd><dt><span class="term"><a id="mesgref"/><span class="command"><strong>mesg</strong></span></span></dt><dd><p>Enables or disables write access to the current user's
        terminal.  Disabling access would prevent another user
        on the network to <a class="link" href="ch15s06.html#writeref">write</a>
        to the terminal.</p><div class="tip" title="Подсказка" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Подсказка</h3><p>It can be quite annoying to have a message
        about ordering pizza suddenly appear in the middle of
        the text file you are editing. On a multi-user network,
        you might therefore wish to disable write access to your
        terminal when you need to avoid interruptions.</p></div></dd><dt><span class="term"><a id="wallref"/><span class="command"><strong>wall</strong></span></span></dt><dd><p>This is an acronym for <span class="quote">«<span class="quote"><a class="link" href="ch15s06.html#writeref">write</a> all,</span>»</span> i.e., sending
        a message to all users at every terminal logged into the
        network. It is primarily a system administrator's tool,
        useful, for example, when warning everyone that the
        system will shortly go down due to a problem (see <a class="xref" href="ch18.html#ex70" title="Пример 18.1. Широковещательная рассылка: Отправить сообщение всем пользователям, вошедшим в систему">Пример 18.1, «<em class="firstterm">Широковещательная рассылка</em>: Отправить сообщение всем пользователям, вошедшим
         в систему »</a>).</p><p>
        </p><pre class="screen"><code class="prompt">bash$ </code><strong class="userinput"><code>wall System going down for maintenance in 5 minutes!</code></strong>
<code class="computeroutput">Broadcast message from bozo (pts/1) Sun Jul  8 13:53:27 2001...

 System going down for maintenance in 5 minutes!</code>
        </pre><p>
      </p><div class="note" title="Замечание" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Замечание</h3><p>If write access to a particular terminal has been
        disabled with <span class="command"><strong>mesg</strong></span>, then
        <span class="command"><strong>wall</strong></span> cannot send a message to
        that terminal.</p></div></dd></dl></div><div class="variablelist" title="Information and Statistics"><a id="statisticssys"/><p class="title"><b><a id="statisticssys1"/>Information and Statistics</b></p><dl><dt><span class="term"><a id="unameref"/><span class="command"><strong>uname</strong></span></span></dt><dd><p>Output system specifications (OS, kernel version,
        etc.) to <code class="filename">stdout</code>.  Invoked with the
        <code class="option">-a</code> option, gives verbose system info
        (see <a class="xref" href="ch15s02.html#ex41" title="Пример 15.5. Logfile: Using xargs to monitor system log">Пример 15.5, «Logfile: Using <em class="firstterm">xargs</em> to monitor system log»</a>). The <code class="option">-s</code>
        option shows only the OS type.</p><pre class="screen"><code class="prompt">bash$ </code><strong class="userinput"><code>uname</code></strong>
<code class="computeroutput">Linux</code>

<code class="prompt">bash$ </code><strong class="userinput"><code>uname -s</code></strong>
<code class="computeroutput">Linux</code>


<code class="prompt">bash$ </code><strong class="userinput"><code>uname -a</code></strong>
<code class="computeroutput">Linux iron.bozo 2.6.15-1.2054_FC5 #1 Tue Mar 14 15:48:33 EST 2006
 i686 i686 i386 GNU/Linux</code></pre></dd><dt><span class="term"><a id="archref"/><span class="command"><strong>arch</strong></span></span></dt><dd><p>Show system architecture.
        Equivalent to <span class="command"><strong>uname -m</strong></span>. See <a class="xref" href="ch10s04.html#casecmd" title="Пример 10.26. Использование подстановки команды для генерирования значения переменной для case.">Пример 10.26, «Использование <em class="firstterm">подстановки команды</em>
       для генерирования значения переменной для <em class="firstterm">case</em>.»</a>.</p><pre class="screen"><code class="prompt">bash$ </code><strong class="userinput"><code>arch</code></strong>
<code class="computeroutput">i686</code>

<code class="prompt">bash$ </code><strong class="userinput"><code>uname -m</code></strong>
<code class="computeroutput">i686</code></pre></dd><dt><span class="term"><a id="lastcommref"/><span class="command"><strong>lastcomm</strong></span></span></dt><dd><p>Gives information about previous commands, as stored
        in the <code class="filename">/var/account/pacct</code> file. Command
        name and user name can be specified by options. This is
        one of the GNU accounting utilities.</p></dd><dt><span class="term"><a id="lastlogref"/><span class="command"><strong>lastlog</strong></span></span></dt><dd><p>List the last login time of all system users. This
        references the <code class="filename">/var/log/lastlog</code>
        file.</p><p>
        </p><pre class="screen"><code class="prompt">bash$ </code><strong class="userinput"><code>lastlog</code></strong>
<code class="computeroutput">root          tty1                      Fri Dec  7 18:43:21 -0700 2001
 bin                                     **Never logged in**
 daemon                                  **Never logged in**
 ...
 bozo          tty1                      Sat Dec  8 21:14:29 -0700 2001</code>



<code class="prompt">bash$ </code><strong class="userinput"><code>lastlog | grep root</code></strong>
<code class="computeroutput">root          tty1                      Fri Dec  7 18:43:21 -0700 2001</code>
        </pre><p>
        </p><div class="caution" title="Предостережение" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Предостережение</h3><p>This command will fail if the user invoking
    it does not have read permission for the
    <code class="filename">/var/log/lastlog</code> file.</p></div></dd><dt><span class="term"><a id="lsofref"/><span class="command"><strong>lsof</strong></span></span></dt><dd><p>List open files. This command outputs a detailed
        table of all currently open files and gives information
        about their owner, size, the processes associated with
        them, and more. Of course, <span class="command"><strong>lsof</strong></span> may
        be piped to <a class="link" href="ch15s04.html#grepref">grep</a> and/or
        <a class="link" href="apcs02.html#awkref">awk</a> to parse and analyze
        its results.</p><p>
        </p><pre class="screen"><code class="prompt">bash$ </code><strong class="userinput"><code>lsof</code></strong>
<code class="computeroutput">COMMAND    PID    USER   FD   TYPE     DEVICE    SIZE     NODE NAME
 init         1    root  mem    REG        3,5   30748    30303 /sbin/init
 init         1    root  mem    REG        3,5   73120     8069 /lib/ld-2.1.3.so
 init         1    root  mem    REG        3,5  931668     8075 /lib/libc-2.1.3.so
 cardmgr    213    root  mem    REG        3,5   36956    30357 /sbin/cardmgr
 ...</code>
        </pre><p>
      </p><p>The <span class="command"><strong>lsof</strong></span> command is a useful,
        if complex administrative tool. If you are unable to
        dismount a filesystem and get an error message that it is
        still in use, then running <em class="firstterm">lsof</em> helps
        determine which files are still open on that filesystem. The
        <code class="option">-i</code> option lists open network socket files,
        and this can help trace intrusion or hack attempts.</p><p>
        </p><pre class="screen"><code class="prompt">bash$ </code><strong class="userinput"><code>lsof -an -i tcp</code></strong>
<code class="computeroutput">COMMAND  PID USER  FD  TYPE DEVICE SIZE NODE NAME
 firefox 2330 bozo  32u IPv4   9956       TCP 66.0.118.137:57596-&gt;67.112.7.104:http ...
 firefox 2330 bozo  38u IPv4  10535       TCP 66.0.118.137:57708-&gt;216.79.48.24:http ...</code>
        </pre><p>
      </p></dd><dt><span class="term"><a id="straceref"/><span class="command"><strong>strace</strong></span></span></dt><dd><p><span class="command"><strong>S</strong></span>ystem <span class="command"><strong>trace</strong></span>:
        diagnostic and debugging tool for tracing <em class="firstterm">system
        calls</em> and signals. This command and
        <span class="command"><strong>ltrace</strong></span>, following, are useful for
        diagnosing why a given program or package fails to
        run . . . perhaps due to missing libraries or related
        causes.</p><p>
      </p><pre class="screen"><code class="prompt">bash$ </code><strong class="userinput"><code>strace df</code></strong>
<code class="computeroutput">execve("/bin/df", ["df"], [/* 45 vars */]) = 0
 uname({sys="Linux", node="bozo.localdomain", ...}) = 0
 brk(0)                                  = 0x804f5e4

 ...</code>
      </pre><p>
      </p><p>This is the Linux equivalent of
        the Solaris <span class="command"><strong>truss</strong></span> command.</p></dd><dt><span class="term"><a id="ltraceref"/><span class="command"><strong>ltrace</strong></span></span></dt><dd><p><span class="command"><strong>L</strong></span>ibrary <span class="command"><strong>trace</strong></span>:
        diagnostic and debugging tool that traces <em class="firstterm">library calls</em>
        invoked by a given command.</p><p>
      </p><pre class="screen"><code class="prompt">bash$ </code><strong class="userinput"><code>ltrace df</code></strong>
<code class="computeroutput">__libc_start_main(0x804a910, 1, 0xbfb589a4, 0x804fb70, 0x804fb68 &lt;unfinished ...&gt;:
 setlocale(6, "")                                 = "en_US.UTF-8"
bindtextdomain("coreutils", "/usr/share/locale") = "/usr/share/locale"
textdomain("coreutils")                          = "coreutils"
__cxa_atexit(0x804b650, 0, 0, 0x8052bf0, 0xbfb58908) = 0
getenv("DF_BLOCK_SIZE")                          = NULL

 ...</code>
      </pre><p>
      </p></dd><dt><span class="term"><a id="nmapref"/><span class="command"><strong>nmap</strong></span></span></dt><dd><p><span class="command"><strong>N</strong></span>etwork <span class="command"><strong>map</strong></span>per
        and port scanner. This command scans a server to
        locate open ports and the services associated with those
        ports. It can also report information about packet filters and
        firewalls. This is an important security tool for locking down
        a network against hacking attempts.</p><pre class="programlisting">#!/bin/bash

SERVER=$HOST                           # localhost.localdomain (127.0.0.1).
PORT_NUMBER=25                         # SMTP port.

nmap $SERVER | grep -w "$PORT_NUMBER"  # Is that particular port open?
#              grep -w matches whole words only,
#+             so this wouldn't match port 1025, for example.

exit 0

# 25/tcp     open        smtp</pre></dd><dt><span class="term"><a id="ncref"/><span class="command"><strong>nc</strong></span></span></dt><dd><p>The <span class="command"><strong>nc</strong></span> (<em class="firstterm">netcat</em>)
        utility is a complete toolkit for connecting to and
        listening to TCP and UDP ports. It is useful as a diagnostic
        and testing tool and as a component in simple script-based HTTP
        clients and servers.</p><p>
      </p><pre class="screen"><code class="prompt">bash$ </code><strong class="userinput"><code>nc localhost.localdomain 25</code></strong>
<code class="computeroutput">220 localhost.localdomain ESMTP Sendmail 8.13.1/8.13.1;
 Thu, 31 Mar 2005 15:41:35 -0700</code></pre><p>
      </p><div class="example"><a id="iscan"/><p class="title"><b>Пример 16.5. Checking a remote server for
              <em class="firstterm">identd</em></b></p><div class="example-contents"><pre class="programlisting">&amp;iscan;</pre></div></div><br class="example-break"/><p>
        And, of course, there's Dr. Andrew Tridgell's notorious
        one-line script in the BitKeeper Affair:
          </p><pre class="programlisting">echo clone | nc thunk.org 5000 &gt; e2fsprogs.dat</pre><p>
      </p></dd><dt><span class="term"><a id="freeref"/><span class="command"><strong>free</strong></span></span></dt><dd><p>Shows memory and cache usage in tabular form. The
        output of this command lends itself to parsing, using
        <a class="link" href="ch15s04.html#grepref">grep</a>, <a class="link" href="apcs02.html#awkref">awk</a> or <span class="command"><strong>Perl</strong></span>. The
        <span class="command"><strong>procinfo</strong></span> command shows all the
        information that <span class="command"><strong>free</strong></span> does, and much
        more.</p><pre class="screen"><code class="prompt">bash$ </code><span class="command"><strong>free</strong></span>
<code class="computeroutput">                total       used       free     shared    buffers     cached
   Mem:         30504      28624       1880      15820       1608       16376
   -/+ buffers/cache:      10640      19864
   Swap:        68540       3128      65412</code></pre><p>To show unused RAM memory:</p><pre class="screen"><code class="prompt">bash$ </code><span class="command"><strong>free | grep Mem | awk '{ print $4 }'</strong></span>
<code class="computeroutput">1880</code></pre></dd><dt><span class="term"><a id="procinforef"/><span class="command"><strong>procinfo</strong></span></span></dt><dd><p>Extract and list information and statistics from the
        <a class="link" href="ch27.html#devprocref"><code class="filename">/proc</code>
        pseudo-filesystem</a>. This gives a very extensive and
        detailed listing.</p><pre class="screen"><code class="prompt">bash$ </code><strong class="userinput"><code>procinfo | grep Bootup</code></strong>
<code class="computeroutput">Bootup: Wed Mar 21 15:15:50 2001    Load average: 0.04 0.21 0.34 3/47 6829</code>
</pre></dd><dt><span class="term"><a id="lsdevref"/><span class="command"><strong>lsdev</strong></span></span></dt><dd><p>List devices, that is, show installed hardware.</p><p>
        </p><pre class="screen"><code class="prompt">bash$ </code><strong class="userinput"><code>lsdev</code></strong>
<code class="computeroutput">Device            DMA   IRQ  I/O Ports
 ------------------------------------------------
 cascade             4     2 
 dma                          0080-008f
 dma1                         0000-001f
 dma2                         00c0-00df
 fpu                          00f0-00ff
 ide0                     14  01f0-01f7 03f6-03f6
 ...</code>
        </pre><p>
        </p></dd><dt><span class="term"><a id="duref"/><span class="command"><strong>du</strong></span></span></dt><dd><p>Show (disk) file usage, recursively. Defaults to current
        working directory, unless otherwise specified.</p><pre class="screen"><code class="prompt">bash$ </code><span class="command"><strong>du -ach</strong></span>
<code class="computeroutput">1.0k    ./wi.sh
 1.0k    ./tst.sh
 1.0k    ./random.file
 6.0k    .
 6.0k    total</code></pre></dd><dt><span class="term"><a id="dfref"/><span class="command"><strong>df</strong></span></span></dt><dd><p>Shows filesystem usage in tabular form.</p><pre class="screen"><code class="prompt">bash$ </code><span class="command"><strong>df</strong></span>
<code class="computeroutput">Filesystem           1k-blocks      Used Available Use% Mounted on
 /dev/hda5               273262     92607    166547  36% /
 /dev/hda8               222525    123951     87085  59% /home
 /dev/hda7              1408796   1075744    261488  80% /usr</code></pre></dd><dt><span class="term"><a id="dmesgref"/><span class="command"><strong>dmesg</strong></span></span></dt><dd><p>Lists all system bootup messages to
        <code class="filename">stdout</code>. Handy for debugging and
        ascertaining which device drivers were installed
        and which system interrupts in use. The output
        of <span class="command"><strong>dmesg</strong></span> may, of course, be
        parsed with <a class="link" href="ch15s04.html#grepref">grep</a>,
        <a class="link" href="apc.html#sedref">sed</a>, or <a class="link" href="apcs02.html#awkref">awk</a> from within a script.</p><p>
        </p><pre class="screen"><code class="prompt">bash$ </code><strong class="userinput"><code>dmesg | grep hda</code></strong>
<code class="computeroutput">Kernel command line: ro root=/dev/hda2
 hda: IBM-DLGA-23080, ATA DISK drive
 hda: 6015744 sectors (3080 MB) w/96KiB Cache, CHS=746/128/63
 hda: hda1 hda2 hda3 &lt; hda5 hda6 hda7 &gt; hda4</code>
        </pre><p>
      </p></dd><dt><span class="term"><a id="statref"/><span class="command"><strong>stat</strong></span></span></dt><dd><p>Gives detailed and verbose <span class="emphasis"><em>stat</em></span>istics 
        on a given file (even a directory or device file) or set
        of files.</p><p>
        </p><pre class="screen"><code class="prompt">bash$ </code><strong class="userinput"><code>stat test.cru</code></strong>
<code class="computeroutput">  File: "test.cru"
   Size: 49970        Allocated Blocks: 100          Filetype: Regular File
   Mode: (0664/-rw-rw-r--)         Uid: (  501/ bozo)  Gid: (  501/ bozo)
 Device:  3,8   Inode: 18185     Links: 1    
 Access: Sat Jun  2 16:40:24 2001
 Modify: Sat Jun  2 16:40:24 2001
 Change: Sat Jun  2 16:40:24 2001</code>
        </pre><p>
      </p><p>If the target file does not exist, <span class="command"><strong>stat</strong></span>
        returns an error message.</p><p>
        </p><pre class="screen"><code class="prompt">bash$ </code><strong class="userinput"><code>stat nonexistent-file</code></strong>
<code class="computeroutput">nonexistent-file: No such file or directory</code>
        </pre><p>
      </p><p>In a script, you can use <span class="command"><strong>stat</strong></span> to extract
        information about files (and filesystems) and set variables
        accordingly.</p><p>
        </p><pre class="programlisting">#!/bin/bash
# fileinfo2.sh

# Per suggestion of Joël Bourquard and . . .
# http://www.linuxquestions.org/questions/showthread.php?t=410766


FILENAME=testfile.txt
file_name=$(stat -c%n "$FILENAME")   # Same as "$FILENAME" of course.
file_owner=$(stat -c%U "$FILENAME")
file_size=$(stat -c%s "$FILENAME")
#  Certainly easier than using "ls -l $FILENAME"
#+ and then parsing with sed.
file_inode=$(stat -c%i "$FILENAME")
file_type=$(stat -c%F "$FILENAME")
file_access_rights=$(stat -c%A "$FILENAME")

echo "File name:          $file_name"
echo "File owner:         $file_owner"
echo "File size:          $file_size"
echo "File inode:         $file_inode"
echo "File type:          $file_type"
echo "File access rights: $file_access_rights"

exit 0

sh fileinfo2.sh

File name:          testfile.txt
File owner:         bozo
File size:          418
File inode:         1730378
File type:          regular file
File access rights: -rw-rw-r--</pre><p>
      </p></dd><dt><span class="term"><a id="vmstatref"/><span class="command"><strong>vmstat</strong></span></span></dt><dd><p>Display virtual memory statistics.</p><p>
      </p><pre class="screen"><code class="prompt">bash$ </code><strong class="userinput"><code>vmstat</code></strong>
<code class="computeroutput">   procs                      memory    swap          io system         cpu
 r  b  w   swpd   free   buff  cache  si  so    bi    bo   in    cs  us  sy id
 0  0  0      0  11040   2636  38952   0   0    33     7  271    88   8   3 89</code>
      </pre><p>
      </p></dd><dt><span class="term"><a id="netstatref"/><span class="command"><strong>netstat</strong></span></span></dt><dd><p>Show current network statistics and information, 
        such as routing tables and active connections. This utility
        accesses information in <code class="filename">/proc/net</code>
        (<a class="xref" href="ch27.html" title="Глава 27. /dev and /proc">Глава 27, <i><code class="filename">/dev</code> and <code class="filename">/proc</code></i></a>). See <a class="xref" href="ch27s02.html#constat" title="Пример 27.4. On-line connect status">Пример 27.4, «On-line connect status»</a>.</p><p><span class="command"><strong>netstat -r</strong></span> is equivalent to <a class="link" href="ch16.html#routeref">route</a>.</p><pre class="screen"><code class="prompt">bash$ </code><strong class="userinput"><code>netstat</code></strong>
<code class="computeroutput">Active Internet connections (w/o servers)
 Proto Recv-Q Send-Q Local Address           Foreign Address         State      
 Active UNIX domain sockets (w/o servers)
 Proto RefCnt Flags       Type       State         I-Node Path
 unix  11     [ ]         DGRAM                    906    /dev/log
 unix  3      [ ]         STREAM     CONNECTED     4514   /tmp/.X11-unix/X0
 unix  3      [ ]         STREAM     CONNECTED     4513
 . . .</code></pre><div class="note" title="Замечание" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Замечание</h3><p>A <span class="command"><strong>netstat -lptu</strong></span> shows <a class="link" href="ch27.html#socketref">sockets</a> that are listening
      to ports, and the associated processes. This can be useful
      for determining whether a computer has been hacked or
      compromised.</p></div></dd><dt><span class="term"><a id="uptimeref"/><span class="command"><strong>uptime</strong></span></span></dt><dd><p>Shows how long the system has been running, along with
        associated statistics.</p><p>
      </p><pre class="screen"><code class="prompt">bash$ </code><strong class="userinput"><code>uptime</code></strong>
<code class="computeroutput">10:28pm  up  1:57,  3 users,  load average: 0.17, 0.34, 0.27</code></pre><p>
      </p><div class="note" title="Замечание" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Замечание</h3><p>A <em class="firstterm">load average</em> of 1 or less
        indicates that the system handles processes immediately. A load
        average greater than 1 means that processes are being queued. When
        the load average gets above 3, then system performance is
        significantly degraded.</p></div></dd><dt><span class="term"><a id="hnameref"/><span class="command"><strong>hostname</strong></span></span></dt><dd><p>Lists the system's host name. This command sets the host
        name in an <code class="filename">/etc/rc.d</code>
        setup script (<code class="filename">/etc/rc.d/rc.sysinit</code>
        or similar).  It is equivalent to <span class="command"><strong>uname
        -n</strong></span>,  and a counterpart to the <a class="link" href="ch09.html#hostnameref">$HOSTNAME</a> internal
        variable.</p><pre class="screen"><code class="prompt">bash$ </code><strong class="userinput"><code>hostname</code></strong>
<code class="computeroutput">localhost.localdomain</code>

<code class="prompt">bash$ </code><strong class="userinput"><code>echo $HOSTNAME</code></strong>
<code class="computeroutput">localhost.localdomain</code></pre><p>Similar to the <span class="command"><strong>hostname</strong></span> command are the
        <span class="command"><strong>domainname</strong></span>,
        <span class="command"><strong>dnsdomainname</strong></span>,
        <span class="command"><strong>nisdomainname</strong></span>, and
        <span class="command"><strong>ypdomainname</strong></span> commands. Use these to
        display or set the system DNS or NIS/YP domain name. Various
        options to <span class="command"><strong>hostname</strong></span> also perform these
        functions.</p></dd><dt><span class="term"><a id="hostidref"/><span class="command"><strong>hostid</strong></span></span></dt><dd><p>Echo a 32-bit hexadecimal numerical identifier for the
        host machine.</p><p>
        </p><pre class="screen"><code class="prompt">bash$ </code><strong class="userinput"><code>hostid</code></strong>
<code class="computeroutput">7f0100</code></pre><p>
      </p><div class="note" title="Замечание" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Замечание</h3><p>This command allegedly fetches a <span class="quote">«<span class="quote">unique</span>»</span>
        serial number for a particular system. Certain
        product registration procedures use this number
        to brand a particular user license. Unfortunately,
        <span class="command"><strong>hostid</strong></span> only returns the machine
        network address in hexadecimal, with pairs of bytes
        transposed.</p><p>The network address of a typical non-networked Linux
        machine, is found in <code class="filename">/etc/hosts</code>.</p><p>
        </p><pre class="screen"><code class="prompt">bash$ </code><strong class="userinput"><code>cat /etc/hosts</code></strong>
<code class="computeroutput">127.0.0.1               localhost.localdomain localhost</code>
</pre><p>
      </p><p>As it happens, transposing the bytes of
        <strong class="userinput"><code>127.0.0.1</code></strong>, we get
        <strong class="userinput"><code>0.127.1.0</code></strong>, which translates in
        hex to <strong class="userinput"><code>007f0100</code></strong>, the exact equivalent
        of what <span class="command"><strong>hostid</strong></span> returns, above. There
        exist only a few million other Linux machines with this
        identical <em class="firstterm">hostid</em>.</p></div></dd><dt><span class="term"><a id="sarref"/><span class="command"><strong>sar</strong></span></span></dt><dd><p>Invoking <span class="command"><strong>sar</strong></span> (System Activity Reporter)
        gives a very detailed rundown on system statistics. The
        Santa Cruz Operation (<span class="quote">«<span class="quote">Old</span>»</span> SCO) released
        <span class="command"><strong>sar</strong></span> as Open Source in June, 1999.</p><p>This command is not part of the base Linux distribution,
        but may be obtained as part of the<a class="ulink" href="http://perso.wanadoo.fr/sebastien.godard/">
        sysstat utilities</a> package, written by <a class="ulink" href="mailto:sebastien.godard@wanadoo.fr">Sebastien
        Godard</a>.</p><pre class="screen">
<code class="prompt">bash$ </code><strong class="userinput"><code>sar</code></strong>
<code class="computeroutput">Linux 2.4.9 (brooks.seringas.fr)  09/26/03

10:30:00          CPU     %user     %nice   %system   %iowait     %idle
10:40:00          all      2.21     10.90     65.48      0.00     21.41
10:50:00          all      3.36      0.00     72.36      0.00     24.28
11:00:00          all      1.12      0.00     80.77      0.00     18.11
Average:          all      2.23      3.63     72.87      0.00     21.27

14:32:30          LINUX RESTART

15:00:00          CPU     %user     %nice   %system   %iowait     %idle
15:10:00          all      8.59      2.40     17.47      0.00     71.54
15:20:00          all      4.07      1.00     11.95      0.00     82.98
15:30:00          all      0.79      2.94      7.56      0.00     88.71
Average:          all      6.33      1.70     14.71      0.00     77.26</code>
           </pre></dd><dt><span class="term"><a id="readelfref"/><span class="command"><strong>readelf</strong></span></span></dt><dd><p>Show information and statistics about a designated
        <em class="firstterm">elf</em> binary. This is part of the
        <em class="firstterm">binutils</em> package.</p><pre class="screen"><code class="prompt">bash$ </code><strong class="userinput"><code>readelf -h /bin/bash</code></strong>
<code class="computeroutput">ELF Header:
   Magic:   7f 45 4c 46 01 01 01 00 00 00 00 00 00 00 00 00 
   Class:                             ELF32
   Data:                              2's complement, little endian
   Version:                           1 (current)
   OS/ABI:                            UNIX - System V
   ABI Version:                       0
   Type:                              EXEC (Executable file)
   . . .</code></pre></dd><dt><span class="term"><a id="sizeref"/><span class="command"><strong>size</strong></span></span></dt><dd><p>The <span class="command"><strong>size [/path/to/binary]</strong></span> command
        gives the segment sizes of a binary executable or archive file.
        This is mainly of use to programmers.</p><p>
        </p><pre class="screen"><code class="prompt">bash$ </code><strong class="userinput"><code>size /bin/bash</code></strong>
<code class="computeroutput">   text    data     bss     dec     hex filename
  495971   22496   17392  535859   82d33 /bin/bash</code>
        </pre><p>
      </p></dd></dl></div><div class="variablelist" title="System Logs"><a id="syslog"/><p class="title"><b><a id="syslog1"/>System Logs</b></p><dl><dt><span class="term"><a id="loggerref"/><span class="command"><strong>logger</strong></span></span></dt><dd><p>Appends a user-generated message to the system log
        (<code class="filename">/var/log/messages</code>). You do not have
        to be <em class="firstterm">root</em> to invoke
        <span class="command"><strong>logger</strong></span>.</p><p>
        </p><pre class="programlisting">logger Experiencing instability in network connection at 23:10, 05/21.
# Now, do a 'tail /var/log/messages'.</pre><p>By embedding a <span class="command"><strong>logger</strong></span> command in a script,
        it is possible to write debugging information to
        <code class="filename">/var/log/messages</code>.</p><pre class="programlisting">logger -t $0 -i Logging at line "$LINENO".
# The "-t" option specifies the tag for the logger entry.
# The "-i" option records the process ID.

# tail /var/log/message
# ...
# Jul  7 20:48:58 localhost ./test.sh[1712]: Logging at line 3.</pre><p>
            </p></dd><dt><span class="term"><a id="logrotateref"/><span class="command"><strong>logrotate</strong></span></span></dt><dd><p>This utility manages the system log files, rotating,
        compressing, deleting, and/or e-mailing them, as appropriate.
        This keeps the <code class="filename">/var/log</code>
        from getting cluttered with old log files.
        Usually <a class="link" href="ch16.html#cronref">cron</a> runs
        <span class="command"><strong>logrotate</strong></span> on a daily basis.</p><p>Adding an appropriate entry to
         <code class="filename">/etc/logrotate.conf</code> makes it possible
         to manage personal log files, as well as system-wide
         ones.</p><div class="note" title="Замечание" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Замечание</h3><p>Stefano Falsetto has created <a class="ulink" href="http://www.gnu.org/software/rottlog/">rottlog</a>,
       which he considers to be an improved version of
       <span class="command"><strong>logrotate</strong></span>.</p></div></dd></dl></div><div class="variablelist" title="Job Control"><a id="jobcontrolsys"/><p class="title"><b><a id="jobcontrolsys1"/>Job Control</b></p><dl><dt><span class="term"><a id="ppssref"/><span class="command"><strong>ps</strong></span></span></dt><dd><p><em class="replaceable"><code>P</code></em>rocess
        <em class="replaceable"><code>S</code></em>tatistics: lists currently
        executing processes by owner and PID (process ID). This
        is usually invoked with <code class="option">ax</code> or
        <code class="option">aux</code> options,
        and may be piped to <a class="link" href="ch15s04.html#grepref">grep</a>
        or <a class="link" href="apc.html#sedref">sed</a> to search for a
        specific process (see <a class="xref" href="ch14.html#ex44" title="Пример 14.14. Forcing a log-off">Пример 14.14, «Forcing a log-off»</a> and <a class="xref" href="ch27s02.html#pidid" title="Пример 27.3. Finding the process associated with a PID">Пример 27.3, «Finding the process associated with a PID»</a>).</p><pre class="screen"><code class="prompt">bash$ </code><strong class="userinput"><code> ps ax | grep sendmail</code></strong>
<code class="computeroutput">295 ?    S    0:00 sendmail: accepting connections on port 25</code></pre><p>To display system processes in graphical <span class="quote">«<span class="quote">tree</span>»</span>
        format: <span class="command"><strong>ps afjx</strong></span> or
        <span class="command"><strong>ps ax --forest</strong></span>.</p></dd><dt><span class="term"><a id="pgrepref"/><span class="command"><strong>pgrep</strong></span>, </span><span class="term"><a id="pkillref"/><span class="command"><strong>pkill</strong></span></span></dt><dd><p>Combining the <span class="command"><strong>ps</strong></span> command
        with <a class="link" href="ch15s04.html#grepref">grep</a> or
        <a class="link" href="ch14.html#killref">kill</a>.</p><p>
        </p><pre class="screen"><code class="prompt">bash$ </code><strong class="userinput"><code>ps a | grep mingetty</code></strong>
<code class="computeroutput">2212 tty2     Ss+    0:00 /sbin/mingetty tty2
 2213 tty3     Ss+    0:00 /sbin/mingetty tty3
 2214 tty4     Ss+    0:00 /sbin/mingetty tty4
 2215 tty5     Ss+    0:00 /sbin/mingetty tty5
 2216 tty6     Ss+    0:00 /sbin/mingetty tty6
 4849 pts/2    S+     0:00 grep mingetty</code>


<code class="prompt">bash$ </code><strong class="userinput"><code>pgrep mingetty</code></strong>
<code class="computeroutput">2212 mingetty
 2213 mingetty
 2214 mingetty
 2215 mingetty
 2216 mingetty</code>
        </pre><p>
      </p><p>Compare the action of <span class="command"><strong>pkill</strong></span> with <a class="link" href="ch14.html#killallref">killall</a>.</p></dd><dt><span class="term"><a id="pstreeref"/><span class="command"><strong>pstree</strong></span></span></dt><dd><p>Lists currently executing processes in
        <span class="quote">«<span class="quote">tree</span>»</span> format. The <code class="option">-p</code> option
        shows the PIDs, as well as the process names.</p></dd><dt><span class="term"><a id="topref"/><span class="command"><strong>top</strong></span></span></dt><dd><p>Continuously updated display of most cpu-intensive
        processes. The <code class="option">-b</code> option displays in text
        mode, so that the output may be parsed or accessed from
        a script.</p><p>
        </p><pre class="screen"><code class="prompt">bash$ </code><strong class="userinput"><code>top -b</code></strong>
<code class="computeroutput">  8:30pm  up 3 min,  3 users,  load average: 0.49, 0.32, 0.13
 45 processes: 44 sleeping, 1 running, 0 zombie, 0 stopped
 CPU states: 13.6% user,  7.3% system,  0.0% nice, 78.9% idle
 Mem:    78396K av,   65468K used,   12928K free,       0K shrd,    2352K buff
 Swap:  157208K av,       0K used,  157208K free                   37244K cached

   PID USER     PRI  NI  SIZE  RSS SHARE STAT %CPU %MEM   TIME COMMAND
   848 bozo      17   0   996  996   800 R     5.6  1.2   0:00 top
     1 root       8   0   512  512   444 S     0.0  0.6   0:04 init
     2 root       9   0     0    0     0 SW    0.0  0.0   0:00 keventd
   ...</code>  
        </pre><p>
      </p></dd><dt><span class="term"><a id="niceref"/><span class="command"><strong>nice</strong></span></span></dt><dd><p><a id="nice2ref"/></p><p>Run a background job with an altered
        priority. Priorities run from 19 (lowest) to -20
        (highest). Only <em class="firstterm">root</em> may set the
        negative (higher) priorities. Related commands are
        <span class="command"><strong>renice</strong></span> and <span class="command"><strong>snice</strong></span>,
        which change the priority of a running process or
        processes, and <span class="command"><strong>skill</strong></span>, which sends a
        <a class="link" href="ch14.html#killref">kill</a> signal to a process
        or processes.</p></dd><dt><span class="term"><a id="nohupref"/><span class="command"><strong>nohup</strong></span></span></dt><dd><p>Keeps a command running even after user logs off.
        The command will run as a foreground process unless followed
        by <span class="token">&amp;amp;</span>.  If you use <span class="command"><strong>nohup</strong></span>
        within a script, consider coupling it with a <a class="link" href="ch14.html#waitref">wait</a> to avoid creating an
        <em class="firstterm">orphan</em> or
        <a class="link" href="ch14.html#zombieref">zombie</a> process.</p></dd><dt><span class="term"><a id="pidofref"/><span class="command"><strong>pidof</strong></span></span></dt><dd><p>Identifies <em class="firstterm">process ID (PID)</em> of a
      running job. Since job control commands, such as <a class="link" href="ch14.html#killref">kill</a> and <a class="link" href="ch16.html#nice2ref">renice</a> act on the
      <em class="firstterm">PID</em> of a process (not its
      name), it is sometimes necessary to identify that
      <em class="firstterm">PID</em>. The <span class="command"><strong>pidof</strong></span>
      command is the approximate counterpart to the <a class="link" href="ch09.html#ppidref">$PPID</a> internal variable.</p><p>
        </p><pre class="screen"><code class="prompt">bash$ </code><strong class="userinput"><code>pidof xclock</code></strong>
<code class="computeroutput">880</code>
        </pre><p>
      </p><div class="example"><a id="killprocess"/><p class="title"><b>Пример 16.6. <em class="firstterm">pidof</em> helps kill a process</b></p><div class="example-contents"><pre class="programlisting">&amp;killprocess;</pre></div></div><br class="example-break"/></dd><dt><span class="term"><a id="fuserref"/><span class="command"><strong>fuser</strong></span></span></dt><dd><p>Identifies the processes (by PID) that are accessing
        a given file, set of files, or directory. May also be
        invoked with the <code class="option">-k</code> option, which kills
        those processes. This has interesting implications for
        system security, especially in scripts preventing
        unauthorized users from accessing system services.</p><p>
        </p><pre class="screen"><code class="prompt">bash$ </code><strong class="userinput"><code>fuser -u /usr/bin/vim</code></strong>
<code class="computeroutput">/usr/bin/vim:         3207e(bozo)</code>



<code class="prompt">bash$ </code><strong class="userinput"><code>fuser -u /dev/null</code></strong>
<code class="computeroutput">/dev/null:            3009(bozo)  3010(bozo)  3197(bozo)  3199(bozo)</code>
        </pre><p>
      </p><p>One important application for <span class="command"><strong>fuser</strong></span> is
       when physically inserting or removing storage media, such
       as CD ROM disks or USB flash drives. Sometimes trying
       a <a class="link" href="ch16.html#umountref">umount</a> fails with a
       <span class="errorname">device is busy</span> error message. This
       means that some user(s) and/or process(es) are accessing
       the device. An <span class="command"><strong>fuser -um /dev/device_name</strong></span>
       will clear up the mystery, so you can kill any relevant
       processes.</p><p>
        </p><pre class="screen"><code class="prompt">bash$ </code><strong class="userinput"><code>umount /mnt/usbdrive</code></strong>
<code class="computeroutput">umount: /mnt/usbdrive: device is busy</code>



<code class="prompt">bash$ </code><strong class="userinput"><code>fuser -um /dev/usbdrive</code></strong>
<code class="computeroutput">/mnt/usbdrive:        1772c(bozo)</code>

<code class="prompt">bash$ </code><strong class="userinput"><code>kill -9 1772</code></strong>
<code class="prompt">bash$ </code><strong class="userinput"><code>umount /mnt/usbdrive</code></strong>
        </pre><p>
      </p><p> The <span class="command"><strong>fuser</strong></span> command, invoked with the
        <code class="option">-n</code> option identifies the processes
        accessing a <em class="firstterm">port</em>. This
        is especially useful in combination with <a class="link" href="ch16.html#nmapref">nmap</a>.</p><p>
        </p><pre class="screen"><code class="prompt">root# </code><strong class="userinput"><code>nmap localhost.localdomain</code></strong>
<code class="computeroutput">PORT     STATE SERVICE
 25/tcp   open  smtp</code>



<code class="prompt">root# </code><strong class="userinput"><code>fuser -un tcp 25</code></strong>
<code class="computeroutput">25/tcp:               2095(root)</code>

<code class="prompt">root# </code><strong class="userinput"><code>ps ax | grep 2095 | grep -v grep</code></strong>
<code class="computeroutput">2095 ?        Ss     0:00 sendmail: accepting connections</code>
        </pre><p>
            </p></dd><dt><span class="term"><a id="cronref"/><span class="command"><strong>cron</strong></span></span></dt><dd><p>Administrative program scheduler, performing such
        duties as cleaning up and deleting system log files and
        updating the <span class="database">slocate</span> database. This
        is the <em class="firstterm">superuser</em> version of <a class="link" href="ch15s03.html#atref">at</a> (although each user may have
        their own <code class="filename">crontab</code> file which can be
        changed with the <span class="command"><strong>crontab</strong></span> command).
        It runs as a <a class="link" href="ch15s06.html#daemonref">daemon</a>
        and executes scheduled entries from
        <code class="filename">/etc/crontab</code>.</p><div class="note" title="Замечание" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Замечание</h3><p>Some flavors of Linux run
        <span class="command"><strong>crond</strong></span>, Matthew Dillon's version of
        <span class="command"><strong>cron</strong></span>.</p></div></dd></dl></div><div class="variablelist" title="Process Control and Booting"><a id="runcontrolsys"/><p class="title"><b><a id="runcontrolsys1"/>Process Control and Booting</b></p><dl><dt><span class="term"><a id="initref"/><span class="command"><strong>init</strong></span></span></dt><dd><p><a id="inittabref"/></p><p>The <span class="command"><strong>init</strong></span> command is the <a class="link" href="ch14.html#forkref">parent</a> of all processes. Called
        in the final step of a bootup, <span class="command"><strong>init</strong></span>
        determines the runlevel of the system from
        <code class="filename">/etc/inittab</code>. Invoked by its alias
        <span class="command"><strong>telinit</strong></span>, and by
        <em class="firstterm">root</em> only.</p></dd><dt><span class="term"><a id="telinitref"/><span class="command"><strong>telinit</strong></span></span></dt><dd><p>Symlinked to <span class="command"><strong>init</strong></span>, this is a means of changing the system runlevel,
        usually done for system maintenance or emergency filesystem
        repairs. Invoked only by <em class="firstterm">root</em>. This
        command can be dangerous -- be certain you understand it
        well before using!</p></dd><dt><span class="term"><a id="runlevelref"/><span class="command"><strong>runlevel</strong></span></span></dt><dd><p>Shows the current and last runlevel, that is, whether the system
        is halted (runlevel <code class="literal">0</code>), in single-user mode
        (<code class="literal">1</code>), in multi-user mode (<code class="literal">2</code>
        or <code class="literal">3</code>), in X Windows (<code class="literal">5</code>), or
        rebooting (<code class="literal">6</code>). This command accesses the
        <code class="filename">/var/run/utmp</code> file.</p></dd><dt><span class="term"><a id="haltref"/><span class="command"><strong>halt</strong></span>, </span><span class="term"><a id="shutdownref"/><span class="command"><strong>shutdown</strong></span>, </span><span class="term"><a id="rebootref"/><span class="command"><strong>reboot</strong></span></span></dt><dd><p>Command set to shut the system down, usually just prior to a power down.</p><div class="warning" title="Внимание" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Внимание</h3><p>On some Linux distros, the <span class="command"><strong>halt</strong></span> command
        has 755 permissions, so it can be invoked by a non-root user.
        A careless <em class="firstterm">halt</em> in a terminal or a script
        may shut down the system!</p></div></dd><dt><span class="term"><a id="serviceref"/><span class="command"><strong>service</strong></span></span></dt><dd><p>Starts or stops a system <em class="firstterm">service</em>.
      The startup scripts in <code class="filename">/etc/init.d</code>
      and <code class="filename">/etc/rc.d</code> use this
      command to start services at bootup.</p><p>
        </p><pre class="screen"><code class="prompt">root# </code><strong class="userinput"><code>/sbin/service iptables stop</code></strong>
<code class="computeroutput">Flushing firewall rules:                                   [  OK  ]
 Setting chains to policy ACCEPT: filter                    [  OK  ]
 Unloading iptables modules:                                [  OK  ]</code>
        </pre><p>
      </p></dd></dl></div><div class="variablelist" title="Network"><a id="networksys"/><p class="title"><b><a id="networksys1"/>Network</b></p><dl><dt><span class="term"><a id="ifconfigref"/><span class="command"><strong>ifconfig</strong></span></span></dt><dd><p>Network <em class="firstterm">interface configuration</em>
        and tuning utility.</p><pre class="screen"><code class="prompt">bash$ </code><strong class="userinput"><code>ifconfig -a</code></strong>
<code class="computeroutput">lo        Link encap:Local Loopback
           inet addr:127.0.0.1  Mask:255.0.0.0
           UP LOOPBACK RUNNING  MTU:16436  Metric:1
           RX packets:10 errors:0 dropped:0 overruns:0 frame:0
           TX packets:10 errors:0 dropped:0 overruns:0 carrier:0
           collisions:0 txqueuelen:0 
           RX bytes:700 (700.0 b)  TX bytes:700 (700.0 b)</code></pre><p>The <span class="command"><strong>ifconfig</strong></span> command is most often used
        at bootup to set up the interfaces, or to shut them down
        when rebooting.</p><pre class="programlisting"># Code snippets from /etc/rc.d/init.d/network

# ...

# Check that networking is up.
[ ${NETWORKING} = "no" ] &amp;&amp; exit 0

[ -x /sbin/ifconfig ] || exit 0

# ...

for i in $interfaces ; do
  if ifconfig $i 2&gt;/dev/null | grep -q "UP" &gt;/dev/null 2&gt;&amp;1 ; then
    action "Shutting down interface $i: " ./ifdown $i boot
  fi
#  The GNU-specific "-q" option to "grep" means "quiet", i.e.,
#+ producing no output.
#  Redirecting output to /dev/null is therefore not strictly necessary.
       
# ...

echo "Currently active devices:"
echo `/sbin/ifconfig | grep ^[a-z] | awk '{print $1}'`
#                            ^^^^^  should be quoted to prevent globbing.
#  The following also work.
#    echo $(/sbin/ifconfig | awk '/^[a-z]/ { print $1 })'
#    echo $(/sbin/ifconfig | sed -e 's/ .*//')
#  Thanks, S.C., for additional comments.</pre><p>See also <a class="xref" href="ch29.html#online" title="Пример 29.6. Cleaning up after Control-C">Пример 29.6, «Cleaning up after <span class="keycap">Control-C</span>»</a>.</p></dd><dt><span class="term"><a id="iwconfigref"/><span class="command"><strong>iwconfig</strong></span></span></dt><dd><p>This is the command set for configuring a wireless network.
        It is the wireless equivalent of <span class="command"><strong>ifconfig</strong></span>,
        above.</p></dd><dt><span class="term"><a id="ipref"/><span class="command"><strong>ip</strong></span></span></dt><dd><p>General purpose utility for setting up, changing, and
        analyzing <em class="firstterm">IP</em> (Internet Protocol)
        networks and attached devices. This command is part of
        the <em class="firstterm">iproute2</em> package.</p><p>
        </p><pre class="screen"><code class="prompt">bash$ </code><strong class="userinput"><code>ip link show</code></strong>
<code class="computeroutput">1: lo: &lt;LOOPBACK,UP&gt; mtu 16436 qdisc noqueue 
     link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
 2: eth0: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc pfifo_fast qlen 1000
     link/ether 00:d0:59:ce:af:da brd ff:ff:ff:ff:ff:ff
 3: sit0: &lt;NOARP&gt; mtu 1480 qdisc noop 
     link/sit 0.0.0.0 brd 0.0.0.0</code>


<code class="prompt">bash$ </code><strong class="userinput"><code>ip route list</code></strong>
<code class="computeroutput">169.254.0.0/16 dev lo  scope link</code>
        </pre><p>
      </p><p>Or, in a script:</p><p>
              </p><pre class="programlisting">&amp;ipscript;</pre><p>
      </p></dd><dt><span class="term"><a id="routeref"/><span class="command"><strong>route</strong></span></span></dt><dd><p>Show info about or make changes to the kernel routing table.</p><p>
        </p><pre class="screen"><code class="prompt">bash$ </code><strong class="userinput"><code>route</code></strong>
<code class="computeroutput">Destination     Gateway         Genmask         Flags   MSS Window  irtt Iface
 pm3-67.bozosisp *               255.255.255.255 UH       40 0          0 ppp0
 127.0.0.0       *               255.0.0.0       U        40 0          0 lo
 default         pm3-67.bozosisp 0.0.0.0         UG       40 0          0 ppp0</code>
        </pre><p>
      </p></dd><dt><span class="term"><a id="chkconfigref"/><span class="command"><strong>chkconfig</strong></span></span></dt><dd><p>Check network and system configuration. This command
        lists and
        manages the network and system services started at bootup in
        the <code class="filename">/etc/rc?.d</code>
        directory.</p><p>Originally a port from IRIX to Red Hat Linux,
        <span class="command"><strong>chkconfig</strong></span> may not be part of the core
        installation of some Linux flavors.</p><p>
        </p><pre class="screen"><code class="prompt">bash$ </code><strong class="userinput"><code>chkconfig --list</code></strong>
<code class="computeroutput">atd             0:off   1:off   2:off   3:on    4:on    5:on    6:off
 rwhod           0:off   1:off   2:off   3:off   4:off   5:off   6:off
 ...</code>
        </pre><p>
      </p></dd><dt><span class="term"><a id="tcpdumpref"/><span class="command"><strong>tcpdump</strong></span></span></dt><dd><p>Network packet <span class="quote">«<span class="quote">sniffer.</span>»</span> This is a tool for
        analyzing and troubleshooting traffic on a network by dumping
        packet headers that match specified criteria.</p><p>Dump ip packet traffic between hosts
          <span class="emphasis"><em>bozoville</em></span> and
          <span class="emphasis"><em>caduceus</em></span>:</p><p>
        </p><pre class="screen"><code class="prompt">bash$ </code><strong class="userinput"><code>tcpdump ip host bozoville and caduceus</code></strong>
        </pre><p>
        </p><p>Of course, the output of <span class="command"><strong>tcpdump</strong></span> can be
          parsed with certain of the previously discussed <a class="link" href="ch15s04.html#tpcommandlisting1">text processing
    utilities</a>.</p></dd></dl></div><div class="variablelist" title="Filesystem"><a id="filesystemsys"/><p class="title"><b><a id="filesystemsys1"/>Filesystem</b></p><dl><dt><span class="term"><a id="mountref"/><span class="command"><strong>mount</strong></span></span></dt><dd><p>Mount a filesystem, usually on an external device,
        such as a floppy or CDROM. <a id="fstabref"/>The file
        <code class="filename">/etc/fstab</code> provides a handy listing
        of available filesystems, partitions, and devices,
        including options, that may be automatically or manually
        mounted. The file <code class="filename">/etc/mtab</code> shows
        the currently mounted filesystems and partitions
        (including the virtual ones, such as <code class="filename">/proc</code>).</p><p><span class="command"><strong>mount -a</strong></span> mounts all filesystems and
        partitions listed in <code class="filename">/etc/fstab</code>,
        except those with a <code class="option">noauto</code>
        option. At bootup, a startup script in
        <code class="filename">/etc/rc.d</code>
        (<code class="filename">rc.sysinit</code> or something similar)
        invokes this to get everything mounted.</p><pre class="programlisting">mount -t iso9660 /dev/cdrom /mnt/cdrom
# Mounts CD ROM. ISO 9660 is a standard CD ROM filesystem.
mount /mnt/cdrom
# Shortcut, if /mnt/cdrom listed in /etc/fstab</pre><p>
     </p><p><a id="isomountref0"/></p><p>The versatile <em class="firstterm">mount</em> command can even
       mount an ordinary file on a block device, and the file will
       act as if it were a filesystem. <em class="firstterm">Mount</em>
       accomplishes that by associating the file with a <a class="link" href="ch27.html#loopbackref">loopback device</a>. One application of
       this is to mount and examine an ISO9660 filesystem image before
       burning it onto a CDR.

    <sup>[<a id="idp15044688" href="#ftn.idp15044688" class="footnote">80</a>]</sup>

       </p><div class="example"><a id="isomountref"/><p class="title"><b>Пример 16.7. Checking a CD image</b></p><div class="example-contents"><pre class="programlisting"># As root...

mkdir /mnt/cdtest  # Prepare a mount point, if not already there.

mount -r -t iso9660 -o loop cd-image.iso /mnt/cdtest   # Mount the image.
#                  "-o loop" option equivalent to "losetup /dev/loop0"
cd /mnt/cdtest     # Now, check the image.
ls -alR            # List the files in the directory tree there.
                   # And so forth.</pre></div></div><br class="example-break"/></dd><dt><span class="term"><a id="umountref"/><span class="command"><strong>umount</strong></span></span></dt><dd><p>Unmount a currently mounted filesystem. Before physically removing a
        previously mounted floppy or CDROM disk, the device must be
        <span class="command"><strong>umount</strong></span>ed, else filesystem corruption may result.
        </p><pre class="programlisting">umount /mnt/cdrom
# You may now press the eject button and safely remove the disk.</pre><div class="note" title="Замечание" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Замечание</h3><p>The <span class="command"><strong>automount</strong></span> utility, if
    properly installed, can mount and unmount floppies or
    CDROM disks as they are accessed or removed. On
    <span class="quote">«<span class="quote">multispindle</span>»</span> laptops with swappable
    floppy and optical drives, this can cause problems,
    however.</p></div></dd><dt><span class="term"><a id="gnomemountref"/><span class="command"><strong>gnome-mount</strong></span></span></dt><dd><p>The newer Linux distros have deprecated
      <span class="command"><strong>mount</strong></span> and <span class="command"><strong>umount</strong></span>.
      The successor, for command-line mounting of removable storage
      devices, is <span class="command"><strong>gnome-mount</strong></span>. It can take the
      <code class="option">-d</code> option to mount a <a class="link" href="ch27.html#devfileref">device file</a> by its listing in
      <code class="filename">/dev</code>.</p><p>For example, to mount a USB flash drive:</p><p>
      </p><pre class="screen"><code class="prompt">bash$ </code><strong class="userinput"><code>gnome-mount -d /dev/sda1</code></strong>
<code class="computeroutput">gnome-mount 0.4</code>


<code class="prompt">bash$ </code><strong class="userinput"><code>df</code></strong>
<code class="computeroutput">. . .
 /dev/sda1                63584     12034     51550  19% /media/disk</code>
 </pre><p>
      </p></dd><dt><span class="term"><a id="syncref"/><span class="command"><strong>sync</strong></span></span></dt><dd><p>Forces an immediate write of all updated data from
        buffers to hard drive (synchronize drive
        with buffers). While not strictly necessary, a
        <span class="command"><strong>sync</strong></span> assures the sys admin or
        user that the data just changed will survive a sudden
        power failure. In the olden days, a <strong class="userinput"><code>sync;
        sync</code></strong> (twice, just to make absolutely sure) was a
        useful precautionary measure before a system reboot.</p><p>At times, you may wish to force an immediate buffer
        flush, as when securely deleting a file (see <a class="xref" href="ch15s09.html#blotout" title="Пример 15.60. Securely deleting a file">Пример 15.60, «Securely deleting a file»</a>) or when the lights begin to
        flicker.</p></dd><dt><span class="term"><a id="losetupref"/><span class="command"><strong>losetup</strong></span></span></dt><dd><p>Sets up and configures <a class="link" href="ch27.html#loopbackref">
        loopback devices</a>.</p><div class="example"><a id="createfs"/><p class="title"><b>Пример 16.8. Creating a filesystem in a file</b></p><div class="example-contents"><pre class="programlisting">SIZE=1000000  # 1 meg

head -c $SIZE &lt; /dev/zero &gt; file  # Set up file of designated size.
losetup /dev/loop0 file           # Set it up as loopback device.
mke2fs /dev/loop0                 # Create filesystem.
mount -o loop /dev/loop0 /mnt     # Mount it.

# Thanks, S.C.</pre></div></div><br class="example-break"/></dd><dt><span class="term"><a id="mkswapref"/><span class="command"><strong>mkswap</strong></span></span></dt><dd><p>Creates a swap partition or file. The swap area must
        subsequently be enabled with
        <span class="command"><strong>swapon</strong></span>.</p></dd><dt><span class="term"><a id="swaponref"/><span class="command"><strong>swapon</strong></span>, </span><span class="term"><a id="swapoffref"/><span class="command"><strong>swapoff</strong></span></span></dt><dd><p>Enable / disable swap partitition or file.
        These commands usually take effect at bootup and
        shutdown.</p></dd><dt><span class="term"><a id="mke2fsref"/><span class="command"><strong>mke2fs</strong></span></span></dt><dd><p>Create a Linux <em class="firstterm">ext2</em>
        filesystem. This command must be invoked as
        <em class="firstterm">root</em>.</p><div class="example"><a id="adddrv"/><p class="title"><b>Пример 16.9. Adding a new hard drive</b></p><div class="example-contents"><pre class="programlisting">&amp;adddrv;</pre></div></div><br class="example-break"/><p>See also <a class="xref" href="ch16.html#createfs" title="Пример 16.8. Creating a filesystem in a file">Пример 16.8, «Creating a filesystem in a file»</a> and <a class="xref" href="ch28.html#ramdisk" title="Пример 28.3. Creating a ramdisk">Пример 28.3, «Creating a ramdisk»</a>.</p></dd><dt><span class="term"><a id="tune2fsref"/><span class="command"><strong>tune2fs</strong></span></span></dt><dd><p>Tune <em class="firstterm">ext2</em> filesystem. May be
        used to change filesystem parameters, such as maximum
        mount count. This must be invoked as
        <em class="firstterm">root</em>.</p><div class="warning" title="Внимание" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Внимание</h3><p>This is an extremely dangerous command. Use it at
        your own risk, as you may inadvertently destroy your filesystem.
        </p></div></dd><dt><span class="term"><a id="dumpe2fsref"/><span class="command"><strong>dumpe2fs</strong></span></span></dt><dd><p>Dump (list to <code class="filename">stdout</code>) very verbose
        filesystem info. This must be invoked as
        <em class="firstterm">root</em>.</p><pre class="screen"><code class="prompt">root# </code><span class="command"><strong>dumpe2fs /dev/hda7 | grep 'ount count'</strong></span>
<code class="computeroutput">dumpe2fs 1.19, 13-Jul-2000 for EXT2 FS 0.5b, 95/08/09
 Mount count:              6
 Maximum mount count:      20</code></pre></dd><dt><span class="term"><a id="hdparmref"/><span class="command"><strong>hdparm</strong></span></span></dt><dd><p>List or change hard disk parameters. This command must be
        invoked as <em class="firstterm">root</em>, and it may be
        dangerous if misused.</p></dd><dt><span class="term"><a id="fdiskref"/><span class="command"><strong>fdisk</strong></span></span></dt><dd><p>Create or change a partition table on a storage device,
        usually a hard drive. This command must be invoked as
        <em class="firstterm">root</em>.</p><div class="warning" title="Внимание" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Внимание</h3><p>Use this command with extreme caution. If something
        goes wrong, you may destroy an existing
        filesystem.</p></div></dd><dt><span class="term"><a id="fsckref"/><span class="command"><strong>fsck</strong></span>, </span><span class="term"><a id="e2fsckref"/><span class="command"><strong>e2fsck</strong></span>, </span><span class="term"><a id="debugfsref"/><span class="command"><strong>debugfs</strong></span></span></dt><dd><p>Filesystem check, repair, and debug command set.</p><p><span class="command"><strong>fsck</strong></span>: a front end for checking a UNIX
        filesystem (may invoke other utilities). The actual
        filesystem type generally defaults to
        <em class="firstterm">ext2</em>.</p><p><span class="command"><strong>e2fsck</strong></span>: ext2 filesystem checker.</p><p><span class="command"><strong>debugfs</strong></span>: ext2 filesystem debugger.
        One of the uses of this versatile, but dangerous command
        is to (attempt to) recover deleted files. For advanced users
        only!</p><div class="caution" title="Предостережение" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Предостережение</h3><p>All of these should be invoked as
        <em class="firstterm">root</em>, and they can damage or destroy
        a filesystem if misused.</p></div></dd><dt><span class="term"><a id="badblocksref"/><span class="command"><strong>badblocks</strong></span></span></dt><dd><p>Checks for bad blocks (physical media flaws) on a
        storage device.  This command finds use when formatting
        a newly installed hard drive or testing the integrity
        of backup media.
          <sup>[<a id="idp15165008" href="#ftn.idp15165008" class="footnote">81</a>]</sup>
        As an example, <span class="command"><strong>badblocks /dev/fd0</strong></span>
        tests a floppy disk.</p><p>The <span class="command"><strong>badblocks</strong></span> command
        may be invoked destructively (overwrite all data) or
        in non-destructive read-only mode. If <em class="firstterm">root
        user</em> owns the device to be tested, as is
        generally the case, then <em class="firstterm">root</em>
        must invoke this command.</p></dd><dt><span class="term"><a id="lsusbref"/><span class="command"><strong>lsusb</strong></span>, </span><span class="term"><span class="command"><strong>usbmodules</strong></span></span></dt><dd><p>The <span class="command"><strong>lsusb</strong></span> command lists all USB
        (Universal Serial Bus) buses and the devices hooked up to
        them.</p><p>The <span class="command"><strong>usbmodules</strong></span> command outputs
        information about the driver modules for connected USB
        devices.</p><p>
        </p><pre class="screen"><code class="prompt">bash$ </code><strong class="userinput"><code>lsusb</code></strong>
<code class="computeroutput">Bus 001 Device 001: ID 0000:0000  
 Device Descriptor:
   bLength                18
   bDescriptorType         1
   bcdUSB               1.00
   bDeviceClass            9 Hub
   bDeviceSubClass         0 
   bDeviceProtocol         0 
   bMaxPacketSize0         8
   idVendor           0x0000 
   idProduct          0x0000

   . . .</code>
        </pre><p>
            </p></dd><dt><span class="term"><a id="lspciref"/><span class="command"><strong>lspci</strong></span></span></dt><dd><p>Lists <em class="firstterm">pci</em> busses present.</p><p>
        </p><pre class="screen"><code class="prompt">bash$ </code><strong class="userinput"><code>lspci</code></strong>
<code class="computeroutput">00:00.0 Host bridge: Intel Corporation 82845 845
 (Brookdale) Chipset Host Bridge (rev 04)
 00:01.0 PCI bridge: Intel Corporation 82845 845
 (Brookdale) Chipset AGP Bridge (rev 04)
 00:1d.0 USB Controller: Intel Corporation 82801CA/CAM USB (Hub #1) (rev 02)
 00:1d.1 USB Controller: Intel Corporation 82801CA/CAM USB (Hub #2) (rev 02)
 00:1d.2 USB Controller: Intel Corporation 82801CA/CAM USB (Hub #3) (rev 02)
 00:1e.0 PCI bridge: Intel Corporation 82801 Mobile PCI Bridge (rev 42)

   . . .</code>
        </pre><p>
            </p></dd><dt><span class="term"><a id="mkbootdiskref"/><span class="command"><strong>mkbootdisk</strong></span></span></dt><dd><p>Creates a boot floppy which can be used to bring up the
        system if, for example, the MBR (master boot record) becomes
        corrupted. Of special interest is the <code class="option">--iso</code>
        option, which uses <span class="command"><strong>mkisofs</strong></span> to create a
        bootable <em class="firstterm">ISO9660</em> filesystem image
        suitable for burning a bootable CDR.</p><p>The <span class="command"><strong>mkbootdisk</strong></span> command is actually
        a Bash script, written by Erik Troan, in the <code class="filename">/sbin</code> directory.</p></dd><dt><span class="term"><a id="mkisofsref"/><span class="command"><strong>mkisofs</strong></span></span></dt><dd><p>Creates an <em class="firstterm">ISO9660</em> filesystem
        suitable for a CDR image.</p></dd><dt><span class="term"><a id="chrootref"/><span class="command"><strong>chroot</strong></span></span></dt><dd><p>CHange ROOT directory. Normally commands are fetched
        from <a class="link" href="ch09.html#pathref">$PATH</a>, relative to
        <code class="filename">/</code>, the default
        <em class="firstterm">root
        directory</em>. This changes the
        <em class="firstterm">root</em> directory to a different one
        (and also changes the working directory to there).  This is
        useful for security purposes, for instance when the system
        administrator wishes to restrict certain users, such as
        those <a class="link" href="ch15s06.html#telnetref">telnetting</a> in,
        to a secured portion of the filesystem (this is sometimes
        referred to as confining a guest user to a <span class="quote">«<span class="quote">chroot
        jail</span>»</span>). Note that after a <span class="command"><strong>chroot</strong></span>,
        the execution path for system binaries is no longer
        valid.</p><p>A <strong class="userinput"><code>chroot /opt</code></strong> would cause
    references to <code class="filename">/usr/bin</code>
    to be translated to <code class="filename">/opt/usr/bin</code>. Likewise,
    <strong class="userinput"><code>chroot /aaa/bbb /bin/ls</code></strong> would
    redirect future instances of <span class="command"><strong>ls</strong></span>
    to <code class="filename">/aaa/bbb</code> as the base directory,
    rather than <code class="filename">/</code> as is
    normally the case. An <span class="command"><strong>alias XX 'chroot /aaa/bbb
    ls'</strong></span> in a user's <a class="link" href="apl.html" title="Приложение L. A Sample .bashrc File"><code class="filename">~/.bashrc</code></a>
    effectively restricts which portion of the filesystem
    she may run command <span class="quote">«<span class="quote">XX</span>»</span> on.</p><p>The <span class="command"><strong>chroot</strong></span> command is also handy
        when running from an emergency boot floppy 
        (<span class="command"><strong>chroot</strong></span> to <code class="filename">/dev/fd0</code>),
        or as an option to <span class="command"><strong>lilo</strong></span> when recovering
        from a system crash. Other uses include installation from a
        different filesystem (an <a class="link" href="ch15s05.html#rpmref">rpm</a>
        option) or running a readonly filesystem from a CD ROM.
        Invoke only as <em class="firstterm">root</em>, and use with
        care.</p><div class="caution" title="Предостережение" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Предостережение</h3><p>It might be necessary to copy certain system
        files to a <em class="firstterm">chrooted</em> directory,
        since the normal <code class="varname">$PATH</code> can no longer
        be relied upon.</p></div></dd><dt><span class="term"><a id="lockfileref"/><span class="command"><strong>lockfile</strong></span></span></dt><dd><p>This utility is part of the <span class="command"><strong>procmail</strong></span>
        package (<a class="ulink" href="http://www.procmail.org">www.procmail.org</a>).
        It creates a <em class="firstterm">lock file</em>, a
        <em class="firstterm">semaphore</em> that controls access to
        a file, device, or resource.</p><div class="sidebar"><p class="title"><b/></p><p><a id="semaphoreref"/>
      <strong class="userinput"><code>Definition:</code></strong>
      A <em class="firstterm">semaphore</em> is a flag or
      signal. (The usage originated in railroading, where a
      colored flag, lantern, or striped movable arm
      <em class="firstterm">semaphore</em> indicated whether a
      particular track was in use and therefore unavailable
      for another train.) A UNIX process can check the
      appropriate semaphore to determine whether a particular
      resource is available/accessible.</p></div><p>The lock file serves as a flag that this particular
        file, device, or resource is in use by a process (and
        is therefore <span class="quote">«<span class="quote">busy</span>»</span>). The presence of a
        lock file permits only restricted access (or no access)
        to other processes.</p><pre class="programlisting">lockfile /home/bozo/lockfiles/$0.lock
# Creates a write-protected lockfile prefixed with the name of the script.

lockfile /home/bozo/lockfiles/${0##*/}.lock
# A safer version of the above, as pointed out by E. Choroba.</pre><p>Lock files are used in such applications as protecting 
        system mail folders from simultaneously being changed
        by multiple users, indicating that a modem port
        is being accessed, and showing that an instance of
        <span class="application">Firefox</span> is using its cache.
        Scripts may check for the existence of a lock file created
        by a certain process to check if that process is running.
        Note that if a script attempts to create a lock file that
        already exists, the script will likely hang.</p><p>Normally, applications create and check for lock files
        in the <code class="filename">/var/lock</code>
        directory.
           <sup>[<a id="idp15250160" href="#ftn.idp15250160" class="footnote">82</a>]</sup>
        A script can test for the presence of a lock file by
        something like the following.
          </p><pre class="programlisting">appname=xyzip
# Application "xyzip" created lock file "/var/lock/xyzip.lock".

if [ -e "/var/lock/$appname.lock" ]
then   #+ Prevent other programs &amp; scripts
       #  from accessing files/resources used by xyzip.
  ...</pre></dd><dt><span class="term"><a id="flockref"/><span class="command"><strong>flock</strong></span></span></dt><dd><p>Much less useful than the <span class="command"><strong>lockfile</strong></span>
        command is <span class="command"><strong>flock</strong></span>. It sets an
        <span class="quote">«<span class="quote">advisory</span>»</span> lock on a file and then executes
        a command while the lock is on. This is to prevent
        any other process from setting a lock on that file until
        completion of the specified command.</p><pre class="programlisting">flock $0 cat $0 &gt; lockfile__$0
#  Set a lock on the script the above line appears in,
#+ while listing the script to stdout.</pre><div class="note" title="Замечание" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Замечание</h3><p>Unlike <span class="command"><strong>lockfile</strong></span>,
        <span class="command"><strong>flock</strong></span> does <span class="emphasis"><em>not</em></span>
        automatically create a lock file.</p></div></dd><dt><span class="term"><a id="mknodref"/><span class="command"><strong>mknod</strong></span></span></dt><dd><p>Creates block or character <a class="link" href="ch27.html#devfileref">device files</a> (may be
        necessary when installing new hardware on the system). The
        <span class="command"><strong>MAKEDEV</strong></span> utility has virtually
        all of the functionality of <span class="command"><strong>mknod</strong></span>,
        and is easier to use.</p></dd><dt><span class="term"><a id="MAKEDEVref"/><span class="command"><strong>MAKEDEV</strong></span></span></dt><dd><p>Utility for creating device files. It must be run as
        <em class="firstterm">root</em>, and in the <code class="filename">/dev</code> directory. It is a sort
        of advanced version of <span class="command"><strong>mknod</strong></span>.</p></dd><dt><span class="term"><a id="tmpwatchref"/><span class="command"><strong>tmpwatch</strong></span></span></dt><dd><p>Automatically deletes files which have not been accessed
        within a specified period of time. Usually invoked by
        <a class="link" href="ch16.html#cronref">cron</a> to remove stale log
        files.</p></dd></dl></div><div class="variablelist" title="Backup"><a id="periphsys"/><p class="title"><b><a id="periphsys1"/>Backup</b></p><dl><dt><span class="term"><a id="dumpref"/><span class="command"><strong>dump</strong></span>, </span><span class="term"><a id="restoreref"/><span class="command"><strong>restore</strong></span></span></dt><dd><p>The <span class="command"><strong>dump</strong></span> command is an elaborate
        filesystem backup utility, generally used on larger
        installations and networks.
    <sup>[<a id="idp15296496" href="#ftn.idp15296496" class="footnote">83</a>]</sup>
        It reads raw disk partitions and writes a backup file
        in a binary format.  Files to be backed up may be saved
        to a variety of storage media, including disks and tape
        drives. The <span class="command"><strong>restore</strong></span> command restores
        backups made with <span class="command"><strong>dump</strong></span>.</p></dd><dt><span class="term"><a id="fdformatref"/><span class="command"><strong>fdformat</strong></span></span></dt><dd><p>Perform a low-level format on a floppy disk
      (<code class="filename">/dev/fd0*</code>).</p></dd></dl></div><div class="variablelist" title="System Resources"><a id="sysresources"/><p class="title"><b><a id="sysresources1"/>System Resources</b></p><dl><dt><span class="term"><a id="ulimitref"/><span class="command"><strong>ulimit</strong></span></span></dt><dd><p>Sets an <em class="firstterm">upper limit</em> on use
       of system resources. Usually invoked with the
       <code class="option">-f</code> option, which sets a limit on file size
       (<span class="command"><strong>ulimit -f 1000</strong></span> limits files to 1 meg
       maximum).
                <sup>[<a id="idp15314016" href="#ftn.idp15314016" class="footnote">84</a>]</sup>
       The <code class="option">-t</code> option limits the coredump
       size (<span class="command"><strong>ulimit -c 0</strong></span> eliminates coredumps).
       Normally, the value of <span class="command"><strong>ulimit</strong></span>
       would be set in <code class="filename">/etc/profile</code>
       and/or <code class="filename">~/.bash_profile</code> (see <a class="xref" href="apg.html" title="Приложение G. Important Files">Приложение G, <i> Important Files</i></a>).</p><div class="important" title="Важно" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Важно</h3><p>Judicious use of <span class="command"><strong>ulimit</strong></span> can
        protect a system against the dreaded <em class="firstterm">fork
        bomb</em>.</p><p>
      </p><pre class="programlisting">#!/bin/bash
# This script is for illustrative purposes only.
# Run it at your own peril -- it WILL freeze your system.

while true  #  Endless loop.
do
  $0 &amp;      #  This script invokes itself . . .
            #+ forks an infinite number of times . . .
            #+ until the system freezes up because all resources exhausted.
done        #  This is the notorious <span class="quote">«<span class="quote">sorcerer's appentice</span>»</span> scenario.

exit 0      #  Will not exit here, because this script will never terminate.</pre><p>
      </p><p>A <span class="command"><strong>ulimit -Hu XX</strong></span> (where
        <span class="emphasis"><em>XX</em></span> is the user process limit) in
        <code class="filename">/etc/profile</code> would abort
        this script when it exceeded the preset limit.
      </p></div></dd><dt><span class="term"><a id="quotaref"/><span class="command"><strong>quota</strong></span></span></dt><dd><p>Display user or group disk quotas.</p></dd><dt><span class="term"><a id="setquotaref"/><span class="command"><strong>setquota</strong></span></span></dt><dd><p>Set user or group disk quotas from the command-line.</p></dd><dt><span class="term"><a id="umaskref"/><span class="command"><strong>umask</strong></span></span></dt><dd><p>User file creation permissions
        <em class="firstterm">mask</em>. Limit the default file
        attributes for a particular user.  All files created
        by that user take on the attributes specified by
        <span class="command"><strong>umask</strong></span>. The (octal) value passed to
        <span class="command"><strong>umask</strong></span> defines the file permissions
        <em class="firstterm">disabled</em>. For example, <span class="command"><strong>umask
        022</strong></span> ensures that new files will have at most
        755 permissions (777 NAND 022).

                <sup>[<a id="idp15349136" href="#ftn.idp15349136" class="footnote">85</a>]</sup>

        Of course, the user may later change the
        attributes of particular files with <a class="link" href="ch15.html#chmodref">chmod</a>. The usual practice
        is to set the value of <span class="command"><strong>umask</strong></span>
        in <code class="filename">/etc/profile</code> and/or
        <code class="filename">~/.bash_profile</code> (see <a class="xref" href="apg.html" title="Приложение G. Important Files">Приложение G, <i> Important Files</i></a>).</p><div class="example"><a id="rot13a"/><p class="title"><b>Пример 16.10. Using <em class="firstterm">umask</em> to hide an output file
          from prying eyes</b></p><div class="example-contents"><pre class="programlisting">&amp;rot13a;</pre></div></div><br class="example-break"/></dd><dt><span class="term"><a id="rdevref"/><span class="command"><strong>rdev</strong></span></span></dt><dd><p>Get info about or make changes to root device, swap space, or video
         mode.  The functionality of <span class="command"><strong>rdev</strong></span> has generally been taken over by
         <span class="command"><strong>lilo</strong></span>, but <span class="command"><strong>rdev</strong></span> remains
         useful for setting up a ram disk. This is a dangerous command, if misused.
       </p></dd></dl></div><div class="variablelist" title="Modules"><a id="modulessys"/><p class="title"><b><a id="modulessys1"/>Modules</b></p><dl><dt><span class="term"><a id="lsmodref"/><span class="command"><strong>lsmod</strong></span></span></dt><dd><p>List installed kernel modules.</p><p>
        </p><pre class="screen"><code class="prompt">bash$ </code><strong class="userinput"><code>lsmod</code></strong>
<code class="computeroutput">Module                  Size  Used by
 autofs                  9456   2 (autoclean)
 opl3                   11376   0
 serial_cs               5456   0 (unused)
 sb                     34752   0
 uart401                 6384   0 [sb]
 sound                  58368   0 [opl3 sb uart401]
 soundlow                 464   0 [sound]
 soundcore               2800   6 [sb sound]
 ds                      6448   2 [serial_cs]
 i82365                 22928   2
 pcmcia_core            45984   0 [serial_cs ds i82365]</code>
        </pre><p>
      </p><div class="note" title="Замечание" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Замечание</h3><p>Doing a <span class="command"><strong>cat /proc/modules</strong></span> gives the
        same information.</p></div></dd><dt><span class="term"><a id="insmodref"/><span class="command"><strong>insmod</strong></span></span></dt><dd><p>Force installation of a kernel module (use
        <span class="command"><strong>modprobe</strong></span> instead, when possible). Must
        be invoked as <em class="firstterm">root</em>.</p></dd><dt><span class="term"><a id="rmmodref"/><span class="command"><strong>rmmod</strong></span></span></dt><dd><p>Force unloading of a kernel module. Must be invoked
        as <em class="firstterm">root</em>.</p></dd><dt><span class="term"><a id="modproberef"/><span class="command"><strong>modprobe</strong></span></span></dt><dd><p>Module loader that is normally invoked automatically
        in a startup script. Must be invoked as
        <em class="firstterm">root</em>.</p></dd><dt><span class="term"><a id="depmodref"/><span class="command"><strong>depmod</strong></span></span></dt><dd><p>Creates module dependency file. Usually invoked from a
        startup script.</p></dd><dt><span class="term"><a id="modinforef"/><span class="command"><strong>modinfo</strong></span></span></dt><dd><p>Output information about a loadable module.</p><pre class="screen"><code class="prompt">bash$ </code><strong class="userinput"><code>modinfo hid</code></strong>
<code class="computeroutput">filename:    /lib/modules/2.4.20-6/kernel/drivers/usb/hid.o
 description: "USB HID support drivers"
 author:      "Andreas Gal, Vojtech Pavlik &lt;vojtech@suse.cz&gt;"
 license:     "GPL"</code>
        </pre></dd></dl></div><div class="variablelist" title="Miscellaneous"><a id="miscsys"/><p class="title"><b><a id="miscsys1"/>Miscellaneous</b></p><dl><dt><span class="term"><a id="envvref"/><span class="command"><strong>env</strong></span></span></dt><dd><p>
        Runs a program or script with certain <a class="link" href="ch04s04.html#envref">environmental variables</a>
        set or changed (without changing the overall system
        environment). The <code class="option">[varname=xxx]</code>
        permits changing the environmental variable
        <code class="varname">varname</code> for the duration of the
        script. With no options specified, this command lists all
        the environmental variable settings.

      <sup>[<a id="idp15415056" href="#ftn.idp15415056" class="footnote">86</a>]</sup>
      </p><div class="note" title="Замечание" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Замечание</h3><p><a id="envv2ref"/>The first line of a script (the
        <span class="quote">«<span class="quote">sha-bang</span>»</span> line) may use <span class="command"><strong>env</strong></span>
        when the path to the shell or interpreter is unknown.</p><pre class="programlisting">#! /usr/bin/env perl

print "This Perl script will run,\n";
print "even when I don't know where to find Perl.\n";

# Good for portable cross-platform scripts,
# where the Perl binaries may not be in the expected place.
# Thanks, S.C.</pre><p>Or even ... </p><pre class="programlisting">#!/bin/env bash
# Queries the $PATH enviromental variable for the location of bash.
# Therefore ...
# This script will run where Bash is not in its usual place, in /bin.
...</pre></div></dd><dt><span class="term"><a id="lddref"/><span class="command"><strong>ldd</strong></span></span></dt><dd><p>Show shared lib dependencies for an executable file.</p><pre class="screen"><code class="prompt">bash$ </code><strong class="userinput"><code>ldd /bin/ls</code></strong>
<code class="computeroutput">libc.so.6 =&gt; /lib/libc.so.6 (0x4000c000)
/lib/ld-linux.so.2 =&gt; /lib/ld-linux.so.2 (0x80000000)</code></pre></dd><dt><span class="term"><a id="watchref"/><span class="command"><strong>watch</strong></span></span></dt><dd><p>Run a command repeatedly, at specified time intervals.</p><p>The default is two-second intervals, but this may be changed
        with the <code class="option">-n</code> option.</p><pre class="programlisting">watch -n 5 tail /var/log/messages
# Shows tail end of system log, /var/log/messages, every five seconds.</pre><div class="note" title="Замечание" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Замечание</h3><p>Unfortunately, <a class="link" href="ch03.html#piperef">piping</a>
        the output of <span class="command"><strong>watch command</strong></span> to <a class="link" href="ch15s04.html#grepref">grep</a> does not work.</p></div></dd><dt><span class="term"><a id="stripref"/><span class="command"><strong>strip</strong></span></span></dt><dd><p>Remove the debugging symbolic references from an executable
        binary. This decreases its size, but makes debugging it
        impossible.</p><p>This command often occurs in a <a class="link" href="ch15s05.html#makefileref">Makefile</a>,
        but rarely in a shell script.</p></dd><dt><span class="term"><a id="nmref"/><span class="command"><strong>nm</strong></span></span></dt><dd><p>List symbols in an unstripped compiled binary.</p></dd><dt><span class="term"><a id="rdistref"/><span class="command"><strong>rdist</strong></span></span></dt><dd><p>Remote distribution client: synchronizes, clones,
        or backs up a file system on a remote server.</p></dd></dl></div><div class="sect1" title="Analyzing a System Script"><div class="titlepage"><div><div><h2 class="title"><a id="sysscripts"/>Analyzing a System Script</h2></div></div></div><p><a id="killall2ref"/></p><p>Using our knowledge of administrative commands, let us examine a system
  script. One of the shortest and simplest to understand scripts is
  <span class="quote">«<span class="quote">killall,</span>»</span>
     <sup>[<a id="idp15459120" href="#ftn.idp15459120" class="footnote">87</a>]</sup>
  used to suspend running processes at system shutdown.</p><div class="example"><a id="ex55"/><p class="title"><b>Пример 16.11. <em class="firstterm">killall</em>, from <code class="filename">/etc/rc.d/init.d</code></b></p><div class="example-contents"><pre class="programlisting">&amp;ex55;</pre></div></div><br class="example-break"/><p>That wasn't so bad. Aside from a little fancy footwork with variable
  matching, there is no new material there.</p><p title="Exercise 1"><b>Exercise 1. </b>In <code class="filename">/etc/rc.d/init.d</code>,
    analyze the <span class="command"><strong>halt</strong></span> script. It is a bit longer
    than <span class="command"><strong>killall</strong></span>, but similar in concept. Make
    a copy of this script somewhere in your home directory and
    experiment with it (do <span class="emphasis"><em>not</em></span> run it as
    <em class="firstterm">root</em>). Do a simulated run
    with the <code class="option">-vn</code> flags (<strong class="userinput"><code>sh
    -vn scriptname</code></strong>). Add extensive
    comments. Change the <span class="quote">«<span class="quote">action</span>»</span> commands to
    <span class="quote">«<span class="quote">echos</span>»</span>.</p><p title="Exercise 2"><b>Exercise 2. </b>Look at some of the more complex scripts in
  <code class="filename">/etc/rc.d/init.d</code>. See if
  you can understand parts of them. Follow the above procedure
  to analyze them. For some additional insight, you might also
  examine the file <code class="filename">sysvinitfiles</code> in <code class="filename">/usr/share/doc/initscripts-?.??</code>,
  which is part of the <span class="quote">«<span class="quote">initscripts</span>»</span>
  documentation.</p></div><div class="footnotes"><br/><hr/><div class="footnote"><p><sup>[<a id="ftn.idp14211328" href="#idp14211328" class="para">78</a>] </sup>This is the case on a Linux machine or a UNIX
       system with disk quotas.</p></div><div class="footnote"><p><sup>[<a id="ftn.idp14227680" href="#idp14227680" class="para">79</a>] </sup>The <span class="command"><strong>userdel</strong></span> command
       will fail if the particular user being deleted is
       still logged on.</p></div><div class="footnote"><p><sup>[<a id="ftn.idp15044688" href="#idp15044688" class="para">80</a>] </sup>For more detail on burning CDRs, see Alex
      Withers' article, <a class="ulink" href="http://www2.linuxjournal.com/lj-issues/issue66/3335.html">Creating
      CDs</a>, in the October, 1999 issue of <a class="ulink" href="http://www.linuxjournal.com"><em class="citetitle">Linux
       Journal</em></a>.</p></div><div class="footnote"><p><sup>[<a id="ftn.idp15165008" href="#idp15165008" class="para">81</a>] </sup>The <code class="option">-c</code> option to <a class="link" href="ch16.html#mke2fsref">mke2fs</a> also invokes a check for bad
    blocks.</p></div><div class="footnote"><p><sup>[<a id="ftn.idp15250160" href="#idp15250160" class="para">82</a>] </sup>Since only <em class="firstterm">root</em>
     has write permission in the <code class="filename">/var/lock</code> directory,
     a user script cannot set a lock file there.</p></div><div class="footnote"><p><sup>[<a id="ftn.idp15296496" href="#idp15296496" class="para">83</a>] </sup>Operators of single-user Linux systems
      generally prefer something simpler for backups, such
      as <span class="command"><strong>tar</strong></span>.</p></div><div class="footnote"><p><sup>[<a id="ftn.idp15314016" href="#idp15314016" class="para">84</a>] </sup>As of the <a class="link" href="ch34s03.html#bash4ref">version
                4 update</a> of Bash, the <code class="option">-f</code>
                and <code class="option">-c</code> options take a block size
                of 512 when in <a class="link" href="ch02.html#posix2ref">POSIX</a>
    mode. Additionally, there are two new options:
    <code class="option">-b</code> for <a class="link" href="ch27.html#socketref">socket</a> buffer size, and
    <code class="option">-T</code> for the limit on the number of
    <em class="firstterm">threads</em>.</p></div><div class="footnote"><p><sup>[<a id="ftn.idp15349136" href="#idp15349136" class="para">85</a>] </sup>NAND is the logical
      <em class="firstterm">not-and</em> operator. Its effect
      is somewhat similar to subtraction.</p></div><div class="footnote"><p><sup>[<a id="ftn.idp15415056" href="#idp15415056" class="para">86</a>] </sup>In Bash and other Bourne shell derivatives, it is
        possible to set variables in a single command's environment.
        <pre class="programlisting">var1=value1 var2=value2 commandXXX
# $var1 and $var2 set in the environment of 'commandXXX' only.</pre>       
            </p></div><div class="footnote"><p><sup>[<a id="ftn.idp15459120" href="#idp15459120" class="para">87</a>] </sup>The <em class="firstterm">killall</em> system
     script should not be confused with the <a class="link" href="ch14.html#killallref">killall</a> command in <code class="filename">/usr/bin</code>.</p></div></div></div><div class="navfooter"><hr/><table width="100%" summary="Navigation footer"><tr><td align="left"><a accesskey="p" href="ch15s09.html">Пред.</a> </td><td align="center"><a accesskey="u" href="pt04.html">Уровень выше</a></td><td align="right"> <a accesskey="n" href="pt05.html">След.</a></td></tr><tr><td align="left" valign="top">Miscellaneous Commands </td><td align="center"><a accesskey="h" href="index.html">Начало</a></td><td align="right" valign="top"> Часть Part 5. Материал повышенной сложности</td></tr></table></div></body></html>
