<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Indirect References</title><meta name="generator" content="DocBook XSL Stylesheets V1.75.2"/><link rel="home" href="index.html" title="Advanced Bash Scripting по-русски"/><link rel="up" href="ch09.html" title="Глава 9. К вопросу о переменных"/><link rel="prev" href="ch09s04.html" title="Typing variables: declare or typeset"/><link rel="next" href="ch09s06.html" title="$RANDOM: generate random integer"/></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Indirect References</th></tr><tr><td align="left"><a accesskey="p" href="ch09s04.html">Пред.</a> </td><th width="60%" align="center">Глава 9. К вопросу о переменных</th><td align="right"> <a accesskey="n" href="ch09s06.html">След.</a></td></tr></table><hr/></div><div class="sect1" title="Indirect References"><div class="titlepage"><div><div><h2 class="title"><a id="ivr"/>Indirect References</h2></div></div></div><p><a id="ivrref"/></p><p>We have seen that <a class="link" href="ch04.html#varsubn" title="Подстановка переменных">referencing
        a variable</a>, <code class="varname">$var</code>, fetches its
        <em class="firstterm">value</em>. <a id="evalindref"/>But,
        what about the <span class="emphasis"><em>value of a value</em></span>? What
        about <code class="varname">$$var</code>?</p><p>The actual notation is
  <em class="replaceable"><code>\$$var</code></em>, usually preceded by
  an <a class="link" href="ch14.html#evalref">eval</a> (and sometimes an
  <a class="link" href="ch14.html#echoref">echo</a>). This is called an
  <em class="firstterm">indirect reference</em>.</p><div class="example"><a id="indref"/><p class="title"><b>Пример 9.24. Indirect Variable References</b></p><div class="example-contents"><pre class="programlisting">&amp;indref;</pre></div></div><br class="example-break"/><p><a id="irrref"/></p><div class="sidebar"><p class="title"><b/></p><p>Indirect referencing in Bash
        is a multi-step process. First, take the name of a variable:
  <code class="varname">varname</code>. Then, reference it:
  <code class="varname">$varname</code>. Then, reference the reference:
  <code class="varname">$$varname</code>. Then, <em class="firstterm">escape</em>
  the first <span class="token">$</span>: <code class="varname">\$$varname</code>.
  Finally, force a reevaluation of the expression and assign it:
  <span class="command"><strong>eval newvar=\$$varname</strong></span>.</p></div><p>Of what practical use is indirect referencing of
    variables? It gives Bash a little of the functionality
    of <a class="link" href="ch04.html#pointerref">pointers</a>
    in <em class="firstterm">C</em>, for instance, in <a class="link" href="ch34.html#resistor" title="Пример 34.3. Simple database application, using indirect variable referencing">table lookup</a>.  And, it also has some
    other very interesting applications. . . .</p><p>Nils Radtke shows how to build <span class="quote">«<span class="quote">dynamic</span>»</span>
    variable names and evaluate their contents. This can be useful
    when <a class="link" href="ch14.html#sourceref">sourcing</a> configuration
    files.</p><pre class="programlisting">#!/bin/bash


# ---------------------------------------------
# This could be "sourced" from a separate file.
isdnMyProviderRemoteNet=172.16.0.100
isdnYourProviderRemoteNet=10.0.0.10
isdnOnlineService="MyProvider"
# ---------------------------------------------
      

remoteNet=$(eval "echo \$$(echo isdn${isdnOnlineService}RemoteNet)")
remoteNet=$(eval "echo \$$(echo isdnMyProviderRemoteNet)")
remoteNet=$(eval "echo \$isdnMyProviderRemoteNet")
remoteNet=$(eval "echo $isdnMyProviderRemoteNet")

echo "$remoteNet"    # 172.16.0.100

# ================================================================

#  And, it gets even better.

#  Consider the following snippet given a variable named getSparc,
#+ but no such variable getIa64:

chkMirrorArchs () { 
  arch="$1";
  if [ "$(eval "echo \${$(echo get$(echo -ne $arch |
       sed 's/^\(.\).*/\1/g' | tr 'a-z' 'A-Z'; echo $arch |
       sed 's/^.\(.*\)/\1/g')):-false}")" = true ]
  then
     return 0;
  else
     return 1;
  fi;
}

getSparc="true"
unset getIa64
chkMirrorArchs sparc
echo $?        # 0
               # True

chkMirrorArchs Ia64
echo $?        # 1
               # False

# Notes:
# -----
# Even the to-be-substituted variable name part is built explicitly.
# The parameters to the chkMirrorArchs calls are all lower case.
# The variable name is composed of two parts: "get" and "Sparc" . . .</pre><p>
        </p><div class="example"><a id="coltotaler2"/><p class="title"><b>Пример 9.25. Passing an indirect reference to <em class="firstterm">awk</em></b></p><div class="example-contents"><pre class="programlisting">&amp;coltotaler2;</pre></div></div><br class="example-break"/><div class="caution" title="Предостережение" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Предостережение</h3><p>This method of indirect referencing is a bit tricky.
  If the second order variable changes its value, then the first
  order variable must be properly dereferenced (as in the above
  example). <a id="ivr2"/>Fortunately, the
  <em class="replaceable"><code>${!variable}</code></em> notation introduced
  with <a class="link" href="ch34.html#bash2ref">version 2</a> of Bash
  (see <a class="xref" href="ch34.html#ex78" title="Пример 34.2. Indirect variable references - the new way">Пример 34.2, «Indirect variable references - the new way»</a> and <a class="xref" href="apa.html#hashex2" title="Пример A.22. More on hash functions">Пример A.22, «More on hash functions»</a>) makes
  indirect referencing more intuitive.</p></div><div class="sidebar"><p class="title"><b/></p><p>Bash does not support pointer arithmetic, and this severely
   limits the usefulness of indirect referencing. In fact, indirect
   referencing in a scripting language is, at best, something of
   an afterthought.</p></div></div><div class="navfooter"><hr/><table width="100%" summary="Navigation footer"><tr><td align="left"><a accesskey="p" href="ch09s04.html">Пред.</a> </td><td align="center"><a accesskey="u" href="ch09.html">Уровень выше</a></td><td align="right"> <a accesskey="n" href="ch09s06.html">След.</a></td></tr><tr><td align="left" valign="top">Typing variables: <span class="command"><strong>declare</strong></span> or
    <span class="command"><strong>typeset</strong></span> </td><td align="center"><a accesskey="h" href="index.html">Начало</a></td><td align="right" valign="top"> $RANDOM: generate random integer</td></tr></table></div></body></html>
