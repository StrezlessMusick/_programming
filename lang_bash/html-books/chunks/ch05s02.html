<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Экранирование символов</title><meta name="generator" content="DocBook XSL Stylesheets V1.75.2"/><link rel="home" href="index.html" title="Advanced Bash Scripting по-русски"/><link rel="up" href="ch05.html" title="Глава 5. Использование кавычек"/><link rel="prev" href="ch05.html" title="Глава 5. Использование кавычек"/><link rel="next" href="ch06.html" title="Глава 6. Exit and Exit Status"/></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Экранирование символов</th></tr><tr><td align="left"><a accesskey="p" href="ch05.html">Пред.</a> </td><th width="60%" align="center">Глава 5. Использование кавычек</th><td align="right"> <a accesskey="n" href="ch06.html">След.</a></td></tr></table><hr/></div><div class="sect1" title="Экранирование символов"><div class="titlepage"><div><div><h2 class="title"><a id="escapingsection"/>Экранирование символов</h2></div></div></div><p><a id="escp"/><em class="firstterm">Экранирование символов</em> -
  это замена управляющих символов на соответствующие текстовые подстановки. 
  Символ экранирования (<span class="token">escape</span>) (<span class="token">\</span>) сообщает 
  командной оболочке, что символ, стоящий за ним, надо воспринимать 
  буквально.</p><div class="caution" title="Предостережение" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Предостережение</h3><p>В определенных командах и утилитах, таких как <a class="link" href="ch14.html#echoref">echo</a> или <a class="link" href="apc.html#sedref">sed</a>, экранирование символа может дать обратный
  эффект - обычный символ может получить специальное значение.</p></div><div class="variablelist" title="Специальные значения некоторых экранированных символов"><a id="specialmeanings"/><p class="title"><b><a id="spm"/>Специальные значения некоторых
  экранированных символов</b></p><dl><dt><span class="term">при использовании <span class="command"><strong>echo</strong></span> и
  <span class="command"><strong>sed</strong></span></span></dt><dd><p/></dd><dt><span class="term"><span class="token">\n</span></span></dt><dd><p>перевод на новую строку</p></dd><dt><span class="term"><span class="token">\r</span></span></dt><dd><p>возврат каретки (перевод позиции печати на крайнее левое 
		    положение)</p></dd><dt><span class="term"><span class="token">\t</span></span></dt><dd><p>табуляция</p></dd><dt><span class="term"><span class="token">\v</span></span></dt><dd><p> вертикальная табуляция</p></dd><dt><span class="term"><span class="token">\b</span></span></dt><dd><p>возврат на одну позицию</p></dd><dt><span class="term"><span class="token">\a</span></span></dt><dd><p>сигнал <em class="firstterm">оповещения</em> (звуковой или световой)</p></dd><dt><span class="term"><span class="token">\0xx</span></span></dt><dd><p><a id="octalref"/>для восьмеричного
	<em class="replaceable"><code>0nn</code></em> выводит символ, соответствующий номеру
	<em class="replaceable"><code>nn</code></em> в таблице ASCII</p><div class="example"><a id="escaped"/><p class="title"><b>Пример 5.2. Экранирование символов</b></p><div class="example-contents"><pre class="programlisting">
#!/bin/bash
# escaped.sh: экранирование символов

echo; echo

# Экранирование символа новой строки.
# ------------------

echo ""

echo "Эта фраза выведется
на две строки."
# Эта фраза выведется
# на две строки.

echo "Эта фраза выведется \
на одну строку."
# Эта фраза выведется на одну строку.

echo; echo

echo "============="


echo "\v\v\v\v"      # Вывод \v\v\v\v.
# Используйте опцию -e команды 'echo', чтобы вывести экранированные символы.
echo "============="
echo "ВЕРТИКАЛЬНАЯ ТАБУЛЯЦИЯ"
echo -e "\v\v\v\v"   # Вывод 4-х вертикальных табуляций.
echo "=============="

echo "КАВЫЧКИ"
echo -e "\042"       # Вывод " (восьмеричный ASCII эквивалент кавычек - 42).
echo "=============="

# При использовании конструкции $'\X' можно обойтись без опции -e.
echo; echo "НОВАЯ СТРОКА И СИГНАЛ ОПОВЕЩЕНИЯ"
echo $'\n'           # Новая строка.
echo $'\a'           # Оповещение (гудок).
# Лично у меня на оповещение реакции никакой (: (прим. переводчика)
echo "==============="
echo "КАВЫЧКИ"
# Версия 2. Bash позволяет использовать конструкцию $'\nnn'.
# Помните, что, в этом случае, '\nnn' имеет восьмеричное значение.
echo $'\t \042 \t'   # Кавычки ("), окруженные табуляциями.

# Работа с шестнадцатеричными значениями тоже возможна.
# При помощи конструкции вида $'\xhhh'.
echo $'\t \x22 \t'  # Кавычки ("), окруженные табуляциями.
# Спасибо, Greg Keraunen, за это указание.
# Ранние версии Bash допускали конструкцию '\x022'.
echo "==============="
echo





# Присваивание ASCII символов переменным.
# ----------------------------------------
quote=$'\042'        # присваивание " переменной.
echo "$quote Эта часть строки в кавычках, $quote а эта за их пределами."

echo

# Объединение ASCII символов в переменной.
triple_underline=$'\137\137\137'  # 137 - это ASCII код символа '_'.
echo "$triple_underline ПОДЧЕРКИВАНИЕ $triple_underline"

echo

ABC=$'\101\102\103\010'           # 101, 102, 103 восьмеричные значения A, B, C.
echo $ABC

echo; echo

escape=$'\033'                    # 033 восьмеричный эквивалент escape-символа
echo "\"escape\" выводится как $escape"
#                                   нет видимого вывода.

echo; echo

exit 0
</pre></div></div><br class="example-break"/><p>Можете посмотреть другой пример использования конструкции
	       <strong class="userinput"><code>$' ... '</code></strong><a class="xref" href="ch34.html#ex77" title="Пример 34.1. String expansion">Пример 34.1, «String expansion»</a>.</p></dd><dt><span class="term"><span class="token">\"</span></span></dt><dd><p> придает кавычкам непосредственное (символьное) значение. 
В противном случае, кавычки означали бы конец выражения, передаваемого в
качестве параметра команде echo.</p><pre class="programlisting">echo "Медведь"                       # Медведь
echo "\"Медведь\" ... он сказал."    # "Медведь" ... он сказал.</pre></dd><dt><span class="term"><span class="token">\$</span></span></dt><dd><p>придает знаку доллара непосредственное значение
        (если перед именем переменной стоит <span class="token">\$</span>, то обращения
        к ее значению не последует)</p><pre class="programlisting">echo "\$variable01"           # $variable01
echo "Стоимость книги \$7.98."  # Стоимость книги $7.98.</pre></dd><dt><span class="term"><span class="token">\\</span></span></dt><dd><p>придает обратному слэшу непосредственное значение (если необходимо вставить символ обратного слэша)</p><pre class="programlisting">echo "\\"  # Результат \

# Тогда как . . .

echo "\"   # Вызов вторичного ввода (secondary prompt) в командной строке.
           # В сценарии будет выдано сообщение об ошибке.

# Однако . . .

echo '\'   # Результат \</pre></dd></dl></div><div class="note" title="Замечание" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Замечание</h3><p>Поведение <span class="token">\</span> зависит от случая использования:
  экранирование, <a class="link" href="ch04.html#snglquo">строгие кавычки</a>,
  <a class="link" href="ch04.html#dblquo">нестрогие кавычки</a>, использование в
  <a class="link" href="ch11.html#commandsubref">подстановке команд</a> или во
  <a class="link" href="ch18.html#heredocref">встроеном документе (here document)</a>.

  </p><pre class="programlisting">                      #  Простое экранирование в кавычках
echo \z               #  z
echo \\z              # \z
echo '\z'             # \z
echo '\\z'            # \\z
echo "\z"             # \z
echo "\\z"            # \z

                      #  Подстановка команд
echo `echo \z`        #  z
echo `echo \\z`       #  z
echo `echo \\\z`      # \z
echo `echo \\\\z`     # \z
echo `echo \\\\\\z`   # \z
echo `echo \\\\\\\z`  # \\z
echo `echo "\z"`      # \z
echo `echo "\\z"`     # \z

                      # Встроенный документ (here document)
cat &lt;&lt;EOF              
\z                      
EOF                   # \z

cat &lt;&lt;EOF              
\\z                     
EOF                   # \z

# Примеры представил Stéphane Chazelas.</pre><p>
      </p><p>Элементы строки, присвоенные переменной, могут быть экранированы,
        но сам символ экранирования не может быть присвоен переменной.
  </p><pre class="programlisting">variable=\
echo "$variable"
# Работать не будет - выдаст сообщение об ошибке:
# test.sh: : command not found
# "Голый" символ экранирования не может быть присвоен переменной.
#
# На самом деле, "\" экранирует символ перевода на следующую строку, и
#+ получается следующее	variable=echo "$variable"
#+                      неверное присваивание переменной

variable=\
23skidoo
echo "$variable"        #  23skidoo
                        #  Работает, так как вторая строка имеет
                        #+ значение годное для присваивания.

variable=\ 
#        \^    экранирование предшествует пробелу
echo "$variable"        # пробел

variable=\\
echo "$variable"        # \

variable=\\\
echo "$variable"
# Работать не будет - выдаст сообщение об ошибке:
# test.sh: \: command not found
#
#  Первый символ экранирования экранирует второй, но третий остается один,
#+ результат будет подобен тому, что мы видели в первом примере, выше.

variable=\\\\
echo "$variable"        # \\
                        # Второй и четвертый escape экранируются.
                        # Все в порядке.</pre><p>
      </p></div><p>Экранирование пробела может предотвратить расщепление слов (word splitting) в списке аргументов команды.
        </p><pre class="programlisting">file_list="/bin/cat /bin/gzip /bin/more /usr/bin/less /usr/bin/vim"
# Список имен файлов может использоваться в качестве аргумента команды.

# Выведем список файлов и добавим еще пару имен.
ls -l /usr/X11R6/bin/xsetroot /sbin/dump $file_list

echo "-------------------------------------------------------------------------"

# Что будет если экранировать пробелы?
ls -l /usr/X11R6/bin/xsetroot\ /sbin/dump\ $file_list
# Ошибка: первые три имени файла объединены в один аргумент команды 'ls -l',
#+ так как экранированные пробелы предотвращали сцепление аргументов (слов).</pre><p>
</p><p><a id="escnewline"/></p><p>Также, <span class="token">экранирование</span> позволяет писать команды,
  занимающие несколько строк. Обычно, разные строки содержат разные команды,
  но <span class="token">escape</span>-символ в конце строки
  <span class="emphasis"><em>экранирует символ перевода на новую строку</em></span>.
  Это позволяет продолжить конструкцию команды на новой строке.</p><pre class="programlisting">(cd /source/directory &amp;&amp; tar cf - . ) | \
(cd /dest/directory &amp;&amp; tar xpvf -)
# Команда копирования дерева каталогов Алана Кокса
# разбита на две строки для увеличения удобства чтения.

# Альтернативный вариант:
tar cf - -C /source/directory . |
tar xpvf - -C /dest/directory
# Смотри замечание ниже.
# (Спасибо, Stéphane Chazelas.)</pre><p>
        
  </p><div class="note" title="Замечание" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Замечание</h3><p>Если строка сценария заканчивается символом конвейера
    <span class="token">|</span> (вертикальная черта),то символ экранирования
    <span class="token">\</span> использовать не обязательно.
    Однако, использовать символ экранирования в командах, занимающих
    несколько строк, является хорошим стилем программирования.</p></div><pre class="programlisting">echo "foo
bar" 
#foo
#bar

echo

echo 'foo
bar'    # Пока никакой разницы.
#foo
#bar

echo

echo foo\
bar     # Экранирование новой строки.
#foobar

echo

echo "foo\
bar"     # В нестрогих кавычках \ еще воспринимается как экранирующий.
#foobar

echo

echo 'foo\
bar'     # В строги кавычках символ \ воспринимается буквально.
#foo\
#bar

# Примеры предложены Stéphane Chazelas.</pre></div><div class="navfooter"><hr/><table width="100%" summary="Navigation footer"><tr><td align="left"><a accesskey="p" href="ch05.html">Пред.</a> </td><td align="center"><a accesskey="u" href="ch05.html">Уровень выше</a></td><td align="right"> <a accesskey="n" href="ch06.html">След.</a></td></tr><tr><td align="left" valign="top">Глава 5. Использование кавычек </td><td align="center"><a accesskey="h" href="index.html">Начало</a></td><td align="right" valign="top"> Глава 6. Exit and Exit Status</td></tr></table></div></body></html>
