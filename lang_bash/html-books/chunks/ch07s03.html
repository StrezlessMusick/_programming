<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Другие операторы сравнения</title><meta name="generator" content="DocBook XSL Stylesheets V1.75.2"/><link rel="home" href="index.html" title="Advanced Bash Scripting по-русски"/><link rel="up" href="ch07.html" title="Глава 7. Проверка условий"/><link rel="prev" href="ch07s02.html" title="Операторы проверки файлов"/><link rel="next" href="ch07s04.html" title="Вложенные конструкции проверки if/then"/></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Другие операторы сравнения</th></tr><tr><td align="left"><a accesskey="p" href="ch07s02.html">Пред.</a> </td><th width="60%" align="center">Глава 7. Проверка условий</th><td align="right"> <a accesskey="n" href="ch07s04.html">След.</a></td></tr></table><hr/></div><div class="sect1" title="Другие операторы сравнения"><div class="titlepage"><div><div><h2 class="title"><a id="comparison-ops"/>Другие операторы сравнения</h2></div></div></div><p><em class="firstterm">Двоичные</em> операторы сравнения производят
  	сравнение двух переменных или двух чисел.<span class="emphasis"><em> Заметьте, что
	для сравнения строк и целых чисел используются различные наборы
	операторов.</em></span></p><div class="variablelist" title="сравнение целочисленных значений"><a id="icomparison"/><p class="title"><b><a id="icomparison1"/>сравнение целочисленных значений</b></p><dl><dt><span class="term"><a id="equalref"/><span class="token">-eq</span></span></dt><dd><p>значения равны</p><p><strong class="userinput"><code>if [ "$a" -eq "$b" ]</code></strong></p></dd><dt><span class="term"><a id="nequalref"/><span class="token">-ne</span></span></dt><dd><p>значения не равны</p><p><strong class="userinput"><code>if [ "$a" -ne "$b" ]</code></strong></p></dd><dt><span class="term"><a id="gt0ref"/><span class="token">-gt</span></span></dt><dd><p>первое значение больше второго</p><p><strong class="userinput"><code>if [ "$a" -gt "$b" ]</code></strong></p></dd><dt><span class="term"><a id="ge0ref"/><span class="token">-ge</span></span></dt><dd><p>первое значение больше или равно второму</p><p><strong class="userinput"><code>if [ "$a" -ge "$b" ]</code></strong></p></dd><dt><span class="term"><a id="lt0ref"/><span class="token">-lt</span></span></dt><dd><p>первое значение меньше второго</p><p><strong class="userinput"><code>if [ "$a" -lt "$b" ]</code></strong></p></dd><dt><span class="term"><a id="le0ref"/><span class="token">-le</span></span></dt><dd><p>первое значение меньше или равно второму</p><p><strong class="userinput"><code>if [ "$a" -le "$b" ]</code></strong></p></dd><dt><span class="term"><a id="intlt"/><span class="token">&lt;</span></span></dt><dd><p>первое значение меньше второго</p>
      (внутри <a class="link" href="ch09s07.html" title="The Double-Parentheses Construct">двойных курглых скобок</a>)
      <p><strong class="userinput"><code>(("$a" &lt; "$b"))</code></strong></p></dd><dt><span class="term"><a id="lteq"/><span class="token">&lt;=</span></span></dt><dd><p>первое значение меньше или равно второму (внутри двойных круглых скобок)</p><p><strong class="userinput"><code>(("$a" &lt;= "$b"))</code></strong></p></dd><dt><span class="term"><a id="intgt"/><span class="token">&gt;</span></span></dt><dd><p>первое значение больше второго (внутри двойных круглых скобок)</p><p><strong class="userinput"><code>(("$a" &gt; "$b"))</code></strong></p></dd><dt><span class="term"><a id="gteq"/><span class="token">&gt;=</span></span></dt><dd><p>первое значение больше или равно второму (внутри двойных круглых скобок)</p><p><strong class="userinput"><code>(("$a" &gt;= "$b"))</code></strong></p></dd></dl></div><div class="variablelist" title="сравнение строк"><a id="scomparison"/><p class="title"><b><a id="scomparison1"/>сравнение строк</b></p><dl><dt><span class="term"><span class="token">=</span></span></dt><dd><p><a id="equalsignref"/></p><p>строки равны</p><p><strong class="userinput"><code>if [ "$a" = "$b" ]</code></strong></p></dd><dt><span class="term"><a id="scomparison2"/><span class="token">==</span></span></dt><dd><p>строки равны</p><p><strong class="userinput"><code>if [ "$a" == "$b" ]</code></strong></p><p>Синоним оператора <span class="token">=</span>.</p><div class="note" title="Замечание" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Замечание</h3><p>
	Оператор <span class="token">==</span> ведет себя по-разному внутри
	<a class="link" href="ch07.html#dblbrackets">двойных квадратных скобок</a>
	и внутри одинарных квадратных скобок.
              </p><pre class="programlisting">[[ $a == z* ]]   # Истинно, если $a начинается с символа "z" (соответствие шаблону).
[[ $a == "z*" ]] # Истинно, если $a равно z* (посимвольное соответствие).

[ $a == z* ]     # Здесь имеют место подстановка имён файлов и разделение строки на слова.
[ "$a" == "z*" ] # Истинно, когда $a равно z* (посимвольное соотвествие).

# Спасибо, Stéphane Chazelas</pre><p>
              </p></div></dd><dt><span class="term"><a id="notequal"/><span class="token">!=</span></span></dt><dd><p>строки не равны</p><p><strong class="userinput"><code>if [ "$a" != "$b" ]</code></strong></p><p>При использовании конструкции <a class="link" href="ch07.html#dblbrackets">[[ ... ]]</a>
	данный оператор может производить проверку по шаблону.</p></dd><dt><span class="term"><a id="ltref"/><span class="token">&lt;</span></span></dt><dd><p>первая строка меньше второй в соответствии с алфавитным порядком таблицы символов ASCII</p><p><strong class="userinput"><code>if [[ "$a" &lt; "$b" ]]</code></strong></p><p><strong class="userinput"><code>if [ "$a" \&lt; "$b" ]</code></strong></p><p>Отметим, что оператор <span class="quote">«<span class="quote">&lt;</span>»</span> должен быть 
      <a class="link" href="ch05s02.html#escp">экранирован</a> при использовании внутри конструкции
      <strong class="userinput"><code>[  ]</code></strong> .</p></dd><dt><span class="term"><a id="gtref"/><span class="token">&gt;</span></span></dt><dd><p>первая строка больше второй в соответствии с алфавитным порядком таблицы символов ASCII</p><p><strong class="userinput"><code>if [[ "$a" &gt; "$b" ]]</code></strong></p><p><strong class="userinput"><code>if [ "$a" \&gt; "$b" ]</code></strong></p><p>Отметим, что оператор <span class="quote">«<span class="quote">&gt;</span>»</span> должен быть экранирован
        при использвоании внутри конструкции <strong class="userinput"><code>[  ]</code></strong> .</p><p>Рассмотрите пример применения данного оператора сравнения
       	в материале <a class="xref" href="ch26.html#bubble" title="Пример 26.11. The Bubble Sort">Пример 26.11, «The Bubble Sort»</a>.</p></dd><dt><span class="term"><a id="stringnull"/><span class="token">-z</span></span></dt><dd><p>строка <em class="firstterm">пустая (null)</em>,
          имеющая нулевую длину</p><pre class="programlisting"> String=''   # Строковая переменная нулевой длины ("null")

if [ -z "$String" ]
then
  echo "\$String пустая."
else
  echo "\$String НЕ пустая."
fi     # $String пустая.</pre></dd><dt><span class="term"><a id="stringnotnull"/><span class="token">-n</span></span></dt><dd><p>строка не <em class="firstterm">пустая (null)</em>.</p><div class="caution" title="Предостережение" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Предостережение</h3><p>Применение <strong class="userinput"><code>-n</code></strong>
	требует заключения строки в двойные кавычки при применении внутри 
	квадратных скобок. Использование строки без кавычек совместно с
    	<em class="firstterm">! -z</em> или внутри скобок без использования
	каких-либо опций (смотрите <a class="xref" href="ch07s03.html#strtest" title="Пример 7.6. Проверка пустых (null) строк">Пример 7.6, «Проверка <em class="firstterm">пустых (null)</em> строк»</a> ) обычно срабатывает нормально, но
	является небезопасной практикой. <span class="emphasis"><em>Всегда</em></span> заключайте в кавычки
	тестируемую строку.
	<sup>[<a id="idp8651744" href="#ftn.idp8651744" class="footnote">33</a>]</sup>
    	</p></div></dd></dl></div><div class="example"><a id="ex13"/><p class="title"><b>Пример 7.5. Арифметические и строковые сравнения</b></p><div class="example-contents"><pre class="programlisting">#!/bin/bash

a=4
b=5

#  Здесь переменные "a" и "b" могут быть рассмотрены либо как целые числа, либо как строки.
#  Так как в Bash переменные не имеют четкого типа, есть различия между
#+ арифметическим и строковым сравнением.

#  Bash разрешает производить арифметические операции и сравнения для переменных,
#+ значения которых целиком состоят из числовых символов.
#  Вы предупреждены.

echo

if [ "$a" -ne "$b" ]
then
  echo "$a не равно $b"
  echo "(арифметическое сравнение)"
fi

echo

if [ "$a" != "$b" ]
then
  echo "$a не равно $b."
  echo "(строковое сравнение)"
  #     "4"  != "5"
  # ASCII 52 != ASCII 53
fi

# В данном частном случае оба варианта ( "-ne" и "!=" ) работают.

echo

exit 0
</pre></div></div><br class="example-break"/><div class="example"><a id="strtest"/><p class="title"><b>Пример 7.6. Проверка <em class="firstterm">пустых (null)</em> строк</b></p><div class="example-contents"><pre class="programlisting">#!/bin/bash
#  str-test.sh: Проверка пустых и незаключенных в кавычки строк

# Исползование  if [ ... ]

# Если строка не была проинициализирована, то она не имеет определённого значения.
# Такое состояние называют "null" (это не то же самое, что ноль!).

if [ -n $string1 ]    # string1 не была объявлена или инициализирована
then
  echo "Строка \"string1\" не пустая."
else  
  echo "Строка \"string1\" пустая."
fi                    # Неверный результат.
# Проверка показывает, что $string1 не пустая, хотя и не была инициализирована.

echo

# Давайте попробуем еще раз. 

if [ -n "$string1" ]  # На этот раз $string1 помещена в кавычки.
then
  echo "Строка \"string1\" не пустая."
else  
  echo "Строка \"string1\" пустая."
fi                    # Заключайте строки в кавычки при использовании внутри квадратных скобок !

echo

if [ $string1 ]       # Теперь $string1 осталась "голой".
then
  echo "Строка \"string1\" не пустая."
else  
  echo "Строка \"string1\" пустая."
fi                    # Сработало хорошо 
# Оператор проверки [ ... ] без ключей и других операторов может определить пустую строку.
# Но, несомненно, хорошим тоном является всё-таки заключение в кавычки(if [ "$string1" ]).
#
# Как указывает Stephane Chazelas,
#    if [ $string1 ]    имеет один аргумент: "]"
#    if [ "$string1" ]  имеет два аргумента: пустую переменную "$string1" и "]" 


echo


string1=initialized

if [ $string1 ]       # И снова $string1 остаётся без кавычек.
then
  echo "Строка \"string1\" не пустая."
else  
  echo "Строка \"string1\" пустая."
fi                    # Вновь получаем верный результат 
# Но до сих пор предпочтительнее использовать кавычки ("$string1"), потому что . . .


string1="a = b"

if [ $string1 ]       # Опять $string1 без кавычек.
then
  echo "Строка \"string1\" не пустая."
else  
  echo "Строка \"string1\" пустая."
fi                    # Не заключённая в кавычки переменная "$string1" явилась причиной неверного результата!

exit 0   # Так же благодарим Florian Wisser за предупреждение.
</pre></div></div><br class="example-break"/><div class="example"><a id="ex14"/><p class="title"><b>Пример 7.7. <em class="firstterm">zmore</em></b></p><div class="example-contents"><pre class="programlisting">
#!/bin/bash
# zmore

# Просмотр сжатых gzip файлов с использованием фильтра 'more'.

E_NOARGS=65
E_NOTFOUND=66
E_NOTGZIP=67

if [ $# -eq 0 ] # Такой же эффект, как от:  if [ -z "$1" ]
# $1 может существовать, но быть пустым:  zmore "" arg2 arg3
then
  echo "Использование: `basename $0` имя_файла" &gt;&amp;2
  # Сообщение об ошибке направляем в stderr.
  exit $E_NOARGS
  # Скрипт возвращает значение 65 (код ошибки).
fi  

filename=$1

if [ ! -f "$filename" ]   # Заключение в кавычки переменной $filename разрешает использование пробелов в ее содержимом.
then
  echo "Файл $filename не найден!" &gt;&amp;2   # Сообщение об ошибке направляем в stderr.
  exit $E_NOTFOUND
fi  

if [ ${filename##*.} != "gz" ]
# Используем фигурные скобки для подстановки.
then
  echo "Файл $1 не является архивом gzip!"
  exit $E_NOTGZIP
fi  

zcat $1 | more

# Используем фильтр 'more'.
# При желании, можно использовать 'less'.

exit $?   # Скрипт возвращает код завершения канала.
#  На самом деле команда "exit $?" вовсе необязательна, так как скрипт в любом случае
#+ вернёт код завершения последней выполненной команды.

</pre></div></div><br class="example-break"/><div class="variablelist" title="составные сравнения"><a id="ccomparison"/><p class="title"><b><a id="ccomparison1"/>составные сравнения</b></p><dl><dt><span class="term"><a id="compoundand"/><span class="token">-a</span></span></dt><dd><p>логическое И</p><p>Составное выражение <em class="replaceable"><code>exp1 -a exp2</code></em> возвращает истину, если
    <span class="emphasis"><em>оба</em></span> выражения - exp1 и exp2 - истинны.</p></dd><dt><span class="term"><a id="compoundor"/><span class="token">-o</span></span></dt><dd><p>логическое ИЛИ </p><p>Составное выражение <em class="replaceable"><code>exp1 -o exp2</code></em> возвращает
		истину, когда <span class="emphasis"><em>хотя бы одно</em></span> из выражений - exp1 или exp2 -
    истинно.</p></dd></dl></div><p>
         Эти два оператора подобны операторам сравнения Bash -
   <span class="command"><strong>&amp;&amp;</strong></span> и <span class="command"><strong>||</strong></span> - , используемым
   внутри <a class="link" href="ch07.html#dblbrackets">двойных квадратных скобок</a>.
     </p><pre class="programlisting">[[ Условие1 &amp;&amp; Условие2 ]]</pre><p>
       </p><p>
   Операторы <span class="command"><strong>-o</strong></span> и <span class="command"><strong>-a</strong></span> используются
   совместно с командой <a class="link" href="ch07.html#ttestref">test</a> 
   или внутри квадратных скобок.
         </p><pre class="programlisting">if [ "$expr1" -a "$expr2" ]
then
  echo "Оба выражения - expr1 и expr2 - истинны."
else
  echo "Одно из выражений - expr1 или expr2 - ложно."
fi</pre><p>
     </p><div class="caution" title="Предостережение" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Предостережение</h3><p>Но, как отмечает <span class="emphasis"><em>rihad</em></span>:
</p><pre class="programlisting">[ 1 -eq 1 ]  &amp;&amp; [ -n "`echo true 1&gt; &amp;2`" ]   # Выводится "true"
[ 1 -eq 2 ] &amp;&amp; [ -n "`echo true 1&gt;&amp;2`" ]   # (нет вывода)
# ^^^^^^^ Ложное условие. Пока что все, как и ожидалось.

# Однако...
[ 1 -eq 2 -a -n "`echo true 1&gt;&amp;2`" ]       # Выводится: "true"
# ^^^^^^^ Ложное условие. Так почему выводится "true"?

# Может быть, потому что оба условия расположены внутри одних и тех же скобок?
[[ 1 -eq 2 &amp;&amp; -n "`echo true 1&gt;&amp;2`" ]]     # (нет вывода)
# Нет, не потому.

# Вероятно, что  &amp;&amp; и || действуют иначе, чем -a и -o .</pre><p>
     </p></div><p>Чтобы познакомиться с составными операторами сравнения
	в действии, посмотрите <a class="xref" href="ch08.html#andor" title="Пример 8.3. Compound Condition Tests Using &amp;&amp; and ||">Пример 8.3, «Compound Condition Tests Using &amp;&amp; and ||»</a>, <a class="xref" href="ch26.html#twodim" title="Пример 26.17. Simulating a two-dimensional array, then tilting it">Пример 26.17, «Simulating a two-dimensional array, then tilting it»</a>,
	и <a class="xref" href="apa.html#whx" title="Пример A.29. Spammer Hunt">Пример A.29, «Spammer Hunt»</a>.</p><div class="footnotes"><br/><hr/><div class="footnote"><p><sup>[<a id="ftn.idp8651744" href="#idp8651744" class="para">33</a>] </sup>Как указывает S.C., в составных тестах
	заключение строковой переменной в кавычки может быть
	недостаточным. Выражение <strong class="userinput"><code>[ -n "$string" -o "$a" = "$b" ]</code></strong>
        в некоторых версиях Bash может вызвать ошибку, если 
        <code class="varname">$string</code> окажется пустой. Можно предупредить появление ошибки,
	добавив дополнительный символ к переменным, которые могут оказаться пустыми,
        <strong class="userinput"><code>[ "x$string" != x -o "x$a" = "x$b" ]</code></strong>
        (символ <span class="quote">«<span class="quote">x</span>»</span> спасает от ошибки).</p></div></div></div><div class="navfooter"><hr/><table width="100%" summary="Navigation footer"><tr><td align="left"><a accesskey="p" href="ch07s02.html">Пред.</a> </td><td align="center"><a accesskey="u" href="ch07.html">Уровень выше</a></td><td align="right"> <a accesskey="n" href="ch07s04.html">След.</a></td></tr><tr><td align="left" valign="top">Операторы проверки файлов </td><td align="center"><a accesskey="h" href="index.html">Начало</a></td><td align="right" valign="top"> Вложенные конструкции проверки <em class="replaceable"><code>if/then</code></em></td></tr></table></div></body></html>
