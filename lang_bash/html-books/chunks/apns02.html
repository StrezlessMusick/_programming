<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Writing Scripts</title><meta name="generator" content="DocBook XSL Stylesheets V1.75.2"/><link rel="home" href="index.html" title="Advanced Bash Scripting по-русски"/><link rel="up" href="apn.html" title="Приложение N. Exercises"/><link rel="prev" href="apn.html" title="Приложение N. Exercises"/><link rel="next" href="apo.html" title="Приложение O. Revision History"/></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Writing Scripts</th></tr><tr><td align="left"><a accesskey="p" href="apn.html">Пред.</a> </td><th width="60%" align="center">Приложение N. Exercises</th><td align="right"> <a accesskey="n" href="apo.html">След.</a></td></tr></table><hr/></div><div class="sect1" title="Writing Scripts"><div class="titlepage"><div><div><h2 class="title"><a id="writingscripts"/>Writing Scripts</h2></div></div></div><p><a id="writingscripts1"/></p><p>Write a script to carry out each of the following tasks.</p><div class="variablelist" title="EASY"><a id="exeasy"/><p class="title"><b><a id="exeasy1"/>EASY</b></p><dl><dt><span class="term"><span class="command"><strong>Self-reproducing Script</strong></span></span></dt><dd><p>Write a script that backs itself up, that is, copies
        itself to a file named <code class="filename">backup.sh</code>.</p><p>Hint: Use the <a class="link" href="ch15.html#catref">cat</a> command
        and the appropriate <a class="link" href="ch04s04.html#scrnameparam">positional
        parameter</a>.</p></dd><dt><span class="term"><span class="command"><strong>Home Directory Listing</strong></span></span></dt><dd><p>Perform a recursive directory listing on the user's home
        directory and save the information to a file. Compress
        the file, have the script prompt the user to insert
        a USB flash drive, then press <span class="keycap"><strong>ENTER</strong></span>.
              Finally, save the file to the flash drive after making
              certain the flash drive has properly mounted by parsing
              the output of <a class="link" href="ch16.html#dfref">df</a>.</p></dd><dt><span class="term"><span class="command"><strong>Converting  <a class="link" href="ch10.html#forloopref1">for</a>
      loops to <a class="link" href="ch10.html#whileloopref">while</a> and <a class="link" href="ch10.html#untilloopref">until</a> loops</strong></span></span></dt><dd><p>Convert the <em class="firstterm">for loops</em> in <a class="xref" href="ch10.html#ex22" title="Пример 10.1. Простой цикл for">Пример 10.1, «Простой цикл <em class="firstterm">for</em>»</a> to <em class="firstterm">while
        loops</em>. Hint: store the data in an <a class="link" href="ch26.html#arrayref">array</a> and step through the array
        elements.</p><p>Having already done the <span class="quote">«<span class="quote">heavy lifting,</span>»</span>
        now convert the loops in the example to <em class="firstterm"> until
        loops</em>.</p></dd><dt><span class="term"><span class="command"><strong>Changing the line spacing of a text file</strong></span></span></dt><dd><p>Write a script that reads each line of a target file, then
        writes the line back to <code class="filename">stdout</code>, but with
        an extra blank line following. This has the effect of
        <span class="emphasis"><em>double-spacing</em></span> the file.</p><p>Include all necessary code to check whether the script
        gets the necessary command-line argument (a filename),
        and whether the specified file exists.</p><p>When the script runs correctly, modify it to
        <span class="emphasis"><em>triple-space</em></span> the target file.</p><p>Finally, write a script to remove all blank lines from
        the target file, <span class="emphasis"><em>single-spacing</em></span> it.</p></dd><dt><span class="term"><span class="command"><strong>Backwards Listing</strong></span></span></dt><dd><p>Write a script that echoes itself to
        <code class="filename">stdout</code>, but
        <span class="emphasis"><em>backwards</em></span>.</p></dd><dt><span class="term"><span class="command"><strong>Automatically Decompressing Files</strong></span></span></dt><dd><p>Given a list of filenames as input, this script
        queries each target file (parsing the output of the
        <a class="link" href="ch15s05.html#fileref">file</a> command) for
        the type of compression used on it. Then the script
        automatically invokes the appropriate decompression command
        (<span class="command"><strong>gunzip</strong></span>, <span class="command"><strong>bunzip2</strong></span>,
        <span class="command"><strong>unzip</strong></span>, <span class="command"><strong>uncompress</strong></span>,
        or whatever). If a target file is not compressed, the
        script emits a warning message, but takes no other action
        on that particular file.</p></dd><dt><span class="term"><span class="command"><strong>Unique System ID</strong></span></span></dt><dd><p>Generate a <span class="quote">«<span class="quote">unique</span>»</span> 6-digit hexadecimal
        identifier for your computer. Do <span class="emphasis"><em>not</em></span>
        use the flawed <a class="link" href="ch16.html#hostidref">hostid</a>
        command. Hint: <span class="command"><strong><a class="link" href="ch15s05.html#md5sumref">md5sum</a>
        <a class="link" href="apg.html#datafilesref1"><code class="filename">/etc/passwd</code></a></strong></span>,
        then select the first 6 digits of output.</p></dd><dt><span class="term"><span class="command"><strong>Backup</strong></span></span></dt><dd><p>Archive as a <span class="quote">«<span class="quote">tarball</span>»</span>
        (<code class="filename">*.tar.gz</code> file) all the files
        in your home directory tree
        (<code class="filename">/home/your-name</code>) that have
        been modified in the last 24 hours. Hint: use <a class="link" href="ch15s02.html#findref">find</a>.</p></dd><dt><span class="term"><span class="command"><strong>Checking whether a process is still running</strong></span></span></dt><dd><p>Given a <a class="link" href="ch03.html#processidref">process ID</a>
        (<em class="firstterm">PID</em>) as an argument, this script
        will check, at user-specified intervals, whether
        the given process is still running. You may use
        the <a class="link" href="ch16.html#ppssref">ps</a> and <a class="link" href="ch15s03.html#sleepref">sleep</a> commands.</p></dd><dt><span class="term"><span class="command"><strong>Primes</strong></span></span></dt><dd><p>Print (to <code class="filename">stdout</code>) all
          prime numbers between 60000 and 63000. The output
          should be nicely formatted in columns (hint:
          use <a class="link" href="ch14.html#printfref">printf</a>).</p></dd><dt><span class="term"><span class="command"><strong>Lottery Numbers</strong></span></span></dt><dd><p>One type of lottery involves picking five
        different numbers, in the range of 1 - 50. Write a
        script that generates five pseudorandom numbers in this
        range, <span class="emphasis"><em>with no duplicates</em></span>. The
        script will give the option of echoing the numbers to
        <code class="filename">stdout</code> or saving them to a file,
        along with the date and time the particular number set
        was generated. (If your script consistently generates
      <span class="emphasis"><em>winning</em></span> lottery numbers, then you can
      retire on the proceeds and leave shell scripting to those
      of us who have to work for a living.)</p></dd></dl></div><div class="variablelist" title="INTERMEDIATE"><a id="exmedium"/><p class="title"><b><a id="exmedium1"/>INTERMEDIATE</b></p><dl><dt><span class="term"><span class="command"><strong>Integer or String</strong></span></span></dt><dd><p>Write a script <a class="link" href="ch23.html#functionref">function</a>
        that determines if an argument passed to it is an integer
        or a string. The function will return TRUE (0) if
        passed an integer, and FALSE (1) if passed a string.</p><p>Hint: What does the following expression return
        when <code class="varname">$1</code> is <span class="emphasis"><em>not</em></span>
        an integer?</p><p><code class="varname">expr $1 + 0</code></p></dd><dt><span class="term"><span class="command"><strong>Managing Disk Space</strong></span></span></dt><dd><p>List, one at a time, all files larger than 100K in
        the <code class="filename">/home/username</code>
        directory tree. Give the user the option to delete or
        compress the file, then proceed to show the next one. Write
        to a logfile the names of all deleted files and the
        deletion times.</p></dd><dt><span class="term"><span class="command"><strong>Banner</strong></span></span></dt><dd><p>Simulate the functionality of the deprecated <a class="link" href="ch15s09.html#bannerref">banner</a> command in a script.</p></dd><dt><span class="term"><span class="command"><strong>Removing Inactive Accounts</strong></span></span></dt><dd><p>Inactive accounts on a network waste disk space and may
        become a security risk. Write an administrative script
        (to be invoked by <em class="firstterm">root</em> or the <a class="link" href="ch16.html#cronref">cron daemon</a>) that checks
        for and deletes user accounts that have not been accessed
        within the last 90 days.</p></dd><dt><span class="term"><span class="command"><strong>Enforcing Disk Quotas</strong></span></span></dt><dd><p>Write a script for a multi-user system that checks users'
        disk usage. If a user surpasses a preset limit
        (100 MB, for example) in her <code class="filename">/home/username</code> directory,
        then the script automatically sends her a warning
        e-mail.</p><p>The script will use the <a class="link" href="ch16.html#duref">du</a> and
        <a class="link" href="ch15s06.html#commmail1">mail</a> commands. As an option,
        it will allow setting and enforcing quotas using the <a class="link" href="ch16.html#quotaref">quota</a> and <a class="link" href="ch16.html#setquotaref">setquota</a> commands.</p></dd><dt><span class="term"><span class="command"><strong>Logged in User Information</strong></span></span></dt><dd><p>For all logged in users, show their real names and the time
              and date of their last login.</p><p>Hint: use <a class="link" href="ch16.html#whoref">who</a>,
        <a class="link" href="ch16.html#lastlogref">lastlog</a>,
        and parse <a class="link" href="apg.html#datafilesref1"><code class="filename">/etc/passwd</code></a>.</p></dd><dt><span class="term"><span class="command"><strong>Safe Delete</strong></span></span></dt><dd><p>Implement, as a script, a <span class="quote">«<span class="quote">safe</span>»</span> delete
        command, <code class="filename">sdel.sh</code>. Filenames passed as
        command-line arguments to this script are not deleted,
        but instead <a class="link" href="ch15s05.html#gzipref">gzipped</a>
        if not already compressed (use <a class="link" href="ch15s05.html#fileref">file</a> to check), then moved
        to a <code class="filename">~/TRASH</code>
        directory. Upon invocation, the script checks the <code class="filename">~/TRASH</code> directory for files
        older than 48 hours and <a class="link" href="ch15.html#rmref">permanently
        deletes</a> them. (An better alternative might be to
        have a second script handle this, periodically invoked
        by the <a class="link" href="ch16.html#cronref">cron daemon</a>.)</p><p><span class="emphasis"><em>Extra credit:</em></span> Write the script
        so it can handle files and directories <a class="link" href="ch15.html#rmrecurs">recursively</a>. This would give it
        the capability of <span class="quote">«<span class="quote">safely deleting</span>»</span> entire
        directory structures.</p></dd><dt><span class="term"><span class="command"><strong>Making Change</strong></span></span></dt><dd><p>What is the most efficient way to make change for $1.68,
        using only coins in common circulations (up to 25c)? It's
        6 quarters, 1 dime, a nickel, and three cents.</p><p>Given any arbitrary command-line input in dollars and
        cents ($*.??), calculate the change, using the minimum
        number of coins. If your home country is not the United
        States, you may use your local currency units instead. The
        script will need to parse the command-line input, then
        change it to multiples of the smallest monetary unit (cents
        or whatever). Hint: look at <a class="xref" href="ch23.html#ex61" title="Пример 23.8. Перевод чисел в Римские цифры">Пример 23.8, «Перевод чисел в Римские цифры»</a>.</p></dd><dt><span class="term"><span class="command"><strong>Quadratic Equations</strong></span></span></dt><dd><p>Solve a <em class="firstterm">quadratic</em> equation of the form
        <em class="parameter"><code>Ax^2 + Bx + C = 0</code></em>. Have a script take
        as arguments the coefficients, <strong class="userinput"><code>A</code></strong>,
        <strong class="userinput"><code>B</code></strong>, and <strong class="userinput"><code>C</code></strong>,
        and return the solutions to four decimal places.</p><p>Hint: pipe the coefficients to <a class="link" href="ch15s08.html#bcref">bc</a>, using the well-known formula,
        <em class="parameter"><code>x = ( -B +/- sqrt( B^2 - 4AC ) ) / 2A</code></em>.</p></dd><dt><span class="term"><span class="command"><strong>Table of Logarithms</strong></span></span></dt><dd><p>Using the <a class="link" href="ch15s08.html#bcref">bc</a> and <a class="link" href="ch14.html#printfref">printf</a> commands, print out a
        nicely-formatted table of eight-place natural logarithms
        in the interval between 0.00 and 100.00, in steps of
        .01.</p><p>Hint: <em class="firstterm">bc</em> requires the
        <code class="option">-l</code> option to load the math library.</p></dd><dt><span class="term"><span class="command"><strong>Sum of Matching Numbers</strong></span></span></dt><dd><p>Find the sum of all five-digit numbers (in the range
        10000 - 99999) containing <span class="emphasis"><em>exactly two</em></span>
        out of the following set of digits: { 4, 5, 6 }. These may
        repeat within the same number, and if so, they count once
        for each occurrence.</p><p>Some examples of <em class="firstterm">matching numbers</em> are
        42057, 74638, and 89515.</p></dd><dt><span class="term"><span class="command"><strong>Lucky Numbers</strong></span></span></dt><dd><p>A <em class="firstterm">lucky number</em> is one whose
        individual digits add up to 7, in successive additions. For
        example, 62431 is a <em class="firstterm">lucky number</em>
        (6 + 2 + 4 + 3 + 1 = 16, 1 + 6 = 7). Find all the
        <em class="firstterm">lucky numbers</em> between 1000 and
        10000.</p></dd><dt><span class="term"><span class="command"><strong>Craps</strong></span></span></dt><dd><p>Borrowing the ASCII graphics from <a class="xref" href="apa.html#petals" title="Пример A.40. Petals Around the Rose">Пример A.40, «Petals Around the Rose»</a>,
        write a script that plays the well-known gambling game of
        <em class="firstterm">craps</em>. The script will accept bets
        from one or more players, roll the dice, and keep track of
        wins and losses, as well as of each player's bankroll.</p></dd><dt><span class="term"><span class="command"><strong>Tic-tac-toe</strong></span></span></dt><dd><p>Write a script that plays the child's game of
        <em class="firstterm">tic-tac-toe</em> against a human
        player. The script will let the human choose whether
        to take the first move. The script will follow
        an optimal strategy, and therefore never lose. To simplify
        matters, you may use ASCII graphics:</p><pre class="programlisting">   o | x |
   ----------
     | x |
   ----------
     | o |
     
   Your move, human (row, column)?</pre></dd><dt><span class="term"><span class="command"><strong>Alphabetizing a String</strong></span></span></dt><dd><p>Alphabetize (in ASCII order) an arbitrary string
        read from the command-line.</p></dd><dt><span class="term"><span class="command"><strong>Parsing</strong></span></span></dt><dd><p>Parse <a class="link" href="apg.html#datafilesref1"><code class="filename">/etc/passwd</code></a>,
      and output its contents in nice, easy-to-read tabular
      form.</p></dd><dt><span class="term"><span class="command"><strong>Logging Logins</strong></span></span></dt><dd><p>Parse <code class="filename">/var/log/messages</code> to
        produce a nicely formatted file of user logins and login
        times. The script may need to run as
        <em class="firstterm">root</em>. (Hint: Search for the string
        <span class="quote">«<span class="quote">LOGIN.</span>»</span>)</p></dd><dt><span class="term"><span class="command"><strong>Pretty-Printing a Data File</strong></span></span></dt><dd><p>Certain database and spreadsheet packages use save-files
        with <em class="firstterm">comma-separated values</em>
        (CSVs). Other applications often need to parse these
        files.</p><p>Given a data file with comma-separated <a class="link" href="ch03.html#fieldref">fields</a>, of the form:
          </p><pre class="programlisting">Jones,Bill,235 S. Williams St.,Denver,CO,80221,(303) 244-7989
Smith,Tom,404 Polk Ave.,Los Angeles,CA,90003,(213) 879-5612
...</pre><p>
        Reformat the data and print it out to
        <code class="filename">stdout</code> in labeled, evenly-spaced columns.</p></dd><dt><span class="term"><span class="command"><strong>Justification</strong></span></span></dt><dd><p>Given ASCII text input either from
        <code class="filename">stdin</code> or a file, adjust
        the word spacing to right-justify each line to a
        user-specified line-width, then send the output to
        <code class="filename">stdout</code>.</p></dd><dt><span class="term"><span class="command"><strong>Mailing List</strong></span></span></dt><dd><p>Using the <a class="link" href="ch15s06.html#commmail1">mail</a> command,
        write a script that manages a simple mailing list. The
        script automatically e-mails the monthly company newsletter,
        read from a specified text file, and sends it to all the
        addresses on the mailing list, which the script reads from
        another specified file.</p></dd><dt><span class="term"><span class="command"><strong>Generating Passwords</strong></span></span></dt><dd><p>Generate pseudorandom 8-character passwords, using
        characters in the ranges [0-9], [A-Z], [a-z]. Each password
        must contain at least two digits.</p></dd><dt><span class="term"><span class="command"><strong>Monitoring a User</strong></span></span></dt><dd><p>You suspect that one particular user on the network
        has been abusing his privileges and possibly attempting to
        hack the system. Write a script to automatically monitor
        and log his activities when he's signed on. The log file
        will save entries for the previous week, and delete those
        entries more than seven days old.</p><p>You may use <a class="link" href="ch16.html#lastref">last</a>,
             <a class="link" href="ch16.html#lastlogref">lastlog</a>, and <a class="link" href="ch16.html#lastcommref">lastcomm</a> to aid your
             surveillance of the suspected malefactor.</p></dd><dt><span class="term"><span class="command"><strong>Checking for Broken Links</strong></span></span></dt><dd><p>Using <a class="link" href="ch15s06.html#lynxref">lynx</a> with the
        <code class="option">-traversal</code> option, write a script that
        checks a Web site for broken links.</p></dd></dl></div><div class="variablelist" title="DIFFICULT"><a id="exdifficult"/><p class="title"><b><a id="exdifficult1"/>DIFFICULT</b></p><dl><dt><span class="term"><span class="command"><strong>Testing Passwords</strong></span></span></dt><dd><p>Write a script to check and validate passwords. The object
        is to flag <span class="quote">«<span class="quote">weak</span>»</span> or easily guessed password
        candidates.</p><p>A trial password will be input to the script as a
         command-line parameter. To be considered acceptable,
         a password must meet the following minimum qualifications:

            </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Minimum length of 8 characters</p></li><li class="listitem"><p>Must contain at least one numeric character</p></li><li class="listitem"><p>Must contain at least one of the following
      non-alphabetic characters: <span class="token">@</span>,
      <span class="token">#</span>, <span class="token">$</span>, <span class="token">%</span>,
      <span class="token">&amp;</span>, <span class="token">*</span>, <span class="token">+</span>,
      <span class="token">-</span>, <span class="token">=</span></p></li></ul></div><p>Optional:

            </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Do a dictionary check on every sequence of at least
      four consecutive alphabetic characters in the password under
      test. This will eliminate passwords containing embedded
      <span class="quote">«<span class="quote">words</span>»</span> found in a standard dictionary.</p></li><li class="listitem"><p>Enable the script to check all the passwords on your
      system. These probably do not reside in
      <a class="link" href="apg.html#datafilesref1"><code class="filename">/etc/passwd</code></a>.</p></li></ul></div><p>This exercise tests mastery of <a class="link" href="ch17.html#regexref">Regular Expressions</a>.</p></dd><dt><span class="term"><span class="command"><strong>Cross Reference</strong></span></span></dt><dd><p>Write a script that generates a
        <em class="firstterm">cross-reference</em>
        (<em class="firstterm">concordance</em>) on a target file.
        The output will be a listing of all word occurrences in
        the target file, along with the line numbers in which
        each word occurs. Traditionally, <em class="firstterm">linked
        list</em> constructs would be used in such
        applications. Therefore, you should investigate <a class="link" href="ch26.html#arrayref">arrays</a> in the course of
        this exercise. <a class="xref" href="ch15s04.html#wf" title="Пример 15.12. Word Frequency Analysis">Пример 15.12, «Word Frequency Analysis»</a> is probably
        <span class="emphasis"><em>not</em></span> a good place to start.</p></dd><dt><span class="term"><a id="newtonsqrt"/><span class="command"><strong>Square Root</strong></span></span></dt><dd><p>Write a script to calculate square roots of numbers
              using <em class="firstterm">Newton's Method</em>.</p><p>The algorithm for this, expressed as a snippet of Bash
              <a class="link" href="ch33s08.html#pseudocoderef">pseudo-code</a> is:</p><pre class="programlisting">#  (Isaac) Newton's Method for speedy extraction
#+ of square roots.

guess = $argument
#  $argument is the number to find the square root of.
#  $guess is each successive calculated "guess" -- or trial solution --
#+ of the square root.
#  Our first "guess" at a square root is the argument itself.

oldguess = 0
# $oldguess is the previous $guess.

tolerance = .000001
# To how close a tolerance we wish to calculate.

loopcnt = 0
# Let's keep track of how many times through the loop.
# Some arguments will require more loop iterations than others.


while [ ABS( $guess $oldguess ) -gt $tolerance ]
#       ^^^^^^^^^^^^^^^^^^^^^^^ Fix up syntax, of course.

#      "ABS" is a (floating point) function to find the absolute value
#+      of the difference between the two terms.
#             So, as long as difference between current and previous
#+            trial solution (guess) exceeds the tolerance, keep looping.

do
   oldguess = $guess  # Update $oldguess to previous $guess.

#  =======================================================
   guess = ( $oldguess + ( $argument / $oldguess ) ) / 2.0
#        = 1/2 ( ($oldguess **2 + $argument) / $oldguess )
#  equivalent to:
#        = 1/2 ( $oldguess + $argument / $oldguess )
#  that is, "averaging out" the trial solution and
#+ the proportion of argument deviation
#+ (in effect, splitting the error in half).
#  This converges on an accurate solution
#+ with surprisingly few loop iterations . . .
#+ for arguments &gt; $tolerance, of course.
#  =======================================================

   (( loopcnt++ ))     # Update loop counter.
done</pre><p>It's a simple enough recipe, and
              <span class="emphasis"><em>seems</em></span> at first glance easy enough to
              convert into a working Bash script. The problem, though,
              is that Bash has <a class="link" href="ch08.html#nofloatingpoint">no native
              support for floating point numbers</a>. So, the script
              writer needs to use <a class="link" href="ch15s08.html#bcref">bc</a> or
              possibly <a class="link" href="apcs02.html#awkref">awk</a> to convert the
              numbers and do the calculations. It may get rather messy
              . . .</p></dd><dt><span class="term"><span class="command"><strong>Logging File Accesses</strong></span></span></dt><dd><p>Log all accesses to the files in <code class="filename">/etc</code> during the course of
        a single day. This information should include the filename,
        user name, and access time. If any alterations to the
        files take place, that should be flagged. Write this data
        as neatly formatted records in a logfile.</p></dd><dt><span class="term"><span class="command"><strong>Monitoring Processes</strong></span></span></dt><dd><p>Write a script to continually monitor all running
        processes and to keep track of how many child processes each
        parent spawns. If a process spawns more than five children,
        then the script sends an e-mail to the system administrator
        (or <em class="firstterm">root</em>) with all relevant
        information, including the time, PID of the parent, PIDs
        of the children, etc. The script appends a report to a log
        file every ten minutes.  </p></dd><dt><span class="term"><span class="command"><strong>Strip Comments</strong></span></span></dt><dd><p>Strip all comments from a shell script whose name
        is specified on the command-line. Note that the <a class="link" href="ch02.html#shabangref">#! line</a> must not be stripped
        out.</p></dd><dt><span class="term"><span class="command"><strong>Strip HTML Tags</strong></span></span></dt><dd><p>Strip all HTML tags from a specified HTML file, then
        reformat it into lines between 60 and 75 characters
        in length. Reset paragraph and block spacing, as
        appropriate, and convert HTML tables to their approximate
        text equivalent.</p></dd><dt><span class="term"><span class="command"><strong>XML Conversion</strong></span></span></dt><dd><p>Convert an XML file to both HTML and text format.</p></dd><dt><span class="term"><a id="cspammers"/><span class="command"><strong>Chasing Spammers</strong></span></span></dt><dd><p> Write a script that analyzes a spam e-mail by doing
        DNS lookups on the IP addresses in the headers to identify
        the relay hosts as well as the originating ISP. The
        script will forward the unaltered spam message to the
        responsible ISPs. Of course, it will be necessary to
        filter out <span class="emphasis"><em>your own ISP's IP address</em></span>,
        so you don't end up complaining about yourself.</p><p>As necessary, use the appropriate <a class="link" href="ch15s06.html#communinfo1">network analysis commands</a>.</p><p>For some ideas, see <a class="xref" href="ch15s06.html#isspammer" title="Пример 15.41. Analyzing a spam domain">Пример 15.41, «Analyzing a spam domain»</a> and <a class="xref" href="apa.html#isspammer2" title="Пример A.28. Spammer Identification">Пример A.28, «Spammer Identification»</a>.</p><p>Optional: Write a script that searches through a list of
        e-mail messages and deletes the spam according to specified
        filters.</p></dd><dt><span class="term"><span class="command"><strong>Creating man pages</strong></span></span></dt><dd><p>Write a script that automates the process of creating
        <a class="link" href="ch15.html#manref">man pages</a>.</p><p>Given a text file which contains information to be
        formatted into a <em class="firstterm">man page</em>, the
        script will read the file, then invoke the appropriate
        <a class="link" href="ch15s04.html#groffref">groff</a> commands to
        output the corresponding <em class="firstterm">man page</em>
        to <code class="filename">stdout</code>. The text file contains
        blocks of information under the standard <em class="firstterm">man
        page</em> headings, i.e., NAME, SYNOPSIS,
        DESCRIPTION, etc.</p><p><a class="xref" href="apa.html#maned" title="Пример A.39. A man page editor">Пример A.39, «A <em class="firstterm">man page</em> editor»</a> is an instructive first step.</p></dd><dt><span class="term"><span class="command"><strong>Morse Code</strong></span></span></dt><dd><p>Convert a text file to Morse code. Each character of the
        text file will be represented as a corresponding Morse
        code group of dots and dashes (underscores), separated by
        whitespace from the next. For example:
    </p><pre class="programlisting">Invoke the "morse.sh" script with "script"
as an argument to convert to Morse.


$ sh morse.sh script

... _._. ._. .. .__. _
s   c    r   i   p   t</pre></dd><dt><span class="term"><span class="command"><strong>Hex Dump</strong></span></span></dt><dd><p>Do a hex(adecimal) dump on a binary file
        specified as an argument. The output should be in neat
        tabular <a class="link" href="ch03.html#fieldref">fields</a>, with the
        first field showing the address, each of the next 8 fields a
        4-byte hex number, and the final field the ASCII equivalent
        of the previous 8 fields.</p><p>The obvious
        followup to this is to extend the hex dump script into a
        disassembler. Using a lookup table, or some other clever
        gimmick, convert the hex values into 80x86 op codes.</p></dd><dt><span class="term"><span class="command"><strong>Emulating a Shift Register</strong></span></span></dt><dd><p>Using <a class="xref" href="ch26.html#stackex" title="Пример 26.15. Emulating a push-down stack">Пример 26.15, «Emulating a push-down stack»</a> as an inspiration,
        write a script that emulates a 64-bit shift register as
        an <a class="link" href="ch26.html#arrayref">array</a>. Implement
        functions to <em class="firstterm">load</em> the register,
        <em class="firstterm">shift left</em>, <em class="firstterm">shift
        right</em>, and <em class="firstterm">rotate</em>
        it. Finally, write a function that interprets the register
        contents as eight 8-bit ASCII characters.</p></dd><dt><span class="term"><span class="command"><strong>Calculating Determinants</strong></span></span></dt><dd><p>Write a script that calculates
        determinants
          <sup>[<a id="idp19867984" href="#ftn.idp19867984" class="footnote">142</a>]</sup>
    
    by <a class="link" href="ch23s02.html#recursionref0">recursively</a> expanding the
        <em class="firstterm">minors</em>. Use a 4 x 4 determinant as
        a test case.</p></dd><dt><span class="term"><span class="command"><strong>Hidden Words</strong></span></span></dt><dd><p>Write a <span class="quote">«<span class="quote">word-find</span>»</span> puzzle generator,
        a script that hides 10 input words in a 10 x 10 array
        of random letters. The words may be hidden across, down,
        or diagonally.</p><p>Optional: Write a script that <span class="emphasis"><em>solves</em></span>
        word-find puzzles. To keep this from becoming too difficult,
        the solution script will find only horizontal and vertical
        words. (Hint: Treat each row and column as a string, and
        search for substrings.)</p></dd><dt><span class="term"><span class="command"><strong>Anagramming</strong></span></span></dt><dd><p> Anagram 4-letter input. For example, the
        anagrams of <span class="emphasis"><em>word</em></span> are:
        <span class="emphasis"><em>do or rod row word</em></span>. You may use
        <code class="filename">/usr/share/dict/linux.words</code> as the
        reference list.</p></dd><dt><span class="term"><span class="command"><strong>Word Ladders</strong></span></span></dt><dd><p>A <span class="quote">«<span class="quote">word ladder</span>»</span> is a sequence of words,
              with each successive word in the sequence differing from
              the previous one by a single letter.</p><p>For example, to <span class="quote">«<span class="quote">ladder</span>»</span> from
              <span class="emphasis"><em>mark</em></span> to
              <span class="emphasis"><em>vase</em></span>:</p><p>
      </p><pre class="programlisting">
mark --&gt; park --&gt; part --&gt; past --&gt; vast --&gt; vase
         ^           ^       ^      ^           ^</pre><p>
            </p><p>Write a script that solves word ladder puzzles. Given
        a starting and an ending word, the script will list all
        intermediate steps in the <span class="quote">«<span class="quote">ladder.</span>»</span> Note
        that <span class="emphasis"><em>all</em></span> words in the sequence must
        be legitimate dictionary words.</p></dd><dt><span class="term"><span class="command"><strong>Fog Index</strong></span></span></dt><dd><p>The <span class="quote">«<span class="quote">fog index</span>»</span> of a passage of text
        estimates its reading difficulty, as a number corresponding
        roughly to a school grade level. For example, a passage
        with a fog index of 12 should be comprehensible to anyone
        with 12 years of schooling.</p><p>The Gunning version of the fog index uses the following
        algorithm.</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p>Choose a section of the text at least
                 100 words in length.</p></li><li class="listitem"><p>Count the number of sentences (a portion of
                 a sentence truncated by the boundary of the text section
                 counts as one).</p></li><li class="listitem"><p>Find the average number of words per
                   sentence.</p><p>AVE_WDS_SEN = TOTAL_WORDS / SENTENCES</p></li><li class="listitem"><p>Count the number of <span class="quote">«<span class="quote">difficult</span>»</span>
       words in the segment -- those containing at least
       3 syllables. Divide this quantity by total words to
       get the proportion of difficult words.</p><p>PRO_DIFF_WORDS = LONG_WORDS / TOTAL_WORDS</p></li><li class="listitem"><p>The Gunning fog index is the sum of the above two
                   quantities, multiplied by 0.4, then rounded to the
                   nearest integer.</p><p>G_FOG_INDEX = int ( 0.4 * ( AVE_WDS_SEN  + PRO_DIFF_WORDS ) )</p></li></ol></div><p>Step 4 is by far the most difficult portion of the
        exercise. There exist various algorithms for estimating
        the syllable count of a word. A rule-of-thumb formula
        might consider the number of letters in a word and the
        vowel-consonant mix.</p><p>A strict interpretation of the Gunning fog index does
        not count compound words and proper nouns as
        <span class="quote">«<span class="quote">difficult</span>»</span> words, but this would enormously
        complicate the script.</p></dd><dt><span class="term"><span class="command"><strong>Calculating PI using Buffon's Needle</strong></span></span></dt><dd><p>The Eighteenth Century French mathematician de Buffon
        came up with a novel experiment. Repeatedly drop a needle
        of length <em class="replaceable"><code>n</code></em> onto a wooden floor
        composed of long and narrow parallel boards. The cracks
        separating the equal-width floorboards are a fixed distance
        <em class="replaceable"><code>d</code></em> apart. Keep track of the
        total drops and the number of times the needle intersects
        a crack on the floor. The ratio of these two quantities
        turns out to be a fractional multiple of PI.</p><p>In the spirit of <a class="xref" href="ch15s08.html#cannon" title="Пример 15.50. Calculating PI">Пример 15.50, «Calculating PI»</a>, write a
        script that runs a Monte Carlo simulation of
        <em class="firstterm">Buffon's Needle</em>. To simplify matters,
        set the needle length equal to the distance between the
        cracks, <em class="parameter"><code>n = d</code></em>.</p><p>Hint: there are actually two critical variables:
              the distance from the center of the needle to the nearest
              crack, and the inclination angle of the needle to that crack.
        You may use <a class="link" href="ch15s08.html#bcref">bc</a> to handle
        the calculations.</p></dd><dt><span class="term"><span class="command"><strong>Playfair Cipher</strong></span></span></dt><dd><p>Implement the Playfair (Wheatstone) Cipher in a
        script.</p><p>The Playfair Cipher encrypts text by substitution
        of <em class="firstterm">digrams</em> (2-letter groupings).
        It is traditional to use a 5 x 5 letter scrambled-alphabet
        <em class="firstterm">key square</em> for the encryption and
        decryption.</p><p>
       </p><pre class="programlisting">   C O D E S
   A B F G H
   I K L M N
   P Q R T U
   V W X Y Z

Each letter of the alphabet appears once, except "I" also represents
"J". The arbitrarily chosen key word, "CODES" comes first, then all
the rest of the alphabet, in order from left to right, skipping letters
already used.

To encrypt, separate the plaintext message into digrams (2-letter
groups). If a group has two identical letters, delete the second, and
form a new group. If there is a single letter left over at the end,
insert a "null" character, typically an "X."

THIS IS A TOP SECRET MESSAGE

TH IS IS AT OP SE CR ET ME SA GE



For each digram, there are three possibilities.
-----------------------------------------------

1) Both letters will be on the same row of the key square:
   For each letter, substitute the one immediately to the right, in that
   row. If necessary, wrap around left to the beginning of the row.

or

2) Both letters will be in the same column of the key square:
   For each letter, substitute the one immediately below it, in that
   row. If necessary, wrap around to the top of the column.

or

3) Both letters will form the corners of a rectangle within the key square:
   For each letter, substitute the one on the other corner the rectangle
   which lies on the same row.


The "TH" digram falls under case #3.
G H
M N
T U           (Rectangle with "T" and "H" at corners)

T --&gt; U
H --&gt; G


The "SE" digram falls under case #1.
C O D E S     (Row containing "S" and "E")

S --&gt; C  (wraps around left to beginning of row)
E --&gt; S

=========================================================================

To decrypt encrypted text, reverse the above procedure under cases #1
and #2 (move in opposite direction for substitution). Under case #3,
just take the remaining two corners of the rectangle.


Helen Fouche Gaines' classic work, ELEMENTARY CRYPTANALYSIS (1939), gives a
fairly detailed description of the Playfair Cipher and its solution methods.</pre><p>
             </p><p>This script will have three main sections</p><div class="orderedlist"><a id="playfairexref"/><ol class="orderedlist"><li class="listitem"><p>Generating the <em class="firstterm">key square</em>,
           based on a user-input keyword.</p></li><li class="listitem"><p>Encrypting a <em class="firstterm">plaintext</em>
           message.</p></li><li class="listitem"><p>Decrypting encrypted
           text.</p></li></ol></div><p>The script will make extensive use of <a class="link" href="ch26.html#arrayref">arrays</a> and <a class="link" href="ch23.html#functionref">functions</a>.</p></dd></dl></div><p>--</p><p>Please do not send the author your solutions to these
            exercises. There are more appropriate ways to impress him with
            your cleverness, such as submitting bugfixes and suggestions
            for improving this book.</p><div class="footnotes"><br/><hr/><div class="footnote"><p><sup>[<a id="ftn.idp19867984" href="#idp19867984" class="para">142</a>] </sup>For all you fine people who failed second-year algebra,
                a <em class="firstterm">determinant</em> is a numerical quantity
    associated with a multidimensional
    <em class="firstterm">matrix</em> (<a class="link" href="ch26.html#arrayref">array</a> of numbers).
      <pre class="programlisting">For the simple case of a 2 x 2 determinant:

  |a  b|
  |b  a|

The solution is a*a - b*b, where "a" and "b" represent numbers.</pre>
                </p></div></div></div><div class="navfooter"><hr/><table width="100%" summary="Navigation footer"><tr><td align="left"><a accesskey="p" href="apn.html">Пред.</a> </td><td align="center"><a accesskey="u" href="apn.html">Уровень выше</a></td><td align="right"> <a accesskey="n" href="apo.html">След.</a></td></tr><tr><td align="left" valign="top">Приложение N. Exercises </td><td align="center"><a accesskey="h" href="index.html">Начало</a></td><td align="right" valign="top"> Приложение O. Revision History</td></tr></table></div></body></html>
