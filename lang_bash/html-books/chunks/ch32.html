<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Глава 32. Scripting With Style</title><meta name="generator" content="DocBook XSL Stylesheets V1.75.2"/><link rel="home" href="index.html" title="Advanced Bash Scripting по-русски"/><link rel="up" href="pt05.html" title="Часть Part 5. Материал повышенной сложности"/><link rel="prev" href="ch31.html" title="Глава 31. Gotchas"/><link rel="next" href="ch33.html" title="Глава 33. Miscellany"/></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Глава 32. Scripting With Style</th></tr><tr><td align="left"><a accesskey="p" href="ch31.html">Пред.</a> </td><th width="60%" align="center">Часть Part 5. Материал повышенной сложности</th><td align="right"> <a accesskey="n" href="ch33.html">След.</a></td></tr></table><hr/></div><div class="chapter" title="Глава 32. Scripting With Style"><div class="titlepage"><div><div><h2 class="title"><a id="scrstyle"/>Глава 32. Scripting With Style</h2></div></div></div><div class="toc"><p><b>Содержание</b></p><dl><dt><span class="sect1"><a href="ch32.html#unofficialst">Unofficial Shell Scripting Stylesheet</a></span></dt></dl></div><p>Get into the habit of writing shell scripts in a structured and
  systematic manner. Even on-the-fly and <span class="quote">«<span class="quote">written on the
  back of an envelope</span>»</span> scripts will benefit if you take a
  few minutes to plan and organize your thoughts before sitting
  down and coding.</p><p>Herewith are a few stylistic guidelines. This is not
  (necessarily) intended as an <span class="emphasis"><em>Official Shell Scripting
  Stylesheet</em></span>.</p><div class="sect1" title="Unofficial Shell Scripting Stylesheet"><div class="titlepage"><div><div><h2 class="title"><a id="unofficialst"/>Unofficial Shell Scripting Stylesheet</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Comment your code. This makes it easier for others to
      understand (and appreciate), and easier for you to maintain.
      </p><pre class="programlisting">PASS="$PASS${MATRIX:$(($RANDOM%${#MATRIX})):1}"
#  It made perfect sense when you wrote it last year,
#+ but now it's a complete mystery.
#  (From Antek Sawicki's "pw.sh" script.)</pre><p>
    </p><p>Add descriptive headers to your scripts and functions.
      </p><pre class="programlisting">#!/bin/bash

#************************************************#
#                   xyz.sh                       #
#           written by Bozo Bozeman              #
#                July 05, 2001                   #
#                                                #
#           Clean up project files.              #
#************************************************#

E_BADDIR=85                       # No such directory.
projectdir=/home/bozo/projects    # Directory to clean up.

# --------------------------------------------------------- #
# cleanup_pfiles ()                                         #
# Removes all files in designated directory.                #
# Parameter: $target_directory                              #
# Returns: 0 on success, $E_BADDIR if something went wrong. #
# --------------------------------------------------------- #
cleanup_pfiles ()
{
  if [ ! -d "$1" ]  # Test if target directory exists.
  then
    echo "$1 is not a directory."
    return $E_BADDIR
  fi

  rm -f "$1"/*
  return 0   # Success.
}  

cleanup_pfiles $projectdir

exit $?</pre></li><li class="listitem"><p>Avoid using <span class="quote">«<span class="quote">magic numbers,</span>»</span>

       <sup>[<a id="idp17458400" href="#ftn.idp17458400" class="footnote">112</a>]</sup>

      that is, <span class="quote">«<span class="quote">hard-wired</span>»</span> literal constants. Use
      meaningful variable names instead. This makes the script
      easier to understand and permits making changes and updates
      without breaking the application.

      </p><pre class="programlisting">if [ -f /var/log/messages ]
then
  ...
fi
#  A year later, you decide to change the script to check /var/log/syslog.
#  It is now necessary to manually change the script, instance by instance,
#+ and hope nothing breaks.

# A better way:
LOGFILE=/var/log/messages  # Only line that needs to be changed.
if [ -f "$LOGFILE" ]
then
  ...
fi</pre><p>
          </p></li><li class="listitem"><p>Choose descriptive names for variables and functions.
      </p><pre class="programlisting">fl=`ls -al $dirname`                 # Cryptic.
file_listing=`ls -al $dirname`       # Better.


MAXVAL=10   # All caps used for a script constant.
while [ "$index" -le "$MAXVAL" ]
...


E_NOTFOUND=95                        #  Uppercase for an errorcode,
                                     #+ and name prefixed with E_.
if [ ! -e "$filename" ]
then
  echo "File $filename not found."
  exit $E_NOTFOUND
fi  


MAIL_DIRECTORY=/var/spool/mail/bozo  #  Uppercase for an environmental
export MAIL_DIRECTORY                #+ variable.


GetAnswer ()                         #  Mixed case works well for a
{                                    #+ function name, especially
  prompt=$1                          #+ when it improves legibility.
  echo -n $prompt
  read answer
  return $answer
}  

GetAnswer "What is your favorite number? "
favorite_number=$?
echo $favorite_number


_uservariable=23                     # Permissible, but not recommended.
# It's better for user-defined variables not to start with an underscore.
# Leave that for system variables.</pre><p>
          </p></li><li class="listitem"><p>Use <a class="link" href="ch06.html#exitcommandref">exit codes</a>
      in a systematic and meaningful way.

      </p><pre class="programlisting">E_WRONG_ARGS=95
...
...
exit $E_WRONG_ARGS</pre><p>
            See also <a class="xref" href="apd.html" title="Приложение D. Exit Codes With Special Meanings">Приложение D, <i>Exit Codes With Special Meanings</i></a>.</p><p><span class="emphasis"><em>Ender</em></span> suggests using the <a class="link" href="apd.html#sysexitsref">exit codes
      in <code class="filename">/usr/include/sysexits.h</code></a> in shell
      scripts, though these are primarily intended for C and C++
      programming.</p></li><li class="listitem"><p>Use standardized parameter flags for script invocation.
       <span class="emphasis"><em>Ender</em></span> proposes the following set
       of flags.</p><p>
             </p><pre class="programlisting">-a      All: Return all information (including hidden file info).
-b      Brief: Short version, usually for other scripts.
-c      Copy, concatenate, etc.
-d      Daily: Use information from the whole day, and not merely
        information for a specific instance/user.
-e      Extended/Elaborate: (often does not include hidden file info).
-h      Help: Verbose usage w/descs, aux info, discussion, help.
        See also -V.
-l      Log output of script.
-m      Manual: Launch man-page for base command.
-n      Numbers: Numerical data only.
-r      Recursive: All files in a directory (and/or all sub-dirs).
-s      Setup &amp; File Maintenance: Config files for this script.
-u      Usage: List of invocation flags for the script.
-v      Verbose: Human readable output, more or less formatted.
-V      Version / License / Copy(right|left) / Contribs (email too).</pre><p>
           </p><p>See also <a class="xref" href="apf.html#standard-options" title="Standard Command-Line Options">«Standard Command-Line Options»</a>.</p></li><li class="listitem"><p>Break complex scripts into simpler modules. Use functions
      where appropriate. See <a class="xref" href="ch34.html#cards" title="Пример 34.4. Using arrays and other miscellaneous trickery to deal four random hands from a deck of cards">Пример 34.4, «Using arrays and other miscellaneous trickery
    to deal four random hands from a deck of cards»</a>.</p></li><li class="listitem"><p>Don't use a complex construct where a simpler one will do.

      </p><pre class="programlisting">COMMAND
if [ $? -eq 0 ]
...
# Redundant and non-intuitive.

if COMMAND
...
# More concise (if perhaps not quite as legible).</pre><p>
          </p></li></ul></div><div class="epigraph"><p>... reading the UNIX source code to the Bourne shell (/bin/sh). I
        was shocked at how much simple algorithms could be made cryptic, and
  therefore useless, by a poor choice of code style. I asked myself,
  <span class="quote">«<span class="quote">Could someone be proud of this code?</span>»</span></p><p>--Landon Noll</p></div></div><div class="footnotes"><br/><hr/><div class="footnote"><p><sup>[<a id="ftn.idp17458400" href="#idp17458400" class="para">112</a>] </sup>In this context, <span class="quote">«<span class="quote">magic
         numbers</span>»</span> have an entirely different meaning than
         the <a class="link" href="ch02.html#magnumref">magic numbers</a> used
         to designate file types.</p></div></div></div><div class="navfooter"><hr/><table width="100%" summary="Navigation footer"><tr><td align="left"><a accesskey="p" href="ch31.html">Пред.</a> </td><td align="center"><a accesskey="u" href="pt05.html">Уровень выше</a></td><td align="right"> <a accesskey="n" href="ch33.html">След.</a></td></tr><tr><td align="left" valign="top">Глава 31. Gotchas </td><td align="center"><a accesskey="h" href="index.html">Начало</a></td><td align="right" valign="top"> Глава 33. Miscellany</td></tr></table></div></body></html>
