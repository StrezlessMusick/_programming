<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Глава 9. К вопросу о переменных</title><meta name="generator" content="DocBook XSL Stylesheets V1.75.2"/><link rel="home" href="index.html" title="Advanced Bash Scripting по-русски"/><link rel="up" href="pt03.html" title="Часть Part 3. Углубленный материал"/><link rel="prev" href="pt03.html" title="Часть Part 3. Углубленный материал"/><link rel="next" href="ch09s02.html" title="Manipulating Strings"/></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Глава 9. К вопросу о переменных</th></tr><tr><td align="left"><a accesskey="p" href="pt03.html">Пред.</a> </td><th width="60%" align="center">Часть Part 3. Углубленный материал</th><td align="right"> <a accesskey="n" href="ch09s02.html">След.</a></td></tr></table><hr/></div><div class="chapter" title="Глава 9. К вопросу о переменных"><div class="titlepage"><div><div><h2 class="title"><a id="variables2"/>Глава 9. К вопросу о переменных</h2></div></div></div><div class="toc"><p><b>Содержание</b></p><dl><dt><span class="sect1"><a href="ch09.html#internalvariables">Внутренние Переменные</a></span></dt><dt><span class="sect1"><a href="ch09s02.html">Manipulating Strings</a></span></dt><dd><dl><dt><span class="sect2"><a href="ch09s02.html#awkstringmanip">Manipulating strings using awk</a></span></dt><dt><span class="sect2"><a href="ch09s02.html#strfdisc">Further Reference</a></span></dt></dl></dd><dt><span class="sect1"><a href="ch09s03.html">Parameter Substitution</a></span></dt><dt><span class="sect1"><a href="ch09s04.html">Typing variables: <span class="command"><strong>declare</strong></span> or
    <span class="command"><strong>typeset</strong></span></a></span></dt><dd><dl><dt><span class="sect2"><a href="ch09s04.html#declare2x">Another use for <em class="firstterm">declare</em></a></span></dt></dl></dd><dt><span class="sect1"><a href="ch09s05.html">Indirect References</a></span></dt><dt><span class="sect1"><a href="ch09s06.html">$RANDOM: generate random integer</a></span></dt><dt><span class="sect1"><a href="ch09s07.html">The Double-Parentheses Construct</a></span></dt></dl></div><p>Правильное использование переменных может придать сценариям дополнительную мощь и гибкость,
    а для этого необходимо изучить все тонкости и
           нюансы.</p><div class="sect1" title="Внутренние Переменные"><div class="titlepage"><div><div><h2 class="title"><a id="internalvariables"/>Внутренние Переменные</h2></div></div></div><div class="variablelist"><a id="internalvariables1"/><dl><dt><span class="term"><em class="replaceable"><code><a class="link" href="ch14.html#builtinref">Встроенные</a> переменные:</code></em></span></dt><dd><p>переменные зависящие от свойств оболочки bash скрипта</p></dd><dt><span class="term"><a id="bashvarref"/><code class="varname">$BASH</code></span></dt><dd><p>Путь к исполняемому файлу <em class="firstterm">Bash</em>
        </p><pre class="screen"><code class="prompt">bash$ </code><strong class="userinput"><code>echo $BASH</code></strong>
<code class="computeroutput">/bin/bash</code></pre><p>
      </p></dd><dt><span class="term"><a id="bashenvref"/><code class="varname">$BASH_ENV</code></span></dt><dd><p><a class="link" href="ch04s04.html#envref">Переменная
    окружения</a> указывающая на Bash файл, который нужно прочитать
    при запуске скрипта</p></dd><dt><span class="term"><a id="bashsubshellref"/><code class="varname">$BASH_SUBSHELL</code></span></dt><dd><p>Переменная показывающая уровень вложенности<a class="link" href="ch20.html#subshellsref">оболочки</a>. Введена в
        <a class="link" href="ch34s02.html#bash3ref">3 версии</a> Bash.</p><p>Смотрите <a class="xref" href="ch20.html#subshell" title="Пример 20.1. Variable scope in a subshell">Пример 20.1, «Variable scope in a subshell»</a> подробнее.</p></dd><dt><span class="term"><a id="bashpidref"/><code class="varname">$BASHPID</code></span></dt><dd><p><em class="firstterm">Номер процесса</em>
            текущей задачи Bash. Это не тоже самое, что и переменная
            <a class="link" href="ch09.html#proccid">$$</a>, но часто дает
            такой же результат.</p><p>
      </p><pre class="screen">
<code class="prompt">bash4$ </code><strong class="userinput"><code>echo $$</code></strong>
<code class="computeroutput">11015</code>


<code class="prompt">bash4$ </code><strong class="userinput"><code>echo $BASHPID</code></strong>
<code class="computeroutput">11015</code>


<code class="prompt">bash4$ </code><strong class="userinput"><code>ps ax | grep bash4</code></strong>
<code class="computeroutput">11015 pts/2    R      0:00 bash4</code>
        </pre><p>
      </p><p><a id="bashpidref2"/>But ...</p><pre class="programlisting">
#!/bin/bash4

echo "\$\$ за пределами подоболочки = $$"                              # 9602
echo "\$BASH_SUBSHELL  за пределами подоболочки = $BASH_SUBSHELL"      # 0
echo "\$BASHPID за пределами подоболочки = $BASHPID"                   # 9602

echo

( echo "\$\$ внутри подоболочки = $$"                             # 9602
  echo "\$BASH_SUBSHELL внутри подоболочки = $BASH_SUBSHELL"      # 1
  echo "\$BASHPID внутри подоболочки = $BASHPID" )                # 9603
  # $$ возвращает PID родительского процесса.
</pre></dd><dt><span class="term"><code class="varname">$BASH_VERSINFO[n]</code></span></dt><dd><p><a class="link" href="ch26.html#arrayref">Массив</a>, состоящий 
      из 6 элементов содержащий информацию о версии Bash. 
      $BASH_VERSINFO очень похожа на переменную 
      <code class="varname">$BASH_VERSION</code>, описываемую ниже.</p><p>
    </p><pre class="programlisting"># Информация о версии Bash:

for n in 0 1 2 3 4 5
do
  echo "BASH_VERSINFO[$n] = ${BASH_VERSINFO[$n]}"
done  

# BASH_VERSINFO[0] = 3                      # Мажорный номер версии.
# BASH_VERSINFO[1] = 00                     # Минорный номер версии.
# BASH_VERSINFO[2] = 14                     # Уровень патчей.
# BASH_VERSINFO[3] = 1                      # Версия сборки.
# BASH_VERSINFO[4] = release                # Статус релиза.
# BASH_VERSINFO[5] = i386-redhat-linux-gnu  # Архитектура
                                            # (то же, что и $MACHTYPE).</pre><p>
    </p></dd><dt><span class="term"><code class="varname">$BASH_VERSION</code></span></dt><dd><p>версия Bash, установленного в системе</p><p>
        </p><pre class="screen"><code class="prompt">bash$ </code><strong class="userinput"><code>echo $BASH_VERSION</code></strong>
<code class="computeroutput">3.2.25(1)-release</code>
        </pre><p>
      </p><p>
        </p><pre class="screen"><code class="prompt">tcsh% </code><strong class="userinput"><code>echo $BASH_VERSION</code></strong>
<code class="computeroutput">BASH_VERSION: Undefined variable.</code>
        </pre><p>
      </p><p>Проверка переменной $BASH_VERSION -- неплохой метод проверки типа
      командной оболочки, под которой исполняется скрипт. Переменная
      <a class="link" href="ch09.html#shellvarref">$SHELL</a> не всегда дает правильный ответ.</p></dd><dt><span class="term"><a id="cdpathref"/><code class="varname">$CDPATH</code></span></dt><dd><p>A colon-separated list of search paths
      available to the <a class="link" href="ch14.html#cdref">cd</a>
      command, similar in function to the <a class="link" href="ch09.html#pathref">$PATH</a> variable for binaries.
            The <code class="varname">$CDPATH</code> variable may be set in the
      local <a class="link" href="apl.html#bashrc" title="Пример L.1. Sample .bashrc file"><code class="filename">~/.bashrc</code></a>
      file.</p><p>
        </p><pre class="screen">
<code class="prompt">bash$ </code><strong class="userinput"><code>cd bash-doc</code></strong>
<code class="computeroutput">bash: cd: bash-doc: No such file or directory</code>


<code class="prompt">bash$ </code><strong class="userinput"><code>CDPATH=/usr/share/doc</code></strong>
<code class="prompt">bash$ </code><strong class="userinput"><code>cd bash-doc</code></strong>
<code class="computeroutput">/usr/share/doc/bash-doc</code>


<code class="prompt">bash$ </code><strong class="userinput"><code>echo $PWD</code></strong>
<code class="computeroutput">/usr/share/doc/bash-doc</code>
        </pre><p>
           </p></dd><dt><span class="term"><a id="dirstackref"/><code class="varname">$DIRSTACK</code></span></dt><dd><p>The top value in the directory stack

              <sup>[<a id="idp9019088" href="#ftn.idp9019088" class="footnote">35</a>]</sup>

      (affected by <a class="link" href="ch14.html#pushdref">pushd</a> and <a class="link" href="ch14.html#popdref">popd</a>)</p><p>This builtin
      variable corresponds to the <a class="link" href="ch14.html#dirsd">dirs</a>
      command, however <span class="command"><strong>dirs</strong></span> shows the entire
      contents of the directory stack.</p></dd><dt><span class="term"><code class="varname">$EDITOR</code></span></dt><dd><p>The default editor invoked by a script, usually
        <span class="command"><strong>vi</strong></span> or <span class="command"><strong>emacs</strong></span>.</p></dd><dt><span class="term"><a id="euidref"/><code class="varname">$EUID</code></span></dt><dd><p><span class="quote">«<span class="quote">effective</span>»</span> user ID number</p><p>Identification number of whatever identity the
        current user has assumed, perhaps by means of <a class="link" href="ch16.html#suref">su</a>.</p><div class="caution" title="Предостережение" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Предостережение</h3><p>The <code class="varname">$EUID</code> is not necessarily
        the same as the <a class="link" href="ch09.html#uidref">$UID</a>.</p></div></dd><dt><span class="term"><code class="varname">$FUNCNAME</code></span></dt><dd><p>Name of the current function</p><pre class="programlisting">xyz23 ()
{
  echo "$FUNCNAME now executing."  # xyz23 now executing.
}

xyz23

echo "FUNCNAME = $FUNCNAME"        # FUNCNAME =
                                   # Null value outside a function.</pre><p>
            </p><p>See also <a class="xref" href="apa.html#usegetopt" title="Пример A.50. An alternate version of the getopt-simple.sh script">Пример A.50, «An alternate version of the
      getopt-simple.sh script»</a>.</p></dd><dt><span class="term"><code class="varname">$GLOBIGNORE</code></span></dt><dd><p>A list of filename patterns to be excluded from
      matching in <a class="link" href="ch17s02.html" title="Глоббинг">globbing</a>.</p></dd><dt><span class="term"><a id="groupsref"/><code class="varname">$GROUPS</code></span></dt><dd><p>Groups current user belongs to</p><p>This is a listing (array) of the group id numbers for
        current user, as  recorded in
        <a class="link" href="apg.html#datafilesref1"><code class="filename">/etc/passwd</code></a>
        and <code class="filename">/etc/group</code>.
      </p><p>
        </p><pre class="screen">
<code class="prompt">root# </code><strong class="userinput"><code>echo $GROUPS</code></strong>
<code class="computeroutput">0</code>


<code class="prompt">root# </code><strong class="userinput"><code>echo ${GROUPS[1]}</code></strong>
<code class="computeroutput">1</code>


<code class="prompt">root# </code><strong class="userinput"><code>echo ${GROUPS[5]}</code></strong>
<code class="computeroutput">6</code>
        </pre><p>
        </p></dd><dt><span class="term"><a id="homedirref"/><code class="varname">$HOME</code></span></dt><dd><p>Home directory of the user, usually <code class="filename">/home/username</code> (see <a class="xref" href="ch09s03.html#ex6" title="Пример 9.16. Using parameter substitution and error messages">Пример 9.16, «Using parameter substitution and error messages»</a>)</p></dd><dt><span class="term"><a id="hostnameref"/><code class="varname">$HOSTNAME</code></span></dt><dd><p>The <a class="link" href="ch16.html#hnameref">hostname</a> command
      assigns the system host name at bootup in an init script.
      However, the <code class="function">gethostname()</code> function
      sets the Bash internal variable <code class="varname">$HOSTNAME</code>.
      See also <a class="xref" href="ch09s03.html#ex6" title="Пример 9.16. Using parameter substitution and error messages">Пример 9.16, «Using parameter substitution and error messages»</a>.</p></dd><dt><span class="term"><code class="varname">$HOSTTYPE</code></span></dt><dd><p>host type</p><p>Like <a class="link" href="ch09.html#machtyperef">$MACHTYPE</a>,
        identifies the system hardware.</p><pre class="screen"><code class="prompt">bash$ </code><strong class="userinput"><code>echo $HOSTTYPE</code></strong>
<code class="computeroutput">i686</code></pre></dd><dt><span class="term"><a id="ifsref"/><code class="varname">$IFS</code></span></dt><dd><p>internal field separator</p><p>This variable determines how Bash recognizes <a class="link" href="ch03.html#fieldref">fields</a>, or word boundaries,
        when it interprets character strings.</p><p><a id="ifsws"/></p><p>$IFS defaults to <a class="link" href="ch03.html#whitespaceref">whitespace</a> (space,
        tab, and newline), but may be changed, for example,
        to parse a comma-separated data file.  Note that
        <a class="link" href="ch09.html#appref">$*</a> uses the first
        character held in <code class="varname">$IFS</code>.  See <a class="xref" href="ch05.html#weirdvars" title="Пример 5.1. Вывод &quot;своеобразных&quot; переменных">Пример 5.1, «Вывод "своеобразных" переменных»</a>.</p><p>
        </p><pre class="screen">
<code class="prompt">bash$ </code><strong class="userinput"><code>echo "$IFS"</code></strong>
<code class="computeroutput">

</code>
<code class="computeroutput">(With $IFS set to default, a blank line displays.)</code>
        


<code class="prompt">bash$ </code><strong class="userinput"><code>echo "$IFS" | cat -vte</code></strong>
<code class="computeroutput"> ^I$
 $</code>
<code class="computeroutput">(Show whitespace: here a single space, ^I [horizontal tab],
  and newline, and display "$" at end-of-line.)</code>



<code class="prompt">bash$ </code><strong class="userinput"><code>bash -c 'set w x y z; IFS=":-;"; echo "$*"'</code></strong>
<code class="computeroutput">w:x:y:z</code>
<code class="computeroutput">(Read commands from string and assign any arguments to pos params.)</code>
        </pre><p>
    </p><div class="caution" title="Предостережение" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Предостережение</h3><p><code class="varname">$IFS</code> does not handle whitespace
      the same as it does other characters.

    </p><div class="example"><a id="ifsh"/><p class="title"><b>Пример 9.1. $IFS and whitespace</b></p><div class="example-contents"><pre class="programlisting">&amp;ifsh;</pre></div></div><p><br class="example-break"/>

    </p></div><p>(Many thanks, Stéphane Chazelas, for clarification
    and above examples.)</p><p>See also <a class="xref" href="ch15s06.html#isspammer" title="Пример 15.41. Analyzing a spam domain">Пример 15.41, «Analyzing a spam domain»</a>, <a class="xref" href="ch10.html#bingrep" title="Пример 10.7. grep для бинарных файлов">Пример 10.7, «<em class="firstterm">grep</em> для бинарных файлов»</a>, and <a class="xref" href="ch18.html#mailboxgrep" title="Пример 18.14. Разбор файла почтового ящика">Пример 18.14, «Разбор файла почтового ящика»</a>
             for instructive examples of using
             <code class="varname">$IFS</code>.</p></dd><dt><span class="term"><code class="varname">$IGNOREEOF</code></span></dt><dd><p>Ignore EOF: how many end-of-files (control-D)
      the shell will ignore before logging out.</p></dd><dt><span class="term"><code class="varname">$LC_COLLATE</code></span></dt><dd><p>Often set in the <a class="link" href="apl.html" title="Приложение L. A Sample .bashrc File"><code class="filename">.bashrc</code></a>
      or <code class="filename">/etc/profile</code> files, this
      variable controls collation order in filename
      expansion and pattern matching. If mishandled,
      <code class="varname">LC_COLLATE</code> can cause unexpected results in
      <a class="link" href="ch17s02.html" title="Глоббинг">filename globbing</a>.</p><div class="note" title="Замечание" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Замечание</h3><p>As of version 2.05 of Bash,
      filename globbing no longer distinguishes between lowercase
      and uppercase letters in a character range between
      brackets. For example, <span class="command"><strong>ls [A-M]*</strong></span>
      would match both <code class="filename">File1.txt</code>
      and <code class="filename">file1.txt</code>. To revert to
      the customary behavior of bracket matching, set
      <code class="varname">LC_COLLATE</code> to <code class="option">C</code>
      by an <strong class="userinput"><code>export LC_COLLATE=C</code></strong>
      in <code class="filename">/etc/profile</code> and/or
      <code class="filename">~/.bashrc</code>.</p></div></dd><dt><span class="term"><code class="varname">$LC_CTYPE</code></span></dt><dd><p>This internal variable controls character interpretation
      in <a class="link" href="ch17s02.html" title="Глоббинг">globbing</a> and pattern
      matching.</p></dd><dt><span class="term"><a id="linenoref"/><code class="varname">$LINENO</code></span></dt><dd><p>This variable is the line number of the shell
      script in which this variable appears. It has significance only
      within the script in which it appears, and is chiefly useful for
      debugging purposes.</p><pre class="programlisting"># *** BEGIN DEBUG BLOCK ***
last_cmd_arg=$_  # Save it.

echo "At line number $LINENO, variable \"v1\" = $v1"
echo "Last command argument processed = $last_cmd_arg"
# *** END DEBUG BLOCK ***</pre></dd><dt><span class="term"><a id="machtyperef"/><code class="varname">$MACHTYPE</code></span></dt><dd><p>machine type</p><p>Identifies the system hardware.</p><pre class="screen"><code class="prompt">bash$ </code><strong class="userinput"><code>echo $MACHTYPE</code></strong>
<code class="computeroutput">i686</code></pre></dd><dt><span class="term"><a id="oldpwd"/><code class="varname">$OLDPWD</code></span></dt><dd><p>Old working directory
    (<span class="quote">«<span class="quote">OLD-Print-Working-Directory</span>»</span>,
      previous directory you were in).</p></dd><dt><span class="term"><code class="varname">$OSTYPE</code></span></dt><dd><p>operating system type</p><pre class="screen"><code class="prompt">bash$ </code><strong class="userinput"><code>echo $OSTYPE</code></strong>
<code class="computeroutput">linux</code></pre></dd><dt><span class="term"><a id="pathref"/><code class="varname">$PATH</code></span></dt><dd><p>Path to binaries, usually 
        <code class="filename">/usr/bin/</code>, 
        <code class="filename">/usr/X11R6/bin/</code>, 
        <code class="filename">/usr/local/bin</code>, etc.</p><p>When given a command, the shell automatically does
        a hash table search on the directories listed in the
        <em class="firstterm">path</em> for the executable. The path
        is stored in the <a class="link" href="ch04s04.html#envref">environmental
        variable</a>, <code class="varname">$PATH</code>, a list
        of directories, separated by colons. Normally,
        the system stores the <code class="varname">$PATH</code>
        definition in <code class="filename">/etc/profile</code>
        and/or <a class="link" href="apl.html" title="Приложение L. A Sample .bashrc File"><code class="filename">~/.bashrc</code></a>
        (see <a class="xref" href="apg.html" title="Приложение G. Important Files">Приложение G, <i> Important Files</i></a>).</p><pre class="screen"><code class="prompt">bash$ </code><span class="command"><strong>echo $PATH</strong></span>
<code class="computeroutput">/bin:/usr/bin:/usr/local/bin:/usr/X11R6/bin:/sbin:/usr/sbin</code></pre><p>
              </p><p><strong class="userinput"><code>PATH=${PATH}:/opt/bin</code></strong> appends
        the <code class="filename">/opt/bin</code>
        directory to the current path. In a script, it may be
        expedient to temporarily add a directory to the path
        in this way. When the script exits, this restores the
        original <code class="varname">$PATH</code> (a child process, such
        as a script, may not change the environment of the parent
        process, the shell).</p><p><a id="currentwdref"/></p><div class="note" title="Замечание" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Замечание</h3><p>The current <span class="quote">«<span class="quote">working directory</span>»</span>, 
        <code class="filename">./</code>, is usually
        omitted from the <code class="varname">$PATH</code> as a security
        measure.</p></div></dd><dt><span class="term"><a id="pipestatusref"/><code class="varname">$PIPESTATUS</code></span></dt><dd><p><a class="link" href="ch26.html#arrayref">Array</a> variable holding
            <a class="link" href="ch06.html#exitstatusref">exit status</a>(es) of
      last executed <em class="firstterm">foreground</em> <a class="link" href="ch03.html#piperef">pipe</a>.</p><p>
        </p><pre class="screen">
<code class="prompt">bash$ </code><strong class="userinput"><code>echo $PIPESTATUS</code></strong>
<code class="computeroutput">0</code>

<code class="prompt">bash$ </code><strong class="userinput"><code>ls -al | bogus_command</code></strong>
<code class="computeroutput">bash: bogus_command: command not found</code>
<code class="prompt">bash$ </code><strong class="userinput"><code>echo ${PIPESTATUS[1]}</code></strong>
<code class="computeroutput">127</code>

<code class="prompt">bash$ </code><strong class="userinput"><code>ls -al | bogus_command</code></strong>
<code class="computeroutput">bash: bogus_command: command not found</code>
<code class="prompt">bash$ </code><strong class="userinput"><code>echo $?</code></strong>
<code class="computeroutput">127</code>
        </pre><p>
        </p><p>The members of the <code class="varname">$PIPESTATUS</code>
    array hold the exit status of each respective command
    executed in a pipe. <code class="varname">$PIPESTATUS[0]</code>
    holds the exit status of the first command in the pipe,
    <code class="varname">$PIPESTATUS[1]</code> the exit status of
    the second command, and so on.</p><div class="caution" title="Предостережение" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Предостережение</h3><p>
        The <code class="varname">$PIPESTATUS</code> variable
              may contain an erroneous <span class="errorcode">0</span> value
              in a login shell (in releases prior to 3.0 of Bash).
              </p><p>
        </p><pre class="screen">
<code class="prompt">tcsh% </code><strong class="userinput"><code>bash</code></strong>

<code class="prompt">bash$ </code><strong class="userinput"><code>who | grep nobody | sort</code></strong>
<code class="prompt">bash$ </code><strong class="userinput"><code>echo ${PIPESTATUS[*]}</code></strong>
<code class="computeroutput">0</code>
        </pre><p>
        </p><p>
        The above lines contained in a script would produce the expected
        <code class="computeroutput">0 1 0</code> output.
              </p><p>
        Thank you, Wayne Pollock for pointing this out and supplying the
        above example.
        </p></div><div class="note" title="Замечание" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Замечание</h3><p>The <code class="varname">$PIPESTATUS</code> variable gives
          unexpected results in some contexts.</p><p>
        </p><pre class="screen">
<code class="prompt">bash$ </code><strong class="userinput"><code>echo $BASH_VERSION</code></strong>
<code class="computeroutput">3.00.14(1)-release</code>

<code class="prompt">bash$ </code><strong class="userinput"><code>$ ls | bogus_command | wc</code></strong>
<code class="computeroutput">bash: bogus_command: command not found
 0       0       0</code>

<code class="prompt">bash$ </code><strong class="userinput"><code>echo ${PIPESTATUS[@]}</code></strong>
<code class="computeroutput">141 127 0</code>
        </pre><p>
        </p><p>Chet Ramey attributes the above output to the behavior of
    <a class="link" href="ch15.html#lsref">ls</a>. If <em class="firstterm">ls</em>
    writes to a <em class="firstterm">pipe</em> whose output is not
    read, then <em class="replaceable"><code>SIGPIPE</code></em> kills it,
    and its <a class="link" href="ch06.html#exitstatusref">exit status</a>
    is <span class="returnvalue">141</span>. Otherwise
    its exit status is <span class="returnvalue">0</span>,
    as expected. This likewise is the case for <a class="link" href="ch15s04.html#trref">tr</a>.</p></div><div class="note" title="Замечание" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Замечание</h3><p><code class="varname">$PIPESTATUS</code> is a
        <span class="quote">«<span class="quote">volatile</span>»</span> variable. It needs to be
        captured immediately after the pipe in question, before
        any other command intervenes.</p><p>
        </p><pre class="screen">
<code class="prompt">bash$ </code><strong class="userinput"><code>$ ls | bogus_command | wc</code></strong>
<code class="computeroutput">bash: bogus_command: command not found
 0       0       0</code>

<code class="prompt">bash$ </code><strong class="userinput"><code>echo ${PIPESTATUS[@]}</code></strong>
<code class="computeroutput">0 127 0</code>

<code class="prompt">bash$ </code><strong class="userinput"><code>echo ${PIPESTATUS[@]}</code></strong>
<code class="computeroutput">0</code>
        </pre><p>
        </p></div><div class="note" title="Замечание" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Замечание</h3><p>The <a class="link" href="ch34s02.html#pipefailref">pipefail option</a>
        may be useful in cases where
        <code class="varname">$PIPESTATUS</code> does not give the desired
        information.</p></div></dd><dt><span class="term"><a id="ppidref"/><code class="varname">$PPID</code></span></dt><dd><p/><p>The <code class="varname">$PPID</code> of a process is
      the process ID (<code class="varname">pid</code>) of its parent process.

        <sup>[<a id="idp9268912" href="#ftn.idp9268912" class="footnote">36</a>]</sup>
        </p><p>Compare this with the <a class="link" href="ch16.html#pidofref">pidof</a> command.</p></dd><dt><span class="term"><code class="varname">$PROMPT_COMMAND</code></span></dt><dd><p>A variable holding a command to be executed
        just before the primary prompt, <code class="varname">$PS1</code>
        is to be displayed.</p></dd><dt><span class="term"><a id="ps1ref"/><code class="varname">$PS1</code></span></dt><dd><p>This is the main prompt, seen at the command-line.</p></dd><dt><span class="term"><a id="secpromptref"/><code class="varname">$PS2</code></span></dt><dd><p>The secondary prompt, seen when additional input is
        expected. It displays as <span class="quote">«<span class="quote">&amp;gt;</span>»</span>.</p></dd><dt><span class="term"><code class="varname">$PS3</code></span></dt><dd><p>The tertiary prompt, displayed in a
      <a class="link" href="ch10s04.html#selectref">select</a> loop (see <a class="xref" href="ch10s04.html#ex31" title="Пример 10.29. Создание меню, используя select">Пример 10.29, «Создание меню, используя <em class="firstterm">select</em>»</a>).</p></dd><dt><span class="term"><code class="varname">$PS4</code></span></dt><dd><p>The quartenary prompt, shown at the beginning of
      each line of output when invoking a script with the
      <span class="token">-x</span> <a class="link" href="ch30.html#optionsref">option</a>.
      It displays as <span class="quote">«<span class="quote">+</span>»</span>.</p></dd><dt><span class="term"><a id="pwdref"/><code class="varname">$PWD</code></span></dt><dd><p>Working directory (directory you are in at the time)</p><p>This is the analog to the <a class="link" href="ch14.html#pwd2ref">pwd</a>
      builtin command.</p><pre class="programlisting">&amp;wipedir;</pre></dd><dt><span class="term"><a id="replyref"/><code class="varname">$REPLY</code></span></dt><dd><p>The default value when a variable is not
      supplied to <a class="link" href="ch14.html#readref">read</a>. Also
      applicable to <a class="link" href="ch10s04.html#selectref">select</a> menus,
      but only supplies the item number of the variable chosen,
      not the value of the variable itself.</p><pre class="programlisting">&amp;reply;</pre></dd><dt><span class="term"><code class="varname">$SECONDS</code></span></dt><dd><p>The number of seconds the script has been running.</p><pre class="programlisting">&amp;seconds;</pre></dd><dt><span class="term"><code class="varname">$SHELLOPTS</code></span></dt><dd><p>The list of enabled shell <a class="link" href="ch30.html#optionsref">options</a>, a readonly variable.
        </p><pre class="screen"><code class="prompt">bash$ </code><strong class="userinput"><code>echo $SHELLOPTS</code></strong>
<code class="computeroutput">braceexpand:hashall:histexpand:monitor:history:interactive-comments:emacs</code>
        </pre><p>
      </p></dd><dt><span class="term"><a id="shlvlref"/><code class="varname">$SHLVL</code></span></dt><dd><p>Shell level, how deeply Bash is nested.
        <sup>[<a id="idp9345888" href="#ftn.idp9345888" class="footnote">37</a>]</sup>
      If, at the command-line, $SHLVL is 1, then in a script it
      will increment to 2.</p><div class="note" title="Замечание" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Замечание</h3><p>This variable is <a class="link" href="ch20.html#subshnlevref">
        <span class="emphasis"><em>not</em></span> affected by
        subshells</a>. Use <a class="link" href="ch09.html#bashsubshellref">$BASH_SUBSHELL</a> when you
        need an indication of subshell nesting.</p></div></dd><dt><span class="term"><a id="tmoutref"/><code class="varname">$TMOUT</code></span></dt><dd><p>If the <em class="replaceable"><code>$TMOUT</code></em>
    environmental variable is set to a non-zero value
    <code class="varname">time</code>, then the shell prompt will time out
    after <code class="varname">$time</code> seconds. This will cause a
    logout.</p><p>As of version 2.05b of Bash, it is now possible to use
      <em class="replaceable"><code>$TMOUT</code></em> in a script in combination
      with <a class="link" href="ch14.html#readref">read</a>.</p><p>
    </p><pre class="programlisting"># Works in scripts for Bash, versions 2.05b and later.

TMOUT=3    # Prompt times out at three seconds.

echo "What is your favorite song?"
echo "Quickly now, you only have $TMOUT seconds to answer!"
read song

if [ -z "$song" ]
then
  song="(no answer)"
  # Default response.
fi

echo "Your favorite song is $song."</pre><p>
    </p><p><a id="timingloop"/></p><p>There are other, more complex, ways of implementing
      timed input in a script. One alternative is to set up
      a timing loop to signal the script when it times out.
      This also requires a signal handling routine to <a class="link" href="ch29.html#trapref1">trap</a> (see <a class="xref" href="ch29.html#ex76" title="Пример 29.5. Trapping at exit">Пример 29.5, «Trapping at exit»</a>)
      the interrupt generated by the timing loop (whew!).</p><div class="example"><a id="tmdin"/><p class="title"><b>Пример 9.2. Timed Input</b></p><div class="example-contents"><pre class="programlisting">&amp;tmdin;</pre></div></div><br class="example-break"/><p><a id="sttyto"/></p><p>An alternative is using <a class="link" href="ch16.html#sttyref">stty</a>.</p><div class="example"><a id="timeout"/><p class="title"><b>Пример 9.3. Once more, timed input</b></p><div class="example-contents"><pre class="programlisting">&amp;timeout;</pre></div></div><br class="example-break"/><p>Perhaps the simplest method is using the
      <code class="option">-t</code> option to <a class="link" href="ch14.html#readref">read</a>.</p><div class="example"><a id="tout"/><p class="title"><b>Пример 9.4. Timed <em class="firstterm">read</em></b></p><div class="example-contents"><pre class="programlisting">&amp;tout;</pre></div></div><br class="example-break"/></dd><dt><span class="term"><a id="uidref"/><code class="varname">$UID</code></span></dt><dd><p>User ID number</p><p>Current user's user identification number, as
        recorded in <a class="link" href="apg.html#datafilesref1"><code class="filename">/etc/passwd</code></a></p><p>This is the current user's real id, even if she has
        temporarily assumed another identity through <a class="link" href="ch16.html#suref">su</a>. <code class="varname">$UID</code> is a
        readonly variable, not subject to change from the command
        line or within a script, and is the counterpart to the
        <a class="link" href="ch16.html#idref">id</a> builtin.</p><div class="example"><a id="amiroot"/><p class="title"><b>Пример 9.5. Am I root?</b></p><div class="example-contents"><pre class="programlisting">&amp;amiroot;</pre></div></div><br class="example-break"/><p>See also <a class="xref" href="ch02.html#ex2" title="Пример 2.3. Очистка: Расширенная, и более универсальная версия скрипта.">Пример 2.3, «<em class="firstterm">Очистка</em>: Расширенная, и более
      универсальная версия скрипта.»</a>.</p><div class="note" title="Замечание" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Замечание</h3><p>The variables <code class="varname">$ENV</code>,
    <code class="varname">$LOGNAME</code>, <code class="varname">$MAIL</code>,
    <code class="varname">$TERM</code>, <code class="varname">$USER</code>, and
    <code class="varname">$USERNAME</code> are <span class="emphasis"><em>not</em></span>
    Bash <a class="link" href="ch14.html#builtinref">builtins</a>. These are,
    however, often set as <a class="link" href="ch04s04.html#envref">environmental
    variables</a> in one of the Bash <a class="link" href="apg.html#filesref1">startup files</a>.  <a id="shellvarref"/><code class="varname">$SHELL</code>,
    the name of the user's login shell, may be set from
    <code class="filename">/etc/passwd</code> or in an <span class="quote">«<span class="quote">init</span>»</span>
    script, and it is likewise not a Bash builtin.</p><p>
        </p><pre class="screen">
<code class="prompt">tcsh% </code><strong class="userinput"><code>echo $LOGNAME</code></strong>
<code class="computeroutput">bozo</code>
<code class="prompt">tcsh% </code><strong class="userinput"><code>echo $SHELL</code></strong>
<code class="computeroutput">/bin/tcsh</code>
<code class="prompt">tcsh% </code><strong class="userinput"><code>echo $TERM</code></strong>
<code class="computeroutput">rxvt</code>

<code class="prompt">bash$ </code><strong class="userinput"><code>echo $LOGNAME</code></strong>
<code class="computeroutput">bozo</code>
<code class="prompt">bash$ </code><strong class="userinput"><code>echo $SHELL</code></strong>
<code class="computeroutput">/bin/tcsh</code>
<code class="prompt">bash$ </code><strong class="userinput"><code>echo $TERM</code></strong>
<code class="computeroutput">rxvt</code>
        </pre><p>
        </p></div></dd></dl></div><div class="variablelist" title="Positional Parameters"><a id="posparmslist"/><p class="title"><b>Positional Parameters</b></p><dl><dt><span class="term"><a id="posparamref"/><code class="varname">$0</code>, <code class="varname">$1</code>,
    <code class="varname">$2</code>, etc.</span></dt><dd><p>Positional parameters, passed from command
        line to script, passed to a function, or <a class="link" href="ch14.html#setref">set</a> to a variable (see <a class="xref" href="ch04s04.html#ex17" title="Пример 4.5. Позиционные параметры">Пример 4.5, «Позиционные параметры»</a> and <a class="xref" href="ch14.html#ex34" title="Пример 14.16. Using set with positional parameters">Пример 14.16, «Using <em class="firstterm">set</em> with positional
          parameters»</a>)</p></dd><dt><span class="term"><a id="clacountref"/><code class="varname">$#</code></span></dt><dd><p>Number of command-line arguments
    <sup>[<a id="idp9431344" href="#ftn.idp9431344" class="footnote">38</a>]</sup>
      or positional parameters (see <a class="xref" href="ch33s03.html#ex4" title="Пример 33.2. A slightly more complex shell wrapper">Пример 33.2, « A slightly more complex <em class="firstterm">shell
  wrapper</em>»</a>)</p></dd><dt><span class="term"><a id="appref"/><code class="varname">$*</code></span></dt><dd><p>All of the positional parameters, seen as a single word</p><div class="note" title="Замечание" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Замечание</h3><p><span class="quote">«<span class="quote"><code class="varname">$*</code></span>»</span> must be
      quoted.</p></div></dd><dt><span class="term"><a id="appref2"/><code class="varname">$@</code></span></dt><dd><p>Same as <span class="token">$*</span>, but each parameter is a
        quoted string, that is, the parameters are passed on
        intact, without interpretation or expansion. This means,
        among other things, that each parameter in the argument
        list is seen as a separate word.</p><div class="note" title="Замечание" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Замечание</h3><p>Of course, <span class="quote">«<span class="quote"><code class="varname">$@</code></span>»</span>
      should be quoted.</p></div><div class="example"><a id="arglist"/><p class="title"><b>Пример 9.6. <em class="firstterm">arglist</em>: Listing arguments
        with $* and $@</b></p><div class="example-contents"><pre class="programlisting">&amp;arglist;</pre></div></div><br class="example-break"/><p>Following a <span class="command"><strong>shift</strong></span>, the
        <code class="varname">$@</code> holds the remaining command-line
        parameters, lacking the previous <code class="varname">$1</code>,
        which was lost.
          </p><pre class="programlisting">#!/bin/bash
# Invoke with ./scriptname 1 2 3 4 5

echo "$@"    # 1 2 3 4 5
shift
echo "$@"    # 2 3 4 5
shift
echo "$@"    # 3 4 5

# Each "shift" loses parameter $1.
# "$@" then contains the remaining parameters.</pre><p>
            </p><p>The <code class="varname">$@</code> special parameter finds
        use as a tool for filtering input into shell scripts. The
        <span class="command"><strong>cat "$@"</strong></span> construction accepts input
        to a script either from <code class="filename">stdin</code> or
        from files given as parameters to the script. See <a class="xref" href="ch15s04.html#rot13" title="Пример 15.24. rot13: ultra-weak encryption.">Пример 15.24, «<em class="firstterm">rot13</em>: ultra-weak encryption.»</a> and <a class="xref" href="ch15s04.html#cryptoquote" title="Пример 15.25. Generating «Crypto-Quote» Puzzles">Пример 15.25, «Generating <span class="quote">«<span class="quote">Crypto-Quote</span>»</span> Puzzles»</a>.</p><div class="caution" title="Предостережение" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Предостережение</h3><p>The <code class="varname">$*</code> and <code class="varname">$@</code>
        parameters sometimes display inconsistent and
        puzzling behavior, depending on the setting of <a class="link" href="ch09.html#ifsref">$IFS</a>.</p></div><div class="example"><a id="incompat"/><p class="title"><b>Пример 9.7. Inconsistent <code class="varname">$*</code> and <code class="varname">$@</code> behavior</b></p><div class="example-contents"><pre class="programlisting">&amp;incompat;</pre></div></div><br class="example-break"/><div class="note" title="Замечание" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Замечание</h3><p>The <span class="command"><strong>$@</strong></span> and <span class="command"><strong>$*</strong></span>
        parameters differ only when between double quotes.</p></div><div class="example"><a id="ifsempty"/><p class="title"><b>Пример 9.8. <code class="varname">$*</code> and <code class="varname">$@</code> when
          <code class="varname">$IFS</code> is empty</b></p><div class="example-contents"><pre class="programlisting">&amp;ifsempty;</pre></div></div><br class="example-break"/></dd></dl></div><div class="variablelist" title="Other Special Parameters"><a id="otherspecparams"/><p class="title"><b>Other Special Parameters</b></p><dl><dt><span class="term"><a id="flpref"/><code class="varname">$-</code></span></dt><dd><p>Flags passed to script (using <a class="link" href="ch14.html#setref">set</a>). See <a class="xref" href="ch14.html#ex34" title="Пример 14.16. Using set with positional parameters">Пример 14.16, «Using <em class="firstterm">set</em> with positional
          parameters»</a>.</p><div class="caution" title="Предостережение" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Предостережение</h3><p>This was originally a <em class="firstterm">ksh</em>
        construct adopted into Bash, and unfortunately it does not
        seem to work reliably in Bash scripts. One possible use
        for it is to have a script <a class="link" href="ch33.html#iitest">self-test
        whether it is interactive</a>.</p></div></dd><dt><span class="term"><a id="pidvarref"/><code class="varname">$!</code></span></dt><dd><p><a class="link" href="ch03.html#processiddef">PID</a> (process ID) of last
        job run in background</p><p>
        </p><pre class="programlisting">LOG=$0.log

COMMAND1="sleep 100"

echo "Logging PIDs background commands for script: $0" &gt;&gt; "$LOG"
# So they can be monitored, and killed as necessary.
echo &gt;&gt; "$LOG"

# Logging commands.

echo -n "PID of \"$COMMAND1\":  " &gt;&gt; "$LOG"
${COMMAND1} &amp;
echo $! &gt;&gt; "$LOG"
# PID of "sleep 100":  1506

# Thank you, Jacques Lederer, for suggesting this.</pre><p>
            </p><p>Using <code class="varname">$!</code> for job control:</p><p>
        </p><pre class="programlisting">possibly_hanging_job &amp; { sleep ${TIMEOUT}; eval 'kill -9 $!' &amp;&gt; /dev/null; }
# Forces completion of an ill-behaved program.
# Useful, for example, in init scripts.

# Thank you, Sylvain Fourmanoit, for this creative use of the "!" variable.</pre><p>

            </p><p>Or, alternately:</p><p>
              </p><pre class="programlisting"># This example by Matthew Sage.
# Used with permission.

TIMEOUT=30   # Timeout value in seconds
count=0

possibly_hanging_job &amp; {
        while ((count &lt; TIMEOUT )); do
                eval '[ ! -d "/proc/$!" ] &amp;&amp; ((count = TIMEOUT))'
                # /proc is where information about running processes is found.
                # "-d" tests whether it exists (whether directory exists).
                # So, we're waiting for the job in question to show up.
                ((count++))
                sleep 1
        done
        eval '[ -d "/proc/$!" ] &amp; kill -15 $!'
        # If the hanging job is running, kill it.
}</pre><p>
            </p></dd><dt><span class="term"><a id="underscoreref"/><code class="varname">$_</code></span></dt><dd><p>Special variable set to final argument of previous command
          executed.</p><div class="example"><a id="uscref"/><p class="title"><b>Пример 9.9. Underscore variable</b></p><div class="example-contents"><pre class="programlisting">#!/bin/bash

echo $_              #  /bin/bash
                     #  Just called /bin/bash to run the script.
                     #  Note that this will vary according to
                     #+ how the script is invoked.

du &gt;/dev/null        #  So no output from command.
echo $_              #  du

ls -al &gt;/dev/null    #  So no output from command.
echo $_              #  -al  (last argument)

:
echo $_              #  :</pre></div></div><br class="example-break"/></dd><dt><span class="term"><a id="xstatvarref"/><code class="varname">$?</code></span></dt><dd><p><a class="link" href="ch06.html#exitstatusref">Exit status</a>
      of a command, <a class="link" href="ch23.html#functionref">function</a>,
      or the script itself (see <a class="xref" href="ch23.html#max" title="Пример 23.7. Максимум из двух чисел">Пример 23.7, «Максимум из двух чисел»</a>)</p></dd><dt><span class="term"><a id="proccid"/><code class="varname">$$</code></span></dt><dd><p>Process ID (<em class="firstterm">PID</em>) of
            the script itself.

        <sup>[<a id="idp9517632" href="#ftn.idp9517632" class="footnote">39</a>]</sup>

            The <code class="varname">$$</code> variable often
      finds use in scripts to construct <span class="quote">«<span class="quote">unique</span>»</span>
      temp file names (see <a class="xref" href="ch29.html#online" title="Пример 29.6. Cleaning up after Control-C">Пример 29.6, «Cleaning up after <span class="keycap">Control-C</span>»</a>, <a class="xref" href="ch15s05.html#derpm" title="Пример 15.31. Unpacking an rpm archive">Пример 15.31, «Unpacking an <em class="firstterm">rpm</em> archive»</a>, and <a class="xref" href="ch14.html#selfdestruct" title="Пример 14.27. A script that kills itself">Пример 14.27, «A script that kills itself»</a>).
      This is usually simpler than invoking <a class="link" href="ch15s05.html#mktempref">mktemp</a>.</p></dd></dl></div></div><div class="footnotes"><br/><hr/><div class="footnote"><p><sup>[<a id="ftn.idp9019088" href="#idp9019088" class="para">35</a>] </sup><a id="stackdefref"/>
              A <em class="firstterm">stack register</em>
              is a set of consecutive memory locations, such that
        the values stored (<em class="firstterm">pushed</em>)
        are retrieved (<em class="firstterm">popped</em>)
        in <span class="emphasis"><em>reverse</em></span> order. The last
        value stored is the first retrieved. This is
        sometimes called a <em class="replaceable"><code>LIFO</code></em>
        (<em class="firstterm">last-in-first-out</em>) or
        <em class="firstterm">pushdown</em> stack.</p></div><div class="footnote"><p><sup>[<a id="ftn.idp9268912" href="#idp9268912" class="para">36</a>] </sup>The PID of the currently running script is
      <code class="varname">$$</code>, of course.</p></div><div class="footnote"><p><sup>[<a id="ftn.idp9345888" href="#idp9345888" class="para">37</a>] </sup>
    Somewhat analogous to <a class="link" href="ch23s02.html#recursionref">recursion</a>, in this context
    <em class="firstterm">nesting</em> refers to a pattern
    embedded within a larger pattern. One of the definitions
    of <em class="firstterm">nest</em>, according to the 1913
    edition of <span class="emphasis"><em>Webster's Dictionary</em></span>,
    illustrates this beautifully: <span class="quote">«<span class="quote"><span class="emphasis"><em>A collection of
    boxes, cases, or the like, of graduated size, each put
    within the one next larger.</em></span></span>»</span>
        </p></div><div class="footnote"><p><sup>[<a id="ftn.idp9431344" href="#idp9431344" class="para">38</a>] </sup>The words <span class="quote">«<span class="quote">argument</span>»</span>
    and <span class="quote">«<span class="quote">parameter</span>»</span> are often used
    interchangeably. In the context of this document, they
    have the same precise meaning: <span class="emphasis"><em>a variable passed
    to a script or function.</em></span></p></div><div class="footnote"><p><sup>[<a id="ftn.idp9517632" href="#idp9517632" class="para">39</a>] </sup>Within a script, inside a subshell,
              <code class="varname">$$</code> <a class="link" href="ch09.html#bashpidref">returns
              the PID of the script</a>, not the
              subshell.</p></div></div></div><div class="navfooter"><hr/><table width="100%" summary="Navigation footer"><tr><td align="left"><a accesskey="p" href="pt03.html">Пред.</a> </td><td align="center"><a accesskey="u" href="pt03.html">Уровень выше</a></td><td align="right"> <a accesskey="n" href="ch09s02.html">След.</a></td></tr><tr><td align="left" valign="top">Часть Part 3. Углубленный материал </td><td align="center"><a accesskey="h" href="index.html">Начало</a></td><td align="right" valign="top"> Manipulating Strings</td></tr></table></div></body></html>
