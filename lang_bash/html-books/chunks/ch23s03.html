<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Рекурсия без локальных переменных</title><meta name="generator" content="DocBook XSL Stylesheets V1.75.2"/><link rel="home" href="index.html" title="Advanced Bash Scripting по-русски"/><link rel="up" href="ch23.html" title="Глава 23. Функции"/><link rel="prev" href="ch23s02.html" title="Локальные переменные"/><link rel="next" href="ch24.html" title="Глава 24. Псевдонимы"/></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Рекурсия без локальных переменных</th></tr><tr><td align="left"><a accesskey="p" href="ch23s02.html">Пред.</a> </td><th width="60%" align="center">Глава 23. Функции</th><td align="right"> <a accesskey="n" href="ch24.html">След.</a></td></tr></table><hr/></div><div class="sect1" title="Рекурсия без локальных переменных"><div class="titlepage"><div><div><h2 class="title"><a id="recurnolocvar"/>Рекурсия без локальных переменных</h2></div></div></div><p>Функция может рекурсивно вызывать себя и без использования
        локальных переменных.</p><p><a id="fiboref"/></p><div class="example"><a id="fibo"/><p class="title"><b>Пример 23.16. <em class="firstterm">Последовательность чисел Фибоначчи</em></b></p><div class="example-contents"><pre class="programlisting">
#!/bin/bash
# fibo.sh : Последовательность чисел Фибоначчи (рекурсия)
# Автор: M. Cooper
# Лицензия: GPL3

# ---------------------------------
# Fibo(0) = 0
# Fibo(1) = 1
# else
#   Fibo(j) = Fibo(j-1) + Fibo(j-2)
# ---------------------------------

MAXTERM=15       # Количество членов последовательности (+1), которое требуется сгенерировать.
MINIDX=2         # Если индекс меньше двух, то Fibo(индекс) = индекс.

Fibonacci ()
{
  idx=$1   # Не требуется делать переменную локальной. Почему?
  if [ "$idx" -lt "$MINIDX" ]
  then
    echo "$idx"  # Перыве два члена последовательности 0 1 ... см. выше.
  else
    (( --idx ))  # j-1
    term1=$( Fibonacci $idx )   #  Fibo(j-1)

    (( --idx ))  # j-2
    term2=$( Fibonacci $idx )   #  Fibo(j-2)

    echo $(( term1 + term2 ))
  fi
  #  Очень безобразный вариант.
  #  Более элегантная реализация на языке C
  #+ может быть произведена непосредственным переводом строк  7 - 10 данного алгоритма на C.
}

for i in $(seq 0 $MAXTERM)
do  # Считаем $MAXTERM+1 членов.
  FIBO=$(Fibonacci $i)
  echo -n "$FIBO "
done
# 0 1 1 2 3 5 8 13 21 34 55 89 144 233 377 610
# Занимает время, не так ли? Рекурсия в сценарии медлительна.

echo

exit 0
</pre></div></div><br class="example-break"/><p><a id="hanoiref"/></p><div class="example"><a id="hanoi"/><p class="title"><b>Пример 23.17. <em class="firstterm">Ханойская Башня</em></b></p><div class="example-contents"><pre class="programlisting">
#! /bin/bash
#
# Ханойская Башня
# сценарий Bash
# Copyright (C) 2000 Amit Singh. Все Права Защищены.
# http://hanoi.kernelthread.com
#
# Протестировано с Bash версии 2.05b.0(13)-release.
# Также работает с Bash версии 3.x.
#
#  Использовано в "Advanced Bash Scripting Guide"
#+ с разрешения автора данного сценария.
#  Немного изменено и прокомментировано автором ABS.

#=================================================================#
#  Ханойская башня -- это математическая головоломка, придуманная
#+ математиком Эдуардом Люка в 19-м веке.
#
#  Даётся три вертикальных стержня.
#  На первый из них нанизано несколько колец.
#  Эти кольца представляют собой диски с отверстием по центру,
#+ так что они могут свободно перемещаться по стержню.
#  Кольца имеют различный диаметр, и расположены в порядке уменьшения
#+ их диаметра.
#  Наименьшее из колец находится в самом верху, а наибольшее внизу.
#
#  Задача заключается в перемещении набора колец
#+ на один из других стержней.
#  За один раз вы можете переместить на другой стержень только одно кольцо.
#  Разрешается возвратить кольцо на стержень, где оно уже было.
#  Вы можете помещать меньшее кольцо сверху большего,
#+ но *не* наоборот.
#  Повторюсь, запрещено размещать большее кольцо сверху меньшего.
#
#  Для небольшого числа колец потребуется лишь несколько перемещений.
#+ Для каждого дополнительного кольца
#+ необходимое число перемещений увеличивается примерно вдвое,
#+ и "стратегия" решения задачи сильно усложняется.
#
#  Для более подробной информации см. http://hanoi.kernelthread.com
#+ или пишите: 186-92 of _The Armchair Universe_ by A.K. Dewdney.
#
#
#         ...                   ...                    ...
#         | |                   | |                    | |
#        _|_|_                  | |                    | |
#       |_____|                 | |                    | |
#      |_______|                | |                    | |
#     |_________|               | |                    | |
#    |___________|              | |                    | |
#   |             |             | |                    | |
# .--------------------------------------------------------------.
# |**************************************************************|
#          #1                   #2                      #3
#
#=================================================================#


E_NOPARAM=66  # В сценарий не передано параметров.
E_BADPARAM=67 # В сценарий передано неверное число колец.
Moves=        # Глобальная переменная, хранящая число перемещений.
              # Добавлено в оригинальный сценарий.

dohanoi() {   # Рекурсивная функция.
    case $1 in
    0)
        ;;
    *)
        dohanoi "$(($1-1))" $2 $4 $3
        echo move $2 "--&gt;" $3
        ((Moves++))          # Добавлено в оригинальный сценарий.
        dohanoi "$(($1-1))" $4 $3 $2
        ;;
    esac
}

case $# in
    1) case $(($1&gt;0)) in     # Должен быть хотя бы один диск.
       1)  # Вложенная конструкция case.
           dohanoi $1 1 3 2
           echo "Total moves = $Moves"   # 2^n - 1, где n = # дисков.
           exit 0;
           ;;
       *)
           echo "$0: illegal value for number of disks";
           exit $E_BADPARAM;
           ;;
       esac
    ;;
    *)
       echo "usage: $0 N"
       echo "       Where \"N\" is the number of disks."
       exit $E_NOPARAM;
       ;;
esac

# Упражнения:
# ---------
# 1) Если разместить команды ниже этой строки, будут ли они выполнены?
#    Почему нет? (Просто)
# 2) Объясните принцип работы функции "dohanoi".
#    (Сложно -- см. ссылку от Dewdney выше.)
</pre></div></div><br class="example-break"/></div><div class="navfooter"><hr/><table width="100%" summary="Navigation footer"><tr><td align="left"><a accesskey="p" href="ch23s02.html">Пред.</a> </td><td align="center"><a accesskey="u" href="ch23.html">Уровень выше</a></td><td align="right"> <a accesskey="n" href="ch24.html">След.</a></td></tr><tr><td align="left" valign="top">Локальные переменные </td><td align="center"><a accesskey="h" href="index.html">Начало</a></td><td align="right" valign="top"> Глава 24. Псевдонимы</td></tr></table></div></body></html>
