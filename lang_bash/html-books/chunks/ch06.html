<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Глава 6. Exit and Exit Status</title><meta name="generator" content="DocBook XSL Stylesheets V1.75.2"/><link rel="home" href="index.html" title="Advanced Bash Scripting по-русски"/><link rel="up" href="pt02.html" title="Часть Part 2. Основы"/><link rel="prev" href="ch05s02.html" title="Экранирование символов"/><link rel="next" href="ch07.html" title="Глава 7. Проверка условий"/></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Глава 6. Exit and Exit Status</th></tr><tr><td align="left"><a accesskey="p" href="ch05s02.html">Пред.</a> </td><th width="60%" align="center">Часть Part 2. Основы</th><td align="right"> <a accesskey="n" href="ch07.html">След.</a></td></tr></table><hr/></div><div class="chapter" title="Глава 6. Exit and Exit Status"><div class="titlepage"><div><div><h2 class="title"><a id="exit-status"/>Глава 6. Exit and Exit Status</h2></div></div></div><div class="epigraph"><p>... there are dark corners in the Bourne shell, and people use all
      of them.</p><p>--Chet Ramey</p></div><p><a id="exitcommandref"/>The 
  <span class="command"><strong>
    <a id="idp8277008" class="indexterm"/>
    <a id="idp8278016" class="indexterm"/>
    exit
  </strong></span> 
  command terminates a script, just as in a <span class="command"><strong>C</strong></span>
  program. It can also return a value, which is available to the
  script's parent process.</p><p><a id="exitstatusref"/>Every command returns an 
  <em class="firstterm">
    <a id="idp8281280" class="indexterm"/>
    exit status
  </em> 
  (sometimes referred to as a 
  <em class="firstterm">
    <a id="idp8282672" class="indexterm"/>
    return status
  </em> or <em class="firstterm">exit code</em>).
  <a id="exitsuccess"/>
  A successful command returns a <span class="returnvalue">0</span>, while
  an unsuccessful one returns a <span class="returnvalue">non-zero</span>
  value that usually can be interpreted as an <em class="firstterm">error
  code</em>. Well-behaved UNIX commands, programs, and
  utilities return a <span class="returnvalue">0</span> exit code upon
  successful completion, though there are some exceptions.</p><p>Likewise, <a class="link" href="ch23.html#functionref">functions</a>
  within a script and the script itself return an exit
  status. The last command executed in the function or
  script determines the exit status. Within a script, an
  <strong class="userinput"><code>exit <em class="replaceable"><code>nnn</code></em></code></strong>
  command may be used to deliver an
  <span class="returnvalue"><em class="replaceable"><code>nnn</code></em></span>
  exit status to the shell
  (<span class="returnvalue"><em class="replaceable"><code>nnn</code></em></span>
  must be an integer in the <span class="returnvalue">0</span> -
  <span class="returnvalue">255</span> range).</p><div class="note" title="Замечание" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Замечание</h3><p>When a script ends with an <span class="command"><strong>exit</strong></span> that has
  no parameter, the exit status of the script is the exit status
  of the last command executed in the script (previous to the
  <span class="command"><strong>exit</strong></span>).</p><pre class="programlisting">#!/bin/bash

COMMAND_1

. . .

COMMAND_LAST

# Will exit with status of last command.

exit</pre><p>The equivalent of a bare <span class="command"><strong>exit</strong></span> is
        <span class="command"><strong>exit $?</strong></span> or even just omitting the
  <span class="command"><strong>exit</strong></span>.</p><pre class="programlisting">#!/bin/bash

COMMAND_1

. . .

COMMAND_LAST

# Will exit with status of last command.

exit $?</pre><pre class="programlisting">#!/bin/bash

COMMAND1

. . . 

COMMAND_LAST

# Will exit with status of last command.</pre></div><p><a id="exsref"/></p><p>
  <code class="varname">
    <a id="idp8298368" class="indexterm"/> <a id="idp8299376" class="indexterm"/> $?</code> reads the exit status of the last
      command executed. After a function returns,
      <code class="varname">$?</code> gives the exit status of the last
      command executed in the function. This is Bash's way of giving
      functions a <span class="quote">«<span class="quote">return value.</span>»</span>
      
        <sup>[<a id="idp8301920" href="#ftn.idp8301920" class="footnote">28</a>]</sup>
      </p><p><a id="pipeex"/>Following the execution of a <a class="link" href="ch03.html#piperef">pipe</a>, a <code class="varname">$?</code>
        gives the exit status of the last command executed.</p><p>After a script terminates, a <code class="varname">$?</code> from the
      command-line gives the exit status of the script, that is, the
      last command executed in the script, which is, by convention,
      <strong class="userinput"><code>0</code></strong> on success or an integer in the
      range <span class="returnvalue">1 - 255</span> on error.</p><div class="example"><a id="ex5"/><p class="title"><b>Пример 6.1. exit / exit status</b></p><div class="example-contents"><pre class="programlisting">&amp;ex5;</pre></div></div><br class="example-break"/><p><a class="link" href="ch09.html#xstatvarref">$?</a> is especially useful
        for testing the result of a command in a script (see <a class="xref" href="ch15s05.html#filecomp" title="Пример 15.35. Using cmp to compare two files within a script.">Пример 15.35, «Using <em class="firstterm">cmp</em> to compare two files
          within a script.»</a> and <a class="xref" href="ch15s04.html#lookup" title="Пример 15.20. Checking words in a list for validity">Пример 15.20, «Checking words in a list for validity»</a>).</p><div class="note" title="Замечание" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Замечание</h3><p>The <a class="link" href="ch03.html#notref">!</a>, the <em class="firstterm">logical
  not</em> qualifier, reverses the outcome of a test or
  command, and this affects its <a class="link" href="ch06.html#exitstatusref">exit
  status</a>.

  </p><div class="example"><a id="negcond"/><p class="title"><b>Пример 6.2. Negating a condition using <span class="token">!</span></b></p><div class="example-contents"><pre class="programlisting">true    # The "true" builtin.
echo "exit status of \"true\" = $?"     # 0

! true
echo "exit status of \"! true\" = $?"   # 1
# Note that the "!" needs a space between it and the command.
#    !true   leads to a "command not found" error
#
# The '!' operator prefixing a command invokes the Bash history mechanism.

true
!true
# No error this time, but no negation either.
# It just repeats the previous command (true).


# =========================================================== #
# Preceding a _pipe_ with ! inverts the exit status returned.
ls | bogus_command     # bash: bogus_command: command not found
echo $?                # 127

! ls | bogus_command   # bash: bogus_command: command not found
echo $?                # 0
# Note that the ! does not change the execution of the pipe.
# Only the exit status changes.
# =========================================================== #

# Thanks, Stéphane Chazelas and Kristopher Newsome.</pre></div></div><p><br class="example-break"/>

      </p></div><div class="caution" title="Предостережение" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Предостережение</h3><p>Certain exit status codes have <a class="link" href="apd.html#exitcodesref">reserved meanings</a> and should not
  be user-specified in a script.  </p></div><div class="footnotes"><br/><hr/><div class="footnote"><p><sup>[<a id="ftn.idp8301920" href="#idp8301920" class="para">28</a>] </sup>In those instances when there is no <a class="link" href="ch23.html#returnref">return</a>
        terminating the function.</p></div></div></div><div class="navfooter"><hr/><table width="100%" summary="Navigation footer"><tr><td align="left"><a accesskey="p" href="ch05s02.html">Пред.</a> </td><td align="center"><a accesskey="u" href="pt02.html">Уровень выше</a></td><td align="right"> <a accesskey="n" href="ch07.html">След.</a></td></tr><tr><td align="left" valign="top">Экранирование символов </td><td align="center"><a accesskey="h" href="index.html">Начало</a></td><td align="right" valign="top"> Глава 7. Проверка условий</td></tr></table></div></body></html>
