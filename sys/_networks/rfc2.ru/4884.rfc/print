<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8" /><link rel="stylesheet" href="../tpl/style.css@f4e332aa" type="text/css" /><link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css' /><style type="text/css">h1,h2,h3,h4{font-family:'Open Sans',sans-serif}</style><link rel="canonical" href="../4884.rfc" /><meta name="Robots" content="noindex, nofollow" /><title>Перевод RFC 4884 — Расширенный протокол ICMP для поддержки сообщений из нескольких частей</title><link rel="alternate" type="application/rss+xml" title="RFC2.ru - Русские Переводы RFC" href="../rss.xml"></head><body><div id="content"><div id="nav"><div class="icon i0"></div> <a href="../index.html" accesskey="`">На Главную</a></div><div id="search" class="ya-site-form ya-site-form_inited_no"><form action="http://yandex.ru/sitesearch" method="get" target="_blank"><input type="hidden" name="searchid" value="2154295"/><input type="hidden" name="l10n" value="ru"/><input type="hidden" name="reqenc" value=""/><input type="hidden" name="submit" value="Найти"/><input type="search" value="" name="text" placeholder="Поиск по RFC2.ru" /></form></div><div itemscope itemtype="http://schema.org/ScholarlyArticle"><meta itemprop="inLanguage" content="ru" /><meta itemprop="editor" content="ru" /><div id="header"><h1><a itemprop="headline" href="../4884.rfc">RFC 4884 — Расширенный протокол ICMP для поддержки сообщений из нескольких частей</a></h1></div><dl class="mute"><dt></dt><dd><div class="icon i1"></div> RFC: 4884</dd><dd><div class="icon i3"></div> Оригинал: <a href="original" target="_blank"><span itemprop="alternativeHeadline">Extended ICMP to Support Multi-Part Messages</span></a></dd><dd><div class="icon i2"></div> Категория: <span itemprop="articleSection">Предложенный стандарт</span></dd><dd><div class="icon i4"></div> Дата публикации: <time itemprop="datePublished" datetime="2007-04-08">Апрель 2007</time></dd><dd><div class="icon i5"></div> Авторы: <span itemprop="author">Ronald P. Bonica</span>, <span itemprop="author">Der-Hwa Gan</span>, <span itemprop="author">Daniel C. Tappan</span>, <span itemprop="author">Carlos Pignataro</span></dd><dd><div class="icon i6"></div> Перевод: <span itemprop="editor">Николай Малых</span></dd></dl><div id="text" itemprop="articleBody"><h3>Статус документа</h3><p>В этом документе содержится проект стандартного протокола, предложенного сообществу Internet. Документ служит приглашением к дискуссии в целях развития и совершенствования протокола. Текущее состояние стандартизации протокола вы можете узнать из документа "Internet Official Protocol Standards" (STD 1). Документ может распространяться без ограничений.</p><h3>Тезисы</h3><p>В этом документе заново определены некоторые сообщения ICMP для поддержки сообщений, состоящих из нескольких частей. Многокомпонентное сообщение ICMP передает всю информацию, которая передавалась сообщениями ICMP ранее, а также дополнительные данные, которые могут требоваться для приложений.</p><p>Многокомпонентные сообщения поддерживаются структурой расширения ICMP. Эта структура располагается в конце сообщения ICMP и включает заголовок расширения, за которым следует один или множество объектов расширения. Каждый из таких объектов содержит заголовок объекта и данные. Заголовки объектов используют общий формат.</p><p>Этот документ переопределяет упомянутые выше сообщения ICMP за счет задания атрибута размера. Все определенные к настоящему моменту сообщения ICMP, к которым будет добавляться в конце структура расширения, включают поле «исходная дейтаграмма». Это поле содержит начальные октеты дейтаграммы, которая вызвала сообщение ICMP об ошибке. Хотя поле «исходной дейтаграммы» имеет переменный размер, в сообщениях ICMP нет поля для указания этого размера. Поэтому, для упрощения анализа сообщений этот документ выделяет 8 ранее зарезервированных битов для указания размера поля исходной дейтаграммы.</p><p>Предложенные модификации меняют требования совместимости для ICMP. Влияние этих изменений на соответствующие требованиям спецификации реализации протокола рассматривается в этом документе. Приведены также требования к будущим реализациям.</p><p>Этот документ является обновлением RFC 792 и RFC 4443.</p><h2>Оглавление</h2><ul class="map"><li><a href="print#p1">1. Введение</a></li><li><a href="print#p2">2. Используемые в документе соглашения</a></li><li><a href="print#p3">3. Список изменений ICMP</a></li><li><a href="print#p4">4. Расширяемость ICMP</a></li><li class="lia"><a href="print#p4.1">4.1. ICMPv4 Destination Unreachable</a></li><li class="lia"><a href="print#p4.2">4.2. ICMPv4 Time Exceeded</a></li><li class="lia"><a href="print#p4.3">4.3. ICMPv4 Parameter Problem</a></li><li class="lia"><a href="print#p4.4">4.4. ICMPv6 Destination Unreachable</a></li><li class="lia"><a href="print#p4.5">4.5. ICMPv6 Time Exceeded</a></li><li class="lia"><a href="print#p4.6">4.6. Сообщения ICMP, которые могут быть расширены</a></li><li><a href="print#p5">5. Совместимость с предыдущими версиями</a></li><li class="lia"><a href="print#p5.1">5.1. Классическое приложение получает сообщение ICMP с расширениями</a></li><li class="lia"><a href="print#p5.2">5.2. Несовместимое приложение получает сообщение ICMP без расширений</a></li><li class="lia"><a href="print#p5.3">5.3. Несовместимое приложение получает сообщение ICMP с совместимым расширением</a></li><li class="lia"><a href="print#p5.4">5.4. Совместимое приложение получает сообщение ICMP без расширений</a></li><li class="lia"><a href="print#p5.5">5.5. Совместимое приложение получает сообщение ICMP с несовместимым расширением</a></li><li><a href="print#p6">6. Взаимодействие с трансляцией адресов</a></li><li><a href="print#p7">7. Структура расширения ICMP</a></li><li><a href="print#p8">8. Объекты расширения ICMP</a></li><li><a href="print#p9">9. Вопросы безопасности</a></li><li><a href="print#p10">10. Согласование с IANA</a></li><li><a href="print#p11">11. Благодарности</a></li><li><a href="print#p12">12. Литература</a></li><li class="lia"><a href="print#p12.1">12.1. Нормативные документы</a></li><li class="lia"><a href="print#p12.2">12.2. Дополнительная литература</a></li></ul><h2 id="p1">1. Введение</h2><p>В этом документе заново определены сообщения <a href="../792.rfc" title="RFC 792 - Протокол ICMP">ICMPv4</a> [RFC0792] и ICMPv6 [RFC4443] для включения структуры расширения и атрибута размера. Структура расширения поддерживает многокомпонентные операции ICMP. Разработчики протоколов могут создавать сообщения ICMP, передающие дополнительную информацию, которая представляется с помощью структуры расширения.</p><p>Этот документ также решает фундаментальную проблему расширяемости ICMP. Все сообщения ICMP, рассматриваемые в этом документе, включают поле «исходной дейтаграммы», содержащее начальные октеты дейтаграммы, вызвавшей сообщение ICMP об ошибке. Хотя поле «исходной дейтаграммы» имеет переменный размер, в сообщениях ICMP нет поля для указания этого размера.</p><p>Приложения определяют размер поля «исходной дейтаграммы» из общего размера сообщения ICMP. Если структура расширения добавляется в конце сообщения без введения атрибута размера поля «исходной дейтаграммы», сообщение становится «неразборчивым». В частности, приложения не смогут, где заканчивается поле «исходной дейтаграммы» и начинается структура расширения. Поэтому в данном документе предложен атрибут размера наряду со структурой расширения, добавляемой в конце сообщения ICMP.</p><p>В документе также решается задача совместимости с существующими реализациями ICMP, которые не поддерживают определенных здесь расширений или реализуют их без добавления атрибута размера. В частности, рассматриваются вопросы совместимости с некотрыми широко распространенными реализациями ICMPv4, совместимыми с MPLS, которые передают определенные здесь расширения без добавления требуемого атрибута размера.</p><p>В этом документе не определяются объекты расширения ICMP. Определен только заголовок расширения и заголовок, используемый всеми объектами. В работах [UNNUMBERED], [ROUTING-INST] и [MPLS-ICMP] описаны примеры применения объектов расширения ICMP.</p><p>Упомянутые выше документы имеют ряд общих характеристик. Они добавляют информацию к сообщениям ICMP Time Expired для программ трассировки (TRACEROUTE). В этом случае, как и во многих других, добавление информации к существующему сообщению ICMP Time Expired более предпочтительно, чем определение нового сообщения и генерация двух сообщений вместо одного при отбрасывании пакетов по причине обнуления TTL.</p><h2 id="p2">2. Используемые в документе соглашения</h2><p>Ключевые слова необходимо (MUST), недопустимо (MUST NOT), требуется (REQUIRED), нужно (SHALL), не следует (SHALL NOT), следует (SHOULD), не нужно (SHOULD NOT), рекомендуется (RECOMMENDED), возможно (MAY), необязательно (OPTIONAL) в данном документе интерпретируются в соответствии с [RFC2119].</p><h2 id="p3">3. Список изменений ICMP</h2><p>The following is a summary of changes to ICMP that are introduced by this memo:</p><ul><li><p>ICMP Extension Structure может добавляться в конец сообщений ICMPv4 Destination Unreachable, Time Exceeded и Parameter Problem.</p></li><li><p>ICMP Extension Structure может добавляться в конец сообщений ICMPv6 Destination Unreachable и Time Exceeded.</p></li><li><p>Перечисленные выше сообщения включают поле «исходной дейтаграммы» и формат сообщений обновлен с добавлением атрибута размера поля «исходной дейтаграммы».</p></li><li><p>При добавлении структуры расширения ICMP в конец сообщения ICMP, содержащего поле «исходной дейтаграммы», это поле должно содержать не менее 128 октетов.</p></li><li><p>При добавлении структуры расширения ICMP в конец сообщения ICMPv4, содержащего поле «исходной дейтаграммы», это поле должно быть дополнено нулями для выравнивания по ближайшей 32-битовой границе.</p></li><li><p>При добавлении структуры расширения ICMP в конец сообщения ICMPv6, содержащего поле «исходной дейтаграммы», это поле должно быть дополнено нулями для выравнивания по ближайшей 64-битовой границе.</p></li><li><p>При определении новых сообщений ICMP в будущем следует указывать, поддерживается ли для этого сообщения определенный в данной спецификации механизм расширения. Для всех новых сообщений рекомендуется поддерживать расширения.</p></li></ul><h2 id="p4">4. Расширяемость ICMP</h2><p>RFC 792 определяет следующие типы сообщений ICMPv4:</p><ul class="dot"><li>Destination Unreachable — адресат недоступен</li><li>Time Exceeded — время жизни истекло</li><li>Parameter Problem — проблема с параметрами</li><li>Source Quench — слишком большая скорость передачи</li><li>Redirect — перенаправление</li><li>Echo Request/Reply — запрос/отклик эхо</li><li>Timestamp/Timestamp Reply — временная метка и отклик с временной сеткой</li><li>Information Request/Information Reply — информационный запрос/отклик</li></ul><p>[RFC1191] резервирует биты для поля Next-Hop MTU в сообщениях Destination Unreachable.</p><p>RFC 4443 определяет следующие типы сообщений ICMPv6:</p><ul class="dot"><li>Destination Unreachable — адресат недоступен</li><li>Packet Too Big — слишком большой пакет</li><li>Time Exceeded — время жизни истекло</li><li>Parameter Problem — проблема с параметрами</li><li>Echo Request/Reply — запрос/отклик эхо</li></ul><p>Многие сообщения ICMP в соответствии с текущими опеределениями являются расширяемыми. Разработчики протоколов могут расширять сообщения ICMP простым добавлением полей или структур данных в конец сообщения.</p><p>Однако ряд сообщений ICMP в соответствии с текущими определениями не поддерживает расширений:</p><ul class="dot"><li>ICMPv4 Destination Unreachable (type = 3)</li><li>ICMPv4 Time Exceeded (type = 11)</li><li>ICMPv4 Parameter Problem (type = 12)</li><li>ICMPv6 Destination Unreachable (type = 1)</li><li>ICMPv6 Packet Too Big (type = 2)</li><li>ICMPv6 Time Exceeded (type = 3)</li><li>ICMPv6 Parameter Problem (type = 4)</li></ul><p>Эти сообщения содержат поле «исходной дейтаграммы», которое включает начальные октеты дейтаграммы, вызвавшей сообщение ICMP. RFC 792 определеяет поле «исходной дейтаграммы» для сообщений ICMPv4. В RFC 792 поле «исходной дейтаграммы» включает заголовок IP и следующие за ним 8 октетов исходной дейтаграммы. [RFC1812] расширяет поле «исходной дейтаграммы», позволяя включать в него любое число октетов при условии, что размер сообщения ICMP не будет превышать минимальный размер буфера сборки IPv4 (т. е., 576 октета). RFC 4443 определяет поле «исходной дейтаграммы» для сообщений ICMPv6. В RFC 4443 поле «исходной дейтаграммы» всегда содержит столько октетов, сколько можно включить без превышения сообщением ICMP минимального размера IPv6 MTU (т. е., 1280 октетов).</p><p>К сожалению, поле «исходной дейтаграммы» не имеет атрибута размера. Приложения определяют размер этого поля по общему размеру сообщения ICMP. Если к сообщения добавляется структура расширения без добавления атрибута размера поля «исходной дейтаграммы», сообщение становится «неразборчивым». В частности, приложение не сможет определить, где заканчивается поле «исходной дейтаграммы» и начинается структура расширения.</p><p>Для решения этой проблемы в настоящем документе вводится 8-битовый атрибут размера для следующих сообщений ICMPv4:</p><ul class="dot"><li>Destination Unreachable (type = 3)</li><li>Time Exceeded (type = 11)</li><li>Parameter Problem (type = 12)</li></ul><p>Такой же 8-битовый атрибут размера добавляется в сообщения ICMPv6:</p><ul class="dot"><li>Destination Unreachable (type = 1)</li><li>Time Exceeded (type = 3)</li></ul><p>Атрибут размера должен задаваться в тех случаях, когда к перечисленным выше сообщениям добавляется ICMP Extension Structure.</p><p>Атрибут размера показывает размер поля «исходной дейтаграммы». Пространство для атрибута размера берется из резервных октетов, которые раньше были определены с нулевым значением.</p><p>Для сообщения ICMPv4 атрибут размера показывает число 32-битовых слов. При наличии атрибута размера поле «исходной дейтаграммы» должно дополняться нулями для выравнивания по ближайшей 32-битовой границе. Поскольку в каждом из затрагиваемых изменениями типов сообщений ICMPv4 был зарезервирован шестой октет, этот октет был выбран для размещения атрибута размера в сообщениях ICMPv4.</p><p>Для сообщения ICMPv6 атрибут размера показывает количество 64-битовых слов. При наличии атрибута размера поле «исходной дейтаграммы» должно дополняться нулями для выравнивания по ближайшей 64-битовой границе. Поскольку в каждом из затрагиваемых типов сообщений ICMPv6 шестой октет был резервным, этот октет был выбран для размещения атрибута размера в ICMPv6.</p><p>Для обеспечения совместимости с более ранними версиями при добавлении в конец сообщения ICMP Extension Structure и наличии поля «исходной дейтаграммы» последнее должно содержать не менее 128 октетов. Если в исходной дейтаграмме менее 128, поле «исходной дейтаграммы» должно дополняться нулями до 128 октетов (обоснование этого приведено в параграфе 5.1).</p><p>В следующих параграфах описан атрибут размера в сообщениях ICMP.</p><h3 id="p4.1">4.1. ICMPv4 Destination Unreachable</h3><p>Рисунок 1 показывает формат сообщения ICMPv4 Destination Unreachable.</p><pre> 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     Type      |     Code      |          Checksum             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     unused    |    Length     |         Next-Hop MTU*         |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|  Заголовок Internet и начальные октеты исходной дейтаграммы   |
|                                                               |
|                           //                                  |
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

Рисунок 1: ICMPv4 Destination Unreachable</pre><p>Синтаксис и семантика всех полей этого сообщения не меняются по сравнению с RFC 792, за исключением добавления во второе слово атрибута размера (Length). Этот атрибут указывает размер поля «исходной дейтаграммы» в 32-битовых словах.</p><p class="note">Поле Next-Hop MTU требуется не во всех случаях. Оно показано только для деонстрации того, что эти биты заняты для данного типа сообщений и их невозможно выделить для целей настойщего документа.</p><h3 id="p4.2">4.2. ICMPv4 Time Exceeded</h3><p>Рисунок 2 показывает формат сообщения ICMPv4 Time Exceeded.</p><pre> 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     Type      |     Code      |          Checksum             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     unused    |    Length     |          unused               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|  Заголовок Internet и начальные октеты исходной дейтаграммы   |
|                                                               |
|                           //                                  |
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

Рисунок 2: ICMPv4 Time Exceeded</pre><p>Синтаксис и семантика всех полей этого сообщения не меняются по сравнению с RFC 792, за исключением добавления во второе слово атрибута размера (Length). Этот атрибут указывает размер поля «исходной дейтаграммы» в 32-битовых словах.</p><h3 id="p4.3">4.3. ICMPv4 Parameter Problem</h3><p>Рисунок 3 показывает формат сообщения ICMPv4 Parameter Problem.</p><pre> 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     Type      |     Code      |          Checksum             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|    Pointer    |    Length     |          unused               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|  Заголовок Internet и начальные октеты исходной дейтаграммы   |
|                                                               |
|                           //                                  |
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

Рисунок 3: ICMPv4 Parameter Problem</pre><p>Синтаксис и семантика всех полей этого сообщения не меняются по сравнению с RFC 792, за исключением добавления во второе слово атрибута размера (Length). Этот атрибут указывает размер поля «исходной дейтаграммы» в 32-битовых словах.</p><h3 id="p4.4">4.4. ICMPv6 Destination Unreachable</h3><p>Рисунок 4 показывает формат сообщения ICMPv6 Destination Unreachable.</p><pre>    0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     Type      |     Code      |          Checksum             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|    Length     |                  Unused                       |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                  Максимально возможное число октетов          |
+                вызвавшего сообщение ICMPv6 пакета, без        +
|                превышения минимального IPv6 MTU [RFC4443]     |

Рисунок 4: ICMPv6 Destination Unreachable</pre><p>Синтаксис и семантика всех полей этого сообщения не меняются по сравнению с RFC 4443, за исключением добавления во второе слово атрибута размера (Length). Этот атрибут указывает размер поля «исходной дейтаграммы» в 64-битовых словах.</p><h3 id="p4.5">4.5. ICMPv6 Time Exceeded</h3><p>Рисунок 5 показывает формат сообщения ICMPv6 Time Exceeded.</p><pre>     0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     Type      |     Code      |          Checksum             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|    Length     |                 Unused                        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                  Максимально возможное число октетов          |
+                вызвавшего сообщение ICMPv6 пакета, без        +
|                превышения минимального IPv6 MTU [RFC4443]     |

Рисунок 5: ICMPv6 Time Exceeded</pre><p>Синтаксис и семантика всех полей этого сообщения не меняются по сравнению с RFC 4443, за исключением добавления во второе слово атрибута размера (Length). Этот атрибут указывает размер поля «исходной дейтаграммы» в 64-битовых словах.</p><h3 id="p4.6">4.6. Сообщения ICMP, которые могут быть расширены</h3><p>Структура расширения ICMP может добавляться в конец сообщений следующих типов:</p><ul class="dot"><li>ICMPv4 Destination Unreachable</li><li>ICMPv4 Time Exceeded</li><li>ICMPv4 Parameter Problem</li><li>ICMPv6 Destination Unreachable</li><li>ICMPv6 Time Exceeded</li></ul><p>ICMP Extension Structure недопустимо добавлять в прочие сообщения ICMP, упомянутые в разделе 4. Расширения не были определены для сообщений ICMPv6 Packet Too Big и Parameter Problem по причине отсутствия в этих типах сообщения пространства для размещения атрибута размера.</p><h2 id="p5">5. Совместимость с предыдущими версиями</h2><p>Сообщения ICMP можно разделить на несколько категорий:</p><ul class="dot"><li>сообщения без расширений ICMP;</li><li>сообщения с несовместимыми с данной спецификацией расширениями ICMP;</li><li>сообщения с совместимыми расширениями ICMP.</li></ul><p>Все реализации ICMP могут передавать сообщения без расширений. Реализации ICMP до 1999 г. просто не знают о расширениях ICMP.</p><p>Некоторые реализации ICMP, выпущенные между 1999 г. и публикацией этого документа могут передавать не соответствующие этой спецификации варианты расширений ICMP. В частности, такие реализации могут добавлять структуру расширения ICMP в конец сообщений Time Exceeded и Destination Unreachable. В таких случаях реализации передают ровно 128 октетов, представляющих исходную дейтаграмму, дополняя ее, при необходимости, нулями. Расчет контрольной суммы такие реализации выполняют в соответствии с приведенным здесь описанием. Однако они не задают атрибут размера для поля «исходной дейтаграммы».</p><p>Предполагается, что будущие реализации ICMP будут передавать расширения ICMP, совместимые с данной спецификацией.</p><p>Приложения, принимающие сообщения ICMP также можно разделить по категориям:</p><ul class="dot"><li>классические приложения;</li><li>несовместимые приложения;</li><li>совместимые приложения.</li></ul><p>Классические приложения не разбирают определенных здесь расширений. Они не воспринимают также атрибут размера, связанный с полем «исходной дейтаграммы».</p><p>Несовместимые реализации разбирают определенные здесь расширения, но только для сообщений Time Expired и Destination Unreachable. Они требуют, чтобы поле «исходной дейтаграммы» имело размер 128 октетов и не понимают атрибута размера, связанного с этим полем. Несовместимые реализации выпускались с 1999 г. до момента публикации этого документа.</p><p>Совместимые реализаци полностью соответствуют данной спецификации.</p><p>Таблица 1 показывает, как приложения каждой категории будут относится к разборке сообщений ICMP всех категорий.</p><table class="c"><tr><td></td><td>Нет расширений</td><td>Несовместимые расширения</td><td>Совместимые расширения</td></tr><tr><td>Классические приложения</td><td> —</td><td>Параграф 5.1</td><td>Параграф 5.1</td></tr><tr><td>Несовместимые приложения</td><td>Параграф 5.2</td><td> —</td><td>Параграф 5.3</td></tr><tr><td>Совместимые приложения</td><td>Параграф 5.4</td><td>Параграф 5.5</td><td> —</td></tr></table><p>Прочерк в ячейке таблицы говорит о нормальной ситуации, которая не требует разъяснений. В последующих параграфах предполагается, что сообщения ICMP относятся к типу Time Exceeded.</p><h3 id="p5.1">5.1. Классическое приложение получает сообщение ICMP с расширениями</h3><p>Когда классическое приложение получает сообщение ICMP с расширением, приложение будет некорректно интерпретировать это расширение, как часть поля «исходной дейтаграммы». К счастью, расширения начинаются не ранее 128 октетов от начала поля «исходной дейтаграммы». Поэтому проблемы могут возникать только у тех приложений, которые обрабатывают более 128 окетов поля «исходной дейтаграммы». На момент публикации этого документа было известно только два таких приложения, причем степень негативного влияния расширений минимальна.</p><p>Некоторые варианты стека TCP при получении сообщения ICMP проверяют контрольную сумму поля «исходной дейтаграммы» [ATTACKS]. Если эта сумма некорректна, стек TCP отбрасывает сообщение ICMP по соображениям безопасности. Если завершающие октеты поля «исходной дейтаграммы» переписаны расширением ICMP, такой стек TCP будет отбрасывать сообщения ICMP, которые не были бы отброшены в обычных условиях. Негативное влияние такого отбрасывания считается минимальным, поскольку множество сообщений ICMP отбрасывается по другим причинам (например, фильтрация ICMP, перегрузка в сети, некорректная контрольная сумма в результате «усекновения» исходной дейтаграммы).</p><p>Другой, теоретически возможный, но весьма маловероятный случай возникает, когда расширения ICMP переписывают часть поля «исходной дейтаграммы», которая представляет заголовок TCP, что приводит стек TCP к работе с некорректным соединением TCP. Такие случаи маловероятны, поскольку для их возникновения нужно, чтобы заголовок TCP выходил за пределы первых 128 октетов поля «исходной дейтаграммы», а расширение напоминало бы корректный заголовок TCP.</p><h3 id="p5.2">5.2. Несовместимое приложение получает сообщение ICMP без расширений</h3><p>Когда несовместимое приложение ICMPv4 получает сообщение без расширений, оно проверяет общий размер сообщения ICMPv4. Если этот размер меньше размера заголовка IP в сообщении + + 144 октета, приложение корректно определяет отсутствие расширений.</p><p>Значение 144 включает 8 октетов двух первых слов сообщения ICMPv4 Time Exceeded, 128 октетов поля «исходной дейтаграммы», 4 октета заголовка расширения ICMP и 4 октета одного заголовка объекта ICMP. Все перечисленные октеты требуются при использовании расширений.</p><p>Если данные ICMPv4 включают не менее 144 октетов, приложение должно проверить октет 137 для определения наличия корректного заголовка ICMPv4 Extension. Корректный заголовок расширения должен содержать корректный номер версии и контрольную суииу. Если это не выполняется, приложение корректно считает, что в сообщении не содержится расширений.</p><p>Несовместимые приложения предполагают, что структура расширения ICMPv4 начинается с октета 137 сообщения Time Exceeded после поля «исходной дейтаграммы» размером 128 октетов.</p><p>В перечисленных ниже случаях возможен некорректный анализ несовместимым приложением сообщения ICMPv4:</p><ul class="dot"><li>сообщение не содержит расширения;</li><li>поле «исходной дейтаграммы» содержит не менее 144 октетов;</li><li>выбранные октеты поля «исходной дейтаграммы» представляют корректные значения номера версии и контрольной суммы заголовка расширения.</li></ul><p>Такие случаи возможны, но маловероятны.</p><p>Аналогичный анализ можно провести для ICMPv6 с соответствующим изменением числовых констант.</p><h3 id="p5.3">5.3. Несовместимое приложение получает сообщение ICMP с совместимым расширением</h3><p>Когда несовместимое приложение получает сообщение с совместимым расширением ICMP, оно сможет корректно разобрать такое сообщение лишь в тех случаях, когда размер поля «исходной дейтаграммы» в точности равен 128 октетам. Это обусловлено тем, что несовместимые приложения не понимают атрибута размера поля «исходной дейтаграммы» (они предполагают этот размер равным 128 октетам).</p><p>За исключением ограничения на размер сообщения ICMP в целом (не более размера минимального буфера сборки — 576 октетов для ICMPv4 и 1280 октетов для ICMPv6), не вводится ограничений на размер поля «исходной дейтаграммы». Однако каждая реализация сама решает, сколько октетов исходной дейтаграммы следует включать в сообщение. Для обеспечения совместимости с несовместимыми с данной спецификацией реализациями TRACEROUTE включается в точности 128 октетов исходной дейтаграммы. Если такая совместимость не требуется, можно включать большее число октетов исходной дейтаграммы.</p><h3 id="p5.4">5.4. Совместимое приложение получает сообщение ICMP без расширений</h3><p>Когда совместимое приложение получает сообщение ICMP, оно проверяет значение атрибута размера поля «исходной дейтаграммы». Если атрибут имеет значение 0, совместимая реализация должна считать, что сообщение не включает расширений.</p><h3 id="p5.5">5.5. Совместимое приложение получает сообщение ICMP с несовместимым расширением</h3><p>Когда совместимое приложение получает сообщение ICMP, оно проверяет значение атрибута размера поля «исходной дейтаграммы». Если атрибут имеет значение 0, совместимая реализация должна считать, что сообщение не включает расширений. В этом случае такое определение корректно, но не обеспечивает совместимости с несовместимой с данной спецификацией реализацией ICMP, которая отправила сообщение.</p><p>Поэтому для упрощения и стимулирования перехода совместимые реализации TRACEROUTE должны включать не используемый по умолчанию механизм поддержки несовместимых откликов. В частности, когда приложение TRACEROUTE, работающее в несовместимом режиме, получает достаточно большое сообщение ICMP без атрибута размера, оно будет разбирать корректный заголовок расширения в фиксированном положении, предполагая поле «исходной дейтаграммы» размером 128 октетов. Если приложение находит корректный номер версии и контрольную сумму, оно будет трактовать следующие октеты, как структуру расширения.</p><h2 id="p6">6. Взаимодействие с трансляцией адресов</h2><p>Расширения ICMP, определенные в этом документе, не конфликтуют с системами трансляции адресов (NAT). [RFC3022] разрешает традиционным устройствам NAT изменять отдельные поля сообщений ICMP. К числу таких полей относится и упоминаемое здесь поле «исходной дейтаграммы». Однако, если устройство NAT меняет поле «исходной дейтаграммы», изменять следует только начальные поля этого поля, представляющие внешний заголовок IP. Поскольку внешний заголовок IP гарантированно располагается в первых 128 октетах поля «исходной дейтаграммы», расширения ICMP и NAT не нарушают работу друг друга.</p><p>Понятно, что реализация NAT может пренебречь ограничениями RFC 3022 и переписать определенное в этом документе поле атрибута размера. Если реализация NAT будет заполнять это поле нулями, полученный в результате пакет будет неотличим от пакетов, генерируемых несовместимыми реализациями ICMP. Вопросы совместимости для таких случаев рассмотрены в параграфе 5.5.</p><h2 id="p7">7. Структура расширения ICMP</h2><p>В этом документе предлагается опциональная структура расширения (ICMP Extension Structure), которая может добавляться в конец сообщений ICMP, перечисленных в параграфе 4.6 этого документа.</p><p>Extension Structure содержит один заголовок расширения (Extension Header), за которым следует один или несколько объектов. Получив сообщение ICMP с расширениями, прикладная программа может обработать часть объектов, игнорируя остальные. Наличие в сообщении нераспознанных объектов не является показателем некорректного формата сообщения ICMP.</p><p>Как сказано выше, общий размер сообщения ICMP, включая расширения, не должен превышать минимальный размер буфера сборки. Рисунок 6 показывает формат ICMP Extension Header.</p><pre> 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|Version|      (Reserved)       |           Checksum            |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

Рисунок 6: Заголовок расширения ICMP</pre><p>Заголовок расширения ICMP имеет следующие поля:</p><ul><li class="b">Version — версия (4 бита)</li><li class="lib">Номер версии расширения ICMP. Данный документ задает версию 2.</li><li class="b">Reserved — резерв (12 битов)</li><li class="lib">Резервное поле, которое должно иметь нулевое значение.</li><li class="b">Checksum — контрольная сумма (16 битов)</li><li class="lib">Дополнение до 1 суммы дополнений до 1 октетов структуры данных. При расчете контрольной суммы значение поля предполагается нулевым. Равное нулю поле контрольной суммы говорит об отсутствии последней. Использование поля контрольной суммы в заголовке расширения описано в параграфе 5.2.</li></ul><h2 id="p8">8. Объекты расширения ICMP</h2><p>Каждый объект расширения содержит по крайней мере одно 32-битовое слово, представляющее заголовок и и данные объекта расширения. Все заголовки объектов используют общий формат. Рисунок 7 показывает формат заголовка и данных объекта.</p><pre> 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|             Length            |   Class-Num   |   C-Type      |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
|                    // (данные объекта) //                     |
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

Рисунок 7: Заголовок и данные объекта расширения</pre><p>Заголовок объекта включает следующие поля:</p><ul><li class="b">Length — размер (16 битов)</li><li class="lib">Размер объекта в октетах с учетом заголовка и данных.</li><li class="b">Class-Num (8 битов)</li><li class="lib">Идентификатор класса объекта.</li><li class="b">C-Type (8 битов)</li><li class="lib">Идентификатор субтипа объекта.</li></ul><h2 id="p9">9. Вопросы безопасности</h2><p>При получении сообщения ICMP прикладная программа должна проверить его синтаксическую корректность. Должна проверяться также контрольная сумма расширения. Некорректно заданные атрибуты размера и другие синтаксические проблемы могут приводить к переполнению буфера.</p><p>В этом документе не задаются условия, при которых маршрутизаторы передают сообщения ICMP. Следовательно, не возникает возможностей для организации новых атак на службы (DoS). Маршрутизаторы могут ограничивать скорость передачи сообщения ICMP.</p><h2 id="p10">10. Согласование с IANA</h2><p>Заголовок ICMP Extension Object содержит два 8-битовых поля — Class-Num идентифицирует класс объекта, а C-Type — субтип класса. Значения субтипов определяются для каждого класса объектов.</p><p>Агенство IANA организовало и поддерживает реестр классов объектов расширения ICMP и субтипов для этих классов. В настоящем документе не задается каких-либо значений для этих реестров. Классы объектов 0xF7 — 0xFF резервируются для частных применений. Значения идентификаторов класса выделяются в порядке поступления заявок (first-come-first-serve). Правила выделения значений субтипов должны задаваться в документах, определяющих класс.</p><h2 id="p11">11. Благодарности</h2><p>Спасибо Pekka Nikander, Mark Doll, Fernando Gont, Joe Touch, Christian Voiqt и Sharon за их комментарии к документу.</p><h2 id="p12">12. Литература</h2><h3 id="p12.1">12.1. Нормативные документы</h3><table itemprop="references"><tr><td>[RFC0792]</td><td>Postel, J., <a href="../792.rfc" title="RFC 792 - Протокол ICMP">«Протокол ICMP», RFC 792</a>, STD 5, Сентябрь 1981.</td></tr><tr><td>[RFC1191]</td><td>Mogul, J. и S. Deering, <a href="../1191.rfc" title="RFC 1191 - Исследование MTU на пути следования сообщения">«Исследование MTU на пути следования сообщения», RFC 1191</a>, Ноябрь 1990.</td></tr><tr><td>[RFC1812]</td><td>Baker, F., «Requirements for IP Version 4 Routers», RFC 1812, Июнь 1995.</td></tr><tr><td>[RFC2119]</td><td>Bradner, S., «Key words for use in RFCs to Indicate Requirement Levels», BCP 14, RFC 2119, Март 1997.</td></tr><tr><td>[RFC4443]</td><td>Conta, A., Deering, S., and M. Gupta, Ed., «Internet Control Message Protocol (ICMPv6) for the Internet Protocol Version 6 (IPv6) Specification», RFC 4443, Март 2006.</td></tr></table><h3 id="p12.2">12.2. Дополнительная литература</h3><table itemprop="references"><tr><td>[UNNUMBERED]</td><td>Atlas, A., Bonica, R., Rivers, JR., Shen, N., and E. Chen, «ICMP Extensions for Unnumbered Interfaces», Work in Progress, Март 2007.</td></tr><tr><td>[MPLS-ICMP]</td><td>Bonica, R., Gan, D., Tappan, D., and C. Pignataro, «ICMP Extensions for MultiProtocol Label Switching», Work in Progress3, Январь 2007.</td></tr><tr><td>[ATTACKS]</td><td>Gont, F., «ICMP attacks against TCP», Work in Progress, Октябрь 2006.</td></tr><tr><td class="nobr">[ROUTING-INST]</td><td>Shen, N. и E. Chen, «ICMP Extensions for Routing Instances», Work in Progress, Ноябрь 2006.</td></tr><tr><td>[RFC3022]</td><td>Srisuresh, P. и K. Egevang, <a href="../3022.rfc" title="RFC 3022 - Традиционная трансляция сетевых адресов IP (NAT)">«Традиционная трансляция сетевых адресов IP (NAT)», RFC 3022</a>, Январь 2001.</td></tr></table><h2>Адреса авторов</h2><p>Ronald P. Bonica<br />Juniper Networks<br />2251 Corporate Park Drive<br />Herndon, VA 20171 US<br />EMail: <bdo dir="rtl">&#116;&#101;&#110;&#46;&#114;&#101;&#112;&#105;&#110;&#117;&#106;&#64;&#97;&#99;&#105;&#110;&#111;&#98;&#114;</bdo></p><p>Der-Hwa Gan<br />Consultant<br />EMail: <bdo dir="rtl">&#109;&#111;&#99;&#46;&#111;&#111;&#104;&#97;&#121;&#64;&#110;&#97;&#103;&#97;&#119;&#104;&#114;&#101;&#100;</bdo></p><p>Daniel C. Tappan<br />Consultant<br />EMail: <bdo dir="rtl">&#109;&#111;&#99;&#46;&#108;&#105;&#97;&#109;&#103;&#64;&#110;&#97;&#112;&#112;&#97;&#116;&#46;&#110;&#97;&#100;</bdo></p><p>Carlos Pignataro<br />Cisco Systems, Inc.<br />7025 Kit Creek Road<br />Research Triangle Park, NC 27709 US<br />EMail: <bdo dir="rtl">&#109;&#111;&#99;&#46;&#111;&#99;&#115;&#105;&#99;&#64;&#97;&#116;&#97;&#110;&#103;&#105;&#112;&#99;</bdo></p></div></div><div id="disqus_thread"></div><script type="text/javascript">var disqus_shortname="rfc2",disqus_title="RFC 4884 - Расширенный протокол ICMP для поддержки сообщений из нескольких частей",disqus_identifier="4884.rfc",disqus_url="http://rfc2.ru/4884.rfc";(function(){var dsq=document.createElement("script");dsq.type="text/javascript";dsq.async=true;dsq.src = "//"+disqus_shortname+".disqus.com/embed.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(dsq);})();</script><div class="bubble">2007 - 2014 © <a href="../index.html" title="Русские переводы RFC">Русские переводы RFC</a>, IETF, ISOC.</div></div><div id="bottom" style="position:static !important;bottom:auto !important"><div class="bubble"><ul><li><!--723572853672--></li></ul></div></div><!-- Yandex.Metrika counter --><script type="text/javascript">(function (d, w, c) { (w[c] = w[c] || []).push(function() { try { w.yaCounter4680559 = new Ya.Metrika({id:4680559, webvisor:true, clickmap:true, accurateTrackBounce:true, trackHash:true, ut:"noindex"}); } catch(e) { } }); var n = d.getElementsByTagName("script")[0], s = d.createElement("script"), f = function () { n.parentNode.insertBefore(s, n); }; s.type = "text/javascript"; s.async = true; s.src = (d.location.protocol == "https:" ? "https:" : "http:") + "//mc.yandex.ru/metrika/watch.js"; if (w.opera == "[object Opera]") { d.addEventListener("DOMContentLoaded", f, false); } else { f(); } })(document, window, "yandex_metrika_callbacks");</script><noscript><div><img src="http://mc.yandex.ru/watch/4680559?ut=noindex" style="position:absolute; left:-9999px;" alt="" /></div></noscript><!-- /Yandex.Metrika counter --></body></html>