<HTML><HEAD>
<TITLE>Калашников.ru - Ассемблер? Это просто!.. (Выпуск № 009)</TITLE>
<BODY aLink=#000000 bgColor=#ebd2a5 link=#660000 text=#000000 vLink=#000000>

<P align=center><A 
href="http://ad.ir.ru/bb.cgi?cmd=go&pubid=128269&pg=2&vbn=10001&nocache=77524" 
target=_top><IMG alt="InterReklama " border=0 
src="http://ad.ir.ru/bb.cgi?cmd=ad&pubid=128269&pg=2&vbn=10001&nocache=77524"></A></P>
<P align=center><A href="http://www.ir.ru" target=_top><FONT size=1>InterReklama 
Advertising</FONT></A> </P>
<HR>


<DIV align=center>
<CENTER>
<TABLE bgColor=#9bdeec border=2 width="100%">
<TBODY>
<TR>
<TD width="100%">
<DIV align=center>
<CENTER>
<TABLE bgColor=#3c89b7 border=3 width="100%">
<TBODY>
<TR>
<TD width="100%">
<P align=center><FONT size=5><STRONG>Здравствуйте, уважаемые 
любители Ассемблера!</STRONG></FONT></P>
<HR>

<P align=center>Выпуск N 009</P></TD></TR></TBODY></TABLE></CENTER></DIV>
<HR>

<P align=left><FONT size=5><STRONG>Сегодня в нашей 
рассылке:</STRONG></FONT></P>
<UL>
<LI>
<P align=left><A href="#letters"><FONT color=#800000 size=3><STRONG>Ваши 
письма</STRONG></FONT></A><FONT color=#800000 
size=3><STRONG>;</STRONG></FONT></P>
<LI>
<P align=left><A href="#previous"><FONT color=#800000 
size=3><STRONG>Программа из прошлого выпуска</STRONG></FONT></A><FONT 
color=#800000 size=3><STRONG>;</STRONG></FONT></P></LI></UL>
<UL>
<LI>
<P align=left><A href="#pract"><FONT color=#800000 
size=3><STRONG>Программка для практики</STRONG></FONT></A><FONT 
color=#800000 size=3><STRONG>;</STRONG></FONT></P>
<LI>
<P align=left><A href="problem"><FONT color=#800000 size=4><STRONG>Моя 
проблема...</STRONG></FONT></A></P></LI></UL>
<HR>

<P align=center><A name=letters><FONT size=5><STRONG>Ваши 
письма</STRONG></FONT></A></P>
<P>Дорогие мои! Я был очень рад получить от вас столько много писем по 
поводу клуба программистов. Почти все поддержали эту идею. Не забывайте, 
что сам клуб будете делать вы! Моя задача - объединить вас всех.</P>
<P>Кстати, на нашем сайте ( <A 
href="http://www.Kalashnikoff.ru/">http://www.Kalashnikoff.ru/</A> ) 
уже есть возможность посетить <FONT color=#008000 
size=4><STRONG>форум</STRONG></FONT> (наконец-то я сделал его!). Добро 
пожаловать!</P>
<P>Там также есть возможность ознакомиться с каждой отдельной рассылкой. 
Если раньше все выпуски я помещал в архив, то теперь любой желающий может 
взять отдельный выпуск и прочитать его (вдруг кто-то не получит выпуск по 
почте?). Тоже самое я сделал и для второй своей рассылки по правам 
потребителей.</P>
<P align=center>________________</P>
<P>Мне очень нравится, как вы уже разбираете программы для практики. 
Поверьте, мне это доставляет море удовольствия! Некоторые варианты и 
решения я разместил на сайте.</P>
<P align=center>_________________</P>
<P>Спасибо всем, кто голосует на сайте. Пока лидирует <EM>"Быстро DOS, а 
затем Win"</EM>. Быстро вовсе не означает "галопом по европам". <STRONG>Мы 
не перейдем к Win до тех пор, пока досконально не изучим DOS.</STRONG></P>
<P>В этом выпуске мы еще рассмотрим несколько новых операторов, а с 10 уже 
начнем писать программы (оболочка а-ля "Нортон Коммандер", вирус, 
резидент). Акцент будем делать на оболочку. На мой взгляд нам понадобится 
месяцев 5-6 для изучения DOS. Но я могу ошибаться..</P>
<HR>

<P align=center><A name=previous><FONT size=5><STRONG>Программа из 
прошлого выпуска.</STRONG></FONT></A></P>
<P align=left><FONT size=3>Надо мне научиться оформлять программы по 
другому, т.к. настоящее оформление очень корявое. Пока времени не хватает 
на все...</FONT></P>
<P align=left><FONT size=3>Давайте разберем программу из прошлого 
выпуска.</FONT></P>
<P align=left><FONT size=3>Вот она:</FONT></P>
<P align=center>_________________</P>
<P>...</P>
<P><EM>;опустим код CSEG и пр.</EM></P>
<P><FONT face="Courier New"><STRONG>(1) Begin: mov 
ax,3D00h</STRONG></FONT> <FONT color=#008080><EM>;будем открывать файл для 
чтения</EM></FONT></P>
<P><FONT color=#008080><EM>;обратите внимание, как мы записываем операторы 
(сразу за меткой). Так тоже можно</EM></FONT></P>
<P><FONT face="Courier New"><STRONG>(2) mov dx,offset 
File_name</STRONG></FONT> <FONT color=#008080><EM>;DS:DX указывают на путь 
к файлу</EM></FONT></P>
<P><FONT face="Courier New"><STRONG>(3) int 21h</STRONG></FONT> <FONT 
color=#800040><EM>;открываем</EM></FONT></P>
<P><FONT face="Courier New"><STRONG>(4) jc Error_file</STRONG></FONT> 
<FONT color=#008080><EM>;если произошла ошибка (нет такого файла, слишком 
много открытых файлов, ошибка чтения) - то на метку 
Error_file</EM></FONT></P>
<P><FONT face="Courier New"><STRONG>(5) mov Handle,ax</STRONG></FONT> 
<FONT color=#008080><EM>;запомним номер файла в переменной 
Handle</EM></FONT></P>
<P><FONT face="Courier New"><STRONG>(6) mov bx,ax</STRONG></FONT> <FONT 
color=#008080><EM>;для того, чтобы прочитать файл нужно в BX указать его 
номер, полученный после открытия. Он у нас в AX. Загрузка числа в регистр 
с другого регистра (а, тем более, если используется AX) происходит 
быстрее, чем с памяти (переменной). Поэтому загружаем с AX, а не с 
переменной. Хотя запись mov bx,Handle не будет ошибочной.</EM></FONT></P>
<P><FONT face="Courier New"><STRONG>(7) mov ah,3Fh</STRONG></FONT> <FONT 
color=#008080><EM>;функция 3Fh - чтение файла</EM></FONT></P>
<P><FONT face="Courier New"><STRONG>(8) mov cx,0FF00h</STRONG></FONT> 
<FONT color=#008080><EM>;будем читать 0FF00h</EM></FONT></P>
<P><FONT face="Courier New"><STRONG>(9) mov dx,offset 
Buffer</STRONG></FONT> <FONT color=#008080><EM>;DS:DX указывает на буфер в 
памяти для чтения</EM></FONT></P>
<P><FONT face="Courier New"><STRONG>(10)int 21h</STRONG></FONT> <FONT 
color=#800040><EM>;все готово. Читаем</EM></FONT></P>
<P><FONT face="Courier New"><STRONG>(11)mov ah,3Eh</STRONG></FONT> <FONT 
color=#008080><EM>;закрываем файл</EM></FONT></P>
<P><FONT face="Courier New"><STRONG>(12)mov bx,Handle</STRONG></FONT> 
<FONT color=#008080><EM>;номер файла должен быть в BX. Но т.к. он менялся, 
то загрузим его с нашей переменной (Handle)</EM></FONT></P>
<P><FONT face="Courier New"><STRONG>(13)int 21h</STRONG></FONT> <FONT 
color=#800040><EM>;закрываем файл</EM></FONT></P>
<P><FONT face="Courier New"><STRONG>(14)mov dx,offset 
Mess_ok</STRONG></FONT> <FONT color=#008080><EM>;загрузим в DX строку с 
сообщением о том, что все в порядке</EM></FONT></P>
<P><FONT face="Courier New"><STRONG>(15)Out_prog: mov ah,9</STRONG></FONT> 
<FONT color=#008080><EM>;функция 09h - вывод строки на экран (можно было и 
не писать!)</EM></FONT></P>
<P><FONT face="Courier New"><STRONG>(16)int 21h</STRONG></FONT> <FONT 
color=#800040><EM>;выводим строку</EM></FONT></P>
<P><FONT face="Courier New"><STRONG>int 20h</STRONG></FONT> <FONT 
color=#8080c0><EM><STRONG>;выходим из программы</STRONG></EM></FONT></P>
<P><FONT face="Courier New"><STRONG>(17)Error_file: mov dx,offset 
Mess_error</STRONG></FONT> <FONT color=#008080><EM>;загрузим в DX строку с 
сообщением о том, что не смогли открыть файл</EM></FONT></P>
<P><FONT face="Courier New"><STRONG>(18)jmp Out_prog</STRONG></FONT> <FONT 
color=#008080><EM>;и пойдем на метку Out_prog (зачем нам дублировать код, 
если он уже есть?)</EM></FONT></P>
<P><FONT color=#008000><STRONG>;Данные</STRONG></FONT></P>
<P>(19)Handle dw 0 <FONT color=#008000><EM>;резерв 2 байта для нашей 
переменной</EM></FONT></P>
<P>(20)Mess_ok db 'Файл загружен в память! Смотрите в отладчике!$' <FONT 
color=#008040><EM>;понятно</EM></FONT></P>
<P>(21)Mess_error db 'Не удалось открыть (найти) файл ' <FONT 
color=#008000><EM>;эти строки...</EM></FONT></P>
<P>(22)File_name db 'c:\msdos.sys',0,'!$' <FONT color=#008040><EM>;... 
рассмотрим ниже...</EM></FONT></P>
<P>(23)Buffer equ $ <FONT color=#008040><EM>;...</EM></FONT></P>
<P align=center>_________________</P>
<P>Для многих (я бы сказал, почти для всех) остались непонятными строки 
(21) - (23). Кто полазил в отладчике - много чего понял и узнал нового. 
Давайте подробней рассмотрим указанные команды.</P>
<P>Запомните оператор: $. При ассемблировании нашей программы Ассемблер 
заменит этот знак на адрес, по которому он расположен. Вот пример:</P>
<P>(1) CSEG segment</P>
<P>(2) assume cs:CSEG</P>
<P>(3) org 100h</P>
<P>(4) Begin:</P>
<P>(5) My_lab equ $</P>
<P>(6) My_lab2 equ $+2</P>
<P>(7) mov bx,offset My_lab</P>
<P>(8) mov bx,offset My_lab2</P>
<P>(9) int 20h</P>
<P>(10) CSEG ends</P>
<P>(11) end Begin</P>
<P>Строки (5) и (6) места в памяти не занимают (как и метки). Ассемблер 
(при ассемблировании) запомнит, что метка My_lab находится по адресу 100h 
(помните: org 100h?), а метка My_lab2 - 102h. Рекомендую Вам посмотреть в 
отладчике эту программу.</P>
<P>В программе из прошлого выпуска (как вы уже поняли) мы размещаем Buffer 
в конце кода. Т.о. оператор:</P>
<P>mov dx,offset Buffer</P>
<P>занесет в DX адрес (смещение) на первый свободный байт, расположенный
за телом программы, в нашем сегменте (CSEG). По этому адресу мы и будем 
загружать в память данные из файла. В отладчике это хорошо видно.</P>
<P>Что касается строк (21) - (22). На сколько вы помните из прошлых 
выпусков, функция 09h прерывания 21h выводит на экран строку. Сама строка 
должна заканчиваться символом $. Я уже говорил, что если этот знак убрать, 
то функция, выведя строку на экран, продолжит выводить остальные символы 
до тех пор, пока в памяти не встретится тот самый "бакс" - $.</P>
<P>Теперь внимательно смотрите на строки (21) - (22):</P>
<P>(21)Mess_error db 'Не удалось открыть (найти) файл '</P>
<P>(22)File_name db 'c:\msdos.sys',0,'!$'</P>
<P>Что мы видим? Мы видим то, что не видим в конце строки (21) символ $ 
(да простят меня за каламбур!). Функция 09h (если файл не был найден) 
выведет на экран следующее:</P>
<P><FONT face="Arial Cyr"><STRONG>Не удалось открыть (найти) файл 
c:\msdos.sys !</STRONG></FONT></P>
<P>Символ '0' будет отображен как пробел. А для чего нужен '0' в строке 
(22)? При открытии файла в DS:DX должен быть указан сам файл. Строка 
должна завершаться символом '0'. Если этот символ убрать, то функция 
скорее всего вернет ошибку. Ведь файла c:\msdos.sys!$ не существует!</P>
<P>Можем сделать и так, конечно. Только мы потеряем байты:</P>
<P>Mess_error db 'Не удалось открыть (найти) файл c:\msdos.sys!$'</P>
<P>File_name db 'c:\msdos.sys',0</P>
<P>Какой смысл?</P>
<P>Вот и разобрались... Мы будем очень часто на практике использовать 
данный метод. Поэтому, если у вас и остались "темные моменты", мы их 
постепенно "просветлим".</P>
<HR>

<P align=center><A name=pract><FONT size=5><STRONG>Программка для 
практики.</STRONG></FONT></A></P>
<P>Давайте поподробнее рассмотрим работу с файлами. Вот пример:</P>
<P>___________________</P>
<P>CSEG segment</P>
<P>assume cs:CSEG, ds:CSEG, es:CSEG, ss:CSEG</P>
<P>org 100h</P>
<P>; -------------- Начало -------------</P>
<P>Begin:</P>
<P>mov dx,offset File_name</P>
<P>call Open_file</P>
<P>jc Error_file</P>
<P>; -------------- Открыли файл -----------</P>
<P>mov bx,ax</P>
<P>mov ah,3Fh</P>
<P>mov cx,offset Finish-100h</P>
<P>mov dx,offset Begin</P>
<P>int 21h</P>
<P>; ------------- Прочитали файл ----------------</P>
<P>call Close_file</P>
<P>; ------------ Выводим сообщение --------------</P>
<P>mov ah,9</P>
<P>mov dx,offset Mess_ok</P>
<P>int 21h</P>
<P>ret</P>
<P>; ---------- Не смогли найти файл -----------------</P>
<P>Error_file:</P>
<P>mov ah,2</P>
<P>mov dl,7</P>
<P>int 21h</P>
<P>ret</P>
<P>; ======= Процедуры пошли... ==========</P>
<P>; --- Открытие файла ---</P>
<P>Open_file proc</P>
<P>cmp Handle,0FFFFh</P>
<P>jne Quit_open</P>
<P>mov ax,3D00h</P>
<P>int 21h</P>
<P>mov Handle,ax</P>
<P>ret</P>
<P>Quit_open:</P>
<P>stc</P>
<P>ret</P>
<P>Handle dw 0FFFFh</P>
<P>Open_file endp</P>
<P>; --- Закрытие файла ---</P>
<P>Close_file proc</P>
<P>cmp Handle,0FFFFh</P>
<P>je No_close</P>
<P>mov ah,3Eh</P>
<P>mov bx,Handle</P>
<P>int 21h</P>
<P>mov Handle,0FFFFh</P>
<P>No_close:</P>
<P>ret</P>
<P>Close_file endp</P>
<P>; ===== Данные ======</P>
<P>File_name db 'less009.com',0</P>
<P>Mess_ok db 'Все нормально!', 0Ah, 0Dh, '$'</P>
<P>Finish equ $</P>
<P>CSEG ends</P>
<P>end Begin</P>
<P>______________________</P>
<P><FONT color=#b31a11 size=4><STRONG>ВНИМАНИЕ: этот файл нужно сохранить 
как less009.asm!</STRONG></FONT></P>
<P>Вот работы вам на целую неделю!!!</P>
<P>Сложно. Очень сложно... Да и отладчик работать не будет... Что же 
делать-то? Ищите, экспериментируйте, пробуйте все варианты... Здесь много 
чего интересного!</P>
<HR>

<P align=center><A name=problem><FONT size=5><STRONG>Моя 
проблема.</STRONG></FONT></A></P>
<P>Друзья мои! Случилось непредвиденное. У меня появились проблемы с 
работой.</P>
<P>Мне очень горько об этом сообщать, но придется. Весь наш отдел попадает 
под сокращение (правда, предлагают очень хорошие условия (деньги платят)). 
Тем не менее, доступа к Сети у меня не будет какое-то время. Дома я не 
могу пользоваться, т.к. очень плохая АТС (шаговая). Я даже не могу 
получить почту. Не шлите, пожалуйста, пока письма...</P>
<P>В связи с этим рассылка уходит на вынужденный отпуск. На какой период - 
не знаю. <STRONG><U>Но очень надеюсь, что ненадолго.</U></STRONG> При 
первой же возможности я выйду на связь.</P>
<P>Естественно, у вас будут возникать вопросы по поводу Ассемблера. В 
связи с чем рискну оставить свой домашний телефон в Москве (огромная 
просьба: не злоупотребляйте этим!): 492-23-53. Если возникнут вопросы, на 
которые вы не сможете найти ответ ни на форуме, ни где-либо еще, то 
звоните мне. Я, конечно, понимаю, что многим будет сложно мне позвонить 
(межгород все-таки), но все-таки хоть что-то...</P>
<P>Я также буду благодарен вам за любые советы и предложения относительно 
работы (хотя варианты у меня пока есть).</P>
<P><FONT size=5><EM>Вот и все. Друзья мои! Не скучайте! Мы скоро 
увидимся!</EM></FONT></P>
<P>&nbsp;</P>
<P><STRONG>Удачи Вам!</STRONG></P>
<P><STRONG>С уважением,</STRONG></P>
<P><STRONG>Калашников Олег</STRONG> ( <A 
href="mailto:oleg77@online.ru?Subject=Ассемблер:"><FONT 
color=#0000ff>oleg77@online.ru?Subject=Ассемблер:</FONT></A> )</P>
<P><STRONG>Сайт: </STRONG><A 
href="http://www.Kalashnikoff.ru"><STRONG>www.Kalashnikoff.ru</STRONG></A></P></TD></TR></TBODY></TABLE></CENTER></DIV><!--noindex-->

<hr>

<p align="center">[<a href="010.htm">Следующий выпуск</a>] [<a target=_BLANK href="http://www.Kalashnikoff.ru/">На главную страницу</a>]</p>


<HR NOSHADE><CENTER>
<!-- SpyLOG v2 f:0211 --><script language="javascript">  
u="u496.71.spylog.com";d=document;nv=navigator;na=nv.appName;p=1;  
bv=Math.round(parseFloat(nv.appVersion)*100);  
n=(na.substring(0,2)=="Mi")?0:1;rn=Math.random();z="p="+p+"&rn="+rn;y="";  
y+="<a href='http://"+u+"/cnt?f=3&p="+p+"&rn="+rn+"' target=_blank>";  
y+="<img src='http://"+u+"/cnt?"+z+  
"&r="+escape(d.referrer)+"&pg="+escape(window.location.href)+"' border=0 width=88 height=31 alt='SpyLOG'>";  
y+="</a>"; d.write(y);if(!n) { d.write("<"+"!--"); }//--></script><noscript><p align="center"><a 
href="http://u496.71.spylog.com/cnt?f=3&amp;p=1" 
target="_blank"><img src="http://u496.71.spylog.com/cnt?p=1" alt="SpyLOG" align="middle" border="0"></a> 
<a href="http://u496.71.spylog.com/cnt?f=3&amp;p=1" target="_blank"></noscript></a> 
<a href="http://u496.71.spylog.com/cnt?f=3&amp;p=1" target="_blank"> 
<script language="javascript1.2"><!-- if(!n) { d.write("--"+">"); }//--></script></a> 
<!-- SpyLOG --> 
 
 <a target=_top href="http://www.one.ru"><img src="http://cnt.one.ru/cgi-bin/cnt.cgi?id=16871&t=9" width=88 height=31 alt="be number one" border=0></a> 
 
 <script language="JavaScript"><!-- 
d=document;a='';a+=';r='+escape(d.referrer) 
js=10//--></script><script language="JavaScript1.1"><!-- 
a+=';j='+navigator.javaEnabled() 
js=11//--></script><script language="JavaScript1.2"><!-- 
s=screen;a+=';s='+s.width+'*'+s.height 
a+=';d='+(s.colorDepth?s.colorDepth:s.pixelDepth) 
js=12//--></script><script language="JavaScript1.3"><!-- 
js=13//--></script><script language="JavaScript"><!-- 
d.write('<a href="http://top.list.ru/jump?from=87856"'+ 
' target=_top><img src="http://top.list.ru/counter'+ 
'?id=87856;t=54;js='+js+a+';rand='+Math.random()+ 
'" alt="TopList"'+' border=0 height=31 width=88></a>') 
if(js>11)d.write('<'+'!-- ')//--></script><noscript><a 
target=_top href="http://top.list.ru/jump?from=87856"><img 
src="http://top.list.ru/counter?js=na;id=87856;t=54" 
border=0 height=31 width=88 
alt="TopList"></a></noscript><script language="JavaScript"><!-- 
if(js>11)d.write('--'+'>')//--></script> 
 
<br><br> 

</BODY></HTML>
