<HTML><HEAD> 
<title>Калашников.ru - Ассемблер? Это просто!.. (Выпуск № 019)</title>
<STYLE><!-- a:link, a:visited, a:active { text-decoration: none; color: #226622} 
a:hover { text-decoration: bold; color: #662266; } 
 .ff { 
font-family : Arial, helvetica, sans-serif; 
font-style : normal; 
font-variant : normal; 
} --></STYLE>
</HEAD><BODY body bgcolor=#CFE7E7>

<P align=center><A 
href="http://ad.ir.ru/bb.cgi?cmd=go&pubid=128269&pg=2&vbn=10001&nocache=77524" 
target=_top><IMG alt="InterReklama " border=0 
src="http://ad.ir.ru/bb.cgi?cmd=ad&pubid=128269&pg=2&vbn=10001&nocache=77524"></A></P>
<P align=center><A href="http://www.ir.ru" target=_top><FONT size=1>InterReklama 
Advertising</FONT></A> </P>
<HR>

<div align="center"><center>

<table border="1" cellpadding="0" cellspacing="0" width="100%"
bgcolor="#CDCD9C">
<tr>
<td colspan="3" width="100%"><p align="center"><font
color="#004080" size="5"><em><strong>Ассемблер?
Это просто! Учимся
программировать</strong></em></font><font
color="#000000" size="2"><br>
______________________________________</font></p>
<p align="center"><font color="#000000" size="4">Выпуск
N 019 (</font><a href="#resident"><font size="4">Резидент</font></a><font
color="#000000" size="4">)</font></p>
</td>
</tr>
</table>
</center></div>

<p align="left"><font color="#000000" size="4"><strong>Сегодня
в рассылке:</strong></font></p>

<dir type="disc">
<li><p align="left"><a href="#enclosure"><font size="4">Новости
рассылки и сайта</font></a></p>
</li>
<li><p align="left"><a href="#letters">Ваши письма</a></p>
</li>
<li><p align="left"><a href="#resident">Резидент
вкратце</a></p>
</li>
</dir>

<hr>
<br>

<div align="center"><center>

<table border="0" cellpadding="0" cellspacing="0" width="100%"
bgcolor="#9CCDCD">
<tr>
<td align="center" width="100%"><a name="enclosure"><font
color="#004080" size="5"><strong>Новости
рассылки и сайта</strong></font></a></td>
</tr>
</table>
</center></div>

<p><font color="#000000" size="3">Дорогие мои
подписчики! Как видите, у нас
изменился внешний вид рассылки.
Если у вас есть что сказать по этому
поводу (стало хуже, плохо печатать
на ч/б принтере и т.п.), то пишите. Я
обязательно исправлю все изъяны.</font></p>

<p align="center"><font color="#000000" size="3">___________</font></p>

<p><font color="#000000" size="3">Но это не
главное. Главное то, что с
настоящего выпуска файл-приложение
будет всегда выходить вместе с
рассылкой! Теперь все просто! После
многочисленных откликов по поводу
рассылки, я все же сел и наконец-то
решил эту проблему. Надеюсь, что
теперь получение файла-приложения
не доставит вам хлопот...</font></p>

<p align="center"><font color="#000000" size="3">___________</font></p>

<p><font color="#000000" size="3">Посоветовавшись
с некоторыми подписчиками, я все же
пришел к выводу, что рассылку нужно
открыть свова (теперь она видна в </font><a
href="http://subscribe.ru/catalog/comp/soft/prog"><font size="3">каталоге
рассылок</font></a><font color="#000000" size="3">).
Так что наши ряды вновь
пополняются!</font></p>

<p align="center"><font color="#000000" size="3">___________</font></p>

<p><font color="#000000" size="3">Наш сайт уже
второй раз поменял адрес. Теперь мы
находимся на </font><a
href="http://www.Kalashnikoff.ru"><font size="4">http://www.Kalashnikoff.ru</font></a><font
color="#000000" size="3">. Думаю, что это
окончательный вариант. Вскоре
(после Нового года, а может и раньше)
будет и своя Гостевая книга там
(скрипты уже нашел кое-какие. Надо
только кое-чего подкорректировать
в них). Заходите, отмечайтесь!
Надеюсь, что попасть на этот сайт
будет гораздо проще, чем на newmail!</font></p>

<p><font color="#000000" size="3">Более того, нужно
освоиться с электронными адресами,
которые у меня появились. Будет
что-то вида </font><a href="mailto:oleg@kalashnikoff.ru"><font
color="#000000" size="3">oleg@kalashnikoff.ru</font></a><font
color="#000000" size="3"> и пр. Их количество неограниченно. Думаю, что к выходу
следующего выпуска я все настрою и
сообщу вам дополнительные
возможности, которые откроются для
вас.</font></p>

<p align="center"><font color="#000000" size="3">___________</font></p>

<p><font color="#000000" size="3">Предыдущий
выпуск № 18 (про оболочку) вышел под
номером 17 по моей ошибке. Если вы
удалили его, то возьмите на нашем
сайте либо напишите мне письмо с
просьбой его выслать.</font></p>

<hr>

<p><font color="#000000" size="2"><br>
</font></p>
<div align="center"><center>

<table border="0" cellpadding="0" cellspacing="0" width="100%"
bgcolor="#9CCDCD">
<tr>
<td align="center" width="100%"><a name="letters"><font
color="#004080" size="5"><strong>Ваши письма</strong></font></a></td>
</tr>
</table>
</center></div>

<p><font size="4">Новости для
пользователей программы Commands
Алексея Старчикова.</font></p>

<p><font size="3">В программе собираются
команды Ассемблера, которые мы
рассматриваем в рассылке.</font></p>

<p>Ниже приведено письмо Алексея:</p>

<p><em>Здравствуйте!<br>
Хочу сообщить вам, что я сделал
сайт, посвященный моей программе.<br>
Адрес: </em><a href="http://www.vunder.newmail.ru/"><em>http://www.vunder.newmail.ru/</em></a><em>.<br>
Там вы можете найти некоторую информацию о программе и скачать ее
последнюю версию.</em></p>

<p><em>С уважением,<br>
Старчиков Алекей. ( </em><a
href="mailto:vunder@spb.cityline.ru"><em>vunder@spb.cityline.ru</em></a><em>
)</em></p>

<p align="center">_________</p>

<p><font size="4">Благодарности экспертам.</font></p>

<p>К сожалению, моя идея с экспертами
работает немножко не так, как
хотелось бы. Вопросов мало (а раньше
их было так много, что думал никогда
в жизни не отвечу!), далеко не все
эксперты отвечают на высланные им
вопросы, не все подписчики высылали
мне оценку... Пришлось самому
смотреть и оценивать...</p>

<p>Кстати, была ошибка (точнее,
упущение) с моей стороны, которая
заключалась в том, что никто не мог
отправить письмо экспертам
напрямую, т.к. у меня на eGroups стояла
&quot;галочка&quot;, которая запрещала
отправлять письма экспертам, если
отправитель не входит в ту или иную
экспертную группу. Теперь все
исправил. Можете отправлять. Чтобы
получить адреса экспертов,
необходимо отправить мне письмо по
адресу <a href="mailto:assmbler@beep.ru?Subject=Experts">assmbler@beep.ru?Subject=Experts</a>.
Обратите внимание на то, что в поле
&quot;Тема&quot; вашего письма должно
быть слово &quot;Experts&quot;. В таком
случае адреса экспертов будут
высланы вам автоматически, что
ускорит ответ.</p>

<p>Тем не менее, можно подвести
кое-какие результаты. Но прежде
хочу поблагодарить всех экспертов,
которые отвечали на вопросы
подписчиков. Всего было отправлено
25 ответов (что не так и много!).</p>

<p><font size="4"><strong>Первое почетное
место:</strong></font></p>

<p>Больше всего &quot;досталось&quot;
эксперту с именем <font size="4"><strong>Slava V</strong></font>.
( <a href="mailto:debug_inc@mailru.com">debug_inc@mailru.com</a>
). На его счету 11 ответов, причем,
ответов грамотных и подробных,
которые изложены на простом языке.
Поздравляю тебя, Слава!!! Надеюсь,
что и впредь ты будешь в нашей
экспертной группе.</p>

<p><font size="4"><strong>Второе почетное
место:</strong></font></p>

<p>На мой взгляд второе место
получают Михаил Юрьевич ( <a
href="mailto:micks@azov.donpac.ru">micks@azov.donpac.ru</a> ) и
K.A. Nick ( <a href="mailto:ILUH_1@mail.ru">ILUH_1@mail.ru</a> ).
На их счету по два полных ответа.
Попрошу вас, Михаил и K. A. Nick, выслать
мне информацию, которую Вы бы
хотели разместить в рассылке для
подписчиков.</p>

<p><font size="4"><strong>Третье почетное
место:</strong></font></p>

<p>Мне кажется, что третье место
можно разделить между:</p>

<ul>
<li>Pavel Bakhtin ( <a href="mailto:pavel@ccc.kcn.ru">pavel@ccc.kcn.ru</a>
);</li>
<li>Denis Sizikov ( <a href="mailto:dsizikov@mail.kz">dsizikov@mail.kz</a>
);</li>
<li>Zakker ( <a href="mailto:zaccer@altavista.net">zaccer@altavista.net</a>
);</li>
<li>Владимир ( <a href="mailto:mefistofel@nm.ru">mefistofel@nm.ru</a>
);</li>
<li>Seam ( <a href="mailto:seam@aport.ru">seam@aport.ru</a>
);</li>
<li>Artos ( <a href="mailto:artos@run.ru">artos@run.ru</a> ).</li>
</ul>

<p>Спасибо всем! Я надеюсь, что
вопросов будет поступать больше, и
я смогу более точнее распределить
места между экспертами...</p>

<hr>

<p><font color="#000000" size="2"><br>
</font></p>
<div align="center"><center>

<table border="0" cellpadding="0" cellspacing="0" width="100%"
bgcolor="#9CCDCD">
<tr>
<td align="center" width="100%"><a name="resident"><font
color="#004080" size="5"><strong>Резидент</strong></font></a></td>
</tr>
</table>
</center></div>

<p>&nbsp;</p>

<p align="center"><font size="4"><!--webbot bot="Validation"
b-value-required="TRUE" i-minimum-length="1" i-maximum-length="80" --><textarea name="description" rows="13"
cols="68">;RESID19.ASM - программа к рассылке № 19

; (С) Авторское право принадлежит подписчикам рассылки &quot;Ассемблер? Это просто! Учимся программировать&quot;
; Автор рассылки: Калашников Олег Александрович (e-mail: Assembler@Kalashnikoff.ru)
; http://www.Kalashnikoff.ru

; --- Ассемблирование ---
;При использовании MASM:
;ML.EXE resid19.asm /AT

;При использовании TASM:
;TASM.EXE resid19.asm
;TLINK.EXE resid19.obj /t/x

;В итоге получаем resid19.COM, а НЕ resid19.EXE!
;______________________________________________________

; === Начало программы: ===
 .286
cseg segment
assume cs:cseg, ds:cseg, ss:cseg, es:cseg
org 100h

Begin:
 jmp Init ; на метку инициализации

; === Обработчик 21h-ого прерывания ===
Int_21h_proc proc
 cmp ax,9889h
 jne Next_step

 xchg ah,al
 iret

Next_step:
 pusha;Сохраним регистры...
 push ds
 push es

 mov bx,ds;BX=DS

 push cs;Настроим сегментные регистры
 push cs
 pop es
 pop ds

 cmp ax,4B00h;Это запуск файла на выполнение?
 je Start_f

 cmp ah,39h;Это создание каталога?
 je Create_dir

 cmp ah,3Ah;Это удаление каталога?
 je Delete_dir

 cmp ah,3Bh;Это смена каталога?
 je Change_dir

 cmp ah,3Ch;Это создание файла?
 je Create_file

 cmp ax,3D02h;Это открытие файла для чтения/записи?
 je Open_fl

 cmp ah,41h;Это удаление файла?
 je Delete_file

 jmp short Go_21h ;Если что-то другое, то передадим управление 21h-ому...

Start_f:
 mov si,offset Start_filemess ;Строка для записи в наш log-файл.
 call Move_string ;Готовим строку и записываем ее в файл...
 jmp short Go_21h ;Передадим управление 21h-ому прерыванию...

Create_dir:
 mov si,offset Create_dirmess
 call Move_string
 jmp short Go_21h

Delete_dir:
 mov si,offset Delete_dirmess
 call Move_string
 jmp short Go_21h

Change_dir:
 mov si,offset Change_dirmess
 call Move_string
 jmp short Go_21h

Create_file:
 mov si,offset Create_filemess
 call Move_string
 jmp short Go_21h

Open_fl:
 mov si,offset Open_filemess
 call Move_string
 jmp short Go_21h

Delete_file:
 mov si,offset Delete_filemess
 call Move_string


Go_21h:
 pop es;Восстановим регистры...
 pop ds
 popa

jmp dword ptr cs:[0FCh] ;Передаем управеление 21h-ому
Int_21h_proc endp

;=== Переносим строку и пишем информацию в файл ===
Move_string proc
mov di,2 ;DS:SI указывают на строку
 ;ES:DI - на место в памяти, где будет формироваться строка...
lodsw;Получим длину строки (первый байт строки)
mov cx,ax ;Длину строки в CX
rep movsb ;Переместили строку по адресу ES:DI (Текущий сегмент:0002h)

push ds
mov ds,bx ;DS указывает на сегмент, где находится имя файла
mov si,dx ;SI - на смещение

Next_char:
lodsb ;Получаем очередной символ
or al,al;Это конец строки с именем файла? Проверка на 0...
jz Zero_found ;
stosb ;Если еще не конец - заносим его в нашу формирующуюся строку
jmp short Next_char ;Следующий символ...

Zero_found:
pop ds;Имя файла перенсли! Восстановим DS

mov ax,0A0Dh ;Добавим возврат каретки/переод строки.
stosw

dec di
dec di
mov word ptr cs:[0],di ;Занесем по 0-ому смещению длину готовой строки

call Save_file;Запишем готовую строку в наш log-файл...

ret
Move_string endp


;=== Пишем в файл ===
Save_file proc
 call Check_file ;Проверим, существует ли наш log-файл или нет...

 mov al,02h;Открываем файл для чтения/записи
 call Open_file

 mov ax,4202h ;Устанавливаем указатель на конец файла
 xor cx,cx
 xor dx,dx
 int 3

 mov ah,40h;Функция записи в файл
 mov cx,cs:[0] ;Количество записываемых байт
 mov dx,2;Откуда будем писАть (DS:DX)
 int 3

 call Close_file ;Закрываем файл...

 ret
Save_file endp

;=== Проверяем: существует ли нужный файл ===
Check_file proc
 xor al,al;Пробуем открыть наш log-файл
 call Open_file
 jnc File_exists ;Если файл существует, то на метку File_exists

; === Атрибуты файла ===
;00001 - только чтение
;00010 - спрятанный
;00100 - системный
;01000 - метка тома
;010000 - подкаталог
;100000 - архивный
 mov ah,3Ch;Если файл не существует, то создадим его
 mov cx,100010b ;атрибут - архивный, спрятанный
 mov dx,offset File_name ;DS:DX указывают на имя файла
 int 3
 jc Error_create ;Ошибка?..
 mov Handle,ax ;Если успешно создали, то запомним номер файла

File_exists:
 call Close_file ;Закрываем файл...

Error_create:
 ret

File_name db 'C:\report.txt',0;Наш log-файл
Check_file endp

;=== Открытие файла ===
Open_file proc
 mov dx,offset File_name
 mov ah,3Dh
 int 3
 jc Error_open

 mov bx,ax
 mov Handle,ax

Error_open:
 ret
Handle dw 0FFFFh
Open_file endp

;=== Закрытие файла ===
Close_file proc
 pusha
 pushf
 cmp Handle,0FFFFh ;Нечего закрывать?..
 je No_close

 mov ah,3Eh
 mov bx,Handle
 int 3
 mov Handle,0FFFFh ;Отметим то, что нет открытых файлов...

No_close:
 popa
 popf
 ret
Close_file endp

;--- Сообщения резидента ---
Start_filemess dw Start_filemessl
 db 'Запуск файла---&gt; '
Start_filemessl equ $-Start_filemess-2

Create_dirmess dw Create_dirmessl
 db 'Создание каталога ---&gt; '
Create_dirmessl equ $-Create_dirmess-2

Delete_dirmess dw Delete_dirmessl
 db 'Удаление каталога ---&gt; '
Delete_dirmessl equ $-Delete_dirmess-2

Change_dirmess dw Change_dirmessl
 db 'Смена каталога на ---&gt; '
Change_dirmessl equ $-Change_dirmess-2

Create_filemess dw Create_filemessl
db 'Создание файла---&gt; '
Create_filemessl equ $-Create_filemess-2

Open_filemess dw Open_filemessl
db 'Открытие файла для чтения/записи ---&gt; '
Open_filemessl equ $-Open_filemess-2

Delete_filemess dw Delete_filemessl
db 'Удаление файла---&gt; '
Delete_filemessl equ $-Delete_filemess-2




; === Инициализация (подготовка и настройка резидента) ===
Init:
 mov ax,9889h ;проверим, в памяти ли мы уже или еще нет
 int 21h
 cmp ax,8998h
 jne Set_resident

 mov ah,9 ;если в памяти, то выведем соответствующее сообщение
 mov dx,offset In_memory
 int 21h

 ret ;...и вернемся в DOS

Set_resident: ;если нас в памяти нет, то установим наш резидент
; 21h-ое...
 mov ax,3521h
 int 21h ;получим и сохраним адрес (вектор) 21h прерывания
 mov word ptr cs:[0FCh],bx
 mov word ptr cs:[0FEh],es

 mov ax,es;Установим старый вектор 21h-прерывания на 3...
 push 0 ;(вырубим отладчик)
 pop es
 mov es:[3*4],bx
 mov es:[3*4+2],ax

 mov ax,2521h
 mov dx,offset Int_21h_proc
 int 3;&quot;повесим&quot; нашу процедуру на 21h прерывание

 call Check_file ;А есть ли наш log-файл?

 mov ah,9
 mov dx,offset Mess_hello
 int 21h

 mov dx,offset Init
 int 27h;оставим программу резидентной в памяти.

In_memory db 'Программа уже загружена в память!!!!',0Ah,0Dh,0Ah

Mess_hello db 'Резидент к рассылке № 019 &quot;Ассемблер? Это просто! Учимся программировать&quot;.',0Ah,0Dh,0Ah
 db 'Автор: Калашников Олег Александрович (Assembler@Kalashnikoff.ru),',0Ah,0Dh
 db 'http://www.Kalashnikoff.ru, Россия, Москва, 2000 год.',0Ah,0Dh,'$'

cseg ends
end Begin</textarea></font></p>

<p><strong>Как переписать
файл-приложение в DOS-файл (так, как
мы скачивали с сайта раньше)?</strong></p>

<p>Для этого:</p>

<ul>
<li><em>отметьте &quot;мышкой&quot; все,
что находится в приведенном
выше окне;</em></li>
<li><em>нажмите Ctrl+Insert;</em></li>
<li><em>запустите DOS Navigator или FAR;</em></li>
<li><em>нажмите Shift+F4;</em></li>
<li><em>введите имя файла RESID19.ASM;</em></li>
<li><em>нажмите Shift+Insert;</em></li>
<li><em>нажмите F2;</em></li>
<li><em>выходите в DOS и
ассемблируйте!</em></li>
</ul>

<p>Приступаем к изучению резидента.
Прежде всего разберемся, что он
делает.</p>

<p>Итак, после загрузки в память,
резидент перехватывает 21h-ое
прерывание. Затем отслеживает
некоторые действия программ
(функции, которые они вызывают) и
записывает информацию в свой так
сказать log-файл. А функции
следующие:</p>

<p>AX = 4B00h ;Запуск файла на выполнение<br>
AH = 39h ;Создание каталога<br>
AH = 3Ah ;Удаление каталога<br>
AH = 3Bh ;Смена каталога<br>
AH = 3Ch ;Создание файла<br>
AX = 3D02h ;Открытие файла для
чтения/записи<br>
AH = 41h ;Удаление файла</p>

<p>Для выполнения всех этих функций
21h-ого прерывания в регистрах DS:DX
должно быть указано имя файла или
каталога. Поэтому мы выполняем одни
и те же действия, если какая-либо функция вызвалась. Постарайтесь
запомнить приведенные выше
функции!</p>

<p>Примеры:</p>

<p><em>Создание каталога:</em><br>
mov ah,39h<br>
mov dx,offset Directory<br>
int 21h</p>

<p><em>Удаление файла:</em><br>
mov ah,39h<br>
mov dx,offset File<br>
int 21h</p>

<p>и т.д. кроме функции 4B00h. Помимо
указания файла для запуска в DS:DX,
нужно еще подготовиться хорошо. Но
это позже рассмотрим...</p>

<p><strong>Что конкретно мы делаем?</strong></p>

<p>Как вы уже знаете, программы типа
*.com начинаются со смещения 100h. От 0
до 0FFh находится т.н. PSP (Prefix Program Segment).
Некоторые поля PSP вы уже знаете.
Например, по смещению 0 находится
команда INT 20h, а по смещению 80h - DTA и
изначально командная строка.
Оставляя резидент в памяти, мы
оставляем и PSP (т.е. &quot;лишние&quot; 100h
байт). Получается, что 100h байт
постоянно висит в памяти... Вы уже,
возможно, заметили, что наши
предыдущие резиденты занимали
памяти больше, чем их реальный
размер. Это-то как раз и связано с
тем, что в памяти &quot;висит&quot; PSP
программы (плюс еще строка
окружения, но об этом попозже).</p>

<p>У нас есть несколько способов
избежать размещения лишних байт в
памяти:</p>

<p>1. Сделать так, чтобы программа в
памяти начиналась не со смещения
100h, а со смещения 0. Однако, здесь
возможны некоторые проблемы. Об
этом позже.</p>

<p>2. Разместить в нашей свободной
области стек (временно, т.е. на то
время, пока работают наши
обработчики прерываний). Тоже
можно...</p>

<p>3. Сделать в области PSP буфер (т.е.
задействовать эту память для
временного хранения данных,
которые не превышают 100h байт).</p>

<p>Я предпочитаю всегда
использовать 3 способ (хотя иногда и
2 использую). В настоящем резиденте
мы так и сделаем. Для чего нужен нам
буфер, сейчас рассмотрим.</p>

<p>Как я уже говорил, мы
перехватываем указанные выше
функции 21h-прерывания и фиксируем
действия программ, которые
вызывают данное прерывание в нашем
log-файле (c:\report.txt).</p>

<p>Теперь смотрим, что делает
обработчик 21h-прерывания:</p>

<p>cmp ax,4B00h<br>
je Start_f</p>

<p>cmp ah,39h ;Это создание каталога?<br>
je Create_dir</p>

<p>...</p>

<p>jmp short Go_21h ;Если что-то другое, то
передадим управление 21h-ому...</p>

<p>&nbsp;</p>

<p>Start_f:<br>
mov si,offset Start_filemess ;Строка для записи в
наш log-файл.<br>
call Move_string ;Готовим строку и
записываем ее в файл...<br>
jmp short Go_21h ;Передадим управление
21h-ому прерыванию...<br>
</p>

<p>Create_dir:<br>
mov si,offset Create_dirmess<br>
call Move_string<br>
jmp short Go_21h</p>

<p>...</p>

<p>Здесь мы вначале проверили,
запускает ли кто-то файл на
выполнение или нет. Затем проверяем
другие функции, которые могут
вызываться. Допустим, некто
пытается создать каталог (функция
39h). Тогда мы передаем управление на
метку Create_dir (создание каталога). Это
видно на приведенном выше примере.
Затем в SI заносится адрес строки
Create_dirmess:</p>

<p>Create_dirmess dw Create_dirmessl<br>
db 'Создание каталога ---&gt; '<br>
Create_dirmessl equ $-Create_dirmess-2</p>

<p>Как видите, первые два байта
адреса, который заносится в SI
содержат длину строки. Обратите
внимание, как мы просто получаем
длину строки! Вместо Create_dirmessl
программа-ассемблер (MASM / TASM)
поставят длину строки, которая
вычисляется таким способом:</p>

<p>Create_dirmessl equ $-Create_dirmess-2</p>

<p>Т.е. $ (текущее смещение) минус
смещение Create_dirmess минус два (т.к.
первые два байта - и будут указывать
на длину строки). После этого
временная переменная (которая не
будет занимать памяти; она нужна
только для MASM / TASM) (Сreate_dirmessl) будет
равна длине строки. <strong>Пожалуйста,
внимательно изучите приведенные
выше примеры! </strong>Вы должны понять
принцип...</p>

<p>Как только занесли в SI адрес троки
(первые два байта корой будут
указывать на длину строки),
вызываем процедуру Move_string. При этом
в BX будет находиться сегмент
строки, которую передала некая
программа.</p>

<p>В общем, принцип такой: процедура
Move_string заносит по смещению 0
сегмента, в котором находится наш
резидент (т.е. в область PSP)
соответствующую строку (например,
&quot;Создание каталога ---&gt; &quot;),
после нее заносится имя файла (то,
что получаем в регистрах DS:DX. Это
может быть как только имя файла, так
и полный путь к файлу, т.е. диск:\
каталог\имя_файла - c:\My_dir\file.ext.). Вот
это мы и записываем по смещению 0
сегмента, в котором находится наша
программа. Вот, что мы получим в
итоге:</p>

<p>Допустим, кто-то создает каталог
c:\assm\directory:</p>

<p>Создание каталога ---&gt; c:\assm\directory.</p>

<p>Приведенная выше строка
запишется в файл. Думаю, что труда
разобраться с резидентом не
составит, тем более, что после
каждой строки идет комментарий. Вы
уже сами можете написать подобный
резидент, опираясь на нашу
рассылку.</p>

<p>Что нужно вынести вам из этого
урока?</p>

<p>Вам нужно разобрать резидент и
понять его работу. Вы должны
разобрать алгоритмы, если, конечно,
хотите выучить Ассемблер.</p>

<p>Отмечу лишь некоторые аспекты.</p>

<p>Мы перехватываем 21h-прерывание,
помещая его адрес в 03h-прерывание.
Это значит, что многие отладчики
просто &quot;обломаются&quot;. Обратите
внимание, как мы вызываем 21h-ое
прерывание в нашем обработчике...</p>

<p>В принципе, наш резидент очень
простой. Вам достаточно
разобраться с описанием в
файле-приложении. Надеюсь, что
труда не составит. Все очень просто.
<strong><u>Главное - обращайте внимание
на алгоритмы</u></strong>.</p>

<p>Более подробно работу данного
резидента мы рассмотрим в
следующем веке...</p>

<p>Еще скажу, что мы постараемся со
временем сделать данный резидент
более гибким и
многофункциональным. Как пишем
нашу оболочку...</p>

<p align="center">____________</p>

<p>Данный выпуск предпраздничный.
Поэтому буду краток.</p>

<p>Все поздравляю Вас с наступающим
Новым годом. Желаю счастья, удачи,
любви и материального
благополучия. Надеюсь, что в новом
веке мы будем вместе, как и прежде.</p>
<hr> 
<p><font size="4"><em><strong>С уважением,</strong></em></font></p> 
<p><font size="3" face="Arial Cyr"><strong>Автор 
рассылки:</strong> Калашников Олег</font><font 
color="#000000" size="2"><br> 
</font><font size="3" face="Arial Cyr"><strong>URL сайта 
подписчиков:</strong> </font><a 
href="http://www.Kalashnikoff.ru"><font size="3" 
face="Arial Cyr">http://www.Kalashnikoff.ru</font></a><font 
color="#000000" size="2"><br> 
</font><font size="3" face="Arial Cyr"><strong>E-mail для 
вопросов:</strong> </font><a 
href="mailto:Assembler@Kalashnikoff.ru"><font size="3" face="Arial Cyr">Assembler@Kalashnikoff.ru</font></a><font 
color="#000000" size="2"><br> 
</font><font size="3" face="Arial Cyr"><strong>UIN:</strong> 
68951340</font></p> 
 
<p><font size="3">Москва, 2000.</font></p> 
 
<hr> 
<div align="center"><center> 
 
<table border="0" cellpadding="0" cellspacing="0" width="100%" 
bgcolor="#DDEEFF" bordercolor="#808080" 
bordercolorlight="#FFFFFF"> 
<tr> 
<td colspan="3" bgcolor="#BDDEFF"><font color="#400040" 
size="1"><strong>(C) Авторское право.</strong> 
Запрещается использование материала из рассылки в коммерческих целях без 
письменного согласия автора.</font></td> 
</tr> 
</table> 
</center></div>

<hr>

<p align="center">[<a href="020.htm">Следующий выпуск</a>] [<a target=_BLANK href="http://www.Kalashnikoff.ru/">На главную страницу</a>]</p>

<HR NOSHADE><CENTER>
<!-- SpyLOG v2 f:0211 --><script language="javascript">  
u="u496.71.spylog.com";d=document;nv=navigator;na=nv.appName;p=1;  
bv=Math.round(parseFloat(nv.appVersion)*100);  
n=(na.substring(0,2)=="Mi")?0:1;rn=Math.random();z="p="+p+"&rn="+rn;y="";  
y+="<a href='http://"+u+"/cnt?f=3&p="+p+"&rn="+rn+"' target=_blank>";  
y+="<img src='http://"+u+"/cnt?"+z+  
"&r="+escape(d.referrer)+"&pg="+escape(window.location.href)+"' border=0 width=88 height=31 alt='SpyLOG'>";  
y+="</a>"; d.write(y);if(!n) { d.write("<"+"!--"); }//--></script><noscript><p align="center"><a 
href="http://u496.71.spylog.com/cnt?f=3&amp;p=1" 
target="_blank"><img src="http://u496.71.spylog.com/cnt?p=1" alt="SpyLOG" align="middle" border="0"></a> 
<a href="http://u496.71.spylog.com/cnt?f=3&amp;p=1" target="_blank"></noscript></a> 
<a href="http://u496.71.spylog.com/cnt?f=3&amp;p=1" target="_blank"> 
<script language="javascript1.2"><!-- if(!n) { d.write("--"+">"); }//--></script></a> 
<!-- SpyLOG --> 
 
 <a target=_top href="http://www.one.ru"><img src="http://cnt.one.ru/cgi-bin/cnt.cgi?id=16871&t=9" width=88 height=31 alt="be number one" border=0></a> 
 
 <script language="JavaScript"><!-- 
d=document;a='';a+=';r='+escape(d.referrer) 
js=10//--></script><script language="JavaScript1.1"><!-- 
a+=';j='+navigator.javaEnabled() 
js=11//--></script><script language="JavaScript1.2"><!-- 
s=screen;a+=';s='+s.width+'*'+s.height 
a+=';d='+(s.colorDepth?s.colorDepth:s.pixelDepth) 
js=12//--></script><script language="JavaScript1.3"><!-- 
js=13//--></script><script language="JavaScript"><!-- 
d.write('<a href="http://top.list.ru/jump?from=87856"'+ 
' target=_top><img src="http://top.list.ru/counter'+ 
'?id=87856;t=54;js='+js+a+';rand='+Math.random()+ 
'" alt="TopList"'+' border=0 height=31 width=88></a>') 
if(js>11)d.write('<'+'!-- ')//--></script><noscript><a 
target=_top href="http://top.list.ru/jump?from=87856"><img 
src="http://top.list.ru/counter?js=na;id=87856;t=54" 
border=0 height=31 width=88 
alt="TopList"></a></noscript><script language="JavaScript"><!-- 
if(js>11)d.write('--'+'>')//--></script> 
 
<br><br> 

</BODY></HTML>