<html>

<head>
<meta http-equiv="Content-Type"
content="text/html; charset=windows-1251">
<title>Калашников.ru - Ассемблер? Это просто!.. (Выпуск № 014)</title>
</head>

<body bgcolor="#FFFFFF">

<P align=center><A 
href="http://ad.ir.ru/bb.cgi?cmd=go&pubid=128269&pg=2&vbn=10001&nocache=77524" 
target=_top><IMG alt="InterReklama " border=0 
src="http://ad.ir.ru/bb.cgi?cmd=ad&pubid=128269&pg=2&vbn=10001&nocache=77524"></A></P>
<P align=center><A href="http://www.ir.ru" target=_top><FONT size=1>InterReklama 
Advertising</FONT></A> </P>
<HR>

<div align="center"><center>

<table border="3" cellpadding="3" cellspacing="3" width="100%"
bgcolor="#8DC7C7" bordercolor="#000040">
<tr>
<td width="100%"><div align="center"><center><table
border="3" cellpadding="3" cellspacing="3" width="100%"
bgcolor="#009797" bordercolor="#000040">
<tr>
<td width="100%"><p align="center"><font size="5"><strong>Доброе
время суток, друзья мои!</strong></font></p>
<hr>
<p align="center"><font size="4"><em><strong>Выпуск
N 014</strong></em></font></p>
</td>
</tr>
</table>
</center></div><p align="right"><em>Какой
чудесный день!</em></p>
<p align="right"><em>Какой крутой мой
&quot;Пень&quot;!</em></p>
<p align="right"><em>Какой веселый я:</em></p>
<p align="right"><em>Рассылочка пришла!</em></p>
<hr>
<p align="center"><font size="4"><em><strong>Чего у
нас сегодня-то?</strong></em></font></p>
<ul>
<li><a href="#clarify"><font color="#800040" size="3"><strong>Заметки,
вопросы, новости</strong></font></a></li>
<li><a href="#experts"><font color="#800040"><strong>Создается
клуб экспертов</strong></font></a><font
color="#800040"><strong> !!!</strong></font></li>
<li><a href="#letters"><font color="#800040">Ваши
письма</font></a></li>
<li><a href="#shell"><font color="#800040">Оболочка
Super Shell!</font></a></li>
</ul>
<hr>
<p align="center"><a name="clarify"><font size="4"><strong>Заметки,
вопросы, новости</strong></font></a></p>
<p>Ох, друзья мои! Ну и болел же я!
Целую неделю. К сожалению, так и
не смог выпустить этот номер
рассылки вовремя. В связи с
этим прошу прощения за такую
длинную задержку. Хотелось бы и
вас предупредить: будьте
осторожны! Не болейте!</p>
<hr>
<p>Дорогие мои подписчики! Я
печатаю рассылку для того,
чтобы вы научились писать
программы на Ассемблере. Более
того, я очень хочу привить у вас
любовь к самому языку и
показать то, что он не такой уж
сложный. Я очень рад тому, что
многие используют информацию с
рассылки для написания
контрольных и/или лабораторных
работ. Я просто счастлив, что
смог кому-то помочь!</p>
<p>Однако, я <strong>был бы</strong>
очень разочарован, узнав, что
информация из рассылки <em>&quot;Ассемблер?
Это просто! Учимся
программировать&quot;</em>
используется кем-то в
коммерческих целях. Прошу вас:
уважайте, пожалуйста, чужой
труд! Если у вас есть
предложение по использованию
информации в рассылке не
только для собственного,
частного использования, но и в
коммерческих целях (сюда <strong>НЕ</strong>
входит написание собственных
рефератов, контрольных и
лабораторных работ и т.п.), то,
будьте так добры: напишите мне
ваше предложение! Мы найдем
общий язык!</p>
<p>В противном случае, мне
придется поступать по всей
строгости Закона РФ <strong>&quot;Об
авторских и смежных правах&quot;</strong>.</p>
<p align="center">____________________</p>
<p>Ко мне пришло много писем с
просьбой включить e-mail в базу
данных с тем, чтобы
автоматически высылать вам
файлы-приложения к рассылке
(sshell.asm, virus.asm, resid.asm). Я отправляю
их порциями по 10-20 адресам.
Верю, что все подписчики
порядочные и солидные люди. <strong>Однако,
если кто-либо получит
некоторое подобие спама</strong>,
используя адреса,
перечисленные в поле
&quot;Кому:&quot;, сообщите мне об
этом. Будем таких искать и
безбожно бить ногами...</p>
<p align="center">___________________</p>
<p align="left"><strong>Почему мы пишем
только *.com файлы?</strong> Да
потому, что модель памяти в Windows
очень напоминает модель памяти
*.com-файлов, которые мы сейчас
рассматриваем. Конечно, мы
напишем несколько примеров
*.exe-файлов, но это будет
попозже.</p>
<p align="left"><em>К слову.</em> Модель
памяти в *.com-файлах называется
TINY (крошечная). В Windows - FLAT
(плоская или как это?).</p>
<p align="center">____________________</p>
<p>Хочу спросить у образованных
людей: есть ли в русском языке
слово <strong>&quot;запомненный&quot;</strong>?
Если нет, то каким словом его
можно заменить?</p>
<p><em>Пример: &quot;Достаем со стека
</em><em><u>запомненный</u></em><em>
адрес строки&quot;.</em></p>
<p>Спасибо!</p>
<p align="center">____________________</p>
<p>Совсем недавно я поместил на <a
href="http://www.Kalashnikoff.ru"><font color="#0000FF">сайт</font></a>
свой <strong>небольшой фотоальбом</strong>,
в котором можно посмотреть
фотографии моей жены, сына,
брата, сестры, отца, матери, а
также меня лично. Если Вам
интересно, то можете заглянуть
в свободное время...</p>
<hr>
<p align="center"><a name="experts"><font size="4"><strong>Создается
клуб экспертов</strong></font></a></p>
<p><strong>Итак, время пришло!</strong>
Некоторые уже ознакомились с
условиями на <a
href="http://www.Kalashnikoff.ru/Experts.htm">сайте</a>,
но я все же рекомендую
прочитать то, что находится в
данном разделе рассылки,
причем <strong><u>всем</u></strong>
подписчикам.</p>
<p>Не все имеют прямой и
постоянный выход в Сеть. В
связи с этим я постараюсь
вкратце объяснить суть нашего
так сказать эксперимента.</p>
<p><strong>Почему я решил сделать
это?</strong></p>
<p>Ко мне приходит много писем с
различными вопросами (как по
Ассемблеру, так и по другим
темам; например, по работе с DOS).
Я, как уже писал, не успеваю
отвечать на все ваши письма.
Поэтому я решил провести
небольшой эксперимент: создать
т.н. <em>&quot;Клуб экспертов&quot;</em>.</p>
<p><strong>Что из себя представляет
этот (как его?) &quot;Клуб
экспертов&quot;?</strong></p>
<p>В него может войти любой
человек, который решит принять
на себя ответственное и
непростое задание и попробоваться в роли
&quot;учителя&quot;, стать т.н.
экспертом. Или, проще говоря,
отвечать компетентно на
вопросы подписчиков. Например:</p>
<ul>
<li>Вася не умеет работать с DOS
(не знает, как запустить
программу, распаковать
файл, как пользоваться MASM /
TASM и пр.);</li>
</ul>
<ul>
<li>У Пети возник вопрос по
поводу работы
дизассемблера;</li>
</ul>
<ul>
<li>Саша написал свою
программу, используя
знания полученные из
рассылки, но - вот беда! -
она не работает так, как
Саша хотел бы. Что делать?</li>
</ul>
<ul>
<li>Вова вообще только что
подписался и не знает что
да как. Куда и к кому
обратиться?</li>
</ul>
<ul>
<li>Дима не понял ничего в
стеке. У него возник
вопрос. Кто сможет помочь
нашему подписчику?</li>
</ul>
<ul>
<li>и пр.</li>
</ul>
<p>Зато у Сергея есть время,
определенные знания и желание
отвечать на вопросы, помогать
другим освоить Ассемблер, но
нет возможности. Более того,
Сергей знает, что при
объяснении темы или при ответе
на вопрос сам чего-то да
начинает понимать. Т.е. будет
учиться сам, обучая других.</p>
<p>Я хочу предоставить эту
возможность Сергею и всем
остальным, кто имеет то же
желание.</p>
<p><strong>Каков принцип работы
клуба?</strong></p>
<p>Например, у меня
зарегистрировалось 5
специалистов-экспертов,
которые изъявили желание
отвечать на вопросы связанные
с DOS. Вася (который не может
разобраться с DOS) высылает мне
письмо с вопросом, которое
автоматически направляется
всем пятерым экспертам.
Эксперты, в свою очередь,
отвечают на вопрос и
отправляют его напрямую Васе.
Т.о. Вася получит 5 писем с
ответами на свой вопрос. Из
одного письма он почерпнет
одно, из другого - второе и т.д.
При этом эксперт направляет
мне копию данного письма. Нет,
не для того, чтобы я проверял, а
для того, чтобы я мог создавать
потихоньку базу данных
вопросов/ответов, которую
потом выложу на сайт. При этом,
естественно, письмо будет
сохранено в первозданном виде,
причем имя и e-mail эксперта
остается (если он этого
захочет).</p>
<p><strong>Что я могу предложить
экспертам?</strong></p>
<p>Вася, получивший 5 писем с
ответами направляет мне оценки
всем пяти экспертам по
пятибалльной шкале (неужели
Васе будет это сложно сделать?).
Т.е. Валик ответил на
&quot;отлично&quot;, а Толик на
&quot;троечку&quot; еле тянет. Я
периодически опубликовываю в
рассылке имена экспертов и
количество набранных ими
баллов.</p>
<p><u>Тройка лидеров получает
возможность:</u></p>
<ul>
<li><em>опубликовать в рассылке
любую информацию о себе;</em></li>
<li><em>указать в рассылке адрес
своего сайта;</em></li>
<li><em>разместить какую-нибудь
рекламу;</em></li>
</ul>
<p>Эксперт, занявший первое
место, может получить, помимо
вышеперечисленного, еще и <font
color="#800040"><strong>денежку</strong></font>
за труды. Много не обещаю, т.к.
собираюсь платить со своего
кармана, но на пивко хватит.</p>
<p>Почему я написал &quot;может&quot;?
Потому что какое-то время (пока
система не заработает в
определенном ритме, если она
вообще заработает!) денежки
выплачиваться не будут. Зато
потом можно будет заработать
не только на пивко, но еще и на
воблочку. А там, глядишь, и до
икорки дойдет... По крайней
мере, я очень на это надеюсь...</p>
<p>Но не все так просто. Все
эксперты должны соблюдать
определенные правила, которые
будут высланы им в скором
времени. Количество экспертов
ограничивается пока <strong>10</strong>
человеками на одну тему.</p>
<p><font color="#800000" size="4"><em><strong>Что
требуется от подписчиков,
задающих вопросы?</strong></em></font></p>
<p>Прежде всего - <strong>порядочность
и внимательность</strong>. А
именно:</p>
<ul>
<li><u>обязательно отправлять
мне </u><strong><u>справедливо</u></strong><u>
поставленную оценку за
ответ</u> (если Вам помог
эксперт в том или ином
вопросе, навел Вас на
Мысль, то почему бы Вам не
помочь ему и наоборот?). <u>Момент!</u>
Эксперты не будут знать
какую оценку дал подписчик
на его ответ!;</li>
</ul>
<ul>
<li><strong><u>четко излагать
вопрос</u></strong><u>, передавая
эксперту как можно больше
информации</u> (&quot;У меня не
работает компьютер. Что
делать?&quot; - не годится! В
лучшем случае эксперт
ответит Вам: &quot;Попробуйте
воткнуть вилку в
розетку!&quot;, на что Вы
посчитаете его идиотом и
отправите мне оценку за
ответ &quot;кол&quot;. А это
несправедливо!);</li>
</ul>
<ul>
<li><u>не задавать вопросы,
например, эксперту по
оболочкам DOS, касающиеся,
скажем, работы с
отладчиком</u> (эксперт,
которому пришел вопрос
&quot;не по адресу&quot;, на него
не отвечает!);</li>
</ul>
<ul>
<li><strong><u>обязательно</u></strong><u>
указывать в теле письма
свой адрес</u> (а иначе как
ответит Вам эксперт?
Письмо-то я фактически
буду отправлять!);</li>
</ul>
<ul>
<li><u>не использовать в
корыстных или иных
подобных целях адреса
экспертов</u> (найду - не
знаю, что сделаю!);</li>
</ul>
<ul>
<li><u>отправлять мне письмо,
если никакого ответа не
последует от экспертов
вообще</u> (что я сомневаюсь,
но все-таки!);</li>
</ul>
<ul>
<li><u>в любых спорных случаях
присылать мне письмо
(жалобу), </u><strong><u>цитируя
при этом переписку с
экспертом</u></strong>.</li>
</ul>
<p><strong><u>Все вышеперечисленное -
самое главное!</u></strong> Для этого
я и хочу сперва пропускать
письма через свой ящик.</p>
<p>_______</p>
<p>Ниже приведена перечень тем
для вопросов, который будет
теперь присутствовать во всех
выпусках (может, чего-нибудь
другое придумаю, чтобы не
нагружать выпуски). С левой
стороны указана экспертная
группа, а справа, в скобках
типичный вопрос к данным
экспертам, <font size="4"><strong><u>после
этого указан адрес с меткой в
поле &quot;Тема&quot;, откуда нужно
будет отправлять вопрос</u></strong></font>:</p>
<ul>
<li>виды и типы компьютеров <em>(&quot;У
меня 486. Это нормально и чем
он отличается от Pentium?&quot;)</em>,
<a
href="mailto:assembler@beep.ru?Subject=QuestionExpertComputers">assembler@beep.ru?Subject=QuestionExpertComputers</a>;</li>
</ul>
<ul>
<li>команды DOS <em>(что такое
файл, как копировать файлы,
как запускать программы и
т.п.), </em><a
href="mailto:assembler@beep.ru?Subject=QuestionExpertDOS">assembler@beep.ru?Subject=QuestionExpertDOS</a>;</li>
</ul>
<ul>
<li>оболочки под DOS <em>(Norton
Commander, DOS Navigator, Volcov Commander и
т.п.)</em>, <a
href="mailto:assembler@beep.ru?Subject=QuestionExpertDOSShells">assembler@beep.ru?Subject=QuestionExpertDOSShells</a>;</li>
</ul>
<ul>
<li>основы работы с Windows'95/98/2000 /
NT <em>(&quot;Почему не
запускается MASM под Win NT?&quot;)</em>,
<a
href="mailto:assembler@beep.ru?Subject=QuestionExpertWin">assembler@beep.ru?Subject=QuestionExpertWin</a>;
</li>
</ul>
<ul>
<li>работа с ассемблерами <em>(MASM/TASM;
как сассемблировать
программу, что означают
другие параметры в
командной строке)</em>, <a
href="mailto:assembler@beep.ru?Subject=QuestionExpertAssemblers">assembler@beep.ru?Subject=QuestionExpertAssemblers</a>;</li>
</ul>
<ul>
<li>работа с отладчиком AFD, <a
href="mailto:assembler@beep.ru?Subject=QuestionExpertAFD">assembler@beep.ru?Subject=QuestionExpertAFD</a>;</li>
</ul>
<ul>
<li>работа с отладчиком CodeView, <a
href="mailto:assembler@beep.ru?Subject=QuestionExpertCV">assembler@beep.ru?Subject=QuestionExpertCV</a>;
</li>
</ul>
<ul>
<li>работа с отладчиком
TurboDebugger, <a
href="mailto:assembler@beep.ru?Subject=QuestionExpertTD">assembler@beep.ru?Subject=QuestionExpertTD</a>;
</li>
</ul>
<ul>
<li>работа с дизассемблерами <em>(как
и что)</em>, <a
href="mailto:assembler@beep.ru?Subject=QuestionExpertDisassm">assembler@beep.ru?Subject=QuestionExpertDisassm</a>;</li>
</ul>
<ul>
<li>Ассемблер: общие вопросы,
не рассматриваемые в
рассылке <em>(&quot;Посмотрите
мою программу и исправьте
ошибки&quot;)</em>, <a
href="mailto:assembler@beep.ru?Subject=QuestionExpertgeneralassm">assembler@beep.ru?Subject=QuestionExpertgeneralassm</a>.</li>
</ul>
<p><strong>Пожалуйста, проверяйте,
чтобы в поле &quot;Тема&quot; Вашего
вопроса была соответствующая
строка, которая идет после
&quot;?Subject=&quot; !!!</strong></p>
<p><font size="5"><strong>Вопросы, которые
вы присылали мне и не получили
ответ, пожалуйста, перешлите соответствующим экспертам.
Спасибо.</strong></font></p>
<hr>
<p align="center"><a name="shell"><font size="4"><strong>Оболочка
Super Shell!</strong></font></a></p>
<p>Сегодня у нас довольно-таки
нудный и неинтересный выпуск.
Но то, что мы будем
рассматривать в нем, очень
важно! Вам придется вспомнить
основы математики и немного
&quot;пошевелить мозгами&quot;.
Да-да, друзья мои! А как вы
хотели выучить Ассемблер без <u>элементарных</u>
знаний математики? Я
подчеркиваю: <strong><u>элементарных</u></strong>.
Вам придется хорошо поработать
сегодня! Хотя, б<strong>о</strong>льшую
часть работы я для вас сделал, а
именно: продумал алгоритм
вывода на экран любого окна
(или рамки) в центр экрана. Вам
осталось только <strong>внимательно</strong>
с ним ознакомиться и <strong>разобраться</strong>.</p>
<p><strong>Полная просьба:
внимательно ознакомьтесь с
данным выпуском и прилагаемым
к нему файлом Sshell14.rar!</strong></p>
<p><strong>Файл-приложение можно
взять здесь: </strong><a
href="http://www.Kalashnikoff.ru/Assembler/Programs/Lessons/Sshell14.rar">http://www.Kalashnikoff.ru/Assembler/Programs/Lessons/Sshell14.rar</a></p>
<p><em>Если у вас нет выхода в
Сеть, то напишите мне письмо с
просьбой выслать. Я также
включу ваш адрес в базу данных.
Затем, перед выходом очередной
рассылки, вы получите этот файл
по почте.</em></p>
<p>Давайте договоримся о
некоторых определениях. Т.к.
программа у нас будет большая,
то для облегчения читаемости и
поиска необходимой процедуры,
я буду указывать в скобках
процедуру и файл, где нужно
искать то, о чем я напишу в
рассылке. Например,</p>
<p>&quot;...Затем мы удаляем файл
(Delete_file, FILES.ASM)...&quot;</p>
<p>Здесь: <em>Delete_file</em> - процедура,
которая удаляет файл, а <em>FILES.ASM</em>
- файл, где нужно ее искать.</p>
<p><strong>Ну, понеслась...</strong></p>
<p>Сразу заглядываем в файл
MAIN.ASM. Перво-наперво, что нам
нужно сделать, так это спрятать
курсор (Hide_cursor, DISPLAY.ASM). Прежде,
чем это сделать, нужно
запомнить его текущую позицию.
Это позволяет сделать функция 3
прерывания 10h:</p>
<div align="center"><center><table border="2" width="70%"
bordercolorlight="#FFFFFF">
<tr>
<td valign="top" width="15%" bgcolor="#52A5A5"><font
size="4"><strong>Вход:</strong></font></td>
<td width="50%">AH=3<p>BH=видеостраница,
с которой получить текущую
позицию курсора</p>
</td>
</tr>
<tr>
<td width="15%" bgcolor="#52A5A5"><font size="4"><strong>Выход:</strong></font></td>
<td width="50%">DX = текущая
позиция курсора (DH - строка,
DL - колонка)</td>
</tr>
</table>
</center></div><p>Как видите, BH должен
указывать на видеостраницу, с
которой нужно сосчитать
позицию курсора. Как уже вам
известно, видеокарта имеет
достаточно памяти для
размещения 8 видеостраниц.
Каждая видеостраница имеет
свой курсор. Но мы-то будем
отображать все на нулевой
странице, следовательно, мы
должны в BH загрузить 0. На
выходе DX будет содержать
текущую позицию курсора: DH -
строку, а DL - колонку. Причем,
отсчет идет с нуля.</p>
<p>После того, как мы получили
текущую позицию курсора, можно
его прятать. Самый
распространенный метод -
установка курсора за границу
экрана. В нашем случае -
установка на 25 строку. Режим-то
у нас будет 3 (25 строк, 80
колонок). Т.к. отсчет идет с
нуля, то последняя позиция
курсора (самая нижняя строка) -
24. Следовательно, установив
курсор на 25 строку (19h), мы его
просто &quot;прячем&quot;!</p>
<p>Установить курсор на нужную
позицию на экране позволяет
сделать функция 2 прерывания 10h:</p>
<div align="center"><center><table border="2" width="70%"
bordercolorlight="#FFFFFF">
<tr>
<td valign="top" width="15%" bgcolor="#52A5A5"><font
size="4"><strong>Вход:</strong></font></td>
<td width="50%">AH=2<p>BH -
видеостраница, на которой
будем устанавливать
курсор</p>
<p>DH - строка, DL - столбец для
установки</p>
</td>
</tr>
<tr>
<td width="15%" bgcolor="#52A5A5"><font size="4"><strong>Выход:</strong></font></td>
<td width="50%">Ничего</td>
</tr>
</table>
</center></div><p>После того, как мы
спрятали курсор, можем
переходить к сохранению
текущего содержания
видеостраницы 0. Как вы знаете,
все уважающие себя оболочки
сохраняют и, при необходимости,
показывают пользователю то,
что изображено на экране.
Например, Norton Commander или DOS-Navigator,
которые отображают
пользовательский экран при
нажатии на клавиши &lt;Ctrl+O&gt;.</p>
<p>Как ее сохранить? Помните, я
говорил о том, что у видеокарты
есть достаточно памяти для
размещения 8 видеостраниц?
Почему бы нам не скопировать
содержимое пользовательской,
нулевой страницы в первую? А
что тут такого?</p>
<p>Вот мы это и делаем (Save_mainscr,
DISPLAY.ASM). Здесь мы встречаем
новые операторы: PUSHA и POPA (POPA
значит POP All - вытолкнуть все (а
не то самое...), а PUSHA - PUSH All -
втолкнуть все). Т.е. этот
оператор толкает в стек
регистры в следующем порядке:</p>
<p>AX, CX, DX, BX, SP, BP, SI и DI</p>
<p>и, соответственно, оператор
POPA выталкивает их из стека в
обратном порядке, т.е.:</p>
<p>DI, SI, BP, SP, BX, DX, CX и AX.</p>
<p>Данные операторы
используются только 286+
процессором. Когда пишут,
например, что такой-то оператор
используется в 386+ процессоре,
то это значит, что данный
оператор будет работать на
процессорах 80386, 80486, Pentium и т.д.,
но никак не на 8086 (PC/XT) и 80286 (PC/AT).</p>
<p>В нашем случае команды PUSHA и
POPA будут работать на 80286 и
последующих (более
современных) процессорах. Для
этого в самом начале файла
SSHELL.ASM мы указываем т.н. директиву .286, что говорит
ассемблеру (MASM, TASM) о том, что в
данной программе могут
встречаться команды
(инструкции) не только 8086
процессора, но и 80286. &quot;Почему
же мы раньше ничего подобного
не писали?&quot; - спросит
внимательный читатель. &quot;Если
ничего подобного не указывать,
то ассемблер (MASM, TASM) считает,
что в программе используются <strong>только</strong>
инструкции 8086 процессора, что
мы до сих пор и делали...&quot; -
ответит ваш покорный слуга.</p>
<p>Безусловно, команды PUSHA и POPA
удобны в тех случаях, когда нам
нужно сохранить в стеке более
одного регистра. Они уменьшают
размер программы.</p>
<p>Обратите также внимание, как
мы заносим в сегментный
регистр число:</p>
<p>push 0B800h</p>
<p>pop es</p>
<p>Это получается на 1 байт
короче, чем если бы мы делали
так:</p>
<p>mov ax,0B800h</p>
<p>mov es,ax</p>
<p>Более того, мы не трогаем
регистр AX, что в некоторых
случаях бывает полезно.</p>
<p>Команда вида</p>
<p>PUSH <em>1234h</em></p>
<p>работает также на
процессорах 80286+ (если быть
точным, то она работает на
процессоре 80186+, но т.к. эти
процессоры не получили
большого распространения в
связи с тем, что через
несколько месяцев после
выпуска 80186 появились 80286, то о
них (о 80186) вообще мало кто
знает).</p>
<p>Все остальное в данной
процедуре (Save_mainscr, DISPLAY.ASM)
должно быть понятно... Точно как
и в процедуре восстановления
экрана (Restore_mainscr, DISPLAY.ASM)...</p>
<p align="center">_______________</p>
<p>Теперь самое нудное (на мой
взгляд).</p>
<p>Курсор спрятали, экран
пользовательский сохранили. Теперь можно и окно (рамку)
рисовать... Будем это делать не
прибегая ни к каким
прерываниям, т.к. они работают
очень медленно. Воспользуемся
выводом символов на экран
путем прямого отображения в
видеобуфер.</p>
<p>С данным методом мы уже
сталкивались, когда пытались
выводить на экран
&quot;рожицу&quot;. Теперь
рассмотрим его более подробно.</p>
<p><strong>Метод прямого
отображения символов в
видеобуфер</strong> - вывод
символов на экран, путем записи
их напрямую в сегмент
видеобуфера (в память
видеокарты), минуя сервис
прерываний.</p>
<p>Стоит отметить, что это самый
быстрый способ вывода символов
на экран. Быстрее уже не
существует. Здесь все зависит
от профессионализма
программиста и - как следствие -
алгоритма вывода, скорости его
выполнения.</p>
<p>Рассмотрим вкратце модели
мониторов, многие из которых
уже уши в прошлое, и только
старые и добрые игрушки
периодически напоминают об их
существовании. Вот ряд: <strong>MDA</strong>
(Monochrome Display Adapter), <strong>Hercules</strong>, <strong>CGA</strong>
(Color Graphic Adapter), <strong>EGA</strong> (Enchanced
Graphic Adapter), <strong>VGA</strong> (Video Graphic
Array), <strong>MCGA</strong> (Multi-Color Graphic
Adapter - подобие VGA), <strong>sVGA</strong>
(Super Video Graphic Array - то, что многие в
настоящий момент используют в
работе).</p>
<p>Так вот, при попытке вывода
символа в мониторе CGA и
подобных ему возникает т.н.
&quot;снег&quot;. Эта ошибка
(недоработка?) была исправлена
только в EGA. &quot;Снега&quot; не
возникало, если символы
выводились при помощи
прерываний 10h или 21h. Однако, эти
прерывания использовали
процедуру, которая проверяла
состояние луча монитора, в
связи с чем скорость вывода
символов существенно
замедлялась. Не знаю, есть ли в
настоящих ПЗУшках и в
прерывании 21h подобная
процедура или нет. Главное - при
выводе символов через
прерывания скорость резко
снижается. Полагая, что никто
из вас не использует сейчас CGA
монитор, будем выводить
символы прямым отображением в
видеобуфер. Повторю еще раз:
это очень быстро даже на 8086
процессорах. Очистка экрана в
PC/XT происходит мгновенно. И уж
тем более на 80286+...</p>
<p>Для процедуры (а может и не
только для нее) заведем две
переменные: Height_X и Width_Y. Пока
временно. В дальнейшем
научимся передавать данные в
стеке. Но это будет позже, а
сейчас переменная Height_X
содержит высоту рамки, а Width_Y -
ширину. Num_attr - цвет рамки (Main_proc,
MAIN.ASM). Можно вызывать процедуру
Draw_frame, которая находится в
файле DISPLAY.ASM.</p>
<p>Вот сейчас и рассмотрим <strong><u>самое
главное</u></strong>. Итак, процедура
Draw_frame.</p>
<p>Перед вызовом данной
процедуры необходимо занести
некоторые числа в
соответствующие переменные
(main.asm), а именно:</p>
<p>Height_X - содержит высоту нашей
рамки;</p>
<p>Width_Y - содержит ширину нашей
рамки;</p>
<p>Num_attr - содержит атрибуты
выводимой рамки.</p>
<p>Пока все. Дальше пойдем -
больше будет...</p>
<p>Итак, занесли. Вызываем
процедуру Draw_frame (Display.asm).</p>
<p>Теперь внимание! Нужно
произвести некоторые расчеты
перед тем, как вывести рамку не
&quot;абы куда&quot;, а именно в
самый центр экрана.</p>
<p><font color="#000000"><strong><u>Нам нужно
разделить высоту рамки на 2 и
вычесть из полученного числа
середину высоты. Вот так:</u></strong></font></p>
<p>(1) mov ax,Height_X</p>
<p>(2) shr al,1</p>
<p>(3) mov dh,11</p>
<p>(4) sub dh,al</p>
<p>В строке (1) заносим в AX высоту
рамки, которую указали перед
вызовом процедуры. Затем, в
строке (2), оператор SHR сдвигает
все биты в регистре AL на 1
вправо. Что получается? Вот
пример:</p>
<p>mov ax,16 --- AX = 10000b, т.е. 16</p>
<p>shr ax,1 --- AX = 1000b, т.е. 8</p>
<p>shr ax,1 --- AX = 100b, т.е. 4</p>
<p>shr ax,1 --- AX = 10b, т.е. 2</p>
<p>shr ax,1 --- AX = 1b, т.е. 1</p>
<p>Т.о. сдвиг битов вправо на
единицу делит число на 2. На
двойку - в четыре раза и т.д. Это
быстрее, если бы мы
пользовались оператором DIV
(который, кстати, мы еще не
изучили) - деление.</p>
<p>В строке (3) мы заносим в DH
середину (или почти середину)
экрана (по горизонтали), т.е. 11. И
вычитаем из 11 полученный
результат.</p>
<p>Например, мы выводим рамку
высотой в 5 строк. Вот, что
получим:</p>
<p>AX=10</p>
<p>AX=AX/2=5</p>
<p>AX=11-5=6</p>
<p>Т.о. вывод начнем со строки 6.</p>
<p>Все тоже самое мы делаем с
колонками (вертикально).
Посмотрите в прилагаемом
примере...</p>
<p>В принципе, пока особо не
заостряйте внимание на этом: со
временем придет опыт и более
точное понимание.</p>
<p>Как только мы вычислили
координаты для вывода рамки в
центре экрана, мы переводим
высоту/ширину в линейный адрес.
Что такое линейный адрес и
зачем нужно переводить в него?</p>
<p>Как вы уже знаете, то, что
находится на экране,
расположено по адресу от 0B800:0000
до 0B800:1000h (если нулевая
страница). Видеокарта не знает,
что такое колонка и строка. Для
нее все данные расположены в
линейном массиве, т.е. от 0 до
1000h. Т.к. один символ занимает 2
байта (символ и атрибут), то
одна строка 3 режима занимает 160
байт (80 строк * 2 = 160). Для того,
чтобы вывести символ в первую
строку (т.е. во вторую, т.к.
отсчет с нуля), нам нужно
выводить его по адресу 161,
смещения 0B800h. Следовательно,
если мы указываем строку/столбец, то нам
необходимо перевести эти числа
в линейный массив,
&quot;понятный&quot; видеокарте. Вот
пример (разбираем
внимательно!):</p>
<p>mov dh,0 ;DH обычно указывает на
строку</p>
<p>mov dl,15 ;а DL - на столбец (это мы и
будем делать во всех наших
процедурах)</p>
<p>;т.о. мы выводить будем в
нулевой строке (т.е. самой
верхней на экране), 15 столбце.</p>
<p>Вот переводим два числа в
линейный массив (переведем в
одно число - смещение):</p>
<p>Linear = DL*2</p>
<p><em>Умножаем на два строку, т.к.
один символ на экране занимает
два байта: символ+его атрибут</em></p>
<p>Linear = Linear + DH*160</p>
<p>Теперь переменная Linear равна
30. Вот он, линейный адрес: 0B800:001Eh
(1Eh = 30)!</p>
<p>Еще пример:</p>
<p>mov dh,8 ;строка 8</p>
<p>mov dl,56 ;столбец 56</p>
<p>Linear = DL*2</p>
<p><em>теперь Linear = 112</em></p>
<p>Linear = Linear + DH*160</p>
<p><em>Теперь Linear = 1392 или 570h</em></p>
<p>И последний пример.
Произведем вычисления для
последнего символа на экране
(нижний правый угол):</p>
<p>Linear = (24 * 160 + 80 * 2) - 2 = 0F9Eh</p>
<p>80 - количество столбцов на
экране, которое нужно умножить
на 2 (учитывая не только символ,
но и его атрибут).</p>
<p>24 - количество строк на
экране, начиная от 0. Т.к. в одной
строке 80 символов (начиная от 1)
* 2 = 160, то, для того, чтобы
получить адрес самого
последнего (24-ого) ряда, нужно
24*160.</p>
<p>Затем все это дело сложить
(адрес 24-ой строки плюс адрес
последнего символа минус два).
Еще раз:</p>
<p>(24-ая строка * 160 + 80-ый символ *
2) - 2</p>
<p>или</p>
<p>(24 * 160 + 80 * 2) - 2 = 3998 или 0F9Eh</p>
<p>Почему &quot;минус два&quot;?
Потому, что... А, хотя, подумайте
сами... Я и так тут
порасписывал...</p>
<p>Я лучше расскажу, как это
выглядит на практике. Итак,
процедура (Get_linear, DISPLAY.ASM) (хотя,
многое и так понятно из
описаний в файле):</p>
<p>shl dl,1 ;умножаем DL на 2 (DL=DL*2)...</p>
<p>Просто сдвинем биты на 1 влево
(по принципу деления. См. выше).</p>
<p>mov al,dh ;в AL - ряд,<br>
mov bl,160 ;который нужно умножить
на 160<br>
mul bl ;умножаем: AL (ряд) * 160;
результат в AX</p>
<p><em>Что-что? Новый оператор MUL?
Ну так рассмотрим сейчас.</em></p>
<p>mov di,ax ;результат умножения в DI<br>
xor dh,dh ;аннулируем DH<br>
add di,dx ;теперь в DI линейный адрес
в видеобуфере...</p>
<p>Итак, вот таблицы с новыми
операторами:</p>
<p>&nbsp;</p>
<div align="left"><table border="1" cellspacing="1"
bordercolorlight="#FFFFFF">
<tr>
<td width="25%" bgcolor="#52A5A5"><strong>Название</strong></td>
<td width="25%" bgcolor="#52A5A5"><strong>Перевод</strong></td>
<td width="20%" bgcolor="#52A5A5"><strong>Применение</strong></td>
<td width="20%" bgcolor="#52A5A5"><strong>Процессор</strong></td>
</tr>
<tr>
<td width="25%">shl источник,
приемник</td>
<td width="25%">SHift Left - сдвиг
влево</td>
<td width="20%">Сдвиг байт</td>
<td width="20%">8086</td>
</tr>
</table>
</div><p>Пример:</p>
<p>mov ax,100b</p>
<p>shl ax,1 ; Теперь в AX число 1000b</p>
<p>--------</p>
<div align="left"><table border="1" cellspacing="1"
bordercolorlight="#FFFFFF">
<tr>
<td width="25%" bgcolor="#52A5A5"><strong>Название</strong></td>
<td width="25%" bgcolor="#52A5A5"><strong>Перевод</strong></td>
<td width="20%" bgcolor="#52A5A5"><strong>Применение</strong></td>
<td width="20%" bgcolor="#52A5A5"><strong>Процессор</strong></td>
</tr>
<tr>
<td width="25%">shr источник,
приемник</td>
<td width="25%">SHift Right - сдвиг
вправо</td>
<td width="20%">Сдвиг байт</td>
<td width="20%">8086</td>
</tr>
</table>
</div><p>Пример:</p>
<p>mov ax,100b</p>
<p>shr ax,1 ; Теперь в AX число 10b</p>
<p>--------</p>
<div align="left"><table border="1" cellspacing="1"
bordercolorlight="#FFFFFF">
<tr>
<td width="25%" bgcolor="#52A5A5"><strong>Название</strong></td>
<td width="25%" bgcolor="#52A5A5"><strong>Перевод</strong></td>
<td width="20%" bgcolor="#52A5A5"><strong>Применение</strong></td>
<td width="20%" bgcolor="#52A5A5"><strong>Процессор</strong></td>
</tr>
<tr>
<td width="25%">mul bl</td>
<td width="25%">Multiplex - умножение</td>
<td width="20%">Умножение</td>
<td width="20%">8086</td>
</tr>
</table>
</div><p>Умножает AL на BL, помещая
результат в AX. Пример:</p>
<p>mov al,5</p>
<p>mov bl,2</p>
<p>mul bl ; Теперь в AX число 10</p>
<hr>
<p>Ну вот, собственно, и все.
Остальное должно быть понятно
из комментариев к программе.</p>
<p>Если у Вас есть вопросы, то
задавайте их, пожалуйста,
экспертам (в редких случаях
можно и мне).</p>
<p>Удачного Вам
программирования!</p>
<p><strong>С уважением,</strong></p>
<hr>
<div align="center"><center><table border="4"
cellpadding="2" width="100%" bgcolor="#53A6A6"
bordercolor="#808080" bordercolorlight="#FFFFFF">
<tr>
<td width="33%"><p align="center"><font size="4"><strong>Автор
рассылки:</strong></font></p>
<p align="center"><em><strong>Калашников
Олег</strong></em></p>
<p align="center"><a
href="http://www.Kalashnikoff.ru"><strong>www.Kalashnikoff.ru</strong></a></p>
</td>
<td width="33%"><p align="center"><font size="5"><strong>E-mail:</strong></font></p>
<p align="center"><a
href="mailto:assembler@beep.ru">assembler@beep.ru</a></p>
</td>
<td width="34%"><p align="center"><font size="4"><strong>UIN
(Тетя Ася):</strong></font></p>
<p align="center"><font color="#0000FF">68951340</font></p>
</td>
</tr>
<tr>
<td colspan="3" bgcolor="#448686"><font
color="#400040" size="1"><strong>(С)
Авторское право.</strong>
Запрещается использование
материала из рассылки в
коммерческих целях без
письменного согласия
автора.</font></td>
</tr>
</table>
</center></div></td>
</tr>
</table>
</center></div>

<hr>

<p align="center">[<a href="015.htm">Следующий выпуск</a>] [<a target=_BLANK href="http://www.Kalashnikoff.ru/">На главную страницу</a>]</p>


<HR NOSHADE><CENTER>
<!-- SpyLOG v2 f:0211 --><script language="javascript">  
u="u496.71.spylog.com";d=document;nv=navigator;na=nv.appName;p=1;  
bv=Math.round(parseFloat(nv.appVersion)*100);  
n=(na.substring(0,2)=="Mi")?0:1;rn=Math.random();z="p="+p+"&rn="+rn;y="";  
y+="<a href='http://"+u+"/cnt?f=3&p="+p+"&rn="+rn+"' target=_blank>";  
y+="<img src='http://"+u+"/cnt?"+z+  
"&r="+escape(d.referrer)+"&pg="+escape(window.location.href)+"' border=0 width=88 height=31 alt='SpyLOG'>";  
y+="</a>"; d.write(y);if(!n) { d.write("<"+"!--"); }//--></script><noscript><p align="center"><a 
href="http://u496.71.spylog.com/cnt?f=3&amp;p=1" 
target="_blank"><img src="http://u496.71.spylog.com/cnt?p=1" alt="SpyLOG" align="middle" border="0"></a> 
<a href="http://u496.71.spylog.com/cnt?f=3&amp;p=1" target="_blank"></noscript></a> 
<a href="http://u496.71.spylog.com/cnt?f=3&amp;p=1" target="_blank"> 
<script language="javascript1.2"><!-- if(!n) { d.write("--"+">"); }//--></script></a> 
<!-- SpyLOG --> 
 
 <a target=_top href="http://www.one.ru"><img src="http://cnt.one.ru/cgi-bin/cnt.cgi?id=16871&t=9" width=88 height=31 alt="be number one" border=0></a> 
 
 <script language="JavaScript"><!-- 
d=document;a='';a+=';r='+escape(d.referrer) 
js=10//--></script><script language="JavaScript1.1"><!-- 
a+=';j='+navigator.javaEnabled() 
js=11//--></script><script language="JavaScript1.2"><!-- 
s=screen;a+=';s='+s.width+'*'+s.height 
a+=';d='+(s.colorDepth?s.colorDepth:s.pixelDepth) 
js=12//--></script><script language="JavaScript1.3"><!-- 
js=13//--></script><script language="JavaScript"><!-- 
d.write('<a href="http://top.list.ru/jump?from=87856"'+ 
' target=_top><img src="http://top.list.ru/counter'+ 
'?id=87856;t=54;js='+js+a+';rand='+Math.random()+ 
'" alt="TopList"'+' border=0 height=31 width=88></a>') 
if(js>11)d.write('<'+'!-- ')//--></script><noscript><a 
target=_top href="http://top.list.ru/jump?from=87856"><img 
src="http://top.list.ru/counter?js=na;id=87856;t=54" 
border=0 height=31 width=88 
alt="TopList"></a></noscript><script language="JavaScript"><!-- 
if(js>11)d.write('--'+'>')//--></script> 
 
<br><br> 

</body>
</html>
