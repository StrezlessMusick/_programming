<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
<title>Калашников.ru - Ассемблер? Это просто!.. (Выпуск № 017)</title>
</head>

<body bgcolor="#EBD2A5" text="#000000" link="#660000" vlink="#000000" alink="#000000">

<P align=center><A 
href="http://ad.ir.ru/bb.cgi?cmd=go&pubid=128269&pg=2&vbn=10001&nocache=77524" 
target=_top><IMG alt="InterReklama " border=0 
src="http://ad.ir.ru/bb.cgi?cmd=ad&pubid=128269&pg=2&vbn=10001&nocache=77524"></A></P>
<P align=center><A href="http://www.ir.ru" target=_top><FONT size=1>InterReklama 
Advertising</FONT></A> </P>
<HR>

<div align="center"><center>

<table border="3" cellpadding="3" cellspacing="3" width="100%"
bgcolor="#8DC7C7" bordercolor="#000040">
<tr>
<td width="100%"><div align="center"><center><table
border="3" cellpadding="3" cellspacing="3" width="100%"
bgcolor="#009797" bordercolor="#000040">
<tr>
<td width="100%"><p align="center"><font size="5"><strong>Здравствуйте,
уважаемые подписчики!</strong></font></p>
<hr>
<p align="center"><font size="4"><em><strong>Выпуск
N 017</strong></em></font></p>
</td>
</tr>
</table>
</center></div><p align="right"><em>Заповедный
напев,</em></p>
<p align="right"><em>Заповедная даль.</em></p>
<p align="right"><em>Свет хрустальной
зари,</em></p>
<p align="right"><em>Свет над Миром
встающий.</em></p>
<p align="right"><em>Мне понятна твоя</em></p>
<p align="right"><em>Вековая печаль,</em></p>
<p align="right"><em>Беловежская пуща.</em></p>
<p align="right"><em><strong>Беловежская
пуща.</strong></em></p>
<hr>
<p align="center"><font size="4"><em><strong>Сегодня
в рассылке:</strong></em></font></p>
<ul>
<li><a href="#Minsk"><font color="#800040">Моя
поездка в Минск.</font></a></li>
<li><a href="#mark"><font color="#800040">Оценка.
Книга</font></a></li>
<li><a href="#question"><font color="#800040">Я
хочу задать вопрос!</font></a></li>
<li><a href="#letters"><font color="#800040">Ваши
письма</font></a></li>
<li><a href="#virus"><font color="#800040">Вирус</font></a></li>
</ul>
<hr>
<p align="left"><font size="3">Друзья мои!
Давайте немного сегодня
поболтаем, пофилософствуем,
прежде чем перейдем к вирусу.
Тем более, что мне нужно много
чего вам сообщить...</font></p>
<p align="center"><a name="Minsk"><font size="4"><strong>Моя
поездка в Минск</strong></font></a></p>
<p align="left"><font size="3">Видно, вы уже
догадались, почему я начал
сегодняшний выпуск с
&quot;Песняров&quot;. Однако, вы не
знаете, почему я действительно
начал с &quot;Песняров&quot;. Есть
две причины:</font></p>
<p align="left"><font size="5"><strong>1.</strong></font><font
size="3"> На праздники ездил в
Минск, столицу Республики
Беларусь, где живут мои
родители. Я родился и вырос там.
Честно говоря, я немного
разочарован. Почему? Просто
потому, что я никогда не видел
Беларусь в таком состоянии, в
каком она находится сейчас. Она
меняется прямо на глазах. </font><font
size="4">Друзья мои, наболело!</font><font
size="3"> </font><font size="4">Обидно за
земляков!</font><font size="3"> Народ
нищает и - как следствие -
меняется на глазах. Причем
меняется не в лучшую сторону.
По крайней мере, мне так
показалось. Я знаю, как было до
17 августа 1998. Знаю потому, что я
покинул свой родной город
Минск 26 февраля 1998 года. Я
родился и вырос там. Я люблю
Беларусь и горжусь тем, что
вырос там.</font></p>
<p align="left"><font size="3">Разговор о
другом. Я не знаю, что Лукашенко
сделал со страной. Страной
богатой, как культурой, как и
природными ресурсами, так и
многим чем другим. В Беларуси
существуют такие гиганты, как
&quot;БелАЗ&quot; и &quot;МАЗ&quot;,
которые выпускают мощнейшие
машины; &quot;Интеграл&quot;,
который сейчас, к сожалению,
продали &quot;LG&quot;; &quot;МТЗ&quot;,
который выпускает хорошие
трактора; &quot;МЗХ&quot;,
производящий холодильники
&quot;Атлант&quot;, &quot;Минск&quot; и др.
Беларусь всегда славилась
своим трикотажем, который
сейчас в Москве продают на
каждом углу; &quot;левый&quot;
трикотаж выдают за белорусский
потому, что белорусский
качественный! Я не раз с этим
сталкивался.</font></p>
<p align="left"><font size="3">Как можно было
так &quot;опустить&quot; Беларусь?!
Да, Россия не далеко ушла от
стран СНГ. Да, все мы стали
одинаковые: мы не способны
защитить свои земли. Нам не
дают жить нормально. Мы не
можем себе позволить рожать
детей потому, что &quot;это очень
дорого&quot;. Мы готовы задушить
того, кто просто попытается
купить колбасу вне очереди,
даже если это участник ВОВ. У
нас появляется чувство
зависти, злость друг на друга.
Люди, с которыми я вырос,
способны съесть меня же,
извините, &quot;с потрохами&quot;!
Почему? Подумайте! Кому-то
выгодно нас разделить. Кому-то
выгодно, чтобы такая некогда
Великая Держава, как СССР
никогда больше не возродилась.
Не надо быть &quot;слепыми
котятами&quot;! Что делает
Белорусский Народный Фронт
(БНФ)?! Сжигает российский флаг
перед камерами ОРТ, НТВ, РТР! </font><font
size="4">Кто платит им за это?</font><font
size="3"> Как можно предавать своих
друзей, земляков, русских за
деньги? Почему даже нацистские
организации России
&quot;признают&quot; три страны как
&quot;свои&quot;: Россию, Беларусь и
Украину? Почему же БНФ плюет на
своих же людей? Вы никогда не
задумывались над этим?</font></p>
<p align="left"><font size="3">Знаю, что на
мою рассылку подписаны люди из
Беларуси. Я обращаюсь к вам,
Земляки! Хочу спросить: что
происходит? Почему некоторые
белорусы стали ненавидеть
русских? Почему мои друзья и
знакомые категорически против
объединения двух стран? Двух
стран, но фактически людей
одной нации? Почему? Разве мы
когда-то разделяли себя на
русских и белорусов? Дорогие
мои, я 20 лет прожил там, в
Беларуси. Я уехал только
потому, что в Москве жила моя
любимая девушка, которая
сейчас является моей женой. Я
уехал в Россию, т.к. считаю РФ
также своей Родиной. Я уехал
еще в самом начале 1998 года,
когда можно было жить
нормально и зарабатывать
хорошо в Минске. Когда доллар
стоил 23.000 рублей, а сейчас -
1.250.000, причем зарплата в 60-70
миллионов БРБ считается
&quot;нормальной&quot;. Когда никто
даже не думал разделять нас,
русских и белорусов, на две
разные нации. Неужели жилось
плохо вместе с Россией? После
разъединения стало лучше? Что
мы теряем? Что теряет Россия?
Что случилось с добрым
белорусским народом? Дорогие
мои Земляки! Не позволяйте себе
управлять вами! Думайте и
анализируйте, что Вам / Нам
говорят. Извините за
банальность: не поддавайтесь
на провокации. Не разделяйте
свой же народ! Иначе Мы...</font></p>
<p align="center"><font color="#000080" size="4"><strong>Хотел
бы сказать ( </strong></font><a
href="mailto:oleg77@beep.ru"><font color="#000080"
size="4"><strong>oleg77@beep.ru</strong></font></a><font
color="#000080" size="4"><strong> )...</strong></font></p>
<p align="center">____________</p>
  <p align="left"><font size="5"><strong>2.</strong></font>
Не будем только о грустном.
Хочу рассказать историю,
которая приключилась со мной в
поезде, когда я ехал в субботу, 9
декабря, из Москвы в Минск. Этот
день запомнится мне на всю
жизнь. Дорогие мои! Я был так
счастлив, что поехал <strong>в 11
поезде, в 15 вагоне 09.12.2000!</strong>
Все дело в том, что мне довелось
ехать <strong>с самими
&quot;Песнярами&quot;</strong>! В
частности с Дайнеко и Мулявиным! Как мы пели
&quot;Беловежскую пущу&quot;,
&quot;Конь незацугляны&quot;,
&quot;Касiу Ясь канюшыну&quot;! Мне кажется, что
молодежь (до 20 лет) не знает о
ком я говорю. Надеюсь все-таки,
что большинство из вас не раз
слышали эту замечательную
музыку, эти прекрасные слова,
эти чудесные голоса. Я
счастлив, что мне удалось
услышать их &quot;в живую&quot;,
поговорить с ними! Более того, я
специально взял в Минск
компакт-диск с
&quot;Песнярами&quot;, чтобы
послушать его с друганами. <strong>Как
он мне пригодился!</strong> Теперь
у меня стоят подписи Дайнеко и Мулявина на нем!</p>
<p>Правда, было очень стыдно,
когда они, увидев компакт,
сказали, что такой никогда не
выпускали. Я-то его на рынке за
семь червонцев купил...</p>
<hr>
<p align="center"><a name="mark"><font size="4"><strong>Оценка</strong></font></a></p>
<p align="left"><font size="3">Хочу
обратиться к каждому из вас
индивидуально. Оглянитесь
назад. Вспомните, что Вы знали
до того, как только-только
получили первый выпуск
рассылки, и что Вы знаете
теперь. У нас было 16 выпусков.
Если бы выпуски выходили
ежедневно (или если бы Вы
читали по одному выпуску в
день), то Вы бы получили эту
информацию за 2,5 недели. Много
это или мало? Просто ли Вам
давались, так сказать, уроки
или сложно? Интересно ли было
Вам или скучно? Устраивает ли
Вас информация в том виде, в
котором я ее Вам преподношу, а
также последовательность этой
информации? Что Вы думаете о
трех программах (вирус,
резидент, оболочка), которые мы
пишем, параллельно изучая язык?
И что вообще Вы можете сказать
по поводу качества выпусков в
целом. Возможно, у Вас есть свои
какие-нибудь пожелания.</font></p>
<p align="left"><font size="3">Огромная
просьба: напишите, пожалуйста,
мне об этом. Просто 2-3 строки
(можно больше). Вы можете
выразить все Ваши мысли,
пожелания, критику, а также все
то, что посчитаете нужным мне
сообщить. Буду Вам очень
признателен.</font></p>
<p align="left"><font size="3"><strong>Для чего
мне это нужно?</strong></font></p>
<p align="left"><font size="3">Многие из вас,
вероятно, заметили, что
подписка для новичков в
настоящий момент закрыта. Это
значит, что теперь у нас будет
тот коллектив, который уже
сформировался. Теперь
подписчики могут только
отписаться. Я бы очень хотел,
чтобы мы остались в том
составе, который сейчас имеем
(7600 человек). Более того, я
прилагаю все усилия для того,
чтобы <strong>каждый</strong> мог
получить очередной выпуск с
файлом-приложением: высылаю
информацию по почте тем, кто не
имеет выхода в Сеть. Некоторые
интересуются: &quot;Сколько ты
получаешь за это?&quot; Отвечу:
&quot;Почти ничего, если не
учитывать моральное
удовлетворение от того, что я
смог кому-то помочь, кого-то
научить.&quot; Я не ставлю перед
собой задачу заработать денег.
Да, Subscribe.ru выплачивает
вознаграждения авторам и
ведущим рассылок. За 1000 очков
они получают 30 центов. В данный
момент у меня на счету
накопилось чуть меньше 3000
очков.</font></p>
<p align="left"><font size="3">Я, конечно,
понимаю, что некоторые
&quot;сгоряча&quot; захотели
научиться программировать на
Ассемблере, но со временем это
желание прошло. Я хочу понять,
почему все-таки желание
проходит. Как сделать так,
чтобы оно постоянно было (если
такое возможно). Я пытаюсь в
каждом выпуске научить Вас не
просто чему-то новому, а
интересному; хочу чтобы Вы
заинтересовались самим <strong><u>процессом</u></strong>
изучения языка. Поэтому я
постоянно напоминаю:
пользуйтесь отладчиком. Ведь
только так можно увидеть, что
же все-таки происходит <strong><u>внутри</u></strong>
этой штуковины, которая
постоянно гудит. Поймите
простую вещь: важно не желание <strong>знать</strong>
Ассемблер (как и любое другое,
например, физику), а желание его
<strong>учить</strong>. Если у меня,
например, есть желание <strong><u>стать</u></strong><strong>
известным физиком, но нет
желания </strong><strong><u>учить</u></strong><strong>
физику</strong>, то ничего не
получится.</font></p>
<p align="left"><font size="3">К чему это?
Дело в том, что <u>я хочу
попробовать написать книгу</u>,
материал которой берется из
нашей рассылки (естественно, я
перерабатываю материал из
прошлых выпусков, исправляю
ошибки, добавляю что-то новое,
удаляю ненужное на мой взгляд).
Я не знаю, что у меня получится.
Поверьте, очень волнуюсь: а так
ли я пишу? А нужно ли это
кому-нибудь? Может, все зря, и
стоит покончить с этим делом (с
написанием книги)?</font></p>
<p align="left"><font size="3">Мне очень
поможет Ваше мнение, Ваша точка
зрения на это. Как Вы думаете,
стоит ли этим заниматься
вообще? Я выкладываю на сайт
первую часть моей &quot;книги&quot;,
которая называется
&quot;Знакомьтесь: Ассемблер&quot;.
Уже почти готова вторая часть
&quot;От знакомства - к дружбе&quot;.
Если Вам интересно, то можете
взглянуть. Файл можно взять
здесь: </font><a
href="http://www.Kalashnikoff.ru/Part1.exe"><font
color="#804040" size="3">http://www.Kalashnikoff.ru/Part1.exe</font></a><font
size="3"> (формат MS Word'97). У кого нет
доступа - напишите, я вышлю.
Конечно, все, что находится в
первой части Вам уже давно
знакомо. Но дело в том, что мне
нужно Ваше мнение (особенно
прошу написать критиков).
Можете просто исправить что-то
в &quot;книге&quot; и выслать мне
исправления (если, конечно,
хотите), выделив их </font><font
color="#004080" size="3">цветом</font><font
size="3"> или </font><font size="3" face="Arial">другим
шрифтом</font><font size="3">. Буду очень
признателен.</font></p>
<p align="left"><font size="3">Чтобы было
честно, могу предложить
публичное обсуждение через
eGroups (</font><a href="mailto:assmclub@egroups.com">assmclub@egroups.com</a>)<font
size="3">. Что нужно для этого? Вам
необходимо просто написать мне
письмо в произвольной форме с
просьбой включить вас в группу
обсуждений.</font></p>
<p align="left">После этого Вы сможете
отправить свою информацию,
которую получу не только я, но и
все остальные, подписанные на
данную группу. Тоже самое
будет, если кто-то другой
отправит письмо в группу (по
адресу <a href="mailto:assmclub@egroups.com">assmclub@egroups.com</a>).
Вы сможете узнать мнение
человека, отправившего
сообщение. Т.о. Вы будете
уверены в том, как относятся к
моей сумасшедшей идее все те,
кто подписан на данную группу.</p>
<p align="left">Чтобы отписаться от
этой группы, достаточно
отправить пустое письмо по
указанному адресу: <a
href="mailto:assmclub-unsubscribe@eGroups.com"><u>assmclub-unsubscribe@eGroups.com</u></a>.</p>
<p align="left">Возможно, я буду в
дальнейшем использовать эту
группу для обмена информацией.
Так что, не спешите
отписываться!</p>
<p align="left"><font size="3">Если вдруг Вы
посчитаете это дело нужным
(очень надеюсь), то я планирую
продавать книгу <strong>только</strong>
в России, на Украине и в
Беларуси.</font></p>
<p align="left"><font size="3">На этом все,
дорогие мои! Надеюсь, что
получу хоть несколько отзывов
по поводу части первой и ответы
на заданные выше вопросы.</font></p>
<hr>
<p align="center"><a name="question"><font size="4"><strong>Я
хочу задать вопрос!</strong></font></a></p>
<p align="left"><font size="3">Если у Вас
возник вопрос, то его можно
задать нашим экспертам,
направив письмо по
соответствующему адресу:</font></p>
<ul>
<li><p align="left"><font size="3"><strong>Эксперты
по ассемблерам (MASM/TASM) - </strong></font><a
href="mailto:ExpertAssm@egroups.com"><font
size="3"><strong>ExpertAssm@egroups.com</strong></font></a><font
size="3">;</font></p>
</li>
<li><p align="left"><font size="3"><strong>Эксперты
по дизассемблерам - </strong></font><a
href="mailto:ExpertDisassm@egroups.com"><font
size="3"><strong>ExpertDisassm@egroups.com</strong></font></a><font
size="3">;</font></p>
</li>
<li><p align="left"><font size="3"><strong>Эксперты
по моделям, видам и типам
компьютеров и все, что с
ними связано (hard) - </strong></font><a
href="mailto:ExpertComputers@egroups.com"><font
size="3"><strong>ExpertComputers@egroups.com</strong></font></a><font
size="3"><strong>;</strong></font></p>
</li>
<li><p align="left"><font size="3"><strong>Эксперты
по общим вопросам
программирования на
Ассемблере под Win32 - </strong></font><a
href="mailto:ExpertAssmWin32@egroups.com"><font
size="3"><strong>ExpertAssmWin32@egroups.com</strong></font></a><font
size="3"><strong>;</strong></font></p>
</li>
<li><p align="left"><font size="3"><strong>Эксперты
по общим вопросам
программирования на
ассемблере под DOS - </strong></font><a
href="mailto:ExpertGeneralAssm@egroups.com"><font
size="3"><strong>ExpertGeneralAssm@egroups.com</strong></font></a><font
size="3"><strong>;</strong></font></p>
</li>
<li><p align="left"><font size="3"><strong>Эксперты
по работе с Windows </strong>(<em>пользовательский
уровень</em>) - </font><a
href="mailto:ExpertWin@egroups.com"><font
size="3"><strong>ExpertWin@egroups.com</strong></font></a><font
size="3">;</font></p>
</li>
<li><p align="left"><font size="3"><strong>Эксперты
по работе с DOS </strong>(<em>пользовательский
уровень</em>)<strong> - </strong></font><a
href="mailto:ExpertDOS@egroups.com"><font
size="3"><strong>ExpertDOS@egroups.com</strong></font></a><font
size="3">;</font></p>
</li>
<li><p align="left"><font size="3"><strong>Эксперты
по оболочкам DOS </strong>- </font><a
href="mailto:ExpertDOSShells@egroups.com"><font
size="3"><strong>ExpertDOSShells@egroups.com</strong></font></a><font
size="3">;</font></p>
</li>
<li><p align="left"><font size="3"><strong>Эксперты
по AFD - </strong></font><a
href="mailto:ExpertAFD@egroups.com"><font
size="3"><strong>ExpertAFD@egroups.com</strong></font></a><font
size="3">;</font></p>
</li>
<li><p align="left"><font size="3"><strong>Эксперты
по CV - </strong></font><a
href="mailto:ExpertCV@egroups.com"><font size="3"><strong>ExpertCV@egroups.com</strong></font></a><font
size="3">;</font></p>
</li>
</ul>
<ul>
<li><p align="left"><font size="3"><strong>Эксперты
по TD - </strong></font><a
href="mailto:ExpertTD@egroups.com"><font size="3"><strong>ExpertTD@egroups.com</strong></font></a><font
size="3">.</font></p>
</li>
</ul>
<p>Ко мне пришло несколько
писем, в которых сообщалось о
том, что вы отправляете письмо
к тому или иному эксперту, а оно
возвращается назад с пометкой
&quot;адресат не найден&quot;.
Скорее всего, проблема в том,
что либо ваш провайдер
перегружен, либо &quot;глючит&quot;
eGroups. Я отправляю вопросы,
адресованные в мой адрес,
соответствующим экспертам. У
меня ни разу письмо не
вернулось! Я не знаю, с чем это
связано... Пробуйте еще раз
отправить. Если же ничего не
получается, то пишите мне,
указав в самом начале адрес
эксперта, которому следует
отправить ваш вопрос.</p>
<p><strong>Вниманию новых
подписчиков!</strong> Эксперты не
высылают предыдущие выпуски
рассылки! Пожалуйста, не
захламляйте их ящики! Помните,
что не у всех неограниченный
трафик!</p>
<hr>
<p align="center"><a name="letters"><font size="4"><strong>Ваши
письма</strong></font></a></p>
<p align="left"><font size="3">Итак, вы уже
люди взрослые, знаете многие
приемы программирования на
Ассемблере. Я бы еще добавил,
что знаете некоторые тонкости
Ассемблера.</font></p>
<p align="left"><font size="3">Это к тому, что
вам уже можно давать некоторые
полезные ссылки на
ассемблерные ресурсы, будь то
программирование на
Ассемблере, программы (утилиты)
для работы с ним, документация
про хакерство, взлом, написание
вирусов, исходники программ, со
многими из которых вы уже
можете разобраться. Все-таки
17-ый выпуск у нас.</font></p>
<p align="left"><font size="3">Ко мне
довольно-таки давно пришло
письмо от Андрея, который
предложил следующее:</font></p>
<p align="left"><font size="3"><em>&quot;Получил
рассылку №16, где говорится об
отладчиках и способах защиты
от них. Посмею предложить
интересную книгу в которой
описаны некоторые способы
обмана отладчиков и
дизассемблеров. Думаю, она
будет интересна Вашим
подписчикам. Книга называется
&quot;Техника и философия
хакерских атак&quot; Крис
Касперски. Выпущена
издательством &quot;Солон&quot;. К
книге прилагается компакт-диск
со всеми нужными программами.
Электронную версию книги можно
взять: </em></font><a
href="http://rusdoc.df.ru/material/vzlom/hackbook.zip"><font
size="3"><em>http://rusdoc.df.ru/material/vzlom/hackbook.zip</em></font></a><font
size="3"><em> </em></font></p>
<p align="left"><font size="3"><em>С
наилучшими пожеланиями, ваш
подписчик Андрей Никитин.&quot;</em></font></p>
<p align="left"><font size="3">Я бы еще
порекомендовал заглянуть на
главную страницу: </font><a
href="http://rusdoc.df.ru/index.shtml"><font size="3">http://rusdoc.df.ru/index.shtml</font></a><font
size="3">. Там, кстати, можно найти
много чего интересного для
программиста.</font></p>
<p align="left"><font size="3">____________</font></p>
<p align="left"><font size="3">Ко мне еще
пришло письмо от одного
подписчика. Каюсь, друзья мои! Я
его где-то потерял. Суть
заключается в следующем.</font></p>
<p align="left"><font size="3">Как я уже
писал в прошлый раз, когда мы
рассматривали вирус, наша
программа, скажем так, теряется
в адресах. Для этого мы код
вируса переносили в область
7-ой видеостраницы. Подписчик
предложил использовать
следующий метод получения
текущего смещения:</font></p>
<p align="left"><font size="3">...</font></p>
<p align="left"><font size="3">call Label_1 <em>;Якобы
переходим на процедуру, при
этом сохраняется в стеке адрес
следующей за командой call
инструкции (т.е. pop ax).</em></font></p>
<p align="left"><font size="3">Label_1:</font></p>
<p align="left"><font size="3">pop ax <em>;И сразу
же достаем этот адрес со стека.
Теперь в AX текущий адрес
(смещение).</em></font></p>
<p align="left"><font size="3">...</font></p>
<p align="left"><font size="3">Причем, в стек
заносится именно текущее
смещение. Т.е. не зависимо от
того, переместили ли мы сами
нашу программу куда-либо по
другому смещению или нет
(помните, когда вирус в хвост
записываем, я говорил, что
команды вида mov dx,offset Message будут
выглядеть в отладчике, как mov
dx,400h. При перемещении вируса в
хвост &quot;программы-жертвы&quot;,
мы, тем самым, перемещаем
строку Message. В итоге получается,
что по смещению 400h будет не
наша строка, а что-то другое.
Посмотрите прошлый выпуск про
вирус, вспомните.).</font></p>
<p align="left"><font size="3">Почему call Label_1
заносит <strong><u>всегда</u></strong> в
стек текущее смещение -
выяснить можно в отладчике. Тем
не менее, мы позже рассмотрим
различие mov dx,offset Message и call Label_1.
В смысле, почему в первом
случае в DX заносится константа
(постоянное число; т.е.,
например, 400h), а во втором
случае - &quot;плавающее&quot;, если
вы поняли, конечно, о чем речь
идет. Так или иначе, считайте,
что в приведенном выше примере
мы получаем <strong><u>всегда
текущее</u></strong> смещение.</font></p>
<p align="left"><font size="3">По этому
принципу мы теперь получим
текущее смещение в нашем
вирусе, тем самым усложнив
задачу и - как следствие -
усовершенствовав сам код
вируса. Но об этом ниже, в
следующем разделе.</font></p>
<p align="left"><font size="3">___________</font></p>
<p align="left"><font size="3">Я отправляю
вам письма с ответами, с
файлами, какой-то другой
информацией. Однако, некоторые
из них возвращаются обратно. Я
пытаюсь еще и еще, но адресат
все равно якобы не найден.
Извините, не могу ничего
поделать...</font></p>
<hr>
<p align="center"><a name="virus"><font size="4"><strong>Вирус</strong></font></a></p>
<p>Файл-приложение можно взять
здесь: <a
href="http://www.Kalashnikoff.ru/Assembler/Programs/Lessons/Virus17.rar">http://www.Kalashnikoff.ru/Assembler/Programs/Lessons/Virus17.rar</a></p>
<p>Итак, открываем файл Virus17.asm.
Сразу же за меткой Init мы
получаем смещение, по которому
расположена метка Get_IP
(получить IP - Instruction Pointer -
указатель инструкций). Из этого
адреса нужно вычесть смещение
метки Get_IP.</p>
<p>Вот, что получаем:</p>
<p>Допустим, мы запускаем вирус
первый раз. Т.е. все адреса в
порядке. Также допустим, что
Get_IP находится по адресу 0203h:</p>
<p>(1) [1234:0200h] call Get_IP</p>
<p>(2) [1234:0203h] Get_IP:</p>
<p>(3) [1234:0203h] pop ax</p>
<p>(4) [1234:0204h] sub ax,offset Get_IP</p>
<p>Строка (1) заносит в стек число
0203h, а (3) - достает со стека 0203h.
Т.о. мы оставили стек
выровненным и получили текущий
адрес (смещение). Сегмент, как
вы знаете, можно получить так:
mov ax,cs, чего не скажешь о IP.
Загрузка и чтение напрямую
числа в/из IP не допускается!
Поэтому нам нужно действовать
хитрее, так, как указано выше в
примере.</p>
<p>Далее получаем так: в строке
(4) вычитаем из 203h смещение
метки Get_IP в памяти. В отладчике
строка (4) будет <strong><u>всегда</u></strong>
выглядеть так:</p>
<p>sub ax,0203h <em>;sub ax,offset Get_IP ---&gt;
AX=203h-203h=0</em></p>
<p>Теперь представим, что мы
находимся в хвосте какого-то
файла, размером 1000h байт
(смотрите на смещения в
скобках). Тот же самый код будет
располагаться по такому
адресу:</p>
<p>(1) [1234:1200h] call Get_IP</p>
<p>(2) [1234:1203h] Get_IP:</p>
<p>(3) [1234:1203h] pop ax</p>
<p>(4) [1234:1204h] sub ax,offset Get_IP</p>
<p>Что мы получаем? Строка (1)
заносит в стек число 1203h. Pop ax
достает его со стека. Затем
выполняется следующее
действие:</p>
<p>sub ax,203h <em>;sub ax,offset Get_IP ---&gt;
AX=1203h-203h=1000h</em></p>
<p>Теперь в AX размер
&quot;файла-жертвы&quot;, т.е. 1000h!
Получили то, что хотели!</p>
<p>Некоторые, возможно, скажут:
&quot;Все равно ничего не понял!
Зачем мы это делаем?&quot; Ничего
страшного. Когда мы в следующем
выпуске про вирус запишемся в
хвост какого-нибудь файла, вы
увидите, что к чему. Сейчас
просто смотрите, как мы
&quot;играем&quot; с адресами...</p>
<p>Итак, теперь в AX размер
&quot;файла-жертвы&quot;. Чтобы
получить реальное смещение
того или иного адреса, нам
достаточно прибавить к уже
имеющемуся в регистре
&quot;ненормальному&quot; смещению
то, что находится в AX, т.е. длину
&quot;файла-жертвы&quot;. Вот, что мы
делаем в вирусе:</p>
<p><em>;Скопируем наш вирус в
область 7-ой видеостраницы, т.е.
сделаем то, что уже делали в
предыдущем выпуске, только
правильней.</em><br>
<font face="Arial">push 0BF00h<br>
pop es</font> <em>;ES - сегмент, куда
будем перемещать код вируса,</em><br>
<br>
<font face="Arial">mov di,offset Open_file</font> <em>;DI
- смещение (адрес самой первой
процедуры (см. файл-приложение))</em><br>
<font face="Arial">mov si,di<br>
</font><font size="4" face="Arial"><strong>add si,ax</strong></font>
<em>;SI должен содержать РЕАЛЬНЫЙ
адрес (смещение), т.к. мы пока
еще в сегменте
&quot;файла-жертвы&quot;...</em><br>
<br>
<font face="Arial">mov cx,offset Finish-100h</font> <em>;т.е.
CX = длина нашего вируса в байтах</em><br>
<font face="Arial">rep movsb</font> <em>;Теперь в
памяти две копии нашего вируса</em></p>
<p>Обратите внимание, как мы
получаем адрес первой
процедуры в памяти. Понятно,
что после offset не обязательно
должен идти адрес метки или
строки, например, для вывода с
помощью функции 09h. А так как
метки и директивы (инструкции
программы-ассемблера) не
занимают памяти, то в DI мы
занесем адрес (смещение)
первого байта процедуры Open_file,
т.е. mov ax,3D02h (не сам mov, а его
смещение!).</p>
<p>Идем дальше. Копию в 7-ой
видеостранице мы сделали.
Теперь можно и переходить
(&quot;прыгать&quot;) на нее. Но
теперь мы не будем
использовать jmp. Давайте
чуть-чуть &quot;извратимся&quot;.
Зато (как их?) &quot;ламеры&quot;
могут &quot;обломаться&quot;. Но
мы-то уже почти &quot;профи&quot;!
Прежде, чем разбирать, вспомним
про ret, retf и iret...</p>
<p>Вспомнили? Поехали!</p>
<p>(1) mov bx,offset Lab_return<br>
(2) add bx,ax<br>
(3) push cs<br>
(4) push bx<br>
(5) retf</p>
<p>(6) Lab_jmp:</p>
<p>Теперь, если вы разобрались с
retf, то труда понять принцип
работы приведенных выше строк
труда не составит. RETF достает
со стека 2 слова (4 байта):
смещение и сегмент для
возврата в то место, откуда
дальняя процедура вызывалась.
Мы же имитируем вызов
процедуры. Поверьте,
процессору все равно откуда
вызывалась процедура и куда
возвращаться нужно. Более того,
ему все равно, а вызывалась ли
процедура вообще или нет. Но
нам-то, программистам, не все
равно! Процессор, если ему
подсунули что-то не то или
забыли сделать что-то, просто
зависнет и все! А вот нам
придется воспользоваться
одной самой надежной кнопкой -
RESET. Поэтому нужно быть
предельно внимательным.</p>
<p>При вызове дальней процедуры
в стек кладется сперва
смещение, а затем - сегмент для
возврата. Знаете, почему...
Делаем это в строках (1) - (4). Но
стоп! Почему мы вначале заносим
сегмент (CS), а затем смещение (BX)?
Ну что, будем думать или сразу
сказать?..</p>
<p>Стек-то как у нас растет?
Снизу вверх. Что получится,
думаю, вы поняли. Люди вы уже
самостоятельные и грамотные...</p>
<p>В строках (1) - (2) мы получаем
смещение для возврата. К этому
смещению и прибавляем размер
&quot;файла-жертвы&quot;, который
находится в AX.</p>
<p>Теперь в стеке (а стек - это,
как мы помним, специально
отведенная память или просто
память) у нас смещение и
сегмент метки Lab_jmp (точнее
первого оператора, который
находится под ней). Что делает
строка (5)? Ну вот, видите, как
стало мне просто объяснять.
Достаточно намекнуть - и все!</p>
<p>Вопрос: а как нам вернуться
назад, в сегмент
&quot;файла-жертвы&quot;? Найдете
сами это в файле-примере?
Конечно! Не сомневаюсь! Все
элементарно! Рассылочка-то как
наша называется?</p>
<p>Что еще нового мы видим? Байты
&quot;файла-жертвы&quot;, которые
нужно восстанавливать:</p>
<p><font face="Arial">First_bytes db 90h, 90h, 90h, 90h,
0CDh, 20h</font></p>
<p>Это - знакомые машинные коды:
90h - NOP; 0CDh - INT; 20h - 20h. Получаем
программу:</p>
<p>nop<br>
nop<br>
nop<br>
nop<br>
int 20h</p>
<p>В эту переменную (в этот
массив) будем заносить первые
шесть байт
&quot;программы-жертвы&quot;, вместо
которых запишем jmp на начало
нашего вируса. Более того, эти
байты будут записаны вместе с
телом нашего вируса на диск,
после &quot;файла-жертвы&quot;. Они
нужны для того, чтобы в
последствии, когда вирус
отработает, восстановить их в
памяти по адресу 100h и
&quot;прыгнуть&quot; на 100h.
Программа даже и не заподозрит,
что кто-то перед тем, как она
получила управление, уже что-то
делал!</p>
<p>Изначально мы заполняем
массив командами nop, а после них
- int 20h. Это нужно для того, чтобы
при первом запуске вируса
корректно завершиться. Первый
запуск вируса - это когда мы
только-только его
сассемблировали (получили
com-файл) и запустили полученную
программу (в нашем случае - это
будет VIRUS17.COM). Она отработает,
заразит какой-нибудь файл (если
найдет), восстановит первые
шесть байт и передаст
управление на метку 100h,
полагая, что восстановила
байты &quot;файла-жертвы&quot; и
передала ему управление. Но на
деле мы просто выйдем в DOS. А
если мы не восстановим эти
байты, но перейдем на метку 100h?
Тогда вирус будет работать
бесконечно.</p>
<p>Если же мы заразили какой-то
файл и сохранили в переменной
First_bytes первые байты
зараженного файла, то мы просто
передадим ей управление. Вот и
все!</p>
<p><font face="Times New Roman Cyr">__________</font></p>
<p>Если вы заглянули в
файл-приложение, то заметили
там не строку</p>
<p><font face="Arial">First_bytes db 90h, 90h, 90h, 90h,
0CDh, 20h</font></p>
<p>а</p>
<p><font face="Arial">First_bytes db 4 dup (90h), 0CDh,
20h</font></p>
<p><font face="Times New Roman Cyr">Директива
DUP - DUPlicate дублирует число,
которое находится в скобка
столько раз, сколько указывает
стоящая перед ней цифра.
Сравните две строки. Все станет
понятно. Только имейте в виду,
что этот массив занимает
память на диске. Проще говоря,
он увеличивает нашу программу
на 6 байт. Пример:</font></p>
<p><font face="Times New Roman Cyr">Array db 1500 dup (0)</font></p>
<p><font face="Times New Roman Cyr">увеличит
нашу программу на 1500 байт.</font></p>
<p><font face="Times New Roman Cyr">__________</font></p>
<p>Обратите еще внимание, как мы
переходим на адрес 100h (передаем
управление
&quot;файлу-жертве&quot;):</p>
<p>mov ax,100h<br>
jmp ax</p>
<p>Видите, как можно делать...</p>
<p>А на сегодня все! Не скучной
вам недели!</p>
<hr>
<p><strong>С уважением,</strong></p>
<div align="center"><center><table border="4"
cellpadding="2" width="100%" bgcolor="#53A6A6"
bordercolor="#808080" bordercolorlight="#FFFFFF">
<tr>
<td width="33%"><p align="center"><font size="4"><strong>Автор
рассылки:</strong></font></p>
<p align="center"><em><strong>Калашников
Олег</strong></em></p>
<p align="center"><a
href="http://www.Kalashnikoff.ru"><font
color="#804040"><strong>www.Kalashnikoff.ru</strong></font></a></p>
</td>
<td width="33%"><p align="center"><font size="5"><strong>E-mail:</strong></font></p>
<p align="center"><a
href="mailto:assembler@beep.ru">assembler@beep.ru</a></p>
</td>
<td width="34%"><p align="center"><font size="4"><strong>UIN
(Тетя Ася):</strong></font></p>
<p align="center"><font color="#0000FF">68951340</font></p>
</td>
</tr>
<tr>
<td colspan="3" bgcolor="#448686"><font
color="#400040" size="1"><strong>(С)
Авторское право.</strong>
Запрещается использование
материала из рассылки в
коммерческих целях без
письменного согласия
автора.</font></td>
</tr>
</table>
</center></div></td>
</tr>
</table>
</center></div>

<hr>

<p align="center">[<a href="018.htm">Следующий выпуск</a>] [<a target=_BLANK href="http://www.Kalashnikoff.ru/">На главную страницу</a>]</p>

<HR NOSHADE><CENTER>
<!-- SpyLOG v2 f:0211 --><script language="javascript">  
u="u496.71.spylog.com";d=document;nv=navigator;na=nv.appName;p=1;  
bv=Math.round(parseFloat(nv.appVersion)*100);  
n=(na.substring(0,2)=="Mi")?0:1;rn=Math.random();z="p="+p+"&rn="+rn;y="";  
y+="<a href='http://"+u+"/cnt?f=3&p="+p+"&rn="+rn+"' target=_blank>";  
y+="<img src='http://"+u+"/cnt?"+z+  
"&r="+escape(d.referrer)+"&pg="+escape(window.location.href)+"' border=0 width=88 height=31 alt='SpyLOG'>";  
y+="</a>"; d.write(y);if(!n) { d.write("<"+"!--"); }//--></script><noscript><p align="center"><a 
href="http://u496.71.spylog.com/cnt?f=3&amp;p=1" 
target="_blank"><img src="http://u496.71.spylog.com/cnt?p=1" alt="SpyLOG" align="middle" border="0"></a> 
<a href="http://u496.71.spylog.com/cnt?f=3&amp;p=1" target="_blank"></noscript></a> 
<a href="http://u496.71.spylog.com/cnt?f=3&amp;p=1" target="_blank"> 
<script language="javascript1.2"><!-- if(!n) { d.write("--"+">"); }//--></script></a> 
<!-- SpyLOG --> 
 
 <a target=_top href="http://www.one.ru"><img src="http://cnt.one.ru/cgi-bin/cnt.cgi?id=16871&t=9" width=88 height=31 alt="be number one" border=0></a> 
 
 <script language="JavaScript"><!-- 
d=document;a='';a+=';r='+escape(d.referrer) 
js=10//--></script><script language="JavaScript1.1"><!-- 
a+=';j='+navigator.javaEnabled() 
js=11//--></script><script language="JavaScript1.2"><!-- 
s=screen;a+=';s='+s.width+'*'+s.height 
a+=';d='+(s.colorDepth?s.colorDepth:s.pixelDepth) 
js=12//--></script><script language="JavaScript1.3"><!-- 
js=13//--></script><script language="JavaScript"><!-- 
d.write('<a href="http://top.list.ru/jump?from=87856"'+ 
' target=_top><img src="http://top.list.ru/counter'+ 
'?id=87856;t=54;js='+js+a+';rand='+Math.random()+ 
'" alt="TopList"'+' border=0 height=31 width=88></a>') 
if(js>11)d.write('<'+'!-- ')//--></script><noscript><a 
target=_top href="http://top.list.ru/jump?from=87856"><img 
src="http://top.list.ru/counter?js=na;id=87856;t=54" 
border=0 height=31 width=88 
alt="TopList"></a></noscript><script language="JavaScript"><!-- 
if(js>11)d.write('--'+'>')//--></script> 
 
<br><br> 

</body>
</html>
