ГЛАВА 10. Экранные операции III: Цвет и графика

------------------------------------------------------------

Экранные операции III: Цвет и графика

Цель: Показать расширенные возможности компьютера, связанные
с использованием цвета и графики на экране.

ВВЕДЕНИЕ
------------------------------------------------------------

   Данная глава знакомит с использованием цвета для текстово
го  и графического  режимов.  Существуют  следующие три типа
видео   монитоpов,   используемые  для  изображения  цветной
графики (в порядке возpастания стоимости и качества):

1.   Немодифицированный   цветной   телевизионный   приемник
     (обычный домашний  телевизор),  применяемый многими для
     своих компьютеров.

2.   Комбинированный   видеомонитор,   принимающий  цветовой
     сигнал без радиочастотной модуляции, и используемый для
     передачи по радиоволнам.  Обеспечивает высокое качество
     изображения.

3.   RGB-монитор,  посылающий входные сигналы на три раздель
     ные электронные пушки -  красную,  зеленую  и синию для
     каждого  из  трех  основных  цветов.  Являясь  наиболее
     дорогим,  RGB-монитор  обеспечивает  наилучшее качество
     изображения.

   Стандартный адаптер  для  цветного  графического монитора
(CGA -  Color/Graphics Adapter)  использует 16К байт памяти,
начинающейся по адресу шест.B8000,  8К байт - для символов и
8К байт для их атрибутов. При работе в формате 80х25 адаптер
может хранить четыре страницы (0-3) дисплейного буфера по 4К
байт  каждая.  При  работе  в  формате  40х25  адаптер может
хранить восемь страниц (0-7) по 2К байт каждая. По умолчанию
используется нулевая страница (в  начале дисплейной памяти).
Программа  может вывести на  экран любую  страницу  и  в это
время формировать другую страницу в памяти  для последующего
вывода на экран.
   Усовершенствованный  графический адаптер (EGA  - Enhanced
Graphics  Adapter)  обеспечивает  более  высокую разрешающую
способность,  по сравнению со стандартным  цветным адаптером
(CGA)  и в большинстве случаев является  совместимым  с ним.
Разрешающая  способность  обеспечивает  320х200,  640х200  и
640х350 точек на экране.
   Цветные  адаптеры  имеют  два   основных  режима  работы:
текстовой  (алфовитно-цифровой)  и  графический,  и возможны
также  дополнительные  режимы  между   двумя  основными.  По
умолчанию  используется  текстовой  режим.  Установка режима
описана в  главе  9  в  разделе  "Преpывание  BIOS  INT 10H"



Ассемблер для IBM PC. Глава 10                           229


(AH=0).  Для установки графического  режима  или  возврата в
текстовой  режим используется  прерывание BIOS INT  10H, как
это показано в двух следующих примерах:

     MOV  AH,00  ;Режим       MOV  AH,00  ;Режим
     MOV  AL,03  ;Цвет+текст  MOV  AL,04  ;Графика среднего
     INT  10H                 INT 10H     ;  разрешения

ТЕКСТОВЫЙ (АЛФАВИТНО-ЦИФРОВОЙ) РЕЖИМ
------------------------------------------------------------

   Текстовой режим предназначен для обычных вычислений  с вы
водом букв и цифр на экран. Данный режим одинаков для черно-
белых  (BW)  и для цветных  мониторов  за  исключением того,
что цветные мониторы не поддерживают  атрибут подчеркивания.
Текстовой режим обеспечивает  работу с  полным набором ASCII
кодов  (256  символов),  как для черно-белых (BW), так и для
цветных мониторов.  Каждый символ на экране может отображать
ся  в одном из  16  цветов  на одном из восьми  цветов фона.
Бордюр экрана может иметь также один из 16 цветов.

   Цвета

   Тремя  основными  цветами  являются  красный,  зеленый  и
синий.  Комбинируя  основные  цвета,  друг  с  другом, можно
получить восемь  цветов,  включая черный и  белый. Используя
два уровня  яркости  для  каждого  цвета,  получим  всего 16
цветов:

                    I R G B                       I R G B
     Черный         0 0 0 0        Серый          1 0 0 0
     Синий          0 0 0 1        Ярко-синий     1 0 0 1
     Зеленый        0 0 1 0        Ярко-зеленый   1 0 1 0
     Голубой        0 0 1 1        Ярко-голубой   1 0 1 1
     Красный        0 1 0 0        Ярко-красный   1 1 0 0
     Сиреневый      0 1 0 1        Ярко-сиреневый 1 1 0 1
     Коричневый     0 1 1 0        Желтый         1 1 1 0
     Белый          0 1 1 0        Ярко-белый     1 1 1 1

   Таким  образом любые  символы  могут  быть  отображены на
экране в oдном из 16  цветов. Фон любого символа может иметь
один из первых восьми цветов.  Если фон и текст имеют один и
тот же цвет,  то текст получается  невидимым. Используя байт
атрибута, можно получить также мигающие символы.

   Байт-атрибут

   Текстовой режим допускает  использование  байта атрибута,
рассмотpенного  в  главе  9.  В  приведенной  ниже  таблице,
атрибут BL обозначает мигание (BLinking), RGB - соответствен
но красный, зеленый и синий цвет, I - выделение яркостью:

                    Фон            Текст



Ассемблер для IBM PC. Глава 10                           230


   Атрибут:         BL  R  G  B    I  R  G  B
   Номера битов:     7  6  5  4    3  2  1  0

   Мигание  и выделение яркостью  относится  к  тексту. Ниже
приведены некоторые типичные атрибуты:

   Текст по фону         Бит:  7  6  5  4  3  2  1  0
                              BL  R  G  B  I  R  G  B  Шест.
   Черный по черному           0  0  0  0  0  0  0  0   00
   Синий по черному            0  0  0  0  0  0  0  1   01
   Красный по синему           0  0  0  1  0  1  0  0   14
   Голубой по зеленому         0  0  1  0  0  0  1  1   23
   Светло-сиреневый по белому  0  1  1  1  1  1  0  1   7D
   Серый по зеленому, мигание  1  0  1  0  1  0  0  0   A8

   Байт-атрибут  используется  аналагично   показанному  для
черно-белого (BW) монитора. Тип монитора можно определить из
программы с помощью команды INT 11H.  Для BW монитора код 07
устанавливает нормальный атрибут.  Для цветных мониторов мож
но использовать любую из цветовых комбинаций. Цвет на экране
сохраняется до тех пор,  пока другая команда не изменит его.
Для установки цвета можно  использовать  в  команде  INT 10H
функции  AH=06,  AH=07  и  AH=09.  Например, для вывода пяти
мигающих звездочек сетло-зеленым  цветом  на  сиреневом фоне
возможна следующая программа:

          MOV  AH,09          ;Функция вывода на экран
          MOV  AL,'*'         ;Выводимый символ
          MOV  BH,00          ;Страница 0
          MOV  BL,0DAH        ;Атрибут цвета
          MOV  CX,05          ;Число повторений
          INT  10H            ;Вызвать BIOS

ГРАФИЧЕСКИЙ РЕЖИМ
------------------------------------------------------------

   Для генерации цветных  изображений  в  графическом режиме
используются  минимальные точки растра  -  пиксели  или пэлы
(pixel). Цветной графический адаптер (CGA) имеет три степени
разрешения:

1.   Низкое разрешение (не поддерживается  в ROM) обеспечива
     ет вывод 100  строк по 160  точек (т.е.  четыре бита на
     точку).   Каждая   точка   может   иметь   один  из  16
     стандартных  цветов,  как описано  в предыдущем разделе
     "Цвета".  Реализация  данного  режима  включает  прямую
     адресацию  контролера  Motorola  6845  CRT.  Для  этого
     используются два порта: шест.3D4 и 3D5.

2.   Среднее  разрешение  для  стандартной  цветной  графики
     обеспечивает 200 строк по 320 точек. Каждый байт в этом
     случае представляет  четыре  точки  (т.е.  два  бита на
     точку).



Ассемблер для IBM PC. Глава 10                           231



3.   Высокое разрешение обеспечивает 200 строк по 640 точек.
     Поскольку  в данном  случае требуется  16К байт памяти,
     высокое  разрешение  достигается  только  в черно-белом
     (BW)  режиме.  Каждый  байт здесь  представляет 8 точек
     (т.е.  один бит  на точку).  Нулевое значение бита дает
     черный цвет точки, единичное - белый.

   Заметим,  что в графическом режиме  ROM содержит точечные
образы только для  первых 128  ASCII-кодов. Команда INT  1FH
обеспечивает  доступ  к   1К  байтовой  области   в  памяти,
определяющей  остальные 128  символов.  (8  байт на символ).
Отображение  графических байтов в  видео сигналы аналогично,
как  для среднего,  так и для  высокого pазрешения.

РЕЖИМ СРЕДНЕГО РАЗРЕШЕНИЯ
------------------------------------------------------------

   При  среднем разрешении  каждый  байт представляет четыре
точки, пронумерованных от 0 до 3:

               Байт:     |C1 C0|C1 C0|C1 C0|C1 C0|
               Пиксели:     0     1     2     3

   В любой момент для каждой точки возможны четыре цвета, от
0   до  3.  Ограничение  в  4  цвета  объясняется  тем,  что
двухбитовая точка имеет 4 комбинации значений битов: 00, 01,
10  и  11.  Можно  выбpать  значение  00  для  любого  из 16
возможных цветов фона или выбрать значение 01,  10, и 11 для
одной из двух палитр. Каждая палитpа имеет три цвета:

          C1   C0        Палитра 0      Палитра 1

          0    0         фон            фон
          0    1         зеленый        голубой
          1    0         красный        сиреневый
          1    1         коричневый     белый

   Для  выбора  цвета палитры и фона  используется  INT 10H.
Таким  обpазом,  если,  например, выбран фон желтого цвета и
палитра  0,  то  возможны  следующие  цвета  точки:  желтый,
зеленый,  красный  и коричневый.  Байт,  содержащий значение
10101010,  соответствует  красным точкам.  Если выбрать цвет
фона  -  синий  и  палитру  1,  то  возможные  цвета: синий,
голубой,   сиреневый  и  белый.  Байт,  содержащий  значение
00011011,  отображает  синюю,  голубую,  сиреневую  и  белую
точки.

   Прерывание BIOS INT 10H для графики







Ассемблер для IBM PC. Глава 10                           232


   Функция AH=00  команды INT  10H устанавливает графический
ркфим.  Функция AH=11 команды INT 10H позволяет выбрать цвет
палитры и вывести на экран графический символ.  Код в регист
ре  AH  определяет  функцию:

   AH=00: Установка режима. Нулевое значение в регистре AH и
04  в pегистре AL устанавливают  стандартый цветной графичес
кий режим:

          MOV  AH,00     ;Функция установки режима
          MOV  AL,04     ;Разрешение 320х200
          INT  10H

   Установка  графического  режима  приводит  к исчезновению
курсора с экрана.  Подробности по установке режима приведены
в главе 9.

   AH=0BH:  Установка цветовой палитры.  Число в регистре BH
определяет назначение регистра BL:

   BH=00  выбирает  цвета фона  и бордюра  в  соответствии с
содержимым pегистра BL.  Цвет фона от 1  до 16 соответствует
шест. значениям oт 0 до F;
   BH=01  выбирает палитру соответственно содержимому регист
ра BL (0 или 1):

          MOV  AH,0BH    ;Функция установки цвета
          MOV  BH,01     ;Выбор палитры
          MOV  BL,00     ;  0 (зеленый, красный, корич.)
          INT  10H       ;Вызвать BIOS

   Палитра,  установленная один  раз,  сохраняется,  пока не
будет отменена другой командой. При смене палитры весь экран
меняет цветовую комбинацию. При использовании функции AH=0BH
в текстовом режиме,  значение,  установленное для цвета  0 в
палитре, определяет цвет бордюра.

   AH=0CH:  Вывод  точки на  экран.  Использование кода 0C в
регистре  AH  позволяет вывести на  экран точку  в выбранном
цвете (фон  и  палитра).  Например,  для  разрешения 320х200
загрузим в регистр DX вертикальную координату (от 0 до 199),
а в регистр CX -  горизонтальную координату (от 0 до 319). В
регистр AL поместим цвет точки (от 0 до 3):

          MOV  AH,0CH         ;Функция вывода точки
          MOV  AL,цвет        ;Цвет точки
          MOV  CX,столбец     ;Горизонтальная координата
          MOV  DX,строка      ;Вертикалькая координата
          INT  10H            ;Вызвать BIOS

   AH=0DH:  Чтение точки с экрана.  Данная функция позволяет
прочитать  точку для  определения  ее  цвета.  В  регистр DX
должна быть загружена вертикальная координата (от 0 до 199),



Ассемблер для IBM PC. Глава 10                           233


а в регистр CX - горизонтальная (от 0 до 319). В регистре AH
должно  быть  значение  0D.  Функция возвращает цвет точки в
регистре AL.

------------------------------------------------------------
------------------------------------------------------------
     Рис. 10.1 Вывод на экран в цветном графическом режиме.

ПРОГРАММА: УСТАНОВКА ГРАФИЧЕСКОГО РЕЖИМА И ОТОБРАЖЕНИЕ ЦВЕТА
------------------------------------------------------------

   Программа,  приведенная на  рис.10.1,  использует команду
INT 10H для установки графического  режима,  выбора зеленого
фона и вывода на экран точек (40  строк по 320  столбцов). В
программе происходит  увеличение  значения  цвета  на  1 для
каждой строки.  Так как в определении цвета участвуют только
три правых бита, цвета повторяются через каждые семь строк.
   После выполнения программы дисплей остается в графическом
режиме.  Восстановление текстового режима возможно с помощью
команды  DOS  MODE  (MODE  CO80)  или  пользовательской  COM
программой,  в  которой для этой  цели  используется команда
INT 10H.

ОСНОВНЫЕ ПОЛОЖЕНИЯ НА ПАМЯТЬ
------------------------------------------------------------

ъ    Память  объемом  16К  для  цветного  дисплея  позволяет
     хранить  дополнительные   страницы  (экраны).  Возможны
     четыре страницы для  экранов на 80  столбцов или восемь
     страниц для экранов на 40  столбцов.

ъ    Графический  режим обеспечивает  низкое  разрешение (не
     поддерживается в ROM),  среднее разрешение (для цветной
     графики)  и  высокое разрешение  (для черно-белой графи
     ки).

ъ    Точка   растра    (минимальный   элемент   графического
     изображения)  представляется определенным числом  бит в
     зависимости  от  графического  адаптера  и  разрешающей
     способности (низкой, средней или высокой).

ъ    Для графики среднего разрешения на  цветном графическом
     адаптере  (CGA)  можно  выбрать четыре  цвета,  один из
     которых принадлежит к 16 возможным цветам, а три других
     формируют цветовую палитру.

ВОПРОСЫ ДЛЯ САМОПРОВЕРКИ
------------------------------------------------------------

10.1. Сколько  цветов  возможно  для фона  и  для  текста на
      стандартном цветном адаптере (CGA) в текстовом режиме?





Ассемблер для IBM PC. Глава 10                           234


10.2. Напишите  байты атрибуты  в  двоичном  формате  для а)
      сиреневого на ярко-голубом,  б) коричневого на желтом,
      в)красного на сером с миганием.

10.3. Объясните  разницу в количестве  цветов, возможных при
      низком,  среднем и высоком  разрешении.

10.4. Напишите команды для  вывода  пяти  символов карточной
      масти  "бубны"  в текстовом режиме ярко-зеленым цветом
      на сиреневом фоне.

10.5. Напишите  команды для установки графического  режима с
      разрешением а)  320х200  в адаптере CGA и б) 640х200 в
      адаптере EGA.

10.6. Напишите команды для установки синего  фона в графичес
      ком режиме.

10.7. Напишите  команды для чтения  точки на 12  строке и 13
      столбце в графическом режиме.

10.8. Модифицируйте программу на рис.10.1 для: а) графическо
      го  режима  на  вашем мониторе;  б)  красного фона; в)
      строк с 10 по 30; г) столбцов с 20 по 300.
































Ассемблер для IBM PC. Глава 11                           241


