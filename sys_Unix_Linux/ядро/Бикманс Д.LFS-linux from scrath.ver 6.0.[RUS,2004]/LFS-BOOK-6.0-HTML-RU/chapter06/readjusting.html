<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content=
    "application/xhtml+xml; charset=koi8-r" />
    <title>
      6.12.&nbsp;Переустановка средств
    </title>
    <link rel="stylesheet" href="../stylesheets/lfs.css" type="text/css" />
    <meta name="generator" content="DocBook XSL Stylesheets V1.65.1" />
    <link rel="stylesheet" href="../stylesheets/lfs-print.css" type=
    "text/css" media="print" />
  </head>
  <body id="lfs" class="6.0">
    <div class="navheader">
      <div class="headertitles">
        <h4>
          Linux From Scratch - Версия 6.0
        </h4>
        <h3>
          Глава&nbsp;6.&nbsp;Установка основных системных программ
        </h3>
      </div>
      <ul class="headerlinks">
        <li class="prev">
          <a accesskey="p" href="glibc.html" title=
          "Glibc-2.3.4-20040701">Назад</a>
          <p>
            Glibc-2.3.4-20040701
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="binutils.html" title=
          "Binutils-2.15.91.0.2">Далее</a>
          <p>
            Binutils-2.15.91.0.2
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="chapter06.html" title=
          "Глава&nbsp;6.&nbsp;Установка основных системных программ">Наверх</a>.
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Linux From Scratch - Версия 6.0">В начало</a>
        </li>
      </ul>
    </div>
    <div class="sect1" lang="en" xml:lang="en">
      <div class="titlepage">
        <h1 class="sect1">
          6.12. Переустановка средств
        </h1>
      </div>
      <p>
        Теперь, когда мы установили новую библиотку C, пришло время
	переустановить наши средства. Это надо для того, чтобы вновь
	скомпилированные программы использовали именно новую библиотеку C.
	То, что мы сейчас сделаем, это реверс того, что мы делали
	на этапе &ldquo;<span class="quote">интеграции</span>&rdquo;
        в начале <a href="../chapter05/chapter05.html">Главы 5</a>.
        В <a href="../chapter05/chapter05.html">Главе 5</a>
        была проведена цепь из основных директорий  <tt class=
        "filename">/{,usr/}lib</tt> в новую директорию <tt class=
        "filename">/tools/lib</tt>. Теперь цепь будет проведена из этой
        самой директории <tt class="filename">/tools/lib</tt>в директорию
        LFS <tt class="filename">/{,usr/}lib</tt>.
      </p>
      <p>
        Первым делом мы отрегулируем компоновщик. Для этого мы вернемся к
	директориям с исходниками и сборкой из второго шага установки
	Binutils. Установим отрегулированый компоновщик запуском следующей
	команды из директориии <tt class="filename">binutils-build</tt>:
      </p>
      <pre class="userinput">
<kbd class="command">make -C ld INSTALL=/tools/bin/install install</kbd>
</pre>
      <div class="note">
        <div class="admonhead">
          <img alt="[Note]" src="../images/note.png" />
          <h3 class="admontitle">
            Замечание
          </h3>
        </div>
        <div class="admonbody">
          <p>
            Если вы пропустили предупреждение о нежелательности удаления
	    директорий с исходниками и сборкой Binutils на втором шаге
	    их установки в <a href=
            "../chapter05/chapter05.html">Главе 5</a> или по другим
	    причинам удалили их или у вас нет доступа к ним, не беспокойтесь,
	    не все потеряно. Просто проигнорируйте вышеприведенную команду.
	    В результате следующий пакет Binutils будет скомпонован с
	    использованием библиотек Glibc из <tt class=
            "filename">/tools</tt> вместо <tt class=
            "filename">/{,usr/}lib</tt>. Это не идеально, но наше тестирование
	    показывает что в обоих случаях бинарники Binutils будут идентичными.
          </p>
        </div>
      </div>
      <p>
        С этого момента все компилируемые программы будут собираться только с
	использованием библиотек из <tt class="filename">/usr/lib</tt> и <tt class=
        "filename">/lib</tt>. Параметр <i class=
        "parameter"><tt>INSTALL=/tools/bin/install</tt></i> необходим потому, что
        файл <tt class="filename">Makefile</tt>, созданый на втором шаге, содержит
        ссылки на <span><b class="command">/usr/bin/install</b></span>,
        который пока не установлен. Некоторые дистрибутивы содержат ссылку <tt class=
        "filename">ginstall</tt> которая имеет первенство в файле
        <tt class="filename">Makefile</tt> и это может создать здесь проблему.
	Вышеуказанная команда также решает и эту проблему.
      </p>
      <p>
        Теперь вы можете удалить обе директории Binutils.
      </p>
      <p>
        Теперь нам необходимо исправить точки в spec файлах GCC, которые
	указывают на динамический компоновщик так, чтобы они указывали на
	новый компоновщик. Выполним следующее:
      </p>
      <pre class="userinput">
<kbd class=
"command">sed -i 's@ /tools/lib/ld-linux.so.2@ /lib/ld-linux.so.2@g' \
    `gcc --print-file specs`</kbd>
</pre>
      <p>
        После этого также неплохо было бы проверить spec файлы, чтобы
	убедиться в сделаных изменениях.
      </p>
      <div class="important">
        <div class="admonhead">
          <img alt="[Important]" src="../images/important.png" />
          <h3 class="admontitle">
            Важно
          </h3>
        </div>
        <div class="admonbody">
          <p>
            Если вы работаете на платформе, на которой имя динамического
	    компоновщика отличается от <tt class="filename">ld-linux.so.2</tt>,
            замените &ldquo;<span class="quote">ld-linux.so.2</span>&rdquo;
            на имя компоновщика для вашей платформы в вышеуказанной команде.
	    Вернитесь к <a href=
            "../chapter05/toolchaintechnotes.html" title=
            "5.3.&nbsp;Toolchain Technical Notes">Разделу 5.3,
            &ldquo;Технические моменты&rdquo;</a>, если необходимо.
          </p>
        </div>
      </div>
      <div class="caution">
        <div class="admonhead">
          <img alt="[Caution]" src="../images/caution.png" />
          <h3 class="admontitle">
            Предупреждение
          </h3>
        </div>
        <div class="admonbody">
          <p>
            На этом месте необходимо остановиться и убедиться, что основные
	    функции (компиляция и компоновка) новых средств работают корректно.
	    Для этого есть простой тест:
          </p>
        </div>
      </div>
          <pre class="userinput">
<kbd class="command">echo 'main(){}' &gt; dummy.c
cc dummy.c
readelf -l a.out | grep ': /lib'</kbd>
</pre>
          <p>
            Если все в порядке, то не будет ошибок и на выводе вы увидите:
          </p>
          <pre class="screen">
<tt class=
"computeroutput">[Requesting program interpreter: /lib/ld-linux.so.2]</tt>
</pre>
          <p>
            Заметьте, что <tt class="filename">/lib</tt> теперь является
            префиксом нашего компоновщика.
          </p>
          <p>
            Если эта надпись вообще не появилась или появилась другая, то что-то
	    сильно не так. Вам надо исследовать и повторить все пройденые шаги,
	    чтобы найти в чем проблема и устранить ее. Точки для возврата после
	    этого места уже не будет. Как правило, что-то не так бывает с
	    вышеописаной правкой specs-фала. Любые проблемы необходимо устранить
            перед продолжением процесса.
          </p>
          <p>
            Если все прошло нормально, удалим тестовые файлы:
          </p>
          <pre class="userinput">
<kbd class="command">rm dummy.c a.out</kbd>
</pre>
        </div>
      </div>
    </div>
    <div class="navfooter">
      <ul>
        <li class="prev">
          <a accesskey="p" href="glibc.html" title=
          "Glibc-2.3.4-20040701">Назад</a>
          <p>
            Glibc-2.3.4-20040701
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="binutils.html" title=
          "Binutils-2.15.91.0.2">Далее</a>
          <p>
            Binutils-2.15.91.0.2
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="chapter06.html" title=
          "Глава&nbsp;6.&nbsp;Установка основных системных программ">Наверх</a>.
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Linux From Scratch - Версия 6.0">В начало</a>.
        </li>
      </ul>
    </div>
  </body>
</html>
