<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content=
    "application/xhtml+xml; charset=koi8-r" />
    <title>
      6.53.&nbsp;Shadow-4.0.4.1
    </title>
    <link rel="stylesheet" href="../stylesheets/lfs.css" type="text/css" />
    <meta name="generator" content="DocBook XSL Stylesheets V1.65.1" />
    <link rel="stylesheet" href="../stylesheets/lfs-print.css" type=
    "text/css" media="print" />
  </head>
  <body id="lfs" class="6.0">
    <div class="navheader">
      <div class="headertitles">
        <h4>
          Linux From Scratch - Версия 6.0
        </h4>
        <h3>
          Глава&nbsp;6.&nbsp;Установка основных системных программ
        </h3>
      </div>
      <ul class="headerlinks">
        <li class="prev">
          <a accesskey="p" href="psmisc.html" title="Psmisc-21.5">Назад</a>
          <p>
            Psmisc-21.5
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="sysklogd.html" title=
          "Sysklogd-1.4.1">Далее</a>
          <p>
            Sysklogd-1.4.1
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="chapter06.html" title=
          "Глава&nbsp;6.&nbsp;Установка основных системных программ">Наверх</a>.
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Linux From Scratch - Версия 6.0">В начало</a>
        </li>
      </ul>
    </div>
    <div class="wrap" lang="en" xml:lang="en">
      <div class="titlepage">
        <h1 class="sect1">
          6.53. Shadow-4.0.4.1
        </h1>
      </div>
      <div class="package" lang="en" xml:lang="en">
        <p>
          Пакет Shadow содержит программы для усиления безопасности системных паролей.
        </p>
        <div class="segmentedlist">
          <p>
            <b>Расчетное время сборки</b> 0.4 SBU
          </p>
          <p>
            <b>Требуемое место на диске</b> 11 MB
          </p>
        </div>
        <div class="segmentedlist">
          <p>
            <b>Shadow - зависимости установки:</b> Bash, Binutils, Bison,
            Coreutils, Diffutils, GCC, Gettext, Glibc, Grep, Make и Sed
          </p>
        </div>
      </div>
      <div class="installation" lang="en" xml:lang="en">
        <div class="titlepage">
          <h2 class="sect2">
            6.53.1. Инсталируем Shadow
          </h2>
        </div>
        <p>
          Подготавливаем Shadow для компиляции:
        </p>
        <pre class="userinput">
<kbd class="command">./configure --libdir=/usr/lib --enable-shared</kbd>
</pre>
        <p>
          Поработаем над проблемой, которая препятствует интернационализации
	  Shadow, выполнив:
        </p>
        <pre class="userinput">
<kbd class="command">echo '#define HAVE_SETLOCALE 1' &gt;&gt; config.h</kbd>
</pre>
        <p>
          Shadow некорректно декларирует функцию malloc(), означающую
          ошибку компиляции. Устраним это:
        </p>
        <pre class="userinput">
<kbd class="command">sed -i '/extern char/d' libmisc/xmalloc.c</kbd>
</pre>
        <p>
          Компилируем пакет
        </p>
        <pre class="userinput">
<kbd class="command">make</kbd>
</pre>
        <p>
          Устанавливаем пакет
        </p>
        <pre class="userinput">
<kbd class="command">make install</kbd>
</pre>
        <p>
          <a id="shadow-limits-login_access" name=
          "shadow-limits-login_access"></a>Shadow использует два файла для
	  настройки параметров аутентификации в системе. Установим эти файлы:
        </p>
        <pre class="userinput">
<kbd class="command">cp etc/{limits,login.access} /etc</kbd>
</pre>
        <p>
          <a id="shadow-login_defs" name="shadow-login_defs"></a>Вместо
          использования по умолчанию метода <span class=
	  "emphasis"><em>crypt</em></span>, используем более защищенный
          метод шифрования паролей <span class="emphasis"><em>MD5</em></span>,
          который также допускает использование паролей длинной более 8 символов.
          Также необходимо изменить положение пользовательских почтовых ящиков на
	  <tt class="filename">/var/spool/mail</tt>, которое Shadow устанавливает
	  по умолчанию в <tt class="filename">/var/mail</tt>.
          Мы сделаем это, проведя следующие изменения конфигурационного файла:
        </p>
        <pre class="userinput">
<kbd class="command">cp etc/login.defs.linux /etc/login.defs
sed -i -e 's@#MD5_CRYPT_ENAB.no@MD5_CRYPT_ENAB yes@' \
    -e 's@/var/spool/mail@/var/mail@' /etc/login.defs</kbd>
</pre>
        <p>
          Переместим некоторые ссылки/программы в более предпочтительное место:
        </p>
        <pre class="userinput">
<kbd class="command">mv /bin/sg /usr/bin
mv /bin/vigr /usr/sbin
mv /usr/bin/passwd /bin</kbd>
</pre>
        <p>
          Переместим динамические библиотеки в более предпочтительное место:
        </p>
        <pre class="userinput">
<kbd class="command">mv /usr/lib/lib{shadow,misc}.so.0* /lib</kbd>
</pre>
        <p>
          Поскольку некоторые пакеты нуждаются в расположении только что
          перемещенных библиотек в <tt class="filename">/usr/lib</tt>,создадим
	  следующие ссылки:
        </p>
        <pre class="userinput">
<kbd class="command">ln -sf ../../lib/libshadow.so.0 /usr/lib/libshadow.so
ln -sf ../../lib/libmisc.so.0 /usr/lib/libmisc.so</kbd>
</pre>
        <p>
          Опция <i class="parameter"><tt>-D</tt></i> программы
          <span><b class="command">useradd</b></span> требует директорию
          <tt class="filename">/etc/default</tt> для корректной работы:
        </p>
        <pre class="userinput">
<kbd class="command">mkdir /etc/default</kbd>
</pre>
        <p>
          Coreutils уже имеет лучшую установленную программу <span><b class=
          "command">groups</b></span> в <tt class=
          "filename">/usr/bin</tt>. Удалим аналогичную программу из Shadow:
        </p>
        <pre class="userinput">
<kbd class="command">rm /bin/groups</kbd>
</pre>
      </div>
      <div class="configuration" lang="en" xml:lang="en">
        <div class="titlepage">
          <a id="conf-shadow" name="conf-shadow"></a>
          <h2 class="sect2">
            6.53.2. Настройка Shadow
          </h2>
        </div>
        <p>
	  Этот пакет содержит утилиты для модификации паролей пользователей,
	  добавления или удаления пользователей и групп и тому подобные. Мы не
	  собираемся объяснять здесь что такое <span class="emphasis"><em>скрытие
	  паролей</em></span> (password shadowing). Полное объяснение можно
	  найти в файле <tt class="filename">doc/HOWTO</tt> в распакованой
	  директории с исходниками Shadow. Сдесь мы опишем только то, что вам
	  понадобится, если вы захотите использовать поддержку Shadow: программы,
	  которые должны проверять пароли (к примеру: xdm, демоны ftp, демоны pop3)
	  должны будут компилироваться с поддержкой 'shadow-совместимости', что
	  надо для использования работы со скрытыми паролями.
        </p>
        <p>
	  Для использования скрытых паролей, запустите команду:
        </p>
        <pre class="userinput">
<kbd class="command">pwconv</kbd>
</pre>
        <p>
	  А для использования скрытых групп, выполните:
        </p>
        <pre class="userinput">
<kbd class="command">grpconv</kbd>
</pre>
        <p>
	  При нормальных обстоятельствах, вам пока нет надобности создавать
	  пароли. Запомните, что если вы решите вернуться к этой главе для
	  включения скрытия паролей, вам надо будет сбросить пароли всех
	  пользователей командой <span><b class="command">passwd</b></span> и пароли
	  всех групп командой <span><b class="command">gpasswd</b></span>.
        </p>
      </div>
      <div class="configuration" lang="en" xml:lang="en">
        <div class="titlepage">
          <h2 class="sect2">
            6.53.3. Установка пароля root
          </h2>
        </div>
        <p>
          Выберите пароль для пользователя <span class=
          "emphasis"><em>root</em></span> и установите его командой:
        </p>
        <pre class="userinput">
<kbd class="command">passwd root</kbd>
</pre>
      </div>
      <div class="content" lang="en" xml:lang="en">
        <div class="titlepage">
          <a id="contents-shadow" name="contents-shadow"></a>
          <h2 class="sect2">
            6.53.4. Описание Shadow
          </h2>
        </div>
        <div class="segmentedlist">
          <p>
            <b>Проинсталированные программы:</b> chage, chfn, chpasswd, chsh, expiry,
            faillog, gpasswd, groupadd, groupdel, groupmod, groups, grpck,
            grpconv, grpunconv, lastlog, login, logoutd, mkpasswd, newgrp,
            newusers, passwd, pwck, pwconv, pwunconv, sg (ссылка на newgrp),
            useradd, userdel, usermod, vigr (ссылка на vipw) и vipw
          </p>
          <p>
            <b>Проинсталированные библиотеки:</b> libshadow[.a,so]
          </p>
        </div>
        <div class="variablelist">
          <h3>
            Короткое описание
          </h3>
          <dl>
            <dt>
              <a id="chage" name="chage"></a><span class=
              "term"><span><b class="command">chage</b></span></span>
            </dt>
            <dd>
              <p>
                Используется для изменения максимального количества дней до
		обязательной смены пароя.
              </p>
            </dd>
            <dt>
              <a id="chfn" name="chfn"></a><span class="term"><span><b class=
              "command">chfn</b></span></span>
            </dt>
            <dd>
              <p>
                Изменяет полное имя пользователя и некоторую другую информацию.
              </p>
            </dd>
            <dt>
              <a id="chpasswd" name="chpasswd"></a><span class=
              "term"><span><b class="command">chpasswd</b></span></span>
            </dt>
            <dd>
              <p>
                Используется для обновления паролей пользовательских аккаунтов.
              </p>
            </dd>
            <dt>
              <a id="chsh" name="chsh"></a><span class="term"><span><b class=
              "command">chsh</b></span></span>
            </dt>
            <dd>
              <p>
                Используется для изменения шелла пользователя по умолчанию.
              </p>
            </dd>
            <dt>
              <a id="expiry" name="expiry"></a><span class=
              "term"><span><b class="command">expiry</b></span></span>
            </dt>
            <dd>
              <p>
                Проверяет и изменяет правила использования паролей.
              </p>
            </dd>
            <dt>
              <a id="faillog" name="faillog"></a><span class=
              "term"><span><b class="command">faillog</b></span></span>
            </dt>
            <dd>
              <p>
                Используется для обработки логов ошибочных входов в систему,
		для установки лимита на ошибки входа до блокирования аккаунта
		или для сброса счетчика этих ошибок.
              </p>
            </dd>
            <dt>
              <a id="gpasswd" name="gpasswd"></a><span class=
              "term"><span><b class="command">gpasswd</b></span></span>
            </dt>
            <dd>
              <p>
                Используется для добавления или удаления членов и администраторов групп.
              </p>
            </dd>
            <dt>
              <a id="groupadd" name="groupadd"></a><span class=
              "term"><span><b class="command">groupadd</b></span></span>
            </dt>
            <dd>
              <p>
                Создает группу с указанным именем.
              </p>
            </dd>
            <dt>
              <a id="groupdel" name="groupdel"></a><span class=
              "term"><span><b class="command">groupdel</b></span></span>
            </dt>
            <dd>
              <p>
                Удаляет группу с указанным именем.
              </p>
            </dd>
            <dt>
              <a id="groupmod" name="groupmod"></a><span class=
              "term"><span><b class="command">groupmod</b></span></span>
            </dt>
            <dd>
              <p>
                Используется для изменения имени указанной группы или ее GID.
              </p>
            </dd>
            <dt>
              <a id="groups" name="groups"></a><span class=
              "term"><span><b class="command">groups</b></span></span>
            </dt>
            <dd>
              <p>
                Возвращает группы, членом которых является указанный пользователь.
              </p>
            </dd>
            <dt>
              <a id="grpck" name="grpck"></a><span class=
              "term"><span><b class="command">grpck</b></span></span>
            </dt>
            <dd>
              <p>
                Проверяет целосность файлов групп <tt class=
                "filename">/etc/group</tt> и <tt class=
                "filename">/etc/gshadow</tt>
              </p>
            </dd>
            <dt>
              <a id="grpconv" name="grpconv"></a><span class=
              "term"><span><b class="command">grpconv</b></span></span>
            </dt>
            <dd>
              <p>
                Создает или обновляет теневой файл групп, используя обычный файл групп.
              </p>
            </dd>
            <dt>
              <a id="grpunconv" name="grpunconv"></a><span class=
              "term"><span><b class="command">grpunconv</b></span></span>
            </dt>
            <dd>
              <p>
                Обновляет <tt class="filename">/etc/group</tt> из <tt class=
                "filename">/etc/gshadow</tt> и затем удаляет последний.
              </p>
            </dd>
            <dt>
              <a id="lastlog" name="lastlog"></a><span class=
              "term"><span><b class="command">lastlog</b></span></span>
            </dt>
            <dd>
              <p>
                Отчитывается о входах пользователей или указанного пользователя в систему.
              </p>
            </dd>
            <dt>
              <a id="login" name="login"></a><span class=
              "term"><span><b class="command">login</b></span></span>
            </dt>
            <dd>
              <p>
                Используется в начале новой сессии работы с системой.
              </p>
            </dd>
            <dt>
              <a id="logoutd" name="logoutd"></a><span class=
              "term"><span><b class="command">logoutd</b></span></span>
            </dt>
            <dd>
              <p>
                Демон, контролирующий время регистрации и порты.
              </p>
            </dd>
            <dt>
              <a id="mkpasswd" name="mkpasswd"></a><span class=
              "term"><span><b class="command">mkpasswd</b></span></span>
            </dt>
            <dd>
              <p>
                Шифрует указанный пароль указанным алгоритмом.
              </p>
            </dd>
            <dt>
              <a id="newgrp" name="newgrp"></a><span class=
              "term"><span><b class="command">newgrp</b></span></span>
            </dt>
            <dd>
              <p>
                Используется для изменения текущего GID.
              </p>
            </dd>
            <dt>
              <a id="newusers" name="newusers"></a><span class=
              "term"><span><b class="command">newusers</b></span></span>
            </dt>
            <dd>
              <p>
                Используется для создания или обновления пользовательских аккаунтов.
              </p>
            </dd>
            <dt>
              <a id="passwd" name="passwd"></a><span class=
              "term"><span><b class="command">passwd</b></span></span>
            </dt>
            <dd>
              <p>
                Используется для изменения пароля пользователя или группы.
              </p>
            </dd>
            <dt>
              <a id="pwck" name="pwck"></a><span class="term"><span><b class=
              "command">pwck</b></span></span>
            </dt>
            <dd>
              <p>
                Проверяет целостность файлов паролей <tt class=
                "filename">/etc/passwd</tt> и <tt class="filename">/etc/shadow</tt>
              </p>
            </dd>
            <dt>
              <a id="pwconv" name="pwconv"></a><span class=
              "term"><span><b class="command">pwconv</b></span></span>
            </dt>
            <dd>
              <p>
                Создает или обновляет теневой файл паролей, используя обычный файл паролей.
              </p>
            </dd>
            <dt>
              <a id="pwunconv" name="pwunconv"></a><span class=
              "term"><span><b class="command">pwunconv</b></span></span>
            </dt>
            <dd>
              <p>
                Обновляет <tt class="filename">/etc/passwd</tt> из <tt class=
                "filename">/etc/shadow</tt> и затем удаляет последний.
              </p>
            </dd>
            <dt>
              <a id="sg" name="sg"></a><span class="term"><span><b class=
              "command">sg</b></span></span>
            </dt>
            <dd>
              <p>
                Выполняет указанную команду с правами группы с указанным GID.
              </p>
            </dd>
            <dt>
              <a id="su" name="su"></a><span class="term"><span><b class=
              "command">su</b></span></span>
            </dt>
            <dd>
              <p>
                Запускает shell с заменой пользователя и ID группы.
              </p>
            </dd>
            <dt>
              <a id="useradd" name="useradd"></a><span class=
              "term"><span><b class="command">useradd</b></span></span>
            </dt>
            <dd>
              <p>
                Создает нового пользователя с указанным именем или обновляет
		информацию по умолчанию для новых пользователей.
              </p>
            </dd>
            <dt>
              <a id="userdel" name="userdel"></a><span class=
              "term"><span><b class="command">userdel</b></span></span>
            </dt>
            <dd>
              <p>
                Удаляет указанный пользовательский аккаунт.
              </p>
            </dd>
            <dt>
              <a id="usermod" name="usermod"></a><span class=
              "term"><span><b class="command">usermod</b></span></span>
            </dt>
            <dd>
              <p>
                Используется для модификации указанноко имени пользователя,
		UID, шелла, группы, домашней директории и т.п.
              </p>
            </dd>
            <dt>
              <a id="vigr" name="vigr"></a><span class="term"><span><b class=
              "command">vigr</b></span></span>
            </dt>
            <dd>
              <p>
                Редактирует файл <tt class="filename">/etc/group</tt> или <tt class=
                "filename">/etc/gshadow</tt>.
              </p>
            </dd>
            <dt>
              <a id="vipw" name="vipw"></a><span class="term"><span><b class=
              "command">vipw</b></span></span>
            </dt>
            <dd>
              <p>
                Редактирует файл <tt class="filename">/etc/passwd</tt> или <tt class=
                "filename">/etc/shadow</tt>.
              </p>
            </dd>
            <dt>
              <a id="libshadow" name="libshadow"></a><span class=
              "term"><tt class="filename">libshadow</tt></span>
            </dt>
            <dd>
              <p>
                Содержит функции, используемые большинством программ этого пакета.
              </p>
            </dd>
          </dl>
        </div>
      </div>
    </div>
    <div class="navfooter">
      <ul>
        <li class="prev">
          <a accesskey="p" href="psmisc.html" title="Psmisc-21.5">Назад</a>
          <p>
            Psmisc-21.5
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="sysklogd.html" title=
          "Sysklogd-1.4.1">Далее</a>
          <p>
            Sysklogd-1.4.1
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="chapter06.html" title=
          "Глава&nbsp;6.&nbsp;Установка основных системных программ">Наверх</a>.
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Linux From Scratch - Версия 6.0">В начало</a>.
        </li>
      </ul>
    </div>
  </body>
</html>
