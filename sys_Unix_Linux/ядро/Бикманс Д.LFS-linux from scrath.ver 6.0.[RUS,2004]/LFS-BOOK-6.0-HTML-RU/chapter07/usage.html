<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content=
    "application/xhtml+xml; charset=koi8-r" />
    <title>
      7.3.&nbsp;Как эти стартовые скрипты работают?
    </title>
    <link rel="stylesheet" href="../stylesheets/lfs.css" type="text/css" />
    <meta name="generator" content="DocBook XSL Stylesheets V1.65.1" />
    <link rel="stylesheet" href="../stylesheets/lfs-print.css" type=
    "text/css" media="print" />
  </head>
  <body id="lfs" class="6.0">
    <div class="navheader">
      <div class="headertitles">
        <h4>
          Linux From Scratch - Версия 6.0
        </h4>
        <h3>
          Глава&nbsp;7.&nbsp;Установка системных скриптов загрузки
        </h3>
      </div>
      <ul class="headerlinks">
        <li class="prev">
          <a accesskey="p" href="bootscripts.html" title=
          "LFS-Bootscripts-2.2.2">Назад</a>
          <p>
            LFS-Bootscripts-2.2.2
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="udev.html" title=
          "Device and Module Handling on an LFS System">Далее</a>
          <p>
            Поддержка устройств и модулей в LFS системе
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="chapter07.html" title=
          "Глава&nbsp;7.&nbsp;Setting Up System Bootscripts">Наверх</a>.
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Linux From Scratch - Версия 6.0">В начало</a>
        </li>
      </ul>
    </div>
    <div class="sect1" lang="en" xml:lang="en">
      <div class="titlepage">
        <h1 class="sect1">
          7.3. Как эти стартовые скрипты работают?
        </h1>
      </div>
      <p>
        Linux использует специальные средства загрузки, называемые SysVinit, которые
        основаны на концепции <span class="emphasis"><em>уровней запуска</em></span>.
        Они могут сильно различаться от одной системы к другой, и мы не можем сказать,
	что скрипты из &lt;подставите сюда имя любого дистрибутива&gt; будут работать на
	LFS. У LFS свой подход к этим скриптам, но они также соответствуют стандартам.
      </p>
      <p>
        SysVinit (с этого момента мы будем называть его &ldquo;<span class=
        "quote">init</span>&rdquo;) работает, используя схему уровней запуска. Всего есть
	семь (от 0 до 6) уровней запуска (точнее, есть больше уровней запуска, но они
	предназначены для специальных целей и обычно не используются. Документация по init
	содержит более полную информацию по этому вопросу) и каждый из них сообщает
	компьютеру, что ему делать при запуске соответствующего уровня. Уровень запуска
	по умолчанию - 3. Вот описание разных уровней загрузки и их назначение:
      </p>
      <div class="literallayout">
        <p>
          0:выключение компьютера<br />
          1:однопользовательский режим<br />
          2:многопользовательский режим без поддержки сети<br />
          3:многопользовательский режим с поддержкой сети<br />
          4:зарезервирован или используется как 3<br />
          5:тоже самое, что и 4, он обычно используется для графического входа
	  в систему (например <span><b class="command">xdm</b></span>&nbsp; из
          X-ов или <span><b class="command">kdm</b></span> из KDE)<br />
          6:перезагрузка компьютера
        </p>
      </div>
      <p>
        Для изменения уровня запуска используется команда <span><b class=
        "command">init <i class=
        "replaceable"><tt>[runlevel]</tt></i></b></span>, где <i class=
        "replaceable"><tt>[runlevel]</tt></i> нужный уровень запуска. Например,
	для перезагрузки компьютера можно использовать команду
        <span><b class="command">init 6</b></span>. Это и делает команда
        <span><b class="command">reboot</b></span>, а команда
        <span><b class="command">halt</b></span> является аналогом
        <span><b class="command">init 0</b></span>.
      </p>
      <p>
        Есть ряд директорий в <tt class=
        "filename">/etc/rc.d</tt>, которые выглядят как <tt class=
        "filename">rc?.d</tt> (где ? является уровнем запуска) и
        <tt class="filename">rcsysinit.d</tt>, которые содержат ряд
	символических ссылок. Часть из них начинается с <span class=
        "emphasis"><em>K</em></span>, другие начинаются с <span class=
        "emphasis"><em>S</em></span>, затем идут две цифры уровня инициализации.
        K означает остановку (kill) сервиса, а S - запуск (start).
        Цисло означает порядок, в котором запускаются скрипты, от 00 до 99;
	чем меньше номер, тем раньше вызывается скрипт. Когда init переключается
	на другой уровень загрузки, одни сервисы останавливаются, другие запускаются.
      </p>
      <p>
        Сами скрипты расположены в <tt class="filename">/etc/rc.d/init.d</tt>.
        Они проделывают всю работу, а ссылки только указывают на них. Ссылки
	остановки и запуска указывают на один и тот же скрипт в <tt class=
        "filename">/etc/rc.d/init.d</tt>. Это возможно благодаря тому, что скрипты
	запукаются с различными параметрами, такими как <i class=
        "parameter"><tt>start</tt></i>, <i class=
        "parameter"><tt>stop</tt></i>, <i class=
        "parameter"><tt>restart</tt></i>, <i class=
        "parameter"><tt>reload</tt></i> и <i class=
        "parameter"><tt>status</tt></i>. Когда обрабатывается ссылка К,
        то соответствующий скрипт вызывается с аргументом <i class=
        "parameter"><tt>stop</tt></i>. Если же обрабатывается ссылка S, то скрипт
	вызывается с параметром <i class="parameter"><tt>start</tt></i>.
      </p>
      <p>
        Но есть одно исключение. Ссылки, начинающиеся с
        <span class="emphasis"><em>S</em></span> в директориях <tt class=
        "filename">rc0.d</tt> и <tt class="filename">rc6.d</tt>
        вызываются только с параметром <i class="parameter"><tt>stop</tt></i>
	для остановки чего-либо. Это понятно, потому что когда вы собираетесь
	перезагрузить или отключить систему, вам не надо ничего запускать, а
	только остановить систему.
      </p>
      <p>
        Вот описание параметров, которые можно передавать скриптам запуска:
      </p>
      <div class="variablelist">
        <dl>
          <dt>
            <span class="term"><i class="parameter"><tt>start</tt></i></span>
          </dt>
          <dd>
            <p>
              Запуск сервиса.
            </p>
          </dd>
          <dt>
            <span class="term"><i class="parameter"><tt>stop</tt></i></span>
          </dt>
          <dd>
            <p>
              Остановка сервиса.
            </p>
          </dd>
          <dt>
            <span class="term"><i class=
            "parameter"><tt>restart</tt></i></span>
          </dt>
          <dd>
            <p>
              Сервис останавливается и запускается заново.
            </p>
          </dd>
          <dt>
            <span class="term"><i class=
            "parameter"><tt>reload</tt></i></span>
          </dt>
          <dd>
            <p>
              Это команда для обновления настроек сервиса. Она обычно
	      вызывается после изменения конфигурационного файла скрипта, но
	      сервису не нужно перезапускаться.
            </p>
          </dd>
          <dt>
            <span class="term"><i class=
            "parameter"><tt>status</tt></i></span>
          </dt>
          <dd>
            <p>
              Показывает, запущен ли сервис и какой у него PID.
            </p>
          </dd>
        </dl>
      </div>
      <p>
        Вы спокойно можете настраивать и изменять процесс загрузки (после
	установки вашей системы LFS). Файлы, описываемые здесь, являются только
	примерами и, возможно, вы сделаете их лучше.
      </p>
    </div>
    <div class="navfooter">
      <ul>
        <li class="prev">
          <a accesskey="p" href="bootscripts.html" title=
          "LFS-Bootscripts-2.2.2">Назад</a>
          <p>
            LFS-Bootscripts-2.2.2
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="udev.html" title=
          "Device and Module Handling on an LFS System">Далее</a>
          <p>
            Поддержка устройств и модулей в LFS системе
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="chapter07.html" title=
          "Глава&nbsp;7.&nbsp;Setting Up System Bootscripts">Наверх</a>.
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Linux From Scratch - Версия 6.0">В начало</a>.
        </li>
      </ul>
    </div>
  </body>
</html>
