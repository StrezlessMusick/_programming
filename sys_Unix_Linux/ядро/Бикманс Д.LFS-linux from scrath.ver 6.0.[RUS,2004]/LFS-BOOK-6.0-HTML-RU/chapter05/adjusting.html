<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> 
<html xmlns="http://www.w3.org/1999/xhtml"> 
  <head> 
    <meta http-equiv="Content-Type" content= 
    "application/xhtml+xml; charset=koi8-r" /> 
    <title> 
      5.9.&nbsp;Интеграция средств 
    </title> 
    <link rel="stylesheet" href="../stylesheets/lfs.css" type="text/css" /> 
    <meta name="generator" content="DocBook XSL Stylesheets V1.65.1" /> 
    <link rel="stylesheet" href="../stylesheets/lfs-print.css" type= 
    "text/css" media="print" /> 
  </head> 
  <body id="lfs" class="6.0"> 
    <div class="navheader"> 
      <div class="headertitles"> 
        <h4> 
          Linux From Scratch - Версия 6.0 
        </h4> 
        <h3> 
          Глава&nbsp;5.&nbsp;Построение временной системы 
        </h3> 
      </div> 
      <ul class="headerlinks"> 
        <li class="prev"> 
          <a accesskey="p" href="glibc.html" title= 
          "Glibc-2.3.4-20040701">Назад</a> 
          <p> 
            Glibc-2.3.4-20040701 
          </p> 
        </li> 
        <li class="next"> 
          <a accesskey="n" href="tcl.html" title="Tcl-8.4.7">Далее</a> 
          <p> 
            Tcl-8.4.7 
          </p> 
        </li> 
        <li class="up"> 
          <a accesskey="u" href="chapter05.html" title= 
          "Глава&nbsp;5.&nbsp;Построение временной системы">Наверх</a>. 
        </li> 
        <li class="home"> 
          <a accesskey="h" href="../index.html" title= 
          "Linux From Scratch - Версия 6.0">В начало</a> 
        </li> 
      </ul> 
    </div> 
    <div class="sect1" lang="en" xml:lang="en"> 
      <div class="titlepage"> 
        <h1 class="sect1"> 
          5.9. "Интеграция" средств 
        </h1> 
      </div> 
      <p> 
        Теперь, когда временные библиотеки C были установлены, мы хотим, 
	чтобы все оставшиеся в этой главе пакеты компоновались с использованием 
	уже установленных библиотек. Чтобы обеспечить это, мы должны настроить 
	specs файл компилятора. 
      </p> 
      <p> 
        Заменим компоновщик, установленный в конце первого шага сборки Binutils, 
        запуском следующей команды в директории <tt class= 
        "filename">binutils-build</tt>: 
      </p> 
      <pre class="userinput"> 
<kbd class="command">make -C ld install</kbd> 
</pre> 
      <p> 
        С этого момента все пакеты быдут собраны только с использованием библиотек из 
        <tt class="filename">/tools/lib</tt>. 
      </p> 
      <div class="note"> 
        <div class="admonhead"> 
          <img alt="[Note]" src="../images/note.png" /> 
          <h3 class="admontitle"> 
            Замечание 
          </h3> 
        </div> 
        <div class="admonbody"> 
          <p> 
            Если вы пропустили предупреждение о том, что не надо было 
	    удалять директории с исходниками и сборкой Binutils из 
	    первого шага или у вас нет доступа к ним, не беспокойтесь, не все 
	    потеряно. Просто проигнорируйте вышеприведенную команду. В результате 
	    появится небольшой шанс, что программы будут скомпонованы с 
	    использованием библиотек основной системы. Это не очень хорошо, но тем 
	    не менее не является такой уж большой проблемой. Ситуация будет 
	    исправлена позже на втором шаге установки Binutils. 
          </p> 
        </div> 
      </div> 
      <p> 
        Теперь, когда установлен откорректированый компоновщик, вы можете 
	удалить директории с исходниками и сборкой Binutils. 
      </p> 
      <p> 
        Следующим нашим действием будет исправление specs-файла GCC для задания 
	расположения нашего компоновщика. Просто выполните следующую команду: 
      </p> 
      <pre class="userinput"> 
<kbd class="command">SPECFILE=`gcc --print-file specs` &amp;&amp; 
sed 's@ /lib/ld-linux.so.2@ /tools/lib/ld-linux.so.2@g' \ 
    $SPECFILE &gt; tempspecfile &amp;&amp; 
mv -f tempspecfile $SPECFILE &amp;&amp; 
unset SPECFILE</kbd> 
</pre> 
      <p> 
        <span>Мы рекомендуем просто скопировать и вставить вышеуказанное вместо 
	того, чтобы просто вводить.</span> Или, при желании, вы можете просто 
	отредактировать specs-файл вручную, заменив встречающиеся строки 
        &ldquo;<span class="quote">/lib/ld-linux.so.2</span>&rdquo; на 
        &ldquo;<span class="quote">/tools/lib/ld-linux.so.2</span>&rdquo; 
      </p> 
      <div class="important"> 
        <div class="admonhead"> 
          <img alt="[Important]" src="../images/important.png" /> 
          <h3 class="admontitle"> 
            Важно 
          </h3> 
        </div> 
        <div class="admonbody"> 
          <p> 
            Если вы работаете на платформе, где имя динамического компоновщика 
	    отлично от <tt class="filename">ld-linux.so.2</tt>, 
            замените&ldquo;<span class="quote">ld-linux.so.2</span>&rdquo; 
            на имя динамического компоновщика вашей платформы в вышеуказанных командах. 
            При необходимости вернитесь к <a href="toolchaintechnotes.html" title= 
            "5.3.&nbsp;">Разделу 5.3</a>. 
          </p> 
        </div> 
      </div> 
      <p> 
        Есть возможность, что некоторые включаемые файлы из основной системы 
	имеются внутри директорий для включаемых файлов GCC. Это могло произойти 
	по причине того, что процесс &ldquo;<span class= 
        "quote">fixincludes</span>&rdquo; запускается как часть сборки GCC. 
        Позже мы раскажем об этом подробнее в этой главе. А пока запустите 
	следующую команду, чтобы исключить эту возможность: 
      </p> 
      <pre class="userinput"> 
<kbd class= 
"command">rm -f /tools/lib/gcc/*/*/include/{pthread.h,bits/sigthread.h}</kbd> 
</pre> 
      <div class="caution"> 
        <div class="admonhead"> 
          <img alt="[Caution]" src="../images/caution.png" /> 
          <h3 class="admontitle"> 
            Внимание 
          </h3> 
        </div> 
        <div class="admonbody"> 
          <p> 
            На этом месте необходимо остановиться и убедиться, что основные 
	    функции (компиляция и компоновка) новых средств работают корректно. Для 
	    этого есть простой тест: 
          </p> 
        </div> 
    </div> 
          <pre class="userinput"> 
<kbd class="command">echo 'main(){}' &gt; dummy.c 
cc dummy.c 
readelf -l a.out | grep ': /tools'</kbd> 
</pre> 
          <p> 
            Если все в порядке, то не будет ошибок и вы увидите следующее: 
          </p> 
          <pre class="screen"> 
<tt class="computeroutput">[Requesting program interpreter: /tools/lib/ld-linux.so.2]</tt> 
</pre> 
          <p> 
            Заметим, что <tt class="filename">/tools/lib</tt> становится 
            префиксом динамического компоновщика. 
          </p> 
          <p> 
            Если эта надпись вообще не появилась или появилась другая, то что-то 
	    сильно не так. Вам надо исследовать и повторить все пройденые шаги, 
	    чтобы найти в чем проблема и устранить ее. Точки для возврата после 
	    этого места уже не будет. Сначала опять проведите предыдущий тест, 
            используя <span><b class="command">gcc</b></span> вместо 
            <span><b class="command">cc</b></span>. Если это работает, тогда 
            отсутствует ссылка <tt class="filename">/tools/bin/cc</tt>. 
            Обратитесь к <a href="gcc-pass1.html" title= 
            "5.5.&nbsp;GCC-3.4.1 - Pass 1">Разделу 5.5, &ldquo;GCC-3.4.1 - 
            Шаг 1&rdquo;</a> и установите ссылку. Следующее, убедитесь в корректности 
            <tt class="envar">PATH</tt>. Это можно проверить запуском команды 
            <span><b class="command">echo $PATH</b></span> и проверить, что 
            <tt class="filename">/tools/bin</tt> является первым в списке. 
            Если <tt class="envar">PATH</tt> ошибочен, это может означать, что вы 
            зарегистрировались не как пользователь <span class= 
            "emphasis"><em>lfs</em></span> или что что-то прошло не правильно 
            в <a href="../chapter04/settingenvironment.html" title= 
            "4.4.&nbsp;Setting Up the Environment">Разделе 4.4, 
            &ldquo;Установка переменных окружения&rdquo;</a>. С другими опцииями 
            что-нибудь может пойти не так при исправлении в specs-файле выше. 
            В этом случае, подправьте исправление в specs-файле<span>, будьте 
            осторожны при копировании и вставке команд</span>. 
          </p> 
          <p> 
            Если все прошло нормально, удалим тестовые файлы: 
          </p> 
          <pre class="userinput"> 
<kbd class="command">rm dummy.c a.out</kbd> 
</pre> 
        </div> 
      </div> 
    </div> 
    <div class="navfooter"> 
      <ul> 
        <li class="prev"> 
          <a accesskey="p" href="glibc.html" title= 
          "Glibc-2.3.4-20040701">Назад</a> 
          <p> 
            Glibc-2.3.4-20040701 
          </p> 
        </li> 
        <li class="next"> 
          <a accesskey="n" href="tcl.html" title="Tcl-8.4.7">Далее</a> 
          <p> 
            Tcl-8.4.7 
          </p> 
        </li> 
        <li class="up"> 
          <a accesskey="u" href="chapter05.html" title= 
          "Глава&nbsp;5.&nbsp;Построение временной системы">Наверх</a>. 
        </li> 
        <li class="home"> 
          <a accesskey="h" href="../index.html" title= 
          "Linux From Scratch - Версия 6.0">В начало</a>. 
        </li> 
      </ul> 
    </div> 
  </body> 
</html> 
