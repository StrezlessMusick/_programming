<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8" /><link rel="stylesheet" href="../tpl/style.css@f4e332aa" type="text/css" /><link rel="prev" href="16" /><link rel="next" href="18" /><link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css' /><style type="text/css">h1,h2,h3,h4{font-family:'Open Sans',sans-serif}</style><title>Перевод RFC 3549 — Linux Netlink как протокол для служб IP, стр. 17</title><meta name="author" content="Jamal Hadi Salim, Hormuzd M Khosravi, Andi Kleen, Alexey Kuznetsov" /><link rel="alternate" type="application/rss+xml" title="RFC2.ru - Русские Переводы RFC" href="../rss.xml"></head><body><div id="content"><div id="nav"><div class="icon i0"></div> <a href="../index.html" accesskey="`">На Главную</a></div><div id="search" class="ya-site-form ya-site-form_inited_no"><form action="http://yandex.ru/sitesearch" method="get" target="_blank"><input type="hidden" name="searchid" value="2154295"/><input type="hidden" name="l10n" value="ru"/><input type="hidden" name="reqenc" value=""/><input type="hidden" name="submit" value="Найти"/><input type="search" value="" name="text" placeholder="Поиск по RFC2.ru" /></form></div><div itemscope itemtype="http://schema.org/ScholarlyArticle"><meta itemprop="inLanguage" content="ru" /><meta itemprop="editor" content="ru" /><div id="header"><h1><a itemprop="headline" href="../3549.rfc">RFC 3549 — Linux Netlink как протокол для служб IP</a></h1></div><dl class="mute"><dt></dt><dd><div class="icon i1"></div> RFC: 3549</dd><dd><div class="icon i3"></div> Оригинал: <a href="original" target="_blank" rel="nofollow"><span itemprop="alternativeHeadline">Linux Netlink as an IP Services Protocol</span></a></dd><dd><div class="icon i2"></div> Категория: <span itemprop="articleSection">Информационный</span></dd><dd><div class="icon i4"></div> Дата публикации: <time itemprop="datePublished" datetime="2003-07-01">Июль 2003</time></dd><dd><div class="icon i5"></div> Авторы: <span itemprop="author">Jamal Hadi Salim</span>, <span itemprop="author">Hormuzd M Khosravi</span>, <span itemprop="author">Andi Kleen</span>, <span itemprop="author">Alexey Kuznetsov</span></dd><dd><div class="icon i6"></div> Перевод: <span itemprop="editor">Николай Малых</span></dd></dl><div class="pages"><p class="r"> <h2 class="pt"><span class="z">RFC 3549,</span> Страница 17 из 21</h2></p><ul><li><noindex><a href="print" rel="nofollow">Одной Страницей</a></noindex></li><li><a accesskey="1" title="Первая страница" href="../3549.rfc" class="arr">&lArr;</a></li><li><a accesskey="2" title="На страницу назад" href="16"><b>&larr;</b></a></li><li><a class="x" href="../3549.rfc">1</a></li><li><a class="x" href="2">2</a></li><li><a class="x" href="3">3</a></li><li><a class="x" href="4">4</a></li><li><a class="x" href="5">5</a></li><li><a class="x" href="6">6</a></li><li><a class="x" href="7">7</a></li><li><a class="x" href="8">8</a></li><li><a class="x" href="9">9</a></li><li><a class="x" href="10">10</a></li><li><a class="x" href="11">11</a></li><li><a class="x" href="12">12</a></li><li><a href="13">13</a></li><li><a href="14">14</a></li><li><a href="15">15</a></li><li><a href="16">16</a></li><li class="this"><span>17</span></li><li><a href="18">18</a></li><li><a href="19">19</a></li><li><a href="20">20</a></li><li><a href="21">21</a></li><li><a accesskey="3" title="На страницу вперед" href="18">&rarr;</a></li><li><a accesskey="4" title="Последняя страница" href="21">&rArr;</a></li></ul></div><div id="text" itemprop="articleBody"><h3>3.2. Служба NETLINK_FIREWALL</h3><p>Эта служба позволяет CPC принимать пакеты через сервисные модули межсетевого экрана IPv4 в FE, манипулировать этими пакетами и повторно передавать их. Правило межсетевого экрана является первым из числа вставляемых для активизации перенаправления пакетов. CPC информирует FEC о своем желании получать метаданные для пакета или реальные данные из него, а также сообщает максимальный размер данных, которые будут перенаправляться. Перенаправленные пакеты по-прежнему сохраняются в FEC, ожидая решения о своей судьбе от CPC. Решение может быть простой командой на восприятие или отбрасывание пакета (в этом случае решение применяется к пакету, все еще находящемуся в FEC) или включать измененный пакет, который должен быть передан взамен исходного.</p><p>Существует два типа сообщений, передаваемых от CPC к FEC — Mode (режим) и Verdict (решение). Сообщения типа Mode незамедлительно передаются FEC и сообщают о том, что CPC желает принимать от FEC. Сообщения типа Verdict передаются FEC после принятия решения о дальнейшей судьбе полученного пакета. Формат сообщений рассматривается ниже.</p><p>Опишем сначала сообщение, указывающее режим.</p><pre>0                   1                   2                   3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|   Mode    |    Reserved1  |           Reserved2             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                         Range                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</pre><ul><li class="b">Mode — 8 битов</li><li class="lib"><p>Определяет тип информации в пакетах, отправляемых CPC:</p><ul><li>IPQ_COPY_META — копировать в CPC только метаданные для пакета.</li><li>IPQ_COPY_PACKET — копировать в CPC метаданные и содержимое поля данных пакета.</li></ul></li><li class="b">Range — 32 бита</li><li class="lib">В режиме IPQ_COPY_PACKET это значение определяет максимальный размер копируемых данных.</li></ul><p>Пакет и связанные с ним метаданные, полученные из пользовательского пространства, показаны на рисунке:</p><pre>0                   1                   2                   3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                       Packet ID                             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                          Mark                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                       timestamp_m                           |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                       timestamp_u                           |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                          hook                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                       indev_name                            |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                       outdev_name                           |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|           hw_protocol       |        hw_type                |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|         hw_addrlen          |           Reserved            |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                       hw_addr                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                       data_len                              |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                      Payload . . .                          |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</pre><ul><li class="b">Packet ID — 32 бита</li><li class="lib">Уникальный идентификатор пакета, передаваемый CPC от FEC.</li><li class="b">Mark — 32 бита</li><li class="lib">Значение внутренних метаданных, установленное для описания правила, в котором был взят пакет.</li><li class="b">timestamp_m — 32 бита</li><li class="lib">Время прибытия пакета (в секундах)</li><li class="b">timestamp_u — 32 бита</li><li class="lib">Время прибытия пакета (микросекунды, добавляемые к timestamp_m)</li><li class="b">hook — 32 бита</li><li class="lib">Модуль межсетевого экрана, из которого был взят пакет.</li><li class="b">indev_name — 128 битов</li><li class="lib">Имя приемного интерфейса (строка ASCII).</li><li class="b">outdev_name — 128 битов</li><li class="lib">Имя выходного интерфейса (строка ASCII).</li><li class="b">hw_protocol — 16 битов</li><li class="lib">Аппаратный протокол (в сетевом порядке битов).</li><li class="b">hw_type — 16 битов</li><li class="lib">Тип оборудования.</li><li class="b">hw_addrlen — 8 битов</li><li class="lib">Размер аппаратного адреса.</li><li class="b">hw_addr — 64 бита</li><li class="lib">Аппаратный адрес.</li><li class="b">data_len — 32 бита</li><li class="lib">Размер данных в пакете.</li><li class="b">Payload — размер задается полем data_len</li><li class="lib">Данные из полученного пакета.</li></ul><p>Формат сообщений типа Verdict показан на рисунке:</p><pre>0                   1                   2                   3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                         Value                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                       Packet ID                             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                      Data Length                            |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                      Payload . . .                          |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</pre><ul><li class="b">Value — 32 бита</li><li class="lib"><p>Решение, принятое по отношению к пакету, который по-прежнему находится в FEC. Поддерживаются значения:</p><ul><li>NF_ACCEPT — принять пакет для дальнейшей обработки.</li><li>NF_DROP — отбросить (Drop) пакет.</li></ul></li><li class="b">Packet ID — 32 бита</li><li class="lib">Уникальный идентификатор пакета, передаваемый CPC от FEC.</li><li class="b">Data Length — 32 бита</li><li class="lib">Размер данных в измененном пакете (в байтах). Если пакет не был изменен, это поле имеет значение 0.</li><li class="b">Payload — размер определяется значением поля Data Length.</li></ul><h3>3.3. Служба NETLINK_ARPD</h3><p>Этот сервис используется CPC для поддержки таблицы соседей в FE. Формат сообщений, передаваемых между FEC и CPC, описан параграфе, посвященном службе учета соседей (стр. 10).</p><p>Предполагается, что сервис CPC принимает участие в работе протоколов организации соседских отношений (neighbor solicitation protocol).</p><p>Сообщение типа RTM_NEWNEIGH передается CPC от FE для информирования CPC об изменениях, которые могут произойти с записью для этого соседа.</p><p>Сообщения RTM_GETNEIGH используются для получения информации о конкретном соседе.</p></div></div><noindex><div class="pages"><p class="r"> <b>Страница 17 из 21</b></p><ul><li><noindex><a href="print" rel="nofollow">Одной Страницей</a></noindex></li><li><a title="Первая страница" href="../3549.rfc" class="arr">&lArr;</a></li><li><a title="На страницу назад" href="16"><b>&larr;</b></a></li><li><a class="x" href="../3549.rfc">1</a></li><li><a class="x" href="2">2</a></li><li><a class="x" href="3">3</a></li><li><a class="x" href="4">4</a></li><li><a class="x" href="5">5</a></li><li><a class="x" href="6">6</a></li><li><a class="x" href="7">7</a></li><li><a class="x" href="8">8</a></li><li><a class="x" href="9">9</a></li><li><a class="x" href="10">10</a></li><li><a class="x" href="11">11</a></li><li><a class="x" href="12">12</a></li><li><a href="13">13</a></li><li><a href="14">14</a></li><li><a href="15">15</a></li><li><a href="16">16</a></li><li class="this"><span>17</span></li><li><a href="18">18</a></li><li><a href="19">19</a></li><li><a href="20">20</a></li><li><a href="21">21</a></li><li><a title="На страницу вперед" href="18">&rarr;</a></li><li><a title="Последняя страница" href="21">&rArr;</a></li></ul></div></noindex><div id="disqus_thread"></div><script type="text/javascript">var disqus_shortname="rfc2",disqus_title="RFC 3549 - Linux Netlink как протокол для служб IP",disqus_identifier="3549.rfc",disqus_url="http://rfc2.ru/3549.rfc";(function(){var dsq=document.createElement("script");dsq.type="text/javascript";dsq.async=true;dsq.src = "//"+disqus_shortname+".disqus.com/embed.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(dsq);})();</script><div class="bubble">2007 - 2014 © <a href="../index.html" title="Русские переводы RFC">Русские переводы RFC</a>, IETF, ISOC.</div></div><div id="bottom" style="position:static !important;bottom:auto !important"><div class="bubble"><ul><li><!--723572853672--></li></ul></div></div><!-- Yandex.Metrika counter --><script type="text/javascript">(function (d, w, c) { (w[c] = w[c] || []).push(function() { try { w.yaCounter4680559 = new Ya.Metrika({id:4680559, webvisor:true, clickmap:true, accurateTrackBounce:true, trackHash:true}); } catch(e) { } }); var n = d.getElementsByTagName("script")[0], s = d.createElement("script"), f = function () { n.parentNode.insertBefore(s, n); }; s.type = "text/javascript"; s.async = true; s.src = (d.location.protocol == "https:" ? "https:" : "http:") + "//mc.yandex.ru/metrika/watch.js"; if (w.opera == "[object Opera]") { d.addEventListener("DOMContentLoaded", f, false); } else { f(); } })(document, window, "yandex_metrika_callbacks");</script><noscript><div><img src="http://mc.yandex.ru/watch/4680559" style="position:absolute; left:-9999px;" alt="" /></div></noscript><!-- /Yandex.Metrika counter --></body></html>