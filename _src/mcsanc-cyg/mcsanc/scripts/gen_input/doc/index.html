<!DOCTYPE html>

<html>
<head>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">

<title>RDoc Documentation</title>

<link type="text/css" media="screen" href="./rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "./";
</script>

<script type="text/javascript" charset="utf-8" src="./js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/navigation.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/search_index.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/search.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/searcher.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/darkfish.js"></script>


<body>
<nav id="metadata">
  <nav id="home-section" class="section">
  <h3 class="section-header">
    <a href="./index.html">Home</a>
    <a href="./table_of_contents.html#classes">Classes</a>
    <a href="./table_of_contents.html#methods">Methods</a>
  </h3>
</nav>


  <nav id="search-section" class="section project-section" class="initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <h3 class="section-header">
      <input type="text" name="search" placeholder="Search" id="search-field"
             title="Type to search, Up and Down to navigate, Enter to load">
    </h3>
  </form>

  <ul id="search-results" class="initially-hidden"></ul>
</nav>


  <div id="project-metadata">
    <nav id="fileindex-section" class="section project-section">
  <h3 class="section-header">Pages</h3>

  <ul>
  
    <li class="file"><a href="./README.html">README</a>
  
  </ul>
</nav>

    <nav id="classindex-section" class="section project-section">
  <h3 class="section-header">Class and Module Index</h3>

  <ul class="link-list">
  
    <li><a href="./Config_gen.html">Config_gen</a>
  
    <li><a href="./MCSANC_Output.html">MCSANC_Output</a>
  
    <li><a href="./MCSANC_Session.html">MCSANC_Session</a>
  
    <li><a href="./MCSANCewparam.html">MCSANCewparam</a>
  
    <li><a href="./MCSANCinput.html">MCSANCinput</a>
  
    <li><a href="./MCSANCinput/Helper.html">MCSANCinput::Helper</a>
  
  </ul>
</nav>

  </div>
</nav>

<div id="documentation" class="description">

<h1 id="label-How+to+write+a+main+generator+script">How to write a main generator script<span><a href="#label-How+to+write+a+main+generator+script">&para;</a> <a href="#documentation">&uarr;</a></span></h1>

<h2 id="label-+%28see+example.rb%29+"><em> (see example.rb) </em><span><a href="#label-+%28see+example.rb%29+">&para;</a> <a href="#documentation">&uarr;</a></span></h2>

<p>Executable ruby script start with</p>

<pre>#!/usr/bin/ruby</pre>

<p>(to make file executable do</p>

<pre>$ chmod +x script.rb</pre>

<p>)</p>

<p>Then one should load main library <strong>mcsanc.rb</strong> and files with
specific configs (if needed).</p>

<pre class="ruby"><span class="ruby-comment"># Loading main library</span>
<span class="ruby-identifier">require</span> <span class="ruby-string">&quot;./mcsanc&quot;</span>
<span class="ruby-comment"># Loading files with specific configs</span>
<span class="ruby-identifier">require</span> <span class="ruby-string">&quot;./input.cfg_iborn-0&quot;</span>
<span class="ruby-identifier">require</span> <span class="ruby-string">&quot;./ewparam.cfg_all&quot;</span>
</pre>

<p>Next turn-on the <a href="MCSANCinput/Helper.html">MCSANCinput::Helper</a>
module which is part of <a href="MCSANCinput.html">MCSANCinput</a> class</p>

<pre>include MCSANCinput::Helper</pre>

<p>Create default configs ( <a
href="MCSANCinput.html#method-c-new">MCSANCinput.new</a>, <a
href="MCSANCewparam.html#method-c-new">MCSANCewparam.new</a>)</p>

<pre>input=MCSANCinput.new
ewparam=MCSANCewparam.new</pre>

<p>Override them with specific configs from loaded files. ruby can extend
objects with constants and methods saved in Module structure, here we
extend our configs using Modules described in
<strong>input.cfg_iborn-0.rb</strong> and
<strong>ewparam.cfg_all.rb</strong></p>

<pre>input.extend Input_BinByBin_def
ewparam.extend EW_BinByBin_def</pre>

<p>The idea is that these loaded configs describe a general setup for the
task: constants, bins and other stuff. Finaly we need to fine tune the
configs for our current job ( <a
href="Config_gen.html#method-i-add">Config_gen#add</a>, <a
href="MCSANCinput/Helper.html">MCSANCinput::Helper</a> ):</p>

<pre>input.add {
  @iflew[IBORN]=1 # here we use constant from Helper module
  @relAcc= 1e-3
  @absAcc= 1e-8
}</pre>

<p>Now we want to make <a
href="MCSANCinput.html#method-i-bin_by_bin">MCSANCinput#bin_by_bin</a>
setup</p>

<pre>bins_input=input.bin_by_bin('m34')</pre>

<p><code>bins_input</code> here is an array of inputs</p>

<p>Here is an example of center bin scale. For each input we make a copy of
<code>ewparam</code> and modify its scales. Then in the end of block we
create a session( <a
href="MCSANC_Session.html#method-c-new">MCSANC_Session.new</a> ). We use <a
href="http://ru.wikibooks.org/wiki/Ruby/%D0%A1%D0%BF%D1%80%D0%B0%D0%B2%D0%BE%D1%87%D0%BD%D0%B8%D0%BA/Array#Array.23map">map</a>
method for bins_inputs array - it returns an array of  elements returned by
the block - in this case an array of sessions.</p>

<pre class="ruby"><span class="ruby-identifier">sessions</span>=<span class="ruby-identifier">bins_input</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">bin_input</span><span class="ruby-operator">|</span>
  <span class="ruby-identifier">session_path</span>=<span class="ruby-constant">MCSANC_Session</span><span class="ruby-operator">::</span><span class="ruby-constant">SHARE</span><span class="ruby-operator">+</span><span class="ruby-node">&quot;bin_#{bin_input.vbh_bins[1]*'_'}&quot;</span>
  <span class="ruby-identifier">bin_ewparam</span>=<span class="ruby-identifier">ewparam</span>.<span class="ruby-identifier">copy</span>
  <span class="ruby-identifier">bin_ewparam</span>.<span class="ruby-identifier">fscale</span>= (<span class="ruby-identifier">bin_input</span>.<span class="ruby-identifier">vbh_bins</span>[<span class="ruby-value">1</span>][<span class="ruby-value">1</span>]<span class="ruby-operator">+</span><span class="ruby-identifier">bin_input</span>.<span class="ruby-identifier">vbh_bins</span>[<span class="ruby-value">1</span>][<span class="ruby-value">0</span>])<span class="ruby-operator">/</span><span class="ruby-value">2.0</span>
  <span class="ruby-identifier">bin_ewparam</span>.<span class="ruby-identifier">rscale</span>= (<span class="ruby-identifier">bin_input</span>.<span class="ruby-identifier">vbh_bins</span>[<span class="ruby-value">1</span>][<span class="ruby-value">1</span>]<span class="ruby-operator">+</span><span class="ruby-identifier">bin_input</span>.<span class="ruby-identifier">vbh_bins</span>[<span class="ruby-value">1</span>][<span class="ruby-value">0</span>])<span class="ruby-operator">/</span><span class="ruby-value">2.0</span>
  <span class="ruby-constant">MCSANC_Session</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">bin_input</span>,<span class="ruby-identifier">bin_ewparam</span>,<span class="ruby-identifier">session_path</span>)
}
</pre>

<p>Run all sessions together with cubacores=1 ( <a
href="MCSANC_Session.html#method-c-bunch_run">MCSANC_Session.bunch_run</a>,
<a
href="http://ru.wikibooks.org/wiki/Ruby/%D0%A1%D0%BF%D1%80%D0%B0%D0%B2%D0%BE%D1%87%D0%BD%D0%B8%D0%BA/Array#Array.23size">Array.size</a>
)</p>

<pre>MCSANC_Session.bunch_run(sessions,sessions.size,1)</pre>

<p>After the jobs are done we want to set born absolute precision for other
parts in all sessions. For each session we parse output and change input
using parsed value.</p>

<pre class="ruby"><span class="ruby-identifier">sessions</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">s</span>.<span class="ruby-identifier">read_output</span>
    <span class="ruby-identifier">s</span>.<span class="ruby-identifier">input</span>.<span class="ruby-identifier">add</span> {
      <span class="ruby-ivar">@iflew</span>[<span class="ruby-constant">IBORN</span>]= <span class="ruby-value">0</span>
      <span class="ruby-ivar">@absAcc</span>= <span class="ruby-identifier">s</span>.<span class="ruby-identifier">results</span>.<span class="ruby-identifier">born</span>.<span class="ruby-identifier">error</span><span class="ruby-operator">/</span><span class="ruby-value">10.0</span>
      <span class="ruby-ivar">@relAcc</span>= <span class="ruby-value">1e-8</span>
  }
}
</pre>

<p>see <a
href="MCSANC_Session.html#method-i-read_output">MCSANC_Session#read_output</a>,
<a
href="http://ru.wikibooks.org/wiki/Ruby/%D0%A1%D0%BF%D1%80%D0%B0%D0%B2%D0%BE%D1%87%D0%BD%D0%B8%D0%BA/Array#Array.23each">Array#each</a>
description for details</p>

<p>Finaly we run modified sessions with <a
href="MCSANC_Session.html#method-c-bunch_run">MCSANC_Session.bunch_run</a>
again</p>

<pre>MCSANC_Session.bunch_run(sessions,sessions.size,1)</pre>
</div>


<footer id="validator-badges">
  <p><a href="http://validator.w3.org/check/referer">[Validate]</a>
  <p>Generated by <a href="https://github.com/rdoc/rdoc">RDoc</a> 4.0.1.
  <p>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish Rdoc Generator</a> 3.
</footer>

