<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8" /><link rel="stylesheet" href="../tpl/style.css@f4e332aa" type="text/css" /><link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css' /><style type="text/css">h1,h2,h3,h4{font-family:'Open Sans',sans-serif}</style><link rel="canonical" href="../3034.rfc" /><meta name="Robots" content="noindex, nofollow" /><title>Перевод RFC 3034 — Применение MPLS-коммутации в сетях с ретрансляцией кадров</title><link rel="alternate" type="application/rss+xml" title="RFC2.ru - Русские Переводы RFC" href="../rss.xml"></head><body><div id="content"><div id="nav"><div class="icon i0"></div> <a href="../index.html" accesskey="`">На Главную</a></div><div id="search" class="ya-site-form ya-site-form_inited_no"><form action="http://yandex.ru/sitesearch" method="get" target="_blank"><input type="hidden" name="searchid" value="2154295"/><input type="hidden" name="l10n" value="ru"/><input type="hidden" name="reqenc" value=""/><input type="hidden" name="submit" value="Найти"/><input type="search" value="" name="text" placeholder="Поиск по RFC2.ru" /></form></div><div itemscope itemtype="http://schema.org/ScholarlyArticle"><meta itemprop="inLanguage" content="ru" /><meta itemprop="editor" content="ru" /><div id="header"><h1><a itemprop="headline" href="../3034.rfc">RFC 3034 — Применение MPLS-коммутации в сетях с ретрансляцией кадров</a></h1></div><dl class="mute"><dt></dt><dd><div class="icon i1"></div> RFC: 3034</dd><dd><div class="icon i3"></div> Оригинал: <a href="original" target="_blank" rel="nofollow"><span itemprop="alternativeHeadline">Use of Label Switching on Frame Relay Networks Specification</span></a></dd><dd><div class="icon i2"></div> Категория: <span itemprop="articleSection">Предложенный стандарт</span></dd><dd><div class="icon i4"></div> Дата публикации: <time itemprop="datePublished" datetime="2001-01-04">Январь 2001</time></dd><dd><div class="icon i5"></div> Авторы: <span itemprop="author">A. Conta</span>, <span itemprop="author">P. Doolan</span>, <span itemprop="author">A. Malis</span></dd><dd><div class="icon i6"></div> Перевод: <span itemprop="editor">Мельников Дмитрий Анатольевич</span></dd></dl><div id="text" itemprop="articleBody"><h2>Оглавление</h2><ul class="map"><li><a href="print#p1">1. Введние</a></li><li><a href="print#p2">2. Терминология</a></li><li><a href="print#p3">3. Специализированные свойства FR-коммутаторов</a></li><li><a href="print#p4">4. Вставка маркеров потока</a></li><li><a href="print#p5">5. Обработка сообщений FR/LSR-коммутаторов</a></li><li class="lia"><a href="print#p5.1">5.1. Использование DLCI-идентификаторов</a></li><li class="lia"><a href="print#p5.2">5.2. Однородные LSP-маршруты</a></li><li class="lia"><a href="print#p5.3">5.3. Неоднородные LSP-маршруты</a></li><li class="lia"><a href="print#p5.4">5.4. Обнаружение и предотвращение петлевых LSP-маршрутов</a></li><li class="lib"><a href="print#p5.4.1">5.4.1. Обнаружение FR/LSR-коммутаторов, приводящих к петлевым маршрутам (обработка TTL-времени в MPLS-системах)</a></li><li class="lib"><a href="print#p5.4.2">5.4.2. Вычисление TTL-времени в MPLS-системах</a></li><li class="lia"><a href="print#p5.5">5.5. Обработка маркеров потока входными FR/LSR-коммутаторами</a></li><li class="lia"><a href="print#p5.6">5.6. Обработка маркеров потока магистральными FR/LSR-коммутаторами</a></li><li class="lia"><a href="print#p5.7">5.7. Обработка маркеров потока выходными FR/LSR-коммутаторами</a></li><li><a href="print#p6">6. Модуль MPLS-управления для FR-сетей</a></li><li class="lia"><a href="print#p6.1">6.1. Гибридные коммутаторы (корабли в ночи, «Ships in the Night»)</a></li><li><a href="print#p7">7. Процедуры распределения и обработки маркеров</a></li><li class="lia"><a href="print#p7.1">7.1. Функционирование граничного LSR-маршрутизатора</a></li><li class="lia"><a href="print#p7.2">7.2. Эффективное использование диапазона маркеров — функция слияния, реализуемая FR/LSR-коммутаторами</a></li><li class="lia"><a href="print#p7.3">7.3. LDP-сообщения для FR-сетей</a></li><li><a href="print#p8">8. Проблемы обеспечения безопасности</a></li><li><a href="print#p.references">Ссылки</a></li></ul><h2 id="p1">1. Введние</h2><p>Существует возможность использования коммутаторов на основе ретрансляции кадров (Frame Relay switch, FR) в качестве маршрутизаторов на основе маркеров потоков (Label Switching Router, LSR). Такие FR-коммутаторы реализуют алгоритмы маршрутизации сетевого уровня (например, OSPF, IS-IS и др.), и поэтому они осуществляют доставку на основе результатов такой маршрутизации. В этой связи, нет необходимости использовать FR-маршрутизацию.</p><p>Если FR-коммутатор используется для обеспечения коммутации на основе маркеров, то верхний в наборе маркер, на основании которого принимается решение о дальнейшей доставке, размещается в DLCI-поле (Data Link Connection Identifier, идентификатор канала передачи данных/соединения канального уровня) заголовка FR-кадра (канального уровня). Вся дополнительная информация транслируется вместе с верхним маркером в наборе маркеров (если IP-пакет помечен несколько раз), но при этом она не обрабатывается FR-коммутатором. Сам же маркер (вместе с набором других маркеров) располагается между протокольным FR-заголовком канального уровня протокольным IP-заголовком сетевого уровня (рис. 1).</p><div class="pic"><img src="../img/rfc-3034-1.png" alt="Расположение набора маркеров" /><p>Рис. 1. Расположение набора маркеров</p></div><p>Постоянные виртуальные FR-каналы (Frame Relay permanent virtual circuit, PVC) могут быть настроены для доставки трафика на основе маркеров потока. DLCI-идентификаторы можно использовать в качестве MPLS-маркеров, тогда FR-коммутаторы могли бы стать FR/LSR-коммутаторами (Frame Relay Label Switching Routers, FR-LSR), а MPLS-трафик можно было бы обрабатывать в соответствие с данным стандартом, и доставлять его на основе служебной (маршрутной) информации сетевого (IP-) уровня.</p><h2 id="p2">2. Терминология</h2><ul class="list"><li><p class="b">LSR-маршрутизатор (Label Switching Router)</p><p class="lia">MPLS-узел, который обеспечивает обработку и доставку реальных IP-пакетов (сетевого уровня).</p></li><li><p class="b">LC/FR-интерфейс (label switching controlled Frame Relay interface)</p><p class="lia">FR-интерфейс, управляемый программным MPLS-модулем. IP-пакеты, доставляемые через LC/FR-интерфейс, содержат маркеры потоков в DLCI-поле.</p></li><li><p class="b">FR/LSR-коммутатор</p><p class="lia">LSR-маршрутизатор, имеющий один или более LC/FR-интерфейсов, и который транслирует FR-кадры между двумя такими интерфейсами, используя для этого маркеры потока, расположенные в DLCI-поле.</p></li><li><p class="b">Сетевой FR/LSR-сегмент (FR-LSR domain)</p><p class="lia">Совокупность FR/LSR-коммутаторов, которые взаимодействуют между собой через LC/FR-интерфейсы.</p></li><li><p class="b">Граничные LSR-маршрутизаторы сетевого FR/LSR-сегмента (edge set of an FR-LSR domain)</p><p class="lia">Совокупность LSR-маршрутизаторов, которые соединены с сетевым FR/LSR-сегментом через LC/FR-интерфейсы.</p></li><li><p class="b">Вставка маркера потока при доставке (forwarding encapsulation)</p><p class="lia">Тип MPLS-вставки при ретрансляции IP-пакета (Frame Relay, ATM, универсальная MPLS-вставка), который определяет MPLS-доставку IP-пакета, или когда имеет место вставка маркера на сетевом уровне, если такой IP-пакет доставляется на основе данных, содержащихся в заголовке сетевого уровня (IP-уровень и др.).</p></li><li><p class="b">Вставка маркера потока на входе (input encapsulation)</p><p class="lia">Тип MPLS-вставки при ретрансляции IP-пакета (Frame Relay, ATM, универсальная MPLS-вставка), когда такой пакет поступил на интерфейс LSR-маршрутизатора, или когда имеет место вставка маркера на сетевом уровне (IP-уровень и др.), если такой IP-пакет не ретранслировался с использованием MPLS-вставки.</p></li><li><p class="b">Вставка маркера потока на выходе (output encapsulation)</p><p class="lia">Тип MPLS-вставки при ретрансляции IP-пакета (Frame Relay, ATM, универсальная MPLS-вставка), когда такой пакет передан на интерфейс LSR-маршрутизатора, или когда имеет место вставка маркера на сетевом уровне (IP-уровень и др.), если такой IP-пакет не ретранслировался с использованием MPLS-вставки.</p></li><li><p class="b">Входное TTL-значение (input TTL)</p><p class="lia">TTL-значение в MPLS-вставке (в верхнем маркере из набора), когда помеченный IP-пакет поступил на LSR-интерфейс, или, когда IP-пакет не помечен, то — TTL-значение в заголовке IP-пакета (сетевого уровня).</p></li><li><p class="b">Выходное TTL-значение (output TTL)</p><p class="lia">TTL-значение в MPLS-вставке (в верхнем маркере из набора), когда помеченный IP-пакет передан на LSR-интерфейс, или, когда IP-пакет не помечен, то — TTL-значение в заголовке IP-пакета (сетевого уровня).</p></li></ul><h2 id="p3">3. Специализированные свойства FR-коммутаторов</h2><p>Несмотря на то, что MPLS-архитектура допускает большое разнообразие программных LSR-модулей (маршрутизаторов), функционирование FR/LSR-коммутатора определяется характеристиками (возможно заранее установленными) аппаратной части и ограничивается некоторыми объективными условиями, например, формат FR-кадра, устанавливаемыми стандартами FR-архитектуры (например, RFC-2427, FR-форум — FRF, и др.). Это связано с тем, что некоторые условия предопределяют наличие и применение некоторых специализированных процедур, необходимых для FR/LSR-коммутаторов. К некоторым ключевым свойствам FR-маршрутизаторов, которые определяют их функционирование как LSR-маршрутизаторов, относятся следующие:</p><ul class="list "><li><p>Функция замены маркеров реализуется по отношению к DLCI-полям в заголовке FR-кадра. А это устанавливает размер и место маркера(ов) в пакете. Длина DLCI-поля может быть 10 бит (в режиме «по умолчанию») или 23 бита, для чего может понадобиться 2 или 4 байта в заголовке.</p></li><li><p>В общем, функция уменьшения TTL-значения на единицу не предусмотрена, в то время как в обычных маршрутизаторах такая функция реализована.</p></li><li><p>Контроль и управление перегрузкой реализуется каждым сетевым узлом на основе переданных в фазе установления соединения параметров. Перед заголовками FR-кадров могут быть использованы последовательности флагов (рис. 1) вследствие, например, перегрузки, или превышения согласованных значений параметров соединения.</p></li><li><p>Несмотря на то, что стандартный коммутатор может быть настроен на сквозное сходящееся соединение (multipoint-to-point circuit), когда на входе коммутатора несколько входных интерфейсов с различными DLCI-идентификаторами, а на выходе — один выходной интерфейс с одним DLCI-идентификатором, он, как правило, не поддерживает сквозное многоадресное соединение (multipoint-to-multipoint VC).</p></li></ul><p>В данном документе представлены способы применения MPLS-коммутации в FR-коммутаторах, которые функционируют в рамках рассмотренных выше ограничений.</p><h2 id="p4">4. Вставка маркеров потока</h2><p>В режиме «по умолчанию» все помеченные пакеты должны доставляться с универсальной MPLS-вставкой (RFC-3032) на основе применения способа пустой FR-вставки (рис.2).</p><div class="pic"><img src="../img/rfc-3034-2.png" alt="Расположение маркер потока" /><p>Рис. 2. Расположение маркер потока</p></div><p>Значение <em>n</em> определяет длину адреса (Q.922) и может иметь значение 2 или 4 октета. На рис. 3 представлены форматы 2- и 4-октетного DLCI-идентификаторов (с указанием порядка следования бит).</p><div class="pic"><img src="../img/rfc-3034-3.png" alt="Форматы 2- и 4-октетного DLCI-идентификаторов" /><p>Рис. 3. Форматы 2- и 4-октетного DLCI-идентификаторов</p></div><p>Использование пустой FR-вставки означает, что маркеры в неявной форме отображают тип сетевого протокола. Правила формирования набора маркеров и процедуры при обнаружении ошибок определены в RFC-3032.</p><p>Универсальная MPLS-вставка содержит <em>n</em> маркеров для набора маркеров глубиной <em>n</em>, в котором верхняя запись содержит соответствующие значения: собственно маркер, бит «<em>S</em>» (окончание набора маркеров) и TTL-поле, но не в интересах маркера, доставляемого в DLCI-поле заголовка FR-кадра, закодированном в формате Q.922 (рис. 3).</p><h2 id="p5">5. Обработка сообщений FR/LSR-коммутаторов</h2><h3 id="p5.1">5.1. Использование DLCI-идентификаторов</h3><p>MPLS-коммутация реализуется путём привязки маркеров к маршрутам, а также на основе использования значения маркера для доставки пакетов, включая определение значения любого заменяемого маркера. При использовании FR/LSR-коммутаторов верхний (текущий) MPLS-маркер доставляется в DLCI-поле заголовка FR-кадра. Верхний маркер содержит информацию в неявной форме о протоколе сетевого уровня.</p><p>Если два FR/LSR-коммутатора соединены друг с другом, то для функционирования LDP-протокола (Label Distribution Protocol) должно быть организовано полностью дуплексное соединение. DLCI-идентификатору, используемого в интересах виртуального соединения (Virtual Circuit, VC) LDP-протокола, присваивается значение с помощью процедуры настройки, аналогично настройке DLCI-идентификатора, используемого между коммутаторами при функционировании протоколов IP-маршрутизации.</p><p>За исключением этого настраиваемого значения параметра, значения DLCI-идентификатора, используемого в MPLS-системах в обоих направлениях канала передачи данных, могут рассматриваться как относящиеся к двум независимым диапазонам, т.е. каждое направление имеет свой собственный DLCI-идентификатор (VC-соединения могут быть полудуплексными).</p><p>Допустимые диапазоны и длина DLCI-идентификаторов, а также способность слияния VC-соединений, должны устанавливаться с помощью сообщений LDP-протокола. Следует заметить, что диапазон DLCI-идентификаторов, используемых для маркеров потока, зависит от длины DLCI-поля.</p><h3 id="p5.2">5.2. Однородные LSP-маршруты</h3><p>Если &lt;LSR<sub>1</sub>, LSR<sub>2</sub>, LSR<sub>3</sub>&gt; является LSP-маршрутом, то можно предположить, что LSR<sub>1</sub>, LSR<sub>2</sub> и LSR<sub>3</sub> будут использовать один и тот же способ кодирования при доставке IP-пакета <em>P</em> от LSR<sub>1</sub> до LSR<sub>2</sub> и далее до LSR<sub>3</sub>. Такой LSP-маршрут является однородным.</p><h3 id="p5.3">5.3. Неоднородные LSP-маршруты</h3><p>Если &lt;LSR<sub>1</sub>, LSR<sub>2</sub>, LSR<sub>3</sub>&gt; является LSP-маршрутом, то можно предположить, что LSR<sub>1</sub> будет использовать один способ кодирования при доставке IP-пакета <em>P</em> от LSR<sub>1</sub> до LSR<sub>2</sub>, а LSR<sub>2</sub> — другой способ кодирования при доставке IP-пакета <em>P</em> до LSR<sub>3</sub>. В целом, MPLS-архитектура допускает использование LSP-маршрутов с различными видами кодирования на разных ретрансляционных участках. После получения помеченного IP-пакета, LSR-маршрутизатор обязан декодировать его с целью определения текущего значения в наборе маркеров, а затем — проанализировать набор маркеров с целью определения значение нового маркера для набора, после чего — закодировать соответствующим образом значение нового маркера, и в последующем — отправить помеченный IP-пакет на следующий ретрансляционный участок.</p><p>Естественно, существуют MPLS-сети, в которых функционируют комбинированные FR/LSR-коммутаторы и обычные LSR-маршрутизаторы, при этом последние использовать различные типы MPLS-вставки, например, универсальная MPLS-вставка (заголовок с MPLS-вставкой) или ATM-вставка. В таких сетях могут функционировать LSR-маршрутизаторы, имеющие FR-интерфейсы и интерфейсы для универсальной MPLS-вставки (MPLS shim). Примером сказанного является LSR-маршрутизатор, реализующий различные способы кодирования маркеров потока на разных ретрансляционных участках одного и того же LSP-маршрута. Такой LSR-маршрутизатор может удалить кодовый FR-маркер на входном интерфейсе, а на выходном интерфейсе вставить универсальную MPLS-вставку.</p><h3 id="p5.4">5.4. Обнаружение и предотвращение петлевых LSP-маршрутов</h3><p>FR/LSR-коммутаторы должны взаимодействовать со свободными FR/LSR-коммутаторами или FR-сегментами LSP-маршрутов, приводящими к петлевым маршрутам. Более того, FR/LSR-коммутаторы должны использовать соответствующие способы и средства выявления и предотвращения петлевых маршрутов.</p><h4 id="p5.4.1">5.4.1. Обнаружение FR/LSR-коммутаторов, приводящих к петлевым маршрутам (обработка TTL-времени в MPLS-системах)</h4><p>В MPLS-системах TTL-значение, содержащееся в наборе маркеров, представляет собой способ, который используется для:</p><ol class="lat lia"><li>предотвращения петлевых маршрутов;</li><li>ограничения области действия IP-пакета.</li></ol><p>Когда IP-пакет следует по LSP-маршрутe, он должен завершить маршрут с таким же TTL-значением, которое он мог бы иметь, если бы проследовал через такую же последовательность маршрутизаторов, но не использующих MPLS-коммутацию. Если IP-пакет следует по иерархической совокупности LSP-маршрутов, то общее число ретрансляционных LSR-участков должно отображаться в TTL-значении этого IP-пакета, когда последний покидает такой иерархический маршрут.</p><p>В MPLS-системах начальное TTL-значение размещается в новой записи, вставляемой в набор маркеров. Это начальное TTL-значение изымается из предшествующего (ранее используемого) TTL-поля, которое было представлено, либо в заголовке сетевого уровня, если набор маркеров ранее отсутствовал, либо из ранее существовавшей записи на более низком уровне в наборе маркеров.</p><p>FR/LSR-коммутаторы, транслируя помеченные IP-пакеты с помощью маркеров одного уровня, не уменьшают значение в TTL-поле. Последовательность таких FR/LSR-коммутаторов образует сетевой сегмент без контроля TTL-поля (non-TTL segment).</p><p>Когда IP-пакет выходит из сетевого сегмента, не контролирующего TTL-поле, тогда всё-таки целесообразно отобразить в TTL-поле число ретрансляционных LSR-участков, пройденных этим IP-пакетом. В случае использования однонаправленного адреса, это можно обеспечить путём распространения реальной протяжённости LSP-маршрута или протяжённость сетевого LSP/FR-сегмента до выходных FR/LSR-узлов, способных уменьшить значение в TTL-поле, прежде чем IP-пакеты будут доставлены в сетевой сегмент, не контролирующий TTL-поле.</p><p>Если входной FR/LSR-коммутатор, при уменьшении TTL-значения в рамках MPLS-системы, определит, что TTL-значение соответствующего IP-пакета будет просрочено ещё до его выхода из сетевого сегмента, не контролирующего TTL-поле, то FR/LSR-коммутатор обязан не транслировать этот IP-пакет с помощью MPLS-коммутации, а следовать рекомендациям, представленным в RFC-3032, и попытаться направить ответное сообщение об ошибке IP-узлу отправителю этого IP-пакета, т.е.:</p><ol class="lia"><li><p>Он интерпретирует IP-пакет, как просроченный, и направляет ответное ICMP-сообщение отправителю этого просроченного IP-пакета.</p></li><li><p>Он транслирует далее IP-пакет, как не помеченный, и содержащий TTL-значение, которое соответствует TTL-значению, указанному в заголовке сетевого уровня.</p></li></ol><p>Если входное TTL-значение равно единице, то реализуется только первое правило, рассмотренное выше.</p><p>В случае групповой адресации, реальная протяжённость LSP-маршрута или протяжённость сетевого LSP/FR-сегмента распространяется до выходного FR/LSR-узла, который способен уменьшить значение в TTL-поле, прежде чем IP-пакеты будут доставлены в сетевой сегмент, не контролирующий TTL-поле.</p><h4 id="p5.4.2">5.4.2. Вычисление TTL-времени в MPLS-системах</h4><p>Вычисление входного TTL-значение (input TTL), которое в последующем становится выходным TTL-значением (output TTL), зависит от:</p><ol class="roman lia"><li>входной вставки (input encapsulation);</li><li>доставляемой вставки (forwarding encapsulation);</li><li>выходной вставки (output encapsulation).</li></ol><p>Связь между этими тремя значениями может быть представлена как функция <em>D</em> от входной (<em>ie</em>), доставляемой (<em>fe</em>) и выходной вставок (<em>oe</em>). Соответственно, вычисление входного TTL-значение (TTL<em><sub>вх</sub></em>), которое в последующем преобразуется в выходное TTL-значение (TTL<em><sub>вых</sub></em>), может быть определено следующим образом:</p><pre>TTL<sub>вых</sub> = TTL<sub>вх</sub> – D(ie, fe, oe)</pre><p>или в краткой форме:</p><pre>TTL<sub>вых</sub> = TTL<sub>вх</sub> – d</pre><p>где <em>d</em> может принимать три значения: «0», «1» или число ретрансляционных участков в сегменте LSP-маршрута.</p><p>В таблице №1 представлены значения <em>d</em> для передачи с использованием однонаправленного адреса.</p><table class="w640 c"><tr><td><em>d</em></td><td>Тип повторного обрамления на входе</td><td>Тип повторного обрамления при доставке</td><td>Тип повторного обрамления на выходе</td></tr><tr><td>0</td><td>Ретрансляция кадров</td><td>Ретрансляция кадров</td><td>Ретрансляция кадров</td></tr><tr><td>1</td><td>Любое</td><td>Универсальная MPLS-вставка</td><td>Универсальная MPLS-вставка</td></tr><tr><td>Число ретрансляционных участков в сегменте LSP-маршрута</td><td>Любое</td><td>Универсальная MPLS-вставка или IP-протокол (сетевой уровень)</td><td>Ретрансляция кадров</td></tr><tr><th colspan="4">Таблица №1</th></tr></table><p>Число ретрансляционных участков в сегменте LSP-маршрута представляет собой значение «счётчика ретрансляционных участков», которое добавляется в маркер потока, используемый при доставке IP-пакета. Если LDP-протокол обеспечивает функцию «счётчик ретрансляционных участков», то значение последнего доставляется в составе маркера потока по LSP-маршруту (т.е. в составе LDP-сообщение имеется поле «hop count object»). Если же LDP-протокол не обеспечивает функцию «счётчика ретрансляционных участков» или обеспечивает поддержку «неизвестного значения» (unknown value), то значение «счётчика ретрансляционных участков в сегменте LSP-маршрута» равно единице.</p><p>Когда транслируется привязанный к восходящему трафику маркер, тогда «счётчик ретрансляционных участков» связан с соответствующей привязкой к нисходящему трафику. И если значение счётчика отличается от «неизвестного значения», то оно должно быть уменьшено на единицу, а результат вычитания будет транслироваться с восходящим трафиком в качестве значения счётчика, связанного с новым маркером этого потоку («неизвестное значение» счётчика транслируется без изменений). Если новое значение «счётчика ретрансляционных участков» превышает допустимое максимальное значение, то FR/LSR-коммутатор не должен передавать помеченный восходящий трафик, но вместо этого обязан направить сообщение об ошибке в составе восходящего потока.</p><p>В таблице №2 представлены значения <em>d</em> для передачи с использованием групповой адресации.</p><table class="w640 c"><tr><td><em>d</em></td><td>Тип повторного обрамления на входе</td><td>Тип повторного обрамления при доставке</td><td>Тип повторного обрамления на выходе</td></tr><tr><td>0</td><td>Ретрансляция кадров</td><td>Ретрансляция кадров</td><td>Ретрансляция кадров</td></tr><tr><td>1</td><td>Любое</td><td>Универсальная MPLS-вставка или IP-протокол (сетевой уровень)</td><td>Ретрансляция кадров</td></tr><tr><td>Число ретрансляционных участков в сегменте LSP-маршрута</td><td>Ретрансляция кадров</td><td>Универсальная MPLS-вставка или IP-протокол (сетевой уровень)</td><td>Любое</td></tr><tr><th colspan="4">Таблица №2</th></tr></table><p>Обозначим доставляемую вставку (forwarding encapsulation) символом «<em>I</em>» при использовании IP-сетей (сетевой уровень), «<em>G</em>» при использовании универсальной MPLS-вставки и «<em>F</em>» при использовании MPLS-коммутации на основе FR-сетей. Аналогично, обозначим LSR-интерфейс символом «<em>i</em>», если входная или выходная вставка относится к сетевому уровню (IP-сеть) и не откосится к MPLS-вставке, «<em>g</em>», если входная или выходная вставка является универсальной MPLS-вставкой, «<em>f</em>», если используется MPLS-коммутация на основе FR-сети, «<em>a</em>», если используется MPLS-коммутация на основе ATM-сети. Кроме этого, в дальнейшем будем использовать следующие символы «<em>iIf</em>», «<em>gGf</em>», «<em>fFf</em>» и т.п. для обозначения LSR-маршрутизаторов, которые осуществляют необходимые входные, доставляемые и выходные вставки, имеющие рассмотренное выше кодирование.</p><p>На рис. 4 и 5 представлены примеры однородного (homogeneous) и не однородного (heterogeneous) LSP-маршрутов (соответственно), в которых используется рассмотренное выше кодирование.</p><div class="pic"><img src="../img/rfc-3034-4.png" alt="Пример однородного LSP-маршрута" /><p>Рис. 4. Пример однородного LSP-маршрута</p></div><hr /><div class="pic"><a href="../img/rfc-3034-5.png" rel="nofollow" title="Увеличить" target="_blank"><img src="../img/rfc-3034-5-thumb.png" alt="Пример не однородного LSP-маршрута" /></a><p><a href="../img/rfc-3034-5.png" rel="nofollow" title="Увеличить" target="_blank">Рис. 5. Пример не однородного LSP-маршрута</a></p></div><p>На рис. 6 и 7 приведены примеры расчёта TTL-значения на входе LSP-маршрута на базе FR-сети при использовании однонаправленного адреса и на выходе LSP-маршрута на базе FR-сети при использовании групповой адресации, соответственно.</p><div class="pic"><img src="../img/rfc-3034-6.png" alt="Пример расчёта TTL-значения на входе LSP-маршрутов на базе FR-сети при использовании однонаправленного адреса" /><p>Рис. 6. Пример расчёта TTL-значения на входе LSP-маршрутов на базе FR-сети при использовании однонаправленного адреса</p></div><hr /><div class="pic"><img src="../img/rfc-3034-7.png" alt="Пример расчёта TTL-значения на выходе LSP-маршрутов на базе FR-сети при использовании групповой адресации" /><p>Рис. 7. Пример расчёта TTL-значения на выходе LSP-маршрутов на базе FR-сети при использовании групповой адресации</p></div><h3 id="p5.5">5.5. Обработка маркеров потока входными FR/LSR-коммутаторами</h3><p>Если IP-пакет впервые «попадает» в сетевой MPLS-сегмент, то он отправляется с помощью стандартных процедур доставки сетевого уровня, за исключением выходной вставки набора MPLS-маркеров, включающего, по крайней мере, одну запись (RFC-3032).</p><p>«Нулевая» FR-вставка содержит информацию о протоколе сетевого уровня, которая в неявном виде транслируется в составе маркера потока. При этом последний должен быть связан только с указанным сетевым протоколом.</p><p>TTL-поле, расположенное в верхней записи набора маркеров, заполняется в соответствие с аналогичным полем в заголовке сетевого уровня (либо «TTL», либо «Hop Limit»), значение которого было получено после доставки (и обработки IP-заголовка) на сетевом уровне (RFC-3032). Последующая обработка FR/LSR-коммутатором идентична в двух следующих возможных случаях:</p><ol class="lat lia"><li><p>Однородный LSP-маршрут — только FR-сеть — FR/LSR-коммутатор является входным.</p></li><li><p>Не однородный LSP-маршрут — LSP-маршрут формируется из сетевых FR-, PPP-, ATM-, Ethernet- и других сегментов — FR/LSR-коммутатор является входом в сетевой FR-сегмент.</p></li></ol><p>Для IP-пакетов с однонаправленными адресами, TTL-значение в MPLS-системах должно уменьшаться на число ретрансляционных участков, либо однородного LSP-маршрута на основе FR-сети, либо сетевого FR-сегмента неоднородного LSP-маршрута. Программный LDP-модуль (LDP-протокол), отвечающий за формирование LSP-маршрута, обязан направлять входному FR/LSR-коммутатору всю необходимую информацию, касающуюся числа ретрансляционных участков сетевого сегмента, не контролирующего TTL-поле.</p><p>Для IP-пакетов с групповой адресацией, TTL-значение в MPLS-системах должно уменьшаться на единицу. Программный LDP-модуль, отвечающий за формирование LSP-маршрута, обязан направлять выходному FR/LSR-коммутатору всю необходимую информацию, касающуюся числа ретрансляционных участков сетевого сегмента, не контролирующего TTL-поле.</p><p>В дальнейшем, IP-пакет, «помещённый» в FR-кадр, который используется в MPLS-системе, направляется по каналу передачи данных, и при этом FR-кадр включает верхний маркер, расположенный в поле выходного DLCI-идентификатора. FR-кадр, используемый в MPLS-системе и содержащий IP-пакет, доставляется по виртуальному FR-соединению следующему LSR-маршрутизатору.</p><h3 id="p5.6">5.6. Обработка маркеров потока магистральными FR/LSR-коммутаторами</h3><p>На выходе FR/LSR-коммутатора текущий (верхний) MPLS-маркер размещается в DLCI-поле заголовка FR-кадра. Также как и в стандартной FR-сети, поступивший на интерфейс FR-кадр содержит в своём заголовке входной DLCI-идентификатор, который просматривается в DLCI-БД (база данных, содержащая информацию о DLCI-идентификаторах), и затем заменяется на выходной DLCI-идентификатор. И после этого, вновь сформированный FR-кадр транслируется через выходной интерфейс (доставляется по ретрансляционному участку на следующий сетевой узел).</p><p>Информация о текущем маркере также транслируется в верхней записи набора маркеров. В записи верхнего уровня все поля имеют текущее значение, кроме данных о маркере, которые доставляются в заголовке FR-кадра и заменяются при прохождении каждого FR/LSR-коммутатора.</p><h3 id="p5.7">5.7. Обработка маркеров потока выходными FR/LSR-коммутаторами</h3><p>Когда FR-кадр достигает конечной точки LSP-маршрута, FR/LSR-коммутатор удаляет набор маркеров. Если удалённый маркер был последним маркером, то необходимо определить соответствующий протокол сетевого уровня, пакет которого транслировался по LSP-маршруту. Набор маркеров не содержит информации в явной форме, по которой можно определить протокол сетевого уровня. Это должно следовать из значения маркера, который удаляется из набора маркеров.</p><p>Если удалённый маркер не был последним маркером, то предыдущее TTL-значение верхнего уровня набора MPLS-маркеров отображается в новой верхней записи этого набора.</p><p>Если FR/LSR-коммутатор является выходом сетевого FR-сегмента гибридного LSP-маршрута, и в тоже время конечная точка сетевого FR-сегмента не является конечной точкой LSP-маршрута, то MPLS-пакет будет обработан на основе NHLFE-записи (Next Hop Label Forwarding Entry) с целью его дальнейшей доставки по следующему ретрансляционному участку LSP-маршрута (RFC-3031). Значение выходного маркера также извлекается из NHLFE-записи, а TTL-значение MPLS-системы уменьшается на соответствующую величину, зависящую от выходного интерфейса или типа ретрансляционной процедуры. Далее MPLS-пакет доставляется в соответствие с MPLS-требованиями для конкретного канала связи следующего ретрансляционного участка (сетевого сегмента) LSP-маршрута.</p><p>Для IP-пакетов с однонаправленными адресами, TTL-значение в MPLS-системах должно уменьшаться на единицу, если выходной интерфейс является универсальным MPLS-интерфейсом, или на число ретрансляционных участков следующего сетевого ATM-сегмента неоднородного LSP-маршрута, если выходной интерфейс является ATM-интерфейсом, не контролирующим TTL-поле (non-TTL).</p><p>Для IP-пакетов с групповой адресацией, TTL-значение в MPLS-системах должно уменьшаться на число ретрансляционных участков сетевого FR-сегмента, являющегося выходным. Программный LDP-модуль, отвечающий за формирование LSP-маршрута, обязан направлять выходному FR/LSR-коммутатору всю необходимую информацию, касающуюся числа ретрансляционных участков сетевого FR-сегмента, не контролирующего TTL-поле.</p><h2 id="p6">6. Модуль MPLS-управления для FR-сетей</h2><p>Для обеспечения MPLS-коммутации FR-коммутатор обязан иметь встроенный модуль управления MPLS-коммутацией, который, в первую очередь, реализует процедуры распределения (размещения) и обработки маркеров потока. Информация о привязке маркера может быть доставлена несколькими способами, одним из которых является протокол распределения маркеров потока (Label Distribution Protocol, LDP, RFC-3036 / RFC-5036).</p><p>Так как модуль управления MPLS-коммутацией использует информацию, которая напрямую поступает от программных модулей маршрутизации сетевого уровня, это предполагает, что коммутатор выступает одной из сторон при информационном взаимодействии в соответствие с такими протоколами (например, OSPF, IS-IS).</p><p>В отдельных случаях LSR-маршрутизаторы могут использовать и другие протоколы (например, RSVP, PIM, BGP) для распространения данных о привязках маркеров. В таких случаях FR/LSR-коммутатор должен участвовать в процедурах информационного взаимодействия, реализуемых в соответствие с такими протоколами.</p><p>В случае, когда FR-соединения формируются с помощью, либо LDP-протокола, либо RSVP-протокола, либо иного протокола, без использования обычных FR-способов, предполагается, что согласуемая информация при формировании соединения (например, максимальный размер входного/выходного кадра, запрашиваемое/подтверждаемое значение входной/выходной пропускной способности, доступное значение входной/выходной пропускной способности, входное/выходное значение фрагментации, входная/выходная скорость передачи кадров), используемая в последующем при передаче, и данные для управления перегрузками могут доставляться FR/LSR-коммутаторам с помощью процедур информационного обмена, реализуемых в соответствие с RSVP-протоколом. С учётом сказанного выше, считается, что FR-соединения могут формироваться и в статическом режиме. Также предполагается, что управление перегрузками и маркирование заголовка кадра, как результат перегрузки, могло бы осуществляться FR/LSR-коммутаторами в таком же режиме, как и при обычных FR-соединениях. С целью имитации наилучшего функционирования маршрутизатора в режиме «по умолчанию», т.е. параметров виртуального соединения в режиме «по умолчанию», при отсутствии LDP- и RSVP-модулей, либо иных средств, участвующих в настройке необходимых параметров, целесообразно, чтобы значение «CIR» (Committed Information Rate, согласованная скорость передачи информации) было нулевым, вследствие чего входной модуль управления будет устанавливать бит «DE» в значение «1» в принимаемых кадрах, но не уничтожать эти кадры.</p><p>Данные управления и о состоянии соединений, основанных на MPLS-коммутации, могут доставляться с помощью LDP-протокола.</p><p>Обеспечение MPLS-коммутации FR-коммутатором требует согласования только кадровой синхронизации, процедуры бит-стаффинга, формата заголовков, алгоритма вычисления и длины поля проверочной суммы, исключая процедуры сигнализации по управлению PVC-соединением и настройку интерфейса локального управления и сигнализации (Local Management Interface — LMI). Система сигнализации, определяемая Рекомендацией ITU-T Q.933, для PVC- и/или SVC-соединений (Switched Virtual Circuit, коммутируемое виртуальное соединение) также не требуется. Система сигнализации для PVC- и/или SVC-соединений может использоваться для PVC- и/или SVC-соединений, не предназначенных для MPLS-коммутации (стандартная FR-коммутация), когда обе системы реализованы на одном и том же MPLS-интерфейсе.</p><h3 id="p6.1">6.1. Гибридные коммутаторы (корабли в ночи, «Ships in the Night»)</h3><p>Наличие в FR-коммутаторе модуля MPLS-управления не устраняет возможности применения модуля FR-управления, описание которого представлено в международных стандартах ITU-T и FRF (Frame Relay Forum). Два модуля MPLS- и FR-управления могут функционировать независимо.</p><p>Однако чтобы обеспечить совместимость этих двух модулей, необходим всего лишь небольшой объём информации, например, данные о разбиении DLCI-диапазона на поддиапазоны, доступные для каждого из этих модулей.</p><h2 id="p7">7. Процедуры распределения и обработки маркеров</h2><p>Процедурная и логическая характеристики LDP-протокола представлены в RFC-3031 и RFC-3036 (RFC-5036). Рассматриваемый ниже способ распределения и обработки маркера «нисходящий поток по требованию» (downstream-on-demand) должен использоваться FR/LSR-коммутаторами, которые не поддерживают функцию слияния (объединения) VC-соединений (этот способ используется для доставки трафика с поузловой маршрутизацией).</p><h3 id="p7.1">7.1. Функционирование граничного LSR-маршрутизатора</h3><p>Рассмотрим функционирование граничного LSR-маршрутизатора из группы граничных LSR-маршрутизаторов, входящих в сетевой FR/LSR-сегмент. Предположим, что в результате его маршрутных вычислений он выбрал FR/LSR-коммутатор в качестве следующего ретрансляционного участка некоторого маршрута (FEC-класс), и что следующий ретрансляционный участок подключён через LC/FR-интерфейс. Будем считать, что на противоположной стороне следующего ретрансляционного участка расположен FR/LSR-коммутатор, который является участником (одной из сторон) информационного взаимодействия по LDP-протоколу (LDP-peer). Граничный LSR-маршрутизатор отправляет LDP-запрос (request) LSR<sub>НП</sub> для привязки маркера к следующему ретрансляционному участку. Когда этот граничный LSR-маршрутизатор получает ответ от LSR<sub>НП</sub> (LDP-сообщение «отображение», mapping), в котором содержится информация о привязке маркера, он сохраняет маркер в соответствующей БД (Label Information Base, LIB) в качестве выходного маркера для данного FEC-класса. Принятое LDP-сообщение «отображение» может включать поле «счётчик ретрансляционных участков», содержащее число ретрансляционных участков, на которое следует уменьшить TTL-значение после прохождения IP-пакетом сетевого FR/LSR-сегмента до выходного FR/LSR-коммутатора при использовании данного маркера. Такая информация может храниться для последующих расчётов TTL-значений. После того, как всё это будет выполнено, LSR-маршрутизатор может использовать MPLS-коммутацию для трансляции IP-пакетов данного FEC-класса.</p><p>Когда граничный LSR-маршрутизатор из группы граничных LSR-маршрутизаторов, входящих в сетевой FR/LSR-сегмент, получает LDP-запрос от FR/LSR-коммутатора в интересах определённого FEC-класса, это означает, что данный граничный LSR-маршрутизатор является выходным FR/LSR-коммутатором. По получении LDP-запроса, он формирует и сохраняет маркер, т.е. делает новую запись в своей LIB-базе и помещает в неё (в специальное поле «входящий маркер») этот маркер. После этого, данный LSR-маршрутизатор отправляет ответное LDP-сообщение («отображение»), содержащее сформированный маркер, назад по направлению восходящего потока противоположной стороне сквозного LDP-соединения, передавшей запрос. Ответное LDP-сообщение («отображение») содержит поле «счётчик ретрансляционных участков» со значением «1»</p><p>Когда в результате маршрутизационных вычислений граничному LSR-маршрутизатору необходимо изменить следующий ретрансляционный участок маршрута, а предыдущий ретрансляционный участок находился в сетевом FR/LSR-сегменте, граничный LSR-маршрутизатор должен оповестить противоположную сторону предыдущего ретрансляционного участка (с помощью LDP-сообщения «разъединение», release), что данные о привязке маркера, относительно данного маршрута, больше не нужны.</p><p>Когда FR/LSR-коммутатор получает LDP-запрос (сообщение «запрос») в интересах определённого маршрута (FEC-класса) от противоположной стороны LDP-соединения, установленного с этим FR/LSR-коммутатором через LC/FR-интерфейс, тогда FR/LSR-коммутатор выполняет следующие действия:</p><ul class="list lia"><li><p>Формирует и сохраняет маркер, т.е. делает новую запись в своей LIB-базе и помещает в неё (в специальное поле «входящий маркер») этот маркер;</p></li><li><p>Направляет LDP-сообщение «запрос» LSR-маршрутизатору, расположенному на противоположной стороне следующего ретрансляционного участка, по направлению нисходящего потока для данного маршрута (FEC-класса).</p></li></ul><p>В режиме «регулируемого управления LSP-маршрутом» (RFC-3031) FR/LSR-коммутатор будет ожидать команду на отправку своего «запроса», на который он в последствие получит ответ от LSR<sub>НП</sub>, содержащий сообщение «отображение», прежде чем отправит ответное сообщение «отображение» LSR<sub>ВП</sub> на запрос последнего. В данном случае FR/LSR-коммутатор уменьшит на единицу число ретрансляционных участков, полученное от LSR<sub>НП</sub>, и будет использовать это значение в ответных сообщениях «отображение», направляемых LSR<sub>ВП</sub>.</p><p>В качестве альтернативы, FR/LSR-коммутатор может направить LSR<sub>ВП</sub> данные о привязке маркера, не дожидаясь получения данных о привязке маркера от LSR<sub>НП</sub> (режим «управления LSP-маршрутом»). В этом случае, FR/LSR-коммутатор использует зарезервированное значение числа ретрансляционных участков в отправляемом сообщении «отображение», указывая в последнем, что это число ему не известно. Корректное значение числа ретрансляционных участков будет отправлено позднее, как это определено ниже.</p><p>Так как оба режима управления LSP-маршрутом (регулируемое и независимое) имеют свои преимущества и недостатки, то право выбор режима остаётся за конкретной реализацией системы или субъектом настройки параметров системы.</p><p>После того, как FR/LSR-коммутатор получит от противоположной стороны следующего ретрансляционного участка ответное LDP-сообщение («отображение»), он размещает маркер потока в специальном поле «исходящий маркер» LIB-записи.</p><p>Следует заметить, что FR/LSR-коммутатор или граничный LSR-маршрутизатор из группы граничных LSR-маршрутизаторов, входящих в сетевой FR/LSR-сегмент, может получить несколько запросов на данные о привязке для одного и того же маршрута (FEC-класса) от одного и того же FR/LSR-коммутатора. Тогда он должен сформировать новое ответное сообщение «отображение» с маркером потока для каждого запроса (полагая, что для этого достаточно ресурсов) и сохранить любой(ые) существующей(ие) маркер(ы) потока. Также целесообразно, чтобы FR/LSR-коммутатор для каждого полученного запроса сформировал новый запрос на данные о привязке к следующему ретрансляционному участку маршрута (FEC-класса).</p><p>Когда в результате маршрутизационных вычислений FR/LSR-коммутатору необходимо изменить следующий ретрансляционный участок маршрута (FEC-класса), FR/LSR-коммутатор должен оповестить противоположную сторону предыдущего ретрансляционного участка (с помощью LDP-сообщения «разъединение»), что данные о привязке маркера, относительно данного маршрута, больше не нужны.</p><p>Когда LSR-маршрутизатор получает извещение о том, что соответствующие данные о привязке маркера больше не нужны, он может открепить маркер от FEC-класса, а саму привязку уничтожить. Этот режим называется «консервативным режимом сохранения маркера потока» (conservative label retention mode, RFC-3031). Там, где LSR-маршрутизатор получает извещение и уничтожает привязку, ему целесообразно оповестить противоположную сторону следующего ретрансляционного участка, что данные о привязке маркера больше не нужны. Если же LSR-маршрутизатор не уничтожает привязку маркера потока (FR/LSR-коммутатор функционирует в «свободном режиме сохранения маркера потока», liberal label retention mode), то он может повторно использовать эту привязку, но только тогда, когда он получит запрос относительно одного и того же маршрута и с одним и тем же значением счётчика ретрансляционных участков, как если бы он получил запрос от противоположной стороны ретрансляционного участка на формирование привязки маркера потока.</p><p>При изменении маршрута, привязки маркеров потока должны повторно формироваться, причём с той точки, в которой «уклонился» от предыдущего маршрута. LSR<sub>ВП</sub> в такой точке «не обращает внимание» на произошедшее изменение (за одним исключением, рассмотренным ниже). Всякий раз, когда LSR-маршрутизатор изменяет свой следующий ретрансляционный участок соответствующего маршрута, и если на его противоположной стороне размещён FR/LSR-коммутатор или граничный LSR-маршрутизатор из группы граничных LSR-маршрутизаторов, подключённый через LC/FR-интерфейс, то для каждой своей LIB-записи, относящейся к маршруту, LSR-маршрутизатор должен отправить запрос (используя LDP-соединение) на получение данных о привязке от противоположной стороны нового ретрансляционного участка.</p><p>Когда FR/LSR-коммутатор получает данные о привязке маркера от соседнего LSR<sub>НП</sub>, он возможно уже имеет подготовленный соответствующий маркер для данного маршрута до соседнего LSR<sub>ВП</sub>. Это может быть следствием, либо того, что FR/LSR-коммутатор функционирует в режиме независимого управления LSP-маршрутом, либо того, что данные о новой привязке маркера, полученные от LSR<sub>НП</sub>, являются результатом изменения маршрута. В таком случае, целесообразно извлечь из данных о новой привязке маркера значение счётчика ретрансляционных участков и увеличить его на единицу. Если новое значение счётчика ретрансляционных участков отличается от того, которое было ранее отправлено соседнему LSR<sub>ВП</sub> (включая случай, когда соседний LSR<sub>ВП</sub> получил значение «не известно»), FR/LSR-коммутатор обязан сообщить об этом изменении соседнему LSR<sub>ВП</sub>. Каждый FR/LSR-коммутатор в последовательности LSP-маршрута увеличивает значение счётчика ретрансляционных участков и отправляет его LSR<sub>ВП</sub>, причём до тех пор, пока оно не достигнет входного граничного LSR-маршрутизатора.</p><p>Всякий раз, когда FR/LSR-коммутатор направляет запрос на данные о привязке маркера LSR-маршрутизатора на противоположной стороне следующего ретрансляционного участка, вследствие приёма запроса на данные о привязке маркера от другого LSR<sub>ВП</sub>, и этот отправленный LSR-маршрутизатору на противоположной стороне следующего ретрансляционного участка не был удовлетворён, FR/LSR-коммутатор, в ответ на принятый запрос, должен уничтожить сформированную привязку и проинформировать об этом запрашивающую сторону, используя для этого LDP-сообщение «изъятие» (withdraw).</p><p>Когда LSR-маршрутизатор установит, что LDP-соединение с другим LSR-маршрутизатором прервано, он выполняет следующие действия:</p><ul class="list lia"><li><p>Обязан уничтожить любые данные о привязке, полученные по этому соединению;</p></li><li><p>Любые данные о привязках маркеров, которые были сформированы в результате приёма запросов на данные о привязках маркеров от противоположной стороны соединения, могут быть уничтожены LSR-маршрутизатором (последний также может открепить маркеры от FEC-классов, связанные с этими привязками).</p></li></ul><h3 id="p7.2">7.2. Эффективное использование диапазона маркеров — функция слияния, реализуемая FR/LSR-коммутаторами</h3><p>В предыдущем параграфе <a href="print#p7.1" title="параграф 7.1 - Функционирование граничного LSR-маршрутизатора">7.1</a> предполагалось, что граничный LSR-маршрутизатор будет запрашивать по одному маркеру потока для каждого префикса из своей маршрутной таблицы, который отображает следующий ретрансляционный участок в сетевом FR/LSR-сегменте. Фактически, имеется возможность существенно уменьшить необходимое число маркеров за счёт использования одного маркера для нескольких маршрутов вместо запроса граничного LSR-маршрутизатора. Использование сходящихся (many-to-one) отображений между маршрутами (префиксы IP-адресов) и маркерами на основе эквивалентных классов доставки<sup><abbr title="Несколько маршрутов объединяются в один FEC-класс, которому присваивается собственный маркер потока.">[?]</abbr></sup> (Forwarding Equivalence Classes, FEC-классы) позволяет (представляет собой способ) уменьшить/сохранить число используемых маркеров.</p><p>Следует заметить, что уменьшение диапазона маркеров (объединение VC-соединений) может быть ограничено в том случае, когда последовательность кадров (трафик) требует FR-фрагментации. Проблема в том, что FR-фрагменты должны передаваться последовательно, т.е. фрагменты разных кадров не должны быть перемежающимися. Если FR/LSR-коммутатор, реализующий функцию фрагментации, гарантирует, что передача последовательности всех фрагментов кадра будет осуществляться без перемежения с фрагментами других кадров, то можно говорить об уменьшении (сохранении) числа маркеров (объединение VC-соединений).</p><p>Если реализуется способ уменьшения (сохранения) числа маркеров, и если FR/LSR-коммутатор получает запрос на данные о привязке маркера от для соответствующего FEC-класса и он уже имеет привязку исходящего маркера для этого же FEC-класса, то ему нет необходимости направлять LSR<sub>НП</sub> запрос на данные о привязке. Вместо этого, FR/LSR-коммутатор может зафиксировать (разместить в своей LIB-базе) входящий маркер и отправить этот маркер в составе сообщения о привязке обратно LSR<sub>ВП</sub>, который прислал запрос. IP-пакеты, принятые от LSR<sub>ВП</sub>, который присылал запрос, и содержащие маркер на верхнем уровне набора маркеров, будут доставляться дальше после замены этого маркера на существующий исходящий маркер для данного FEC-класса. Если FR/LSR-коммутатор не обладает исходящим маркером, привязанным к данному FEC-классу, но имеет неисполненный запрос для этого FEC-класса, то ему нет необходимости отправлять другой запрос. Это означает, что в случае уменьшения (сохранения) числа маркеров, FR/LSR-коммутатор обязан отправить ответ, содержащий данные о новой привязке маркера, на каждый запрос от LSR<sub>ВП</sub>, но ему может понадобиться передать LSR<sub>НП</sub> всего лишь один запрос на данные о привязке.</p><p>В случае уменьшения (сохранения) числа маркеров, и если изменения в маршрутной таблице «вынуждают» FR/LSR-коммутатор выбрать новый ретрансляционный участок для одного из своих FEC-классов, то он может удалить привязку этого маршрута от «старого» ретрансляционного участка. Если же FR/LSR-коммутатор ещё не имеет данных о соответствующей привязке для нового ретрансляционного участка, то он обязан их запросить (необходимо заметить, что выбор нового ретрансляционного участка зависит от режима сохранения маркера потока, RFC-3031).</p><p>Если данные о новой привязке получены, и они включают значение счётчика ретрансляционных участков, отличающееся от значения в старых данных о привязке, то FR/LSR-коммутатор обязан выполнить следующие действия:</p><ul class="list lia"><li><p>Увеличить это значение на единицу, если оно не является «неизвестным»;</p></li><li><p>Уведомить о новом значении счётчика ретрансляционных участков соседние LSR<sub>ВП</sub>, которые имеют привязки маркеров для этого FEC-класса.</p></li></ul><p>Для обеспечения гарантированного обнаружения петлевых маршрутов, в случае, когда новое значение счётчика ретрансляционных участков превысило «максимальное» значение, соответствующие маркеры для данного FEC-класса должны быть отозваны у всех соседних LSR<sub>ВП</sub>, которым ранее высылались данные о привязке этих маркеров.</p><h3 id="p7.3">7.3. LDP-сообщения для FR-сетей</h3><p>LDP-сообщения, которыми обмениваются два FR/LSR-коммутатора, являющиеся взаимодействующими сторонами LDP-соединения, могут содержать специализированную информацию в интересах FR-сетей. К такой информации относится:</p><ol><li><p class="b">Диапазон FR-маркеров (Frame Relay Label Range)</p><div class="lia"><pre>| 0             6 | 7   8 | 9                                      31 |
+-----------------+-------+-------------------------------------------+
| Зарезервировано | Длина | Минимальное значение DLCI-идентификатора  |
+-----------------+-------+-------------------------------------------+
|     Зарезервировано     | Максимальное значение DLCI-идентификатора |
+-------------------------+-------------------------------------------+

Рис. 8. Формат блока данных «диапазон FR-маркеров»</pre><p>На рис. 8 представлен формат блока данных «диапазон FR-маркеров», который включает следующие поля:</p></div><ul class="list lia"><li><p class="b">«Зарезервировано»</p><p class="lia">Эти поля являются резервными. Они должны заполняться нулями при передаче и игнорироваться при приёме.</p></li><li><p class="b">«Длина»</p><p class="lia">Это поле определяет число бит DLCI-идентификатора. Оно может принимать следующие значения:</p><ol class="lat lia"><li>«0» — 10-битовый DLCI-идентификатор;</li><li>«2» — 23-битовый DLCI-идентификатор;</li><li>«1» и «3» — зарезервированы для будущего использования;</li></ol></li><li><p class="b">«Минимальное значение DLCI-идентификатора» (Minimum DLCI)</p><p class="lia">Это 23-битовое поле содержит двоичное значение нижней границы диапазона DLCI-идентификаторов, которое поддерживается FR/LSR-коммутатором. Минимальное значение DLCI-идентификатора должно правильно размещаться в этом поле, а все предшествующие биты должны быть нулевыми.</p></li><li><p class="b">«Максимальное значение DLCI-идентификатора» (Maximum DLCI)</p><p class="lia">Это 23-битовое поле содержит двоичное значение верхней границы диапазона DLCI-идентификаторов, которое поддерживается FR/LSR-коммутатором. Максимальное значение DLCI-идентификатора должно правильно размещаться в этом поле, а все предшествующие биты должны быть нулевыми.</p></li></ul></li></ol><ol start="2"><li><p class="b">Объединение VC-соединений в FR-сети (Frame Relay Merge)</p><div class="lia"><p>Данная информация необходима для определения функциональности FR/LSR-коммутатора: способен ли он объединять VC-соединения или нет.</p><pre>| 0             6 | 7 |
+-----------------+---+
| Зарезервировано | M |
+-----------------+---+

Рис. 9. Формат блока данных «объединение VC-соединений в FR-сети»</pre><p>На рис. 9 представлен формат блока данных «объединение VC-соединений в FR-сети», который включает следующие поля:</p></div><ul class="list lia"><li><p class="b">«Зарезервировано»</p><p class="lia">Это поле является резервными. Оно должно заполняться нулями при передаче и игнорироваться при приёме.</p></li><li><p class="b">«Объединение VC-соединений» («М»)</p><p class="lia">Это 1-битовое поле определяет функциональность FR/LSR-коммутатора. Оно может принимать следующие значения:</p><ol class="lat lia"><li>«0» — FR/LSR-коммутатор не способен объединять VC-соединения;</li><li>«1» — FR/LSR-коммутатор способен объединять VC-соединения;</li></ol></li><p class="lia">FR-LSR-коммутатор, который способен объединять VC-соединения, обязан гарантировать, что фрагментируемые кадры с входящими DLCI-идентификаторами не будут перемежаться на выходе с фрагментами кадров, имеющих иные исходящие DLCI-идентификаторы.</p></li><li><p class="b">Маркер в FR-сети (Frame Relay Label)</p><div class="lia"><pre>| 0             6 | 7   8 | 9                                      31 |
+-----------------+-------+-------------------------------------------+
| Зарезервировано | Длина |            DLCI-идентификатор             |
+-----------------+-------+-------------------------------------------+

Рис. 10. Формат блока данных «маркер в FR-сети»</pre><p>На рис. 10 представлен формат блока данных «маркер в FR-сети», который включает следующие поля:</p></div><ul class="list lia"><li><p class="b">«Зарезервировано»</p><p class="lia">Это поле является резервными. Оно должно заполняться нулями при передаче и игнорироваться при приёме.</p></li><li><p class="b">«Длина»</p><p class="lia">Это поле определяет число бит DLCI-идентификатора. Оно может принимать следующие значения:</p><ol class="lat lia"><li>«0» — 10-битовый DLCI-идентификатор;</li><li>«2» — 23-битовый DLCI-идентификатор;</li><li>«1» и «3» — зарезервированы для будущего использования;</li></ol></li><li><p class="b">«DLCI-идентификатор»</p><p class="lia">Это двоичная величина FR-маркера. Соответствующее число бит (10 или 23) значения маркера отображают DLCI-идентификатор, который является часть заголовка FR-кадра канального уровня (параграф <a href="print#p4" title="параграф 4 - Вставка маркеров потока">4</a>).</p></li></ul></li></ol><h2 id="p8">8. Проблемы обеспечения безопасности</h2><p>К наиболее важным проблемам обеспечения информационной безопасности относятся:</p><ol class="lat lia"><li><p>Безопасность потока кадров (FR-трафик).</p></li><li><p>Безопасность распределения маркеров потока.</p></li></ol><p>MPLS-вставка не влияет на аутентифицированные или зашифрованные пакеты сетевого уровня, т.е. IP-пакеты, которые были аутентифицированы или зашифрованы, не будут подвержены каким-либо изменениям.</p><p>MPLS-протокол не имеет каких-либо собственных средств для защиты от ложного перенаправления IP-пакетов или «маскарада», устроенного захваченного нарушителем LSR-маршрутизатором, вследствие возникновения нештатной ситуации или злого умысла.</p><p>Изменение информации вследствие нештатной ситуации или подделки существующего маркера в DLCI-поле заголовка FR-кадра, а также вследствие модификации одного или более полей, за которыми может следовать набор маркеров, приводит к нарушению доставки этого кадра.</p><p>Способ и средства распространения и доставки маркеров потока могут быть защищены на основе применения процедур аутентификации или шифрования на соответствующем уровне архитектуры безопасности по отношению к базовому протоколу, обеспечивающему доставку данные о маркерах потока (RFC-3036 / RFC-5036).</p><h2 id="p.references">Ссылки</h2><table itemprop="references"><tr><td>[MIFR]</td><td>Bradley, T., Brown, C. и A. Malis, <a href="../2427.rfc" title="RFC 2427 — Многопротокольные соединения через Frame Relay">«Многопротокольные соединения через Frame Relay», RFC 2427</a>, Сентябрь 1998.</td></tr><tr><td>[ARCH]</td><td>Rosen, E., Callon, R. и A. Vishwanathan, <a href="../3031.rfc" title="RFC 3031 — Архитектура многопротокольной коммутации на основе маркеров потока (MPLS)">«Архитектура многопротокольной коммутации на основе маркеров потока (MPLS)», RFC 3031</a>, Январь 2001.</td></tr><tr><td>[LDP]</td><td>Andersson, L., Doolan, P., Feldman, N., Fredette, A. и R. Thomas, «Label Distribution Protocol», RFC 3036, Январь 2001.</td></tr><tr><td>[STACK]</td><td>Rosen, E., Rehter, Y., Tappan, D., Farinacci, D., Fedorkow, G., Li, T. и A. Conta, <a href="../3032.rfc" title="RFC 3032 — Кодирование набора маркеров в MPLS-системах">«Кодирование набора маркеров в MPLS-системах», RFC 3032</a>, Январь 2001.</td></tr><tr><td>[ATM]</td><td>Davie, B., Lawrence, J., McCloghrie, M., Rosen, E., Swallow, G., Rekhter, Y., and P. Doolan, <a href="../3035.rfc" title="RFC 3035 — Применение MPLS-коммутации в сетях с асинхронным режимом доставки">«Применение MPLS-коммутации в сетях с асинхронным режимом доставки», RFC 3035</a>, Январь 2001.</td></tr><tr><td>[ITU]</td><td>International Telecommunications Union, «ISDN Data Link Layer Specification for Frame Mode Bearer Services», ITU-T Recommendation Q.922, 1992.</td></tr><tr><td>[FRF]</td><td>Frame Relay Forum, User-to-Network Implementation Agreement (UNI), FRF 1.1, Январь 19, 1996.</td></tr></table></div></div><div id="disqus_thread"></div><script type="text/javascript">var disqus_shortname="rfc2",disqus_title="RFC 3034 - Применение MPLS-коммутации в сетях с ретрансляцией кадров",disqus_identifier="3034.rfc",disqus_url="http://rfc2.ru/3034.rfc";(function(){var dsq=document.createElement("script");dsq.type="text/javascript";dsq.async=true;dsq.src = "//"+disqus_shortname+".disqus.com/embed.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(dsq);})();</script><div class="bubble">2007 - 2014 © <a href="../index.html" title="Русские переводы RFC">Русские переводы RFC</a>, IETF, ISOC.</div></div><div id="bottom" style="position:static !important;bottom:auto !important"><div class="bubble"><ul><li><!--723572853672--></li></ul></div></div><!-- Yandex.Metrika counter --><script type="text/javascript">(function (d, w, c) { (w[c] = w[c] || []).push(function() { try { w.yaCounter4680559 = new Ya.Metrika({id:4680559, webvisor:true, clickmap:true, accurateTrackBounce:true, trackHash:true, ut:"noindex"}); } catch(e) { } }); var n = d.getElementsByTagName("script")[0], s = d.createElement("script"), f = function () { n.parentNode.insertBefore(s, n); }; s.type = "text/javascript"; s.async = true; s.src = (d.location.protocol == "https:" ? "https:" : "http:") + "//mc.yandex.ru/metrika/watch.js"; if (w.opera == "[object Opera]") { d.addEventListener("DOMContentLoaded", f, false); } else { f(); } })(document, window, "yandex_metrika_callbacks");</script><noscript><div><img src="http://mc.yandex.ru/watch/4680559?ut=noindex" style="position:absolute; left:-9999px;" alt="" /></div></noscript><!-- /Yandex.Metrika counter --></body></html>